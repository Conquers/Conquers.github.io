<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wtt&#39;s Blog</title>
  
  
  <link href="http://conquers.github.io/atom.xml" rel="self"/>
  
  <link href="http://conquers.github.io/"/>
  <updated>2024-01-16T03:17:31.404Z</updated>
  <id>http://conquers.github.io/</id>
  
  <author>
    <name>wtt</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Latex å¸®åŠ©æ‰‹å†Œ</title>
    <link href="http://conquers.github.io/posts/a7415b86.html"/>
    <id>http://conquers.github.io/posts/a7415b86.html</id>
    <published>2024-01-08T01:51:59.000Z</published>
    <updated>2024-01-16T03:17:31.404Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LaTex-å¸®åŠ©æ‰‹å†Œ"><a href="#LaTex-å¸®åŠ©æ‰‹å†Œ" class="headerlink" title="LaTex å¸®åŠ©æ‰‹å†Œ"></a>LaTex å¸®åŠ©æ‰‹å†Œ</h1><blockquote><p>è¯¥æ–‡æ¡£æ—¨åœ¨å¸®åŠ©åƒæˆ‘ä¸€æ ·é›¶åŸºç¡€ï¼Œåªæƒ³æŒæ¡åŸºç¡€è¯­æ³•ï¼Œç¼–å†™ä¸€ä»½ <code>LaTex</code> æ ¼å¼çš„è®ºæ–‡ã€‚ </p><p>ç‰¹åˆ«åœ°ï¼Œå¦‚æœä½ ç°åœ¨æ­£è¦æŠ•ç¨¿ IEEE çš„æœŸåˆŠï¼Œé‚£ä¹ˆå¯ä»¥å‚è€ƒä¸€ä¸‹é—®é¢˜éƒ¨åˆ†ï¼Œåº”è¯¥æœ‰ç±»ä¼¼çš„é—®é¢˜ï¼</p><p>æ›´è¯¦ç»†çš„å…¥é—¨æ–‡æ¡£ï¼Œå¯ä»¥å‚è€ƒï¼š</p><ul><li><a href="https://oi-wiki.org/tools/latex/">LaTeX å…¥é—¨ - OI Wiki (oi-wiki.org)</a></li><li>æˆ–å…¶ä»–å…¥é—¨æ•™ç¨‹</li></ul></blockquote><h2 id="å¥½å¸®æ‰‹â­"><a href="#å¥½å¸®æ‰‹â­" class="headerlink" title="å¥½å¸®æ‰‹â­"></a>å¥½å¸®æ‰‹â­</h2><p><strong>å…¬å¼</strong>åœ¨çº¿é¢„è§ˆ + å¸¸ç”¨ç¬¦å·</p><p><a href="https://www.latexlive.com/">https://www.latexlive.com/</a></p><p><strong>è¡¨æ ¼</strong>åœ¨çº¿ç”Ÿæˆ</p><p><a href="https://www.tablesgenerator.com/">Create LaTeX tables online â€“ TablesGenerator.com</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li><p>åœ¨çº¿ç¼–å†™ï¼Œè¯·ç™¾åº¦æœç´¢ Overleaf</p></li><li><p>åœ¨æœ¬åœ°ç¼–å†™ LaTex æ–‡ä»¶ï¼Œéœ€è¦å®‰è£… texliveï¼ˆTeXå‘è¡Œç‰ˆï¼‰ + texstudioï¼ˆæ–‡æœ¬ç¼–è¾‘å™¨æˆ–å…¶ä»–ç¼–å†™å·¥å…·ï¼‰</p></li></ul><h3 id="texlive"><a href="#texlive" class="headerlink" title="texlive"></a>texlive</h3><p>texlive ä¸‹è½½åœ°å€ï¼š<a href="https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/">Index of &#x2F;CTAN&#x2F;systems&#x2F;texlive&#x2F;Images&#x2F; | æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror</a></p><p><img src="/./Resources/image-20240110203418348.png" alt="image-20240110203418348"></p><p>windows å®‰è£…æ–¹å¼ï¼šå®‰è£…åŒ…ä¸‹è½½å®Œåï¼Œæ‰“å¼€ä¸‹è½½åçš„å®‰è£…åŒ…ï¼ŒåŒå‡»è¿è¡Œ <code>install-tl-windows.bat</code> è€å¿ƒç­‰å¾…å®‰è£…ï¼Œä¸è¦ç‚¹ abortï¼Œä¸€ç›´ç­‰åˆ°å‡ºç°å®‰è£…å®Œæˆã€‚</p><h3 id="texstudio"><a href="#texstudio" class="headerlink" title="texstudio"></a>texstudio</h3><p>textstudio ä¸‹è½½åœ°å€ï¼š<a href="https://texstudio.sourceforge.net/">TeXstudio - A LaTeX editor (sourceforge.net)</a></p><p>ä»¥ä¸Šéƒ½å®‰è£…å®Œæˆåï¼Œå³å¯åœ¨ texstudio ä¸­ç¼–å†™ LaTex æ ¼å¼çš„æ–‡ä»¶ã€‚</p><h3 id="å¯é€‰é¡¹ï¼štexlive-vscode-git"><a href="#å¯é€‰é¡¹ï¼štexlive-vscode-git" class="headerlink" title="å¯é€‰é¡¹ï¼štexlive + vscode + git"></a>å¯é€‰é¡¹ï¼štexlive + vscode + git</h3><ol><li><p>åœ¨ vscode ä¸­ä¸‹è½½ LaTex Workshop æ’ä»¶</p><p><img src="/./Resources/image-20240111194053145.png" alt="image-20240111194053145"></p></li><li><p>åˆ›å»ºæ–‡æ¡£ã€ç¼–è¯‘åŠæŸ¥çœ‹</p></li></ol><p><img src="/./Resources/image-20240111203024493.png" alt="image-20240111203024493"></p><ol start="3"><li>åœ¨åŒçº§ç›®å½•åˆ›å»º git ä»“åº“</li></ol><h3 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h3><p>Mac ä¸‹è½½ Tex å‘è¡Œç‰ˆåœ°å€ï¼š<a href="https://tug.org/mactex/">MacTeX - TeX Users Group (tug.org)</a></p><p>å…¶ä»–çš„å¯ä»¥å‚è€ƒ Windows å®‰è£…ã€‚</p><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h2><p>åˆ›å»ºä¸€ä¸ª .tex æ–‡ä»¶</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\documentclass</span>&#123;article&#125;<br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br>hello world<br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><p><img src="/./Resources/image-20240110204200926.png" alt="image-20240110204200926"></p><h2 id="æœ‰åºåˆ—è¡¨"><a href="#æœ‰åºåˆ—è¡¨" class="headerlink" title="æœ‰åºåˆ—è¡¨"></a>æœ‰åºåˆ—è¡¨</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;enumerate&#125;<br>    <span class="hljs-keyword">\item</span><br>    <span class="hljs-keyword">\item</span><br><span class="hljs-keyword">\end</span>&#123;enumerate&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æœ‰åºåˆ—è¡¨çš„å½¢å¼ä¸ºï¼š</p><p><img src="/./Resources/image-20240108201306391.png" alt="image-20240108201306391"></p><p>å¦å¤–ï¼Œå¯ä»¥åœ¨ <code>\item</code> åé¢ä½¿ç”¨ä¸­æ‹¬å·å‘½ä»¤æ¥ä¿®æ”¹æ ·å¼, æ¯”å¦‚</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;enumerate&#125;<br>    <span class="hljs-keyword">\item</span>[1.]<br>    <span class="hljs-keyword">\item</span>[2.]<br><span class="hljs-keyword">\end</span>&#123;enumerate&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæœ‰åºåˆ—è¡¨çš„å½¢å¼ä¸ºï¼š</p><p><img src="/./Resources/image-20240108201410012.png" alt="image-20240108201410012"></p><h2 id="æ— åºåˆ—è¡¨"><a href="#æ— åºåˆ—è¡¨" class="headerlink" title="æ— åºåˆ—è¡¨"></a>æ— åºåˆ—è¡¨</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;itemize&#125;<br>    <span class="hljs-keyword">\item</span> 1<br>    <span class="hljs-keyword">\item</span> 2<br><span class="hljs-keyword">\end</span>&#123;itemize&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œæ— åºåˆ—è¡¨çš„å½¢å¼ä¸ºï¼š</p><p><img src="/./Resources/image-20240109195240607.png" alt="image-20240109195240607"></p><h2 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;equation&#125;<br>   x = 1 <br><span class="hljs-keyword">\end</span>&#123;equation&#125;<br></code></pre></td></tr></table></figure><p><img src="/./Resources/image-20240110204222127.png" alt="image-20240110204222127"></p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ä½¿ç”¨ BibTeX</p><p>åœ¨ .tex åŒçº§ç›®å½•ä¸‹ï¼Œåˆ›å»º .bib æ–‡ä»¶</p><p><img src="/./Resources/image-20240110205206895.png" alt="image-20240110205206895"></p><p>åœ¨ .tex æ–‡æ¡£æœ€åï¼Œ <code>\end&#123;document&#125;</code> å‰ï¼ŒåŠ å…¥ä¸‹é¢çš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lat">\bibliographystyle&#123;IEEEtran&#125;<br>\bibliography&#123;ref&#125;<br></code></pre></td></tr></table></figure><p>å°†å¼•ç”¨æ–‡ç« çš„ BibTeX æ ¼å¼ï¼Œæ·»åŠ åˆ° ref.bib æ–‡ä»¶ä¸­</p><p><img src="/./Resources/image-20240110205221506.png" alt="image-20240110205221506"></p><p>å®ç°æ•ˆæœå¦‚ä¸‹</p><p><img src="/./Resources/image-20240110205302190.png" alt="image-20240110205302190"></p><p>å¦‚æœå‚è€ƒæ–‡çŒ®æ˜¾ç¤ºé—®å·æˆ–è€…ä¸æ˜¾ç¤ºå‚è€ƒæ–‡çŒ®ï¼Œå‚è€ƒé—®é¢˜ï¼š<a href="https://conquers.github.io/posts/a7415b86.html#citation-undefined">Latex å¸®åŠ©æ‰‹å†Œ - wttâ€™s Blog</a></p><h2 id="å›¾ç‰‡è£å‰ª"><a href="#å›¾ç‰‡è£å‰ª" class="headerlink" title="å›¾ç‰‡è£å‰ª"></a>å›¾ç‰‡è£å‰ª</h2><p>å°† visio ä¸­å¯¼å‡ºçš„ pdf æ”¾å…¥ LaTex ä¸­ï¼Œpdf ä¸Šä¸‹ç™½è‰²éƒ¨åˆ†å¤ªå¤§çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè£å‰ª</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\begin</span>&#123;figure*&#125;[htbp]<br>  <span class="hljs-keyword">\centering</span><br>  <span class="hljs-comment">% scale æ˜¯åŸå›¾çš„å¤šå°‘å€ï¼Œtrim å¯¹åº”çš„ä½ç½®åˆ†åˆ«æ˜¯left bottom right up</span><br>   <span class="hljs-keyword">\includegraphics</span>[scale=0.75,trim=200 200 200 300]&#123;fig.pdf&#125;<br>     <span class="hljs-keyword">\caption</span>&#123;fig&#125;<br>  <span class="hljs-keyword">\label</span>&#123;fig&#125;<br><span class="hljs-keyword">\end</span>&#123;figure*&#125;<br></code></pre></td></tr></table></figure><h2 id="å›¾ç‰‡çš„-label-å±…ä¸­"><a href="#å›¾ç‰‡çš„-label-å±…ä¸­" class="headerlink" title="å›¾ç‰‡çš„ label å±…ä¸­"></a>å›¾ç‰‡çš„ label å±…ä¸­</h2><p>åœ¨å¯¼è¨€åŒºæ·»åŠ å¦‚ä¸‹è¯­å¥</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\usepackage</span>[justification=centering]&#123;caption&#125;<br></code></pre></td></tr></table></figure><h2 id="è¡¨æ ¼è°ƒæ•´å¤§å°"><a href="#è¡¨æ ¼è°ƒæ•´å¤§å°" class="headerlink" title="è¡¨æ ¼è°ƒæ•´å¤§å°"></a>è¡¨æ ¼è°ƒæ•´å¤§å°</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\renewcommand</span>&#123;<span class="hljs-keyword">\arraystretch</span>&#125;&#123;1.5&#125;<br></code></pre></td></tr></table></figure><p>è°ƒæ•´ä¸º 1.5 å€ï¼Œå¦‚æœä¸å¤Ÿç”¨ï¼Œå‚è€ƒæ›´è¯¦ç»†çš„è°ƒæ•´æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/xovee/article/details/126026878">LaTeX è°ƒæ•´è¡Œè·ã€åˆ—å®½ï¼Œä»¥åŠè¡¨æ ¼çš„æ•´ä½“å¤§å°å’Œå­—ä½“å¤§å°_latexè°ƒæ•´è¡¨æ ¼å¤§å°-CSDNåšå®¢</a></p><h2 id="ä½œè€…ä¿¡æ¯æ’ç‰ˆ"><a href="#ä½œè€…ä¿¡æ¯æ’ç‰ˆ" class="headerlink" title="ä½œè€…ä¿¡æ¯æ’ç‰ˆ"></a>ä½œè€…ä¿¡æ¯æ’ç‰ˆ</h2><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><p>ä¿®æ”¹ texlive ä¸‹ <code>IEEEtran.cls</code> æ–‡ä»¶ä¸­ä¸‹åˆ—ä¿¡æ¯ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´æ•°å­—ï¼Œè¿™é‡Œæ˜¯æŠŠ4æ”¹æˆäº†1</p><p>æ–‡ä»¶ä½ç½®ä¸ºï¼š<code>texlive/2023/texmf-dist/tex/latex/ieeetran/IEEEtran.cls</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-\def\@IEEEBIOskipN&#123;4\baselineskip&#125;% nominal value of the vskip above the biography</span><br><br><span class="hljs-addition">+\def\@IEEEBIOskipN&#123;1.2\baselineskip&#125;% nominal value of the vskip above the biography</span><br></code></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p>åœ¨ä¸¤ä¸ªä½œè€…ä¿¡æ¯ä¹‹é—´åŠ ä¸Š <code>\vspace&#123;-100 pt&#125;</code></p><p>æ³¨æ„æ˜¯ <code>\end&#123;*IEEEbiography*&#125;</code> å‰ï¼Œ<code>\end&#123;*IEEEbiography*&#125;</code>å</p><h3 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a>æ–¹æ³•ä¸‰</h3><p>å¦‚æœä½œè€…æ˜¯å•ç‹¬çš„ä¸€é¡µï¼Œä¸”æ€ä¹ˆå°è¯•æ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒéƒ½ä¸è¡Œï¼Œå¯ä»¥æŠŠä½œè€…æ”¹æˆåŒåˆ—</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯å››ä¸ªä½œè€…ï¼Œå°†å››ä¸ªä½œè€…åˆ†åˆ«æ”¾å·¦è¾¹ä¸¤ä¸ªï¼Œå³è¾¹ä¸¤ä¸ªã€‚å†ä½¿ç”¨ <code>\vspace</code> è°ƒæ•´é—´è·</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\documentclass</span>[lettersize,journal]&#123;IEEEtran&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;amsmath,amsfonts&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;algorithmic&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;algorithm&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;array&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;subfigure&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;textcomp&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;stfloats&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;url&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;verbatim&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;graphicx&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;cite&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;multirow&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;graphicx&#125;<br><span class="hljs-keyword">\usepackage</span>&#123;float&#125;<br><span class="hljs-keyword">\usepackage</span>[justification=centering]&#123;caption&#125;<br><span class="hljs-keyword">\hyphenation</span>&#123;op-tical net-works semi-conduc-tor IEEE-Xplore&#125;<br><span class="hljs-comment">% updated with editorial comments 8/9/2021</span><br><br><span class="hljs-keyword">\begin</span>&#123;document&#125;<br><br><span class="hljs-keyword">\begin</span>&#123;IEEEbiography&#125;[&#123;<span class="hljs-keyword">\includegraphics</span>[width=1in,height=1.25in,clip,keepaspectratio]&#123;author/avator.jpg&#125;&#125;]&#123;a&#125;<br>  <span class="hljs-keyword">\vspace</span>&#123;-450 pt&#125;<br><span class="hljs-keyword">\end</span>&#123;IEEEbiography&#125;<br><br><br><span class="hljs-keyword">\begin</span>&#123;IEEEbiography&#125;[&#123;<span class="hljs-keyword">\includegraphics</span>[width=1in,height=1.25in,clip,keepaspectratio]&#123;author/avator.jpg&#125;&#125;]&#123;b&#125;<br><span class="hljs-keyword">\end</span>&#123;IEEEbiography&#125;<br><span class="hljs-keyword">\newpage</span><br><br><span class="hljs-keyword">\begin</span>&#123;IEEEbiography&#125;[&#123;<span class="hljs-keyword">\includegraphics</span>[width=1in,height=1.25in,clip,keepaspectratio]&#123;author/avator.jpg&#125;&#125;]&#123;c&#125;<br>  <span class="hljs-keyword">\vspace</span>&#123;-450 pt&#125;<br><span class="hljs-keyword">\end</span>&#123;IEEEbiography&#125;<br><br><br><span class="hljs-keyword">\begin</span>&#123;IEEEbiography&#125;[&#123;<span class="hljs-keyword">\includegraphics</span>[width=1in,height=1.25in,clip,keepaspectratio]&#123;author/avator.jpg&#125;&#125;]&#123;d&#125;<br><span class="hljs-keyword">\end</span>&#123;IEEEbiography&#125;<br><br><span class="hljs-keyword">\end</span>&#123;document&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/./Resources/image-20240116111623748.png" alt="image-20240116111623748"></p><h3 id="å¯æ ¹æ®å®é™…éœ€è¦è‡ªç”±ç»„åˆæ–¹æ³•ä¸€ã€äºŒã€ä¸‰"><a href="#å¯æ ¹æ®å®é™…éœ€è¦è‡ªç”±ç»„åˆæ–¹æ³•ä¸€ã€äºŒã€ä¸‰" class="headerlink" title="å¯æ ¹æ®å®é™…éœ€è¦è‡ªç”±ç»„åˆæ–¹æ³•ä¸€ã€äºŒã€ä¸‰"></a>å¯æ ¹æ®å®é™…éœ€è¦è‡ªç”±ç»„åˆæ–¹æ³•ä¸€ã€äºŒã€ä¸‰</h3><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="å¯¼å…¥äº†-subfigureï¼Œä½†æ˜¯ç¼–è¯‘æŠ¥é”™"><a href="#å¯¼å…¥äº†-subfigureï¼Œä½†æ˜¯ç¼–è¯‘æŠ¥é”™" class="headerlink" title="å¯¼å…¥äº† subfigureï¼Œä½†æ˜¯ç¼–è¯‘æŠ¥é”™"></a>å¯¼å…¥äº† subfigureï¼Œä½†æ˜¯ç¼–è¯‘æŠ¥é”™</h3><p>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹</p><p><img src="/./Resources/image-20240110203014425.png" alt="image-20240110203014425"> </p><p>æ£€æŸ¥å¯¼è¨€åŒºæ˜¯å¦æœ‰è¿™ä¸¤ä¸ªåŒ…ï¼Œå¦‚æœæ˜¯ï¼Œæ³¨é‡Šè°ƒç¬¬ä¸€ä¸ªï¼Œå³å¯è§£å†³</p><p><img src="/./Resources/image-20240110202942653.png" alt="image-20240110202942653"></p><h3 id="citation-undefined"><a href="#citation-undefined" class="headerlink" title="citation undefined"></a>citation undefined</h3><p>ç‚¹å‡» texstudio ä¸­çš„å·¥å…·ï¼Œé€‰æ‹©æ¸…ç†è¾…åŠ©æ–‡ä»¶ï¼Œå†æ¬¡ç‚¹å‡»å·¥å…·ï¼Œé€‰æ‹©å‚è€ƒæ–‡çŒ®ï¼Œå†é‡æ–°ç¼–è¯‘</p><blockquote><p>å¦‚æœä¸èƒ½è§£å†³ï¼Œè¯•è¯•ä¸‹é¢çš„æ–¹æ³•ï¼Œä¸åŒçš„ç”µè„‘å¯èƒ½è§£å†³çš„æ–¹å¼ä¸ä¸€æ ·</p><ul><li><a href="https://blog.csdn.net/pxy19941023/article/details/81164481">TexStudioæç¤ºæŠ¥é”™citation undefinedçš„è§£å†³_texstudio citation undefined-CSDNåšå®¢</a></li><li><a href="https://blog.csdn.net/sunny0722/article/details/121352168">LaTexç¼–è¯‘æ—¶å‡ºç°undefined citationçš„è§£å†³åŠæ³•ã€‚_latex citation undefined-CSDNåšå®¢</a></li></ul></blockquote><h3 id="ç¼–è¯‘æŠ¥é”™ï¼Œåœ¨æŸä¸ª-figure-å—å†…æŠ¥é”™"><a href="#ç¼–è¯‘æŠ¥é”™ï¼Œåœ¨æŸä¸ª-figure-å—å†…æŠ¥é”™" class="headerlink" title="ç¼–è¯‘æŠ¥é”™ï¼Œåœ¨æŸä¸ª figure å—å†…æŠ¥é”™"></a>ç¼–è¯‘æŠ¥é”™ï¼Œåœ¨æŸä¸ª figure å—å†…æŠ¥é”™</h3><p>å…·ä½“æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š<code>I can&#39;t write on file &#39;xxxx.pdf&#39;. \includegraphics&#123;xxx&#125;</code></p><p>è¿™æ˜¯å› ä¸ºåœ¨å…¶ä»–è½¯ä»¶é¢„è§ˆäº†ç¼–è¯‘åçš„ pdfï¼Œå…³é—­å³å¯</p><h3 id="å¼•ç”¨ä¸èƒ½è·³è½¬"><a href="#å¼•ç”¨ä¸èƒ½è·³è½¬" class="headerlink" title="å¼•ç”¨ä¸èƒ½è·³è½¬"></a>å¼•ç”¨ä¸èƒ½è·³è½¬</h3><h4 id="å‚è€ƒæ–‡çŒ®å¼•ç”¨ä¸èƒ½è·³è½¬"><a href="#å‚è€ƒæ–‡çŒ®å¼•ç”¨ä¸èƒ½è·³è½¬" class="headerlink" title="å‚è€ƒæ–‡çŒ®å¼•ç”¨ä¸èƒ½è·³è½¬"></a>å‚è€ƒæ–‡çŒ®å¼•ç”¨ä¸èƒ½è·³è½¬</h4><p>å¯¼è¨€åŒºæ·»åŠ å¦‚ä¸‹è¯­å¥</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\usepackage</span>&#123;hyperref&#125;<br></code></pre></td></tr></table></figure><h4 id="å›¾ç‰‡ã€è¡¨æ ¼å’Œå…¬å¼æ·»åŠ å¼•ç”¨"><a href="#å›¾ç‰‡ã€è¡¨æ ¼å’Œå…¬å¼æ·»åŠ å¼•ç”¨" class="headerlink" title="å›¾ç‰‡ã€è¡¨æ ¼å’Œå…¬å¼æ·»åŠ å¼•ç”¨"></a>å›¾ç‰‡ã€è¡¨æ ¼å’Œå…¬å¼æ·»åŠ å¼•ç”¨</h4><p>åœ¨å›¾ç‰‡ã€è¡¨æ ¼å’Œå…¬å¼å¤„ï¼Œä½¿ç”¨ <code>\label&#123;fig1&#125;</code> æ·»åŠ æ ‡è®°</p><p>åœ¨ä½¿ç”¨å¤„ä½¿ç”¨ <code>\ref</code> å¼•ç”¨</p><p>ä¾‹å¦‚å›¾ç‰‡çš„å¼•ç”¨æ–¹å¼ï¼š<code>Fig.\ref&#123;fig1&#125;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;LaTex-å¸®åŠ©æ‰‹å†Œ&quot;&gt;&lt;a href=&quot;#LaTex-å¸®åŠ©æ‰‹å†Œ&quot; class=&quot;headerlink&quot; title=&quot;LaTex å¸®åŠ©æ‰‹å†Œ&quot;&gt;&lt;/a&gt;LaTex å¸®åŠ©æ‰‹å†Œ&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;è¯¥æ–‡æ¡£æ—¨åœ¨å¸®åŠ©åƒæˆ‘ä¸€æ ·é›¶åŸºç¡€ï¼Œåªæƒ³æŒæ¡åŸºç¡€è¯­æ³•ï¼Œç¼–</summary>
      
    
    
    
    <category term="LaTex" scheme="http://conquers.github.io/categories/LaTex/"/>
    
    
    <category term="LaTex" scheme="http://conquers.github.io/tags/LaTex/"/>
    
  </entry>
  
  <entry>
    <title>Queue ä¸­ offer() å’Œ add() çš„åŒºåˆ«</title>
    <link href="http://conquers.github.io/posts/b568ceb4.html"/>
    <id>http://conquers.github.io/posts/b568ceb4.html</id>
    <published>2023-11-13T07:58:45.000Z</published>
    <updated>2023-11-13T13:10:12.042Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Queue-ä¸­-offer-å’Œ-add-çš„åŒºåˆ«"><a href="#Queue-ä¸­-offer-å’Œ-add-çš„åŒºåˆ«" class="headerlink" title="Queue ä¸­ offer() å’Œ add() çš„åŒºåˆ«"></a>Queue ä¸­ offer() å’Œ add() çš„åŒºåˆ«</h1><p>åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œå‘ç°è‡ªå·±ç”¨çš„ add()ï¼Œåˆ«äººç”¨çš„ offer()ï¼Œå¥½åƒä¸¤ä¸ªæ–¹æ³•çš„åŠŸèƒ½æ˜¯ä¸€è‡´çš„ï¼Œç„¶åå»çœ‹äº†ä¸€ä¸‹ Queue çš„å®ç°ç±» <code>LinkedList</code> çš„æºç ï¼Œå‘ç°å¹¶æ— åŒºåˆ«ã€‚</p><p><img src="/./Resources/image-20231113160414176.png" alt="image-20231113160414176"></p><p>æ—¢ç„¶æ²¡æœ‰åŒºåˆ«ï¼Œé‚£ä¸ºä»€ä¹ˆè¦åˆ†æˆä¸¤ä¸ªæ–¹æ³•å‘¢ï¼Ÿçœ‹äº†ä¸€ä¸‹ä¸Šé¢çš„æ³¨é‡Šï¼š<mark>offer åœ¨ä½¿ç”¨<strong>å®¹é‡å—é™</strong>çš„é˜Ÿåˆ—æ—¶ï¼Œæ­¤æ–¹æ³•é€šå¸¸æ¯” add æ›´å¯å–ï¼Œå› ä¸º add åªèƒ½é€šè¿‡å¼•å‘å¼‚å¸¸æ¥æ’å…¥å…ƒç´ ã€‚</mark></p><p><img src="/./Resources/image-20231113160304045.png" alt="image-20231113160304045"></p><p>ä¹Ÿå°±æ˜¯è¯´åªæœ‰åœ¨å®¹é‡å—é™çš„é˜Ÿåˆ—ä¸­ï¼Œæ‰èƒ½å…·ä½“åŒºåˆ†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç„¶åå»çœ‹äº†ä¸€ä¸‹ <code>ArrayBlockingQueue</code> çš„æºç </p><p><img src="/./Resources/image-20231113160651312.png" alt="image-20231113160651312"></p><p>å³ï¼Œåœ¨é¡¶å±‚æ¥å£ Queue ä¸­ç¡®å®å®šä¹‰äº†æ–¹æ³•çš„æ ‡å‡†ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°ç±»å¯èƒ½ä¼šæ ¹æ®å…¶ç‰¹å®šçš„æ•°æ®ç»“æ„å’Œç”¨é€”ï¼Œå¯¹è¿™äº›æ–¹æ³•çš„å®ç°ç»†èŠ‚è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p><blockquote><p>çŸ¥é“äº†åŒºåˆ«ï¼Œé‚£ä¸ºä»€ä¹ˆ Queue æœ‰äº† add æ–¹æ³•ï¼ˆç»§æ‰¿è‡ª Collection) ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å®šä¹‰ä¸€ä¸ª offer æ–¹æ³•å‘¢ï¼Ÿ</p></blockquote><p>æŸ¥é˜…äº†è®¸å¤šæ–‡æ¡£ï¼Œæ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°æ˜äº†çš„ç­”æ¡ˆï¼Œä½†æ˜¯åœ¨ <a href="https://stackoverflow.com/questions/2703984/what-is-the-difference-between-the-add-and-offer-methods-in-a-queue-in-java">What is the difference between the add and offer methods in a Queue in Java? - Stack Overflow</a> è¿™ä¸ªé—®é¢˜ä¸­å¯ä»¥ä»ä¸­å‘ç°ä¸€äº›ä¿¡æ¯ï¼Œåœ¨ä¸‹é¢æåˆ°äº†ï¼ŒQueue é¦–å…ˆæ˜¯ç»§æ‰¿ Collectionï¼Œè‡ªç„¶ä»–ä¹Ÿæ‹¥æœ‰ add æ–¹æ³•ï¼Œåœ¨ <a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/Collection.html#add(E)">Collection çš„ add æ–¹æ³•</a>ä¸­ï¼Œå®šä¹‰äº†<mark>å¦‚æœé›†åˆå‡ºäºé™¤å·²åŒ…å«å…ƒç´ ä»¥å¤–çš„ä»»ä½•åŸå› æ‹’ç»æ·»åŠ ç‰¹å®šå…ƒç´ ï¼Œåˆ™å®ƒå¿…é¡»å¼•å‘å¼‚å¸¸</mark>ã€‚</p><p>ä½†æ˜¯é˜Ÿåˆ—æˆ‘ä»¬çŸ¥é“åˆ†ä¸ºæœ‰ç•Œé˜Ÿåˆ—å’Œæ— ç•Œé˜Ÿåˆ—ï¼Œåœ¨æ— ç•Œé˜Ÿåˆ—ä¸­çš„ offer å…¶å®åº•å±‚ä¹Ÿå°±æ˜¯ addï¼Œä½†åœ¨æœ‰ç•Œé˜Ÿåˆ—ä¸­ï¼Œoffer å°±ä¸å¤ªä¸€æ ·äº†ï¼Œä¹Ÿå°±æ˜¯ offer è®¾è®¡å‡ºæ¥çš„æ„ä¹‰ã€‚åœ¨ <a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/Queue.html">Queue çš„ offer æ–¹æ³•</a> ä¸­ï¼Œ å®šä¹‰äº†<mark>è®¾è®¡ç”¨äºåœ¨å¤±è´¥è¢«è§†ä¸ºæ­£å¸¸æƒ…å†µè€Œéå¼‚å¸¸æƒ…å†µæ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œåœ¨å›ºå®šå®¹é‡ï¼ˆæˆ–ç§°ä¸ºâ€œæœ‰ç•Œâ€ï¼‰çš„é˜Ÿåˆ—ä¸­ã€‚</mark></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Queue-ä¸­-offer-å’Œ-add-çš„åŒºåˆ«&quot;&gt;&lt;a href=&quot;#Queue-ä¸­-offer-å’Œ-add-çš„åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;Queue ä¸­ offer() å’Œ add() çš„åŒºåˆ«&quot;&gt;&lt;/a&gt;Queue ä¸­ offer</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/Java/"/>
    
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Springboot ä¸ºä»€ä¹ˆç¼–å†™äº†é…ç½®æ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨</title>
    <link href="http://conquers.github.io/posts/e25bd392.html"/>
    <id>http://conquers.github.io/posts/e25bd392.html</id>
    <published>2023-10-20T02:50:28.000Z</published>
    <updated>2023-10-20T08:19:22.478Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Springboot-è‡ªåŠ¨é…ç½®æ•°æ®æº-DataSource-åŸç†åˆ†æ"><a href="#Springboot-è‡ªåŠ¨é…ç½®æ•°æ®æº-DataSource-åŸç†åˆ†æ" class="headerlink" title="Springboot è‡ªåŠ¨é…ç½®æ•°æ®æº DataSource åŸç†åˆ†æ"></a>Springboot è‡ªåŠ¨é…ç½®æ•°æ®æº DataSource åŸç†åˆ†æ</h1><p>æ›´å®Œæ•´çš„é—®é¢˜æ˜¯ï¼šä¸ºä»€ä¹ˆåœ¨ <code>application.yml</code> æˆ– <code>application.properties</code> ä¸­ç¼–å†™äº†æ•°æ®åº“çš„ä¿¡æ¯å°±å¯ä»¥è¿›è¡Œä½¿ç”¨äº†<br>å³ï¼Œä¸ºä»€ä¹ˆç¼–å†™å®Œæˆé…ç½®ä¿¡æ¯åï¼ŒSpring å®¹å™¨ä¸­å°±æœ‰ dataSource çš„å®ä¾‹</p><p>å½“æˆ‘ä»¬åœ¨ <code>application.yml</code> ä¸­é…ç½®å¥½æ•°æ®åº“ä¿¡æ¯æ—¶ï¼Œå¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/study?useSSL=false&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br></code></pre></td></tr></table></figure><p>å½“ Spring Boot åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p><p>é¦–å…ˆæ˜¯ <code>DataSourceAutoConfiguration</code> é…ç½®ç±»ï¼Œ<code>@ConditionalOnClass</code> è¡¨ç¤ºåé¢ä¸¤ä¸ªç±»å­˜åœ¨æ—¶ï¼Œæ‰ä¼šæ¿€æ´»è¿™ä¸ªç±»</p><p><img src="/Resources/Pasted%20image%2020231020154219.png"></p><p>å‰ä¸€ä¸ª <code>DataSource</code> æ˜¯ <code>java.x.sql.DataSource</code> åŒ…ä¸‹çš„ï¼Œå·²ç»å­˜åœ¨ï¼Œåä¸€ä¸ªæ˜¯ <code>org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</code> ï¼Œè¿™ä¸ªç±»å­˜åœ¨äº <code>spring-jdbc</code> ä¾èµ–ä¸‹ï¼Œæ›´æ–¹ä¾¿åœ°ï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>spring-boot-starter-jdbc</code> ä¾èµ–ï¼Œ<br><img src="/Resources/Pasted%20image%2020231020154818.png"><br>è¯¥ä¾èµ–åŒ…å«ä¸€ä¸ªé»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± åŠ <code>spring-jdbc</code> </p><p>æ¥ç€ï¼Œä¾ç„¶æ˜¯åœ¨ <code>DataSourceAutoConfiguration</code> é…ç½®ç±»ä¸‹ï¼Œå®šä¹‰äº†å¦‚ä¸‹çš„ bean å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>  <br><span class="hljs-meta">@Conditional(PooledDataSourceCondition.class)</span>  <br><span class="hljs-meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span>  <br><br>åœ¨è¿™é‡Œå¼•å…¥äº†å¾ˆå¤šç±»å‹æ•°æ®æºçš„è‡ªåŠ¨é…ç½®ç±»<br><span class="hljs-meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,  </span><br><span class="hljs-meta">       DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,  </span><br><span class="hljs-meta">       DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span>  <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PooledDataSourceConfiguration</span> &#123;  <br>  <br>&#125;<br><br></code></pre></td></tr></table></figure><p>åœ¨é™æ€æ–¹æ³•ä¸Šå¼•å…¥äº†å¾ˆå¤šç±»å‹æ•°æ®æºçš„è‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯ä¸ªé…ç½®ç±»éƒ½å¯¹åº”äºç‰¹å®šç±»å‹çš„æ•°æ®æºï¼Œä¸»è¦ç”¨äºæ ¹æ®ä¸åŒçš„æ•°æ®åº“è¿æ¥æ± æŠ€æœ¯åˆ›å»ºå’Œé…ç½® <code>DataSource</code> beanã€‚ä»¥ä¸‹æ˜¯å¼•å…¥çš„å„ä¸ªç±»çš„ä½œç”¨ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> <span class="hljs-strong">**DataSourceConfiguration.Hikari**</span>:<br><span class="hljs-bullet">    -</span> è¿™ä¸ªé…ç½®ç±»ç”¨äºåˆ›å»ºå’Œé…ç½® <span class="hljs-code">`HikariCP`</span> æ•°æ®åº“è¿æ¥æ± çš„ <span class="hljs-code">`DataSource`</span>ã€‚å¦‚æœHikariCPåœ¨ç±»è·¯å¾„ä¸Šå¯ç”¨ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºå±æ€§æŒ‡ç¤ºä½¿ç”¨HikariCPï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«ä½¿ç”¨ã€‚<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**DataSourceConfiguration.Tomcat**</span>:<br><span class="hljs-bullet">    -</span> è¿™ä¸ªé…ç½®ç±»ç”¨äºåˆ›å»ºå’Œé…ç½®åŸºäº <span class="hljs-code">`Tomcat`</span> è¿æ¥æ± çš„ <span class="hljs-code">`DataSource`</span>ã€‚å¦‚æœTomcatè¿æ¥æ± åœ¨ç±»è·¯å¾„ä¸Šå¯ç”¨ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºå±æ€§æŒ‡ç¤ºä½¿ç”¨Tomcatè¿æ¥æ± ï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«ä½¿ç”¨ã€‚<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**DataSourceConfiguration.Dbcp2**</span>:<br><span class="hljs-bullet">    -</span> è¿™ä¸ªé…ç½®ç±»ç”¨äºåˆ›å»ºå’Œé…ç½®åŸºäº <span class="hljs-code">`Apache Commons DBCP 2`</span> çš„ <span class="hljs-code">`DataSource`</span>ã€‚å¦‚æœDBCP2åœ¨ç±»è·¯å¾„ä¸Šå¯ç”¨ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºå±æ€§æŒ‡ç¤ºä½¿ç”¨DBCP2ï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«ä½¿ç”¨ã€‚<br><span class="hljs-bullet">4.</span> <span class="hljs-strong">**DataSourceConfiguration.OracleUcp**</span>:<br><span class="hljs-bullet">     -</span> è¿™ä¸ªé…ç½®ç±»ç”¨äºåˆ›å»ºå’Œé…ç½®åŸºäº <span class="hljs-code">`Oracle UCP`</span> çš„ <span class="hljs-code">`DataSource`</span>ã€‚å¦‚æœOracle UCPåœ¨ç±»è·¯å¾„ä¸Šå¯ç”¨ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºå±æ€§æŒ‡ç¤ºä½¿ç”¨Oracle UCPï¼Œé‚£ä¹ˆè¿™ä¸ªé…ç½®ç±»å°±ä¼šè¢«ä½¿ç”¨ã€‚<br><span class="hljs-bullet">5.</span> <span class="hljs-strong">**DataSourceConfiguration.Generic**</span>:<br><span class="hljs-bullet">    -</span> è¿™ä¸ªé…ç½®ç±»ç”¨äºåˆ›å»ºå’Œé…ç½®ä¸ç‰¹å®šäºä»»ä½•ç‰¹å®šè¿æ¥æ± å®ç°çš„é€šç”¨ <span class="hljs-code">`DataSource`</span>ã€‚å½“æ²¡æœ‰å…¶ä»–ç‰¹å®šçš„è¿æ¥æ± æŠ€æœ¯åœ¨ç±»è·¯å¾„ä¸Šå¯ç”¨æ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»å¯èƒ½ä¼šè¢«ä½¿ç”¨ã€‚<br><span class="hljs-bullet">6.</span> <span class="hljs-strong">**DataSourceJmxConfiguration**</span>:<br><span class="hljs-bullet">    -</span> è¿™ä¸ªé…ç½®ç±»è´Ÿè´£æ³¨å†Œä¸æ•°æ®æºç›¸å…³çš„JMXç®¡ç†beanï¼Œå…è®¸é€šè¿‡JMXç›‘è§†å’Œç®¡ç†æ•°æ®æºã€‚<br></code></pre></td></tr></table></figure><p>é»˜è®¤çš„æ˜¯ Hikari ï¼ŒæŸ¥çœ‹ Hikari çš„æºç å¦‚ä¸‹ï¼Œè¯¥ç±»ä½äº <code>org.springframework.boot.autoconfigure.jdbc.DataSourceConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Hikari DataSource configuration.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnClass(HikariDataSource.class)</span>  ç±»è·¯å¾„ä¸‹å¿…é¡»å­˜åœ¨HikariDataSourceè¿™ä¸ªç±»<br><span class="hljs-meta">@ConditionalOnMissingBean(DataSource.class)</span>  å½“å‰å®¹å™¨ä¸­å­˜åœ¨DataSourceç±»å‹çš„bean<br> <br>    å¦‚æœspring.datasource.typeé…ç½®äº†ï¼Œå¦‚æœé…ç½®çš„å€¼ä¸ºcom.zaxxer.hikari.HikariDataSource<br>    æˆ–è€…æ²¡æœ‰é…ç½®spring.datasource.typeè¿™ä¸ªå€¼ é‚£å°±æ¿€æ´»HikariDataSourceçš„è‡ªåŠ¨é…ç½®ç±»ã€‚<br><span class="hljs-meta">@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;, havingValue = &quot;com.zaxxer.hikari.HikariDataSource&quot;,</span><br><span class="hljs-meta">matchIfMissing = true)</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hikari</span> &#123;<br> <br><span class="hljs-meta">@Bean</span><br>        è¿™ä¸ªæ³¨è§£è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥æŒ‡å®šé…ç½®ä»¥spring.datasource.hikariä¸ºå‰ç¼€çš„é…ç½®é¡¹æ¥é…ç½®hikariæ•°æ®æº<br>           ä¾‹å¦‚ï¼šspring.datasource.hikari.jdbc-url=xxx<br>                 spring.datasource.hikari.driver-class-name=xxx<br>                 spring.datasource.hikari.username=xxx<br>                 spring.datasource.hikari.password=xxx<br>                 ...<br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource.hikari&quot;)</span><br> <br>        Q:é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸é…ç½®ä»¥spring.datasource.hikariä¸ºå‰ç¼€çš„é…ç½®é¡¹å¦‚spring.datasource.url<br>ç­‰é…ç½®ä¹Ÿèƒ½ç”Ÿæ•ˆå‘¢ï¼Ÿæ­¤å¤„çš„propertieså°±æ˜¯æˆ‘ä»¬é…ç½®çš„spring.datasource.urlç­‰é…ç½®é¡¹<br> <br>HikariDataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">(DataSourceProperties properties)</span> &#123;<br><span class="hljs-type">HikariDataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> createDataSource(properties, HikariDataSource.class);<br><span class="hljs-keyword">if</span> (StringUtils.hasText(properties.getName())) &#123;<br>dataSource.setPoolName(properties.getName());<br>&#125;<br><span class="hljs-keyword">return</span> dataSource;<br>&#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¯¹äºä¸Šé¢ Qï¼Œæˆ‘ä»¬è§‚å¯Ÿä»–çš„å‚æ•° <code>DataSourceProperties properties</code><br>è¿™ä¸ªç±»åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œé€šè¿‡ <code>@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</code> æ³¨è§£ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å±æ€§ã€‚<br><img src="/Resources/Pasted%20image%2020231020160438.png"></p></blockquote><p>åœ¨ä¸Šé¢çš„ Hikari ç±»ä¸­ï¼Œè°ƒç”¨äº† <code>HikariDataSource dataSource = createDataSource(properties, HikariDataSource.class);</code><br><img src="/Resources/Pasted%20image%2020231020160647.png"></p><p><code>createDataSource()</code> æ–¹æ³•ä½äº <code>DataSourceConfiguration</code> ä¸­<br><img src="/Resources/Pasted%20image%2020231020160703.png"></p><p>æ¥ä¸‹æ¥ä¼šæ‰§è¡Œ <code>initializeDataSourceBuilder()</code> æ–¹æ³•ï¼Œå¾—åˆ°ä¸€ä¸ª DataSourceBuilder<br><img src="/Resources/Pasted%20image%2020231020160923.png"></p><p>åœ¨æ¥ä¸‹æ¥ä¼šæ‰§è¡Œ <code>build()</code> æ–¹æ³•<br><img src="/Resources/Pasted%20image%2020231020161023.png"></p><p>æœ€åè¿”å› dataSource å®ä¾‹<br><img src="/Resources/Pasted%20image%2020231020161127.png"></p><p>æœ€åï¼šåœ¨ä¹‹å‰æœ‰ä¸€ä¸ªç±»ï¼Œå¼•å…¥äº†å¾ˆå¤šç±»å‹æ•°æ®æºçš„è‡ªåŠ¨é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,  </span><br><span class="hljs-meta">       DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class,  </span><br><span class="hljs-meta">       DataSourceConfiguration.Generic.class, DataSourceJmxConfiguration.class &#125;)</span>  <br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PooledDataSourceConfiguration</span> &#123;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­æœ‰ä¸€ä¸ª Genericï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Generic DataSource configuration.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnMissingBean(DataSource.class)</span><br> <br>    å¦‚æœé…ç½®äº†spring.datasource.typeå±æ€§å°±æ¿€æ´»ï¼Œå¦‚æœé…ç½®çš„spring.datasource.typeä¸æ˜¯å…¶ä»–æ•°æ®æº<br>ç±»å‹çš„ï¼Œå°±ä¼šä½¿ç”¨æ¬¡æ•°æ®æºé…ç½®ç±»ï¼Œä¼šæ ¹æ®é…ç½®çš„æ•°æ®æºç±»å‹æ¥è¿›è¡Œæ•°æ®æºé…ç½®ï¼Œæ¯”å¦‚é…ç½®<br>spring.datasource.type=com.alibaba.druid.pool.DruidDataSource æ˜¯é˜¿é‡Œçš„druidï¼Œé‚£ä¹ˆæœ€åé…ç½®çš„æ•°<br>æ®æºå°±æ˜¯DruidDataSourceã€‚<br><span class="hljs-meta">@ConditionalOnProperty(name = &quot;spring.datasource.type&quot;)</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Generic</span> &#123;<br> <br><span class="hljs-meta">@Bean</span><br>DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">(DataSourceProperties properties)</span> &#123;<br><span class="hljs-keyword">return</span> properties.initializeDataSourceBuilder().build();<br>&#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://blog.csdn.net/qq_34978129/article/details/108747440">springboot8â€”ï¼springbootè‡ªåŠ¨é…ç½®æ•°æ®æºDataSourceåŸç†åˆ†æ_springboot datasourceåˆ›å»ºåŸç†-CSDNåšå®¢</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Springboot-è‡ªåŠ¨é…ç½®æ•°æ®æº-DataSource-åŸç†åˆ†æ&quot;&gt;&lt;a href=&quot;#Springboot-è‡ªåŠ¨é…ç½®æ•°æ®æº-DataSource-åŸç†åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;Springboot è‡ªåŠ¨é…ç½®æ•°æ®æº DataS</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="Spring" scheme="http://conquers.github.io/categories/Java/Spring/"/>
    
    
    <category term="Spring" scheme="http://conquers.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜</title>
    <link href="http://conquers.github.io/posts/95a885e4.html"/>
    <id>http://conquers.github.io/posts/95a885e4.html</id>
    <published>2023-10-08T08:20:11.000Z</published>
    <updated>2023-10-08T13:38:26.169Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜"><a href="#Spring-ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜" class="headerlink" title="Spring ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜"></a>Spring ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜</h1><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>éƒ½çŸ¥é“ Spring é€šè¿‡ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚ä½†æ˜¯æ˜¯ä¸æ˜¯å¿…é¡»ä¸‰çº§ç¼“å­˜æ‰èƒ½è§£å†³ï¼ŒäºŒçº§ç¼“å­˜ä¸èƒ½è§£å†³å—ï¼Ÿ<br>è¦åˆ†ææ˜¯ä¸æ˜¯å¯ä»¥å»æ‰å…¶ä¸­ä¸€çº§ç¼“å­˜ï¼Œå°±å…ˆè¿‡ä¸€é Spring æ˜¯å¦‚ä½•é€šè¿‡ä¸‰çº§ç¼“å­˜æ¥è§£å†³å¾ªç¯ä¾èµ–çš„ã€‚</p><blockquote><p>å¯¹äºè¿™éƒ¨åˆ†å†…å®¹ï¼Œéœ€è¦äº†è§£ Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚</p></blockquote><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>åœ¨ Spring ç”Ÿå‘½å‘¨æœŸçš„ populateBean éƒ¨åˆ†ï¼Œå¦‚æœå‘ç°è¯¥å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰è¿˜æœªåœ¨ spring ä¸­ç”Ÿæˆï¼Œåˆ™ä¼šè·‘å»ç”Ÿæˆå±æ€§å¯¹è±¡å®ä¾‹</p><p><img src="/./Resources/image-20231008150928305.png" alt="image-20231008150928305"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¡«å……å±æ€§çš„æ—¶å€™ï¼Œspring ä¼šæå‰å°†å·²ç»å®ä¾‹åŒ–çš„ bean é€šè¿‡ ObjectFactory åŠæˆå“æš´éœ²å‡ºå»ï¼Œä¸ºä»€ä¹ˆç§°ä¸ºåŠæˆå“æ˜¯å› ä¸ºè¿™æ—¶å€™çš„ bean å¯¹è±¡å®ä¾‹åŒ–ï¼Œä½†æ˜¯æœªè¿›è¡Œå±æ€§å¡«å……ï¼Œæ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„ bean å®ä¾‹å¯¹è±¡</p><p><img src="/./Resources/image-20231008151216188.png" alt="image-20231008151216188"></p><p>spring åˆ©ç”¨ singletonObjects, earlySingletonObjects, singletonFactories ä¸‰çº§ç¼“å­˜å»è§£å†³çš„ï¼Œæ‰€è¯´çš„ç¼“å­˜å…¶å®ä¹Ÿå°±æ˜¯ä¸‰ä¸ª Map</p><p><img src="/./Resources/42c63cd9a94d0d2d4000473cabc221b7.png" alt="image"></p><p>å¯ä»¥çœ‹åˆ°ä¸‰çº§ç¼“å­˜å„è‡ªä¿å­˜çš„å¯¹è±¡ï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨äºŒçº§ç¼“å­˜ earlySingletonObjects å’Œä¸‰çº§ç¼“å­˜ singletonFactoryï¼Œä¸€çº§ç¼“å­˜å¯ä»¥è¿›è¡Œå¿½ç•¥ã€‚å‰é¢æˆ‘ä»¬è®²è¿‡å…ˆå®ä¾‹åŒ–çš„ bean ä¼šé€šè¿‡ ObjectFactory åŠæˆå“æå‰æš´éœ²åœ¨ä¸‰çº§ç¼“å­˜ä¸­</p><p><img src="/./Resources/image-20231008151721379.png" alt="image-20231008151721379"></p><p>singletonFactory æ˜¯ä¼ å…¥çš„ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œè°ƒç”¨ ObjectFactory.getObject() æœ€ç»ˆä¼šè°ƒç”¨ getEarlyBeanReference æ–¹æ³•ã€‚å†æ¥çœ‹çœ‹å¾ªç¯ä¾èµ–ä¸­æ˜¯æ€ä¹ˆæ‹¿å…¶å®ƒåŠæˆå“çš„å®ä¾‹å¯¹è±¡çš„ã€‚</p><p>æˆ‘ä»¬å‡è®¾ç°åœ¨æœ‰è¿™æ ·çš„åœºæ™¯ AService ä¾èµ– BServiceï¼ŒBService ä¾èµ– AService</p><ul><li>AService é¦–å…ˆå®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–é€šè¿‡ ObjectFactory åŠæˆå“æš´éœ²åœ¨ä¸‰çº§ç¼“å­˜ä¸­</li><li>å¡«å……å±æ€§ BServiceï¼Œå‘ç° BService è¿˜æœªè¿›è¡Œè¿‡åŠ è½½ï¼Œå°±ä¼šå…ˆå»åŠ è½½ BService</li><li>å†åŠ è½½ BService çš„è¿‡ç¨‹ä¸­ï¼Œå®ä¾‹åŒ–ï¼Œä¹Ÿé€šè¿‡ ObjectFactory åŠæˆå“æš´éœ²åœ¨ä¸‰çº§ç¼“å­˜</li><li>BService å¡«å……å±æ€§ AService çš„æ—¶å€™ï¼Œè¿™æ—¶å€™èƒ½å¤Ÿä»ä¸‰çº§ç¼“å­˜ä¸­æ‹¿åˆ°åŠæˆå“çš„ ObjectFactory ï¼ˆAServiceï¼‰</li></ul><p><img src="/./Resources/image-20231008190716923.png" alt="image-20231008190716923"></p><p>æ‹¿åˆ° ObjectFactory å¯¹è±¡åï¼Œè°ƒç”¨ ObjectFactory.getObject() æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨ getEarlyBeanReference() æ–¹æ³•ï¼ŒgetEarlyBeanReference è¿™ä¸ªæ–¹æ³•ä¸»è¦é€»è¾‘å¤§æ¦‚æè¿°ä¸‹ï¼Œå¦‚æœ bean è¢« AOP åˆ‡é¢ä»£ç†åˆ™è¿”å›çš„æ˜¯ beanProxy å¯¹è±¡ï¼Œå¦‚æœæœªè¢«ä»£ç†åˆ™è¿”å›çš„æ˜¯åŸ bean å®ä¾‹ï¼Œè¿™æ—¶æˆ‘ä»¬ä¼šå‘ç°èƒ½å¤Ÿæ‹¿åˆ° bean å®ä¾‹(å±æ€§æœªå¡«å……)ï¼Œç„¶åä»ä¸‰çº§ç¼“å­˜ç§»é™¤ï¼Œæ”¾åˆ°äºŒçº§ç¼“å­˜earlySingletonObjects ä¸­ï¼ŒğŸ””ï¼ˆè¡¥å……å†…å®¹è§ä¸‹éƒ¨åˆ†ï¼‰ï¼Œç„¶å B åˆ›å»ºå®Œæ¯•ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜ä¸­ï¼Œå†å›åˆ° A çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå»ä¸€çº§ç¼“å­˜æ‹¿åˆ°äº†Bï¼Œç„¶å A ä¹Ÿåˆ›å»ºå®Œæˆï¼ŒA æœ€åä¹Ÿæ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜ï¼Œæœ€ç»ˆä¸¤ä¸ªéƒ½åˆ›å»ºå®Œæˆï¼›</p><p>ğŸ””ï¼šè€Œæ­¤æ—¶ B æ³¨å…¥çš„æ˜¯ä¸€ä¸ªåŠæˆå“çš„å®ä¾‹Aå¯¹è±¡ï¼Œä¸è¿‡éšç€ B åˆå§‹åŒ–å®Œæˆåï¼ŒA ä¼šç»§ç»­è¿›è¡Œåç»­çš„åˆå§‹åŒ–æ“ä½œï¼Œæœ€ç»ˆBä¼šæ³¨å…¥çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„Aå®ä¾‹ï¼Œå› ä¸ºåœ¨å†…å­˜ä¸­å®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><p>è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/./Resources/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.drawio.png" alt="å¾ªç¯ä¾èµ–.drawio"></p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>å¯ä»¥çœ‹åˆ°ï¼Œå¾ªç¯ä¾èµ–ä¸‹ï¼Œæœ‰æ²¡æœ‰ä»£ç†æƒ…å†µä¸‹çš„åŒºåˆ«å°±åœ¨ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">singletonObject</span> <span class="hljs-operator">=</span> singletonFactory.getObject()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>åœ¨å¾ªç¯ä¾èµ–å‘ç”Ÿçš„æƒ…å†µä¸‹ B ä¸­çš„ A èµ‹å€¼æ—¶ï¼š</p><ol><li>æ— ä»£ç†ï¼šgetObject ç›´æ¥è¿”å›åŸæ¥çš„ Bean</li><li>æœ‰ä»£ç†ï¼šgetObject è¿”å›çš„æ˜¯ä»£ç†å¯¹è±¡</li></ol><p>ç„¶åéƒ½æ”¾åˆ°<strong>äºŒçº§ç¼“å­˜</strong>ã€‚</p><p><strong>ä¸ºä»€ä¹ˆè¦ä¸‰çº§ç¼“å­˜?</strong></p><ol><li><p>å‡è®¾å»æ‰ä¸‰çº§ç¼“å­˜</p><p>å»æ‰ä¸‰çº§ç¼“å­˜ä¹‹åï¼ŒBean ç›´æ¥åˆ›å»º <code>earlySingletonObjects</code>ï¼Œ çœ‹ç€å¥½åƒä¹Ÿå¯ä»¥ã€‚</p><p>å¦‚æœæœ‰ä»£ç†çš„æ—¶å€™ï¼Œåœ¨ <code>earlySingletonObjects</code> ç›´æ¥æ”¾ä»£ç†å¯¹è±¡å°±è¡Œäº†ã€‚</p><p>ä½†æ˜¯ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šæ„å‘³ç€ Bean åœ¨æ„é€ å®Œåå°±åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè¿™æ ·è¿èƒŒäº† Spring è®¾è®¡åŸåˆ™ã€‚Spring ç»“åˆ AOP è·Ÿ Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯åœ¨ Bean åˆ›å»ºå®Œå…¨ä¹‹åé€šè¿‡ AnnotationAwareAspectJAutoProxyCreator è¿™ä¸ªåç½®å¤„ç†å™¨æ¥å®Œæˆçš„ï¼Œåœ¨è¿™ä¸ªåç½®å¤„ç†çš„ postProcessAfterInitialization æ–¹æ³•ä¸­å¯¹åˆå§‹åŒ–åçš„ Bean å®Œæˆ AOP ä»£ç†ã€‚å¦‚æœå‡ºç°äº†å¾ªç¯ä¾èµ–ï¼Œé‚£æ²¡æœ‰åŠæ³•ï¼Œåªæœ‰ç»™ Bean å…ˆåˆ›å»ºä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰å‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œè®¾è®¡ä¹‹åˆå°±æ˜¯è®© Bean åœ¨ç”Ÿå‘½å‘¨æœŸçš„æœ€åä¸€æ­¥å®Œæˆä»£ç†è€Œä¸æ˜¯åœ¨å®ä¾‹åŒ–åå°±ç«‹é©¬å®Œæˆä»£ç†ã€‚</p><p>è¿™ä¹ˆä¸€æƒ³ï¼Œæ˜¯ä¸æ˜¯ä¼šå¯¹ Bean çš„ç”Ÿå‘½å‘¨æœŸæœ‰å½±å“ã€‚</p><p>åŒæ ·ï¼Œå…ˆåˆ›å»º <code>singletonFactory</code> çš„å¥½å¤„å°±æ˜¯ï¼š<strong>åœ¨çœŸæ­£éœ€è¦å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå†ä½¿ç”¨ singletonFactory.getObject() è·å– Bean æˆ–è€… Bean çš„ä»£ç†</strong>ã€‚ç›¸å½“äºæ˜¯å»¶è¿Ÿå®ä¾‹åŒ–ã€‚</p></li><li><p>å‡è®¾å»æ‰äºŒçº§ç¼“å­˜</p><p>å¦‚æœå»æ‰äº†äºŒçº§ç¼“å­˜ï¼Œåˆ™éœ€è¦ç›´æ¥åœ¨ <code>singletonFactory.getObject()</code> é˜¶æ®µåˆå§‹åŒ–å®Œæ¯•ï¼Œå¹¶æ”¾åˆ°ä¸€çº§ç¼“å­˜ä¸­ã€‚</p><p><img src="/Resources/Pasted%20image%2020231008213556.png"><br>B å’Œ C éƒ½ä¾èµ– A</p><p>é‚£æœ‰è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼ŒB å’Œ C éƒ½ä¾èµ–äº† Aã€‚</p><p>è¦çŸ¥é“åœ¨æœ‰ä»£ç†çš„æƒ…å†µä¸‹ <code>singletonFactory.getObject()</code> è·å–çš„æ˜¯ä»£ç†å¯¹è±¡ã€‚</p><p><img src="/Resources/Pasted%20image%2020231008213609.png">å¤šæ¬¡è·å–ä»£ç†å¯¹è±¡ä¸åŒ</p><p>è€Œå¤šæ¬¡è°ƒç”¨ <code>singletonFactory.getObject()</code> è¿”å›çš„ä»£ç†å¯¹è±¡æ˜¯ä¸åŒçš„ï¼Œå°±ä¼šå¯¼è‡´ B å’Œ C ä¾èµ–äº†ä¸åŒçš„ Aã€‚</p><p>é‚£å¦‚æœè·å– B åˆ°ä¹‹åç›´æ¥æ”¾åˆ°ä¸€çº§ç¼“å­˜ï¼Œç„¶å C å†è·å–å‘¢ï¼Ÿ</p><p>â€¦</p><p>ä¸€çº§ç¼“å­˜æ”¾çš„æ˜¯å·²ç»åˆå§‹åŒ–å®Œæ¯•çš„ Beanï¼Œè¦çŸ¥é“ A ä¾èµ–äº† B å’Œ C ï¼ŒA è¿™æ—¶å€™è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæ¯•ã€‚</p></li></ol><blockquote><p>å‚è€ƒæ–‡ç« </p><p><a href="https://www.cnblogs.com/semi-sub/p/13548479.html">Spring ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜ - åŠåˆ†ã€ - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/610322151">å½»åº•ææ‡‚Springä¹‹ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://cloud.tencent.com/developer/article/2019359">ã€å½»åº•ææ‡‚ã€‘Springä¹‹ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p><p><a href="https://www.bilibili.com/video/BV1rt4y1u7q5">https://www.bilibili.com/video/BV1rt4y1u7q5</a></p><p><a href="https://blog.csdn.net/weixin_49592546/article/details/108050566">Springå¾ªç¯ä¾èµ–ä¸‰çº§ç¼“å­˜æ˜¯å¦å¯ä»¥å‡å°‘ä¸ºäºŒçº§ç¼“å­˜ï¼Ÿ-CSDNåšå®¢</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜&quot;&gt;&lt;a href=&quot;#Spring-ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜&quot; class=&quot;headerlink&quot; title=&quot;Spring ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="Spring" scheme="http://conquers.github.io/categories/Java/Spring/"/>
    
    
    <category term="Spring" scheme="http://conquers.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="http://conquers.github.io/posts/89080a8e.html"/>
    <id>http://conquers.github.io/posts/89080a8e.html</id>
    <published>2023-10-08T06:53:09.000Z</published>
    <updated>2023-10-08T13:38:26.166Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</h1><h2 id="Bean-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Bean-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Bean çš„ç”Ÿå‘½å‘¨æœŸ"></a>Bean çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹æ‰€ç¤º</p><p><img src="/./Resources/image-20231008205654478.png" alt="image-20231008205654478"></p><p>åœ¨åˆ›å»º Bean ä¹‹å‰ï¼ŒSpring å®¹å™¨ä¼šå°†æ‰€æœ‰ Bean çš„ä¿¡æ¯ï¼ˆxml é‡Œé¢çš„ <code>&lt;bean&gt;</code> æˆ–è€…æ³¨è§£ä¿®é¥°çš„å¯¹è±¡ï¼‰å°è£…æˆä¸€ä¸ª BeanDefinition å¯¹è±¡ï¼Œæ‰€æœ‰çš„ BeanDefinition å­˜å‚¨åˆ°ä¸€ä¸ªåä¸º beanDefinitionMap çš„ Map é›†åˆä¸­å»ï¼ŒSpring æ¡†æ¶åœ¨å¯¹è¯¥ Map è¿›è¡Œéå†ï¼Œç„¶ååˆ›å»ºå¯¹è±¡ï¼Œå³å¦‚ä¸‹è¿‡ç¨‹</p><h3 id="doCteateBean"><a href="#doCteateBean" class="headerlink" title="doCteateBean"></a>doCteateBean</h3><p>è¯¥éƒ¨åˆ†å¯¹åº”å›¾ä¸­çš„åˆå§‹åŒ–èµ‹å€¼éƒ¨åˆ†</p><p>æŸ¥çœ‹å®ç°ç±» AbstractAutowireCapableBeanFactory ä¸­çš„ doCteateBean æ–¹æ³•</p><p><img src="/./Resources/image-20231008205913076.png" alt="image-20231008205913076"></p><blockquote><p>ç»§æ‰¿ç±»å›¾</p><p><img src="/./Resources/image-20231008102641438.png" alt="image-20231008102641438"></p></blockquote><p>è¯¥æ–¹æ³•æ˜¯åˆ›å»º bean çš„å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¦–å…ˆéœ€è¦å®ä¾‹åŒ–è¿™ä¸ª beanï¼Œä¹Ÿå°±æ˜¯åœ¨å †ä¸­å¼€è¾Ÿä¸€å—å†…å­˜ç©ºé—´ç»™è¿™ä¸ªå¯¹è±¡ï¼ŒcreateBeanInstance æ–¹æ³•é‡Œé¢é€»è¾‘å¤§æ¦‚å°±æ˜¯é‡‡ç”¨åå°„ç”Ÿæˆå®ä¾‹å¯¹è±¡ï¼Œè¿›è¡Œåˆ°è¿™é‡Œè¡¨ç¤ºå¯¹è±¡è¿˜å¹¶æœªè¿›è¡Œå±æ€§çš„å¡«å……ï¼Œä¹Ÿå°±æ˜¯ @Autowired æ³¨è§£çš„å±æ€§è¿˜æœªå¾—åˆ°æ³¨å…¥</p><p><img src="/./Resources/image-20231008205954228.png" alt="image-20231008205954228"><br><img src="/./Resources/image-20231008210004652.png" alt="image-20231008210004652"></p><h3 id="populateBean"><a href="#populateBean" class="headerlink" title="populateBean"></a>populateBean</h3><p>è¯¥éƒ¨åˆ†å¯¹åº”å›¾ä¸­çš„ä¾èµ–æ³¨å…¥éƒ¨åˆ†</p><h3 id="initializeBean"><a href="#initializeBean" class="headerlink" title="initializeBean"></a>initializeBean</h3><p>è¯¥éƒ¨åˆ†å¯¹åº”å›¾ä¸­çš„ Aware åˆ° BeanPostProcessor#after éƒ¨åˆ†</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬äºŒæ­¥å°±æ˜¯å¡«å…… bean çš„æˆå‘˜å±æ€§ï¼ŒpopulateBean æ–¹æ³•é‡Œé¢çš„é€»è¾‘å¤§è‡´å°±æ˜¯å¯¹ä½¿ç”¨åˆ°äº†æ³¨å…¥å±æ€§çš„æ³¨è§£å°±ä¼šè¿›è¡Œæ³¨å…¥ï¼Œå¦‚æœåœ¨æ³¨å…¥çš„è¿‡ç¨‹å‘ç°æ³¨å…¥çš„å¯¹è±¡è¿˜æ²¡ç”Ÿæˆï¼Œåˆ™ä¼šè·‘å»ç”Ÿäº§è¦æ³¨å…¥çš„å¯¹è±¡ï¼Œç¬¬ä¸‰æ­¥å°±æ˜¯è°ƒç”¨ initializeBean æ–¹æ³•åˆå§‹åŒ–beanï¼Œ</p><p><img src="/./Resources/image-20231008210028120.png" alt="image-20231008210028120"></p><h4 id="è°ƒç”¨å®ç°-Aware-æ¥å£çš„æ–¹æ³•"><a href="#è°ƒç”¨å®ç°-Aware-æ¥å£çš„æ–¹æ³•" class="headerlink" title="è°ƒç”¨å®ç° Aware æ¥å£çš„æ–¹æ³•"></a>è°ƒç”¨å®ç° Aware æ¥å£çš„æ–¹æ³•</h4><p>å¯ä»¥çœ‹åˆ° initializeBean æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨çš„æ˜¯å®ç°çš„ Aware æ¥å£çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…·ä½“çœ‹ä¸€ä¸‹ invokeAwareMethods æ–¹æ³•ä¸­ä¼šè°ƒç”¨ Aware æ¥å£çš„é‚£äº›æ–¹æ³•</p><p><img src="/./Resources/image-20231008103715206.png" alt="image-20231008103715206">æˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚æœæˆ‘ä»¬å®ç°äº†BeanNameAwareï¼ŒBeanClassLoaderAwareï¼ŒBeanFactoryAwareä¸‰ä¸ªAwareæ¥å£çš„è¯ï¼Œä¼šä¾æ¬¡è°ƒç”¨ setBeanName(), setBeanClassLoader(), setBeanFactory() æ–¹æ³•</p><blockquote><p>å¯¹äº Await æ¥å£çš„ä½œç”¨å‚è€ƒï¼š</p><p>Aware æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * A marker superinterface indicating that a bean is eligible to be notified by the</span><br><span class="hljs-comment"> * Spring container of a particular framework object through a callback-style method.</span><br><span class="hljs-comment"> * The actual method signature is determined by individual subinterfaces but should</span><br><span class="hljs-comment"> * typically consist of just one void-returning method that accepts a single argument.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;Note that merely implementing &#123;<span class="hljs-doctag">@link</span> Aware&#125; provides no default functionality.</span><br><span class="hljs-comment"> * Rather, processing must be done explicitly, for example in a</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.config.BeanPostProcessor&#125;.</span><br><span class="hljs-comment"> * Refer to &#123;<span class="hljs-doctag">@link</span> org.springframework.context.support.ApplicationContextAwareProcessor&#125;</span><br><span class="hljs-comment"> * for an example of processing specific &#123;<span class="hljs-doctag">@code</span> *Aware&#125; interface callbacks.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Chris Beams</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Juergen Hoeller</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 3.1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Aware</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Aware æ¥å£ä¸º Spring å®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œæ˜¯ä¸€ä¸ªå…·æœ‰æ ‡è¯†ä½œç”¨çš„è¶…çº§æ¥å£ï¼Œå®ç°äº†è¯¥æ¥å£çš„ bean æ˜¯å…·æœ‰è¢« Spring å®¹å™¨é€šçŸ¥çš„èƒ½åŠ›ï¼Œé€šçŸ¥çš„æ–¹å¼æ˜¯é‡‡ç”¨å›è°ƒçš„æ–¹å¼ã€‚</p><p>Aware æ¥å£æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œå®é™…çš„æ–¹æ³•ç­¾åç”±å„ä¸ªå­æ¥å£æ¥ç¡®å®šï¼Œä¸”è¯¥æ¥å£é€šå¸¸åªä¼šæœ‰ä¸€ä¸ªæ¥æ”¶å•å‚æ•°çš„ set æ–¹æ³•ï¼Œè¯¥ set æ–¹æ³•çš„å‘½åæ–¹å¼ä¸º set + å»æ‰æ¥å£åä¸­çš„ Aware åç¼€ï¼Œå³ XxxAware æ¥å£ï¼Œåˆ™æ–¹æ³•å®šä¹‰ä¸º setXxx()ï¼Œä¾‹å¦‚ BeanNameAwareï¼ˆsetBeanNameï¼‰ï¼ŒApplicationContextAwareï¼ˆsetApplicationContextï¼‰ã€‚</p><p>Aware çš„å­æ¥å£éœ€è¦æä¾›ä¸€ä¸ª <code>setXxx</code> æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“ set æ˜¯è®¾ç½®å±æ€§å€¼çš„æ–¹æ³•ï¼Œå³ Aware ç±»æ¥å£çš„ <code>setXxx</code> æ–¹æ³•å…¶å®å°±æ˜¯è®¾ç½® xxx å±æ€§å€¼çš„ã€‚ Aware çš„å«ä¹‰æ˜¯æ„ŸçŸ¥çš„ã€æ„Ÿåº”çš„ï¼Œé‚£ä¹ˆåœ¨ Spring å®¹å™¨ä¸­æ˜¯å¦‚ä½•å®ç°æ„ŸçŸ¥å¹¶è®¾ç½®å±æ€§å€¼çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»åˆå§‹åŒ– bean ä¸­çš„æ¿€æ´» Aware çš„æ–¹æ³• <code>invokeAwareMethods()</code> ä¸­çœ‹åˆ°ä¸€ç‚¹ç‚¹ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/./Resources/image-20231008111710296.png" alt="image-20231008111710296"></p><p>ä»è¿™ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå°±å¯ä»¥ Aware çœŸæ­£çš„å«ä¹‰æ˜¯ä»€ä¹ˆäº†ï¼Ÿæ„ŸçŸ¥ï¼Œå…¶å®æ˜¯ Spring å®¹å™¨åœ¨åˆå§‹åŒ–ä¸»åŠ¨æ£€æµ‹å½“å‰ bean æ˜¯å¦å®ç°äº† Aware æ¥å£ï¼Œå¦‚æœå®ç°äº†åˆ™å›è°ƒå…¶ set æ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±èƒ½æ‹¿åˆ°å¯¹åº”çš„ XX èµ„æºï¼Œå¯¹ XX èµ„æºåšä¸€äº›å¤„ç†ï¼›</p><p>è¡¥å……ï¼šè™½ç„¶è¿™ä¸ªåå­—å« setXXXï¼Œä½†å®é™…ä¸Šæ›´å¤šçš„è¿˜æ˜¯æ‹¿åˆ°è¿™ä¸ªèµ„æºã€‚</p><p>Spring Aware æ¥å£çš„å®é™…åº”ç”¨åœºæ™¯æ˜¯å¾ˆå¤šçš„ï¼Œæ¯”å¦‚ï¼š</p><ol><li>è·å– Spring å®¹å™¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šé€šè¿‡ ApplicationContextAware æ¥å£å¯ä»¥è·å– Spring å®¹å™¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ Bean ä¸­ä½¿ç”¨ Spring å®¹å™¨æä¾›çš„å„ç§æœåŠ¡ï¼Œå¦‚äº‹ä»¶æœºåˆ¶ã€AOPã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚</li><li>åŠ¨æ€åŠ è½½èµ„æºï¼šé€šè¿‡ ResourceLoaderAware æ¥å£å¯ä»¥è·å– ResourceLoaderï¼Œå¯ä»¥åœ¨ Bean ä¸­åŠ¨æ€åŠ è½½èµ„æºï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶ã€æ¨¡æ¿æ–‡ä»¶ç­‰ã€‚</li><li>æ“ä½œ Servlet ç›¸å…³çš„ä¿¡æ¯ï¼šé€šè¿‡ ServletConfigAware å’Œ ServletContextAware æ¥å£å¯ä»¥è·å– Servlet ç›¸å…³çš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨ Bean ä¸­æ“ä½œ Servlet ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è·å– ServletContext åˆå§‹åŒ–å‚æ•°ã€ServletContext ç›‘å¬å™¨ç­‰ã€‚</li><li>è·å– Bean å·¥å‚çš„ä¿¡æ¯ï¼šé€šè¿‡ BeanFactoryAware æ¥å£å¯ä»¥è·å– BeanFactoryï¼Œå¯ä»¥åœ¨ Bean ä¸­ä½¿ç”¨ BeanFactory æä¾›çš„å„ç§æœåŠ¡ï¼Œå¦‚ Bean ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä¾èµ–æ³¨å…¥ã€AOPã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚</li></ol><p>æ€»ä¹‹ï¼ŒSpring Aware æ¥å£å¯ä»¥è®© Bean æ›´å¥½åœ°ä¸ Spring å®¹å™¨è¿›è¡Œäº¤äº’ï¼Œå®ç°æ›´çµæ´»ã€æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥é¿å…æ»¥ç”¨ Spring Aware æ¥å£ï¼Œå› ä¸ºè¿‡å¤šåœ°ä½¿ç”¨ä¼šå¯¼è‡´ Bean ä¸ Spring å®¹å™¨çš„ç´§è€¦åˆï¼Œé™ä½ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚</p></blockquote><h4 id="è°ƒç”¨-beforeâ€¦-æ–¹æ³•"><a href="#è°ƒç”¨-beforeâ€¦-æ–¹æ³•" class="headerlink" title="è°ƒç”¨ beforeâ€¦ æ–¹æ³•"></a>è°ƒç”¨ beforeâ€¦ æ–¹æ³•</h4><p>å¯ä»¥çœ‹åˆ° applyBeanPostProcessorsBeforeInitialization æ–¹æ³•ä¸­ï¼Œå¦‚æœæœ‰ç±»å®ç°äº† BeanPostProcessor æ¥å£ï¼Œå°±ä¼šæ‰§è¡ŒpostProcessBeforeInitialization æ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœå¤šä¸ªç±»å®ç° BeanPostProcessor æ¥å£ï¼Œé‚£ä¹ˆå¤šä¸ªå®ç°ç±»éƒ½ä¼šæ‰§è¡Œ postProcessBeforeInitialization æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ for å¾ªç¯ä¾æ¬¡æ‰§è¡Œçš„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹å°±æ˜¯å¦‚æœåŠ è½½ A ç±»åˆ°springå®¹å™¨ä¸­ï¼ŒA ç±»ä¹Ÿé‡å†™äº† BeanPostProcessor æ¥å£çš„postProcessBeforeInitialization æ–¹æ³•ï¼Œè¿™æ—¶è¦æ³¨æ„ A ç±»çš„ postProcessBeforeInitialization æ–¹æ³•å¹¶ä¸ä¼šå¾—åˆ°æ‰§è¡Œï¼Œå› ä¸ºAç±»è¿˜æœªåŠ è½½å®Œæˆï¼Œè¿˜æœªå®Œå…¨æ”¾åˆ° Spring çš„ singletonObjects ä¸€çº§ç¼“å­˜ä¸­ã€‚</p><p><img src="/./Resources/image-20231008104006392.png" alt="image-20231008104006392"></p><h4 id="æ‰§è¡Œ-init-method-æ–¹æ³•"><a href="#æ‰§è¡Œ-init-method-æ–¹æ³•" class="headerlink" title="æ‰§è¡Œ init-method æ–¹æ³•"></a>æ‰§è¡Œ init-method æ–¹æ³•</h4><p>å¯ä»¥çœ‹åˆ° invokeInitMethods æ–¹æ³•ä¸­ï¼Œå¦‚æœå®ç°äº† InitializingBean æ¥å£ï¼Œé‡å†™äº† afterPropertiesSet æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒç”¨ afterPropertiesSet æ–¹æ³•ï¼Œæœ€åè¿˜ä¼šè°ƒç”¨æ˜¯å¦æŒ‡å®šäº† init-methodï¼Œå¯ä»¥é€šè¿‡ <code>&lt;bean init-method&gt;</code> æ ‡ç­¾ï¼Œæˆ–è€… @Bean æ³¨è§£çš„ <code>initMethod</code> æŒ‡å®š</p><p><img src="/./Resources/image-20231008104502810.png" alt="image-20231008104502810"></p><h4 id="è°ƒç”¨-afterâ€¦-æ–¹æ³•"><a href="#è°ƒç”¨-afterâ€¦-æ–¹æ³•" class="headerlink" title="è°ƒç”¨ afterâ€¦ æ–¹æ³•"></a>è°ƒç”¨ afterâ€¦ æ–¹æ³•</h4><p>å¯ä»¥çœ‹åˆ° applyBeanPostProcessorsAfterInitialization æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ä¹‹å‰çš„ postProcessBeforeInitialization æ–¹æ³•ï¼ˆç¬¬äºŒæ­¥ï¼‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å¾ªç¯éå†å®ç°äº† BeanPostProcessor çš„æ¥å£å®ç°ç±»ï¼Œæ‰§è¡Œ postProcessAfterInitialization æ–¹æ³•ã€‚æ•´ä¸ª bean çš„ç”Ÿå‘½æ‰§è¡Œæµç¨‹å°±å¦‚ä¸Šé¢æˆªå›¾æ‰€ç¤ºï¼Œå“ªä¸ªæ¥å£çš„æ–¹æ³•åœ¨å“ªé‡Œè¢«è°ƒç”¨ï¼Œæ–¹æ³•çš„æ‰§è¡Œæµç¨‹</p><p><img src="/./Resources/image-20231008104728077.png" alt="image-20231008104728077"></p><blockquote><p>ç¬¬äºŒæ­¥çš„ä»£ç å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°åªæ˜¯åå­—ä¸åŒè€Œå·²</p><p><img src="/./Resources/image-20231008105850710.png" alt="image-20231008105850710"></p></blockquote><p>æœ€åï¼Œå¯¹beançš„ç”Ÿå‘½æµç¨‹è¿›è¡Œä¸€ä¸ªæµç¨‹å›¾çš„æ€»ç»“</p><p><img src="/./Resources/image-20231008105033641.png" alt="image-20231008105033641"></p><blockquote><p>å‚è€ƒæ–‡ç« </p><p><a href="https://www.cnblogs.com/semi-sub/p/13548479.html">Spring ä¸ºä½•éœ€è¦ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼Œè€Œä¸æ˜¯äºŒçº§ç¼“å­˜ - åŠåˆ†ã€ - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/Bronze5/article/details/105902892">springä¸­çš„Awareæ¥å£åŸæ¥æ˜¯è¿™ä¹ˆå›äº‹_spring wareæ¥å£-CSDNåšå®¢</a></p><p><a href="https://cloud.tencent.com/developer/article/1380827">ã€æ­»ç£• Springã€‘â€”â€“ IOC ä¹‹ æ·±å…¥åˆ†æ Aware æ¥å£-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;a href=&quot;#Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ&quot; class=&quot;headerlink&quot; title=&quot;Spring Beançš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;/a&gt;Spring Beançš„ç”Ÿå‘½å‘¨æœŸ&lt;/h1&gt;&lt;h2 id=&quot;Bean-çš„ç”Ÿå‘½å‘¨</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="Spring" scheme="http://conquers.github.io/categories/Java/Spring/"/>
    
    
    <category term="Spring" scheme="http://conquers.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>åƒåœ¾æ”¶é›†å™¨</title>
    <link href="http://conquers.github.io/posts/6158ee9c.html"/>
    <id>http://conquers.github.io/posts/6158ee9c.html</id>
    <published>2023-09-24T07:31:03.000Z</published>
    <updated>2023-09-25T03:00:58.259Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰ç½®çŸ¥è¯†ï¼Œä¸ç„¶ç†è§£è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå›°éš¾</p><ul><li><a href="https://javaguide.cn/java/jvm/memory-area.html">Javaå†…å­˜åŒºåŸŸè¯¦è§£ï¼ˆé‡ç‚¹ï¼‰</a></li><li><a href="https://javaguide.cn/java/jvm/jvm-garbage-collection.html#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95">JVMåƒåœ¾å›æ”¶ç®—æ³•è¯¦è§£</a></li></ul><p><strong>å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚</strong></p><p>å¯¹äºåƒåœ¾æ”¶é›†ç®—æ³•ï¼Œç®€è¦è¯´æ˜å¦‚ä¸‹</p><ul><li>æ ‡è®°-æ¸…é™¤ï¼šäº§ç”Ÿè¿‡å¤šåœ°å†…å­˜ç¢ç‰‡ </li><li>å¤åˆ¶ï¼šæ²¡æœ‰ç¢ç‰‡ï¼Œæµªè´¹ç©ºé—´</li><li>æ ‡è®°-æ•´ç†ï¼šæ²¡æœ‰ç¢ç‰‡ï¼Œæ•ˆç‡è¾ƒä½</li></ul><p>æ¥ä¸‹æ¥è®¨è®ºçš„æ”¶é›†å™¨åŸºäº JDK1.7 Update 14 ä¹‹åçš„ HotSpot è™šæ‹Ÿæœºï¼ˆåœ¨æ­¤ç‰ˆæœ¬ä¸­æ­£å¼æä¾›äº†å•†ç”¨çš„ G1 æ”¶é›†å™¨ï¼Œä¹‹å‰ G1 ä»å¤„äºå®éªŒçŠ¶æ€ï¼‰ï¼Œè¯¥è™šæ‹ŸæœºåŒ…å«çš„æ‰€æœ‰æ”¶é›†å™¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/./Resources/82a369cjhi.jpeg" alt="img"></p><p>ä¸Šå›¾å±•ç¤ºäº† 7 ç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ï¼Œå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚</p><p>è™šæ‹Ÿæœºæ‰€å¤„çš„åŒºåŸŸï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯å±äºæ–°ç”Ÿä»£æ”¶é›†å™¨è¿˜æ˜¯è€å¹´ä»£æ”¶é›†å™¨ã€‚ Hotspot å®ç°äº†å¦‚æ­¤å¤šçš„æ”¶é›†å™¨ï¼Œæ­£æ˜¯å› ä¸ºç›®å‰å¹¶æ— å®Œç¾çš„æ”¶é›†å™¨å‡ºç°ï¼Œåªæ˜¯é€‰æ‹©å¯¹å…·ä½“åº”ç”¨æœ€é€‚åˆçš„æ”¶é›†å™¨ã€‚</p><blockquote><p>æˆªè‡³ Java 15 ç‰ˆæœ¬ï¼Œåƒåœ¾æ”¶é›†å™¨å¦‚ä¸‹ï¼š</p><p>å·¦ä¸º Java 8 ä¹‹å‰ï¼Œå³ä¸º Java 8 ä¹‹åï¼Œå¹¶ä¸” Java 8 ä¹‹åä¸å†åŒºåˆ†å¹´è½»ä»£ï¼Œè€å¹´ä»£ï¼Œä½¿ç”¨åˆ†åŒºæ¨¡å‹æ›¿æ¢åˆ†ä»£æ¨¡å‹ã€‚</p><p><img src="/./Resources/image-20230924170853349.png" alt="image-20230924170853349"></p></blockquote><h2 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨"></a>Serial æ”¶é›†å™¨</h2><p><img src="/./Resources/serial-garbage-collector.png" alt="Serial æ”¶é›†å™¨"></p><p>ä¼˜ç‚¹ï¼šç®€å•é«˜æ•ˆ</p><p>ç¼ºç‚¹ï¼šå•çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆ <strong>â€œStop The Worldâ€</strong> ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚</p><h2 id="ParNew-å›æ”¶å™¨"><a href="#ParNew-å›æ”¶å™¨" class="headerlink" title="ParNew å›æ”¶å™¨"></a>ParNew å›æ”¶å™¨</h2><p><img src="/./Resources/parnew-garbage-collector.png" alt="ParNew æ”¶é›†å™¨ "></p><p>ParNew å›æ”¶å™¨å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº† Serial æ”¶é›†å™¨å¤–ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œåé¢ä¼šä»‹ç»åˆ°ï¼‰é…åˆå·¥ä½œã€‚</p><h2 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h2><p><img src="/./Resources/parallel-scavenge-garbage-collector-1695542218518-10.png" alt="Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><p>Parallel Scavenge ä¸ ParNew å¯¹æ¯”ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºï¼š</p><p>Parallel Scavenge æ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆé«˜æ•ˆç‡çš„åˆ©ç”¨ CPUï¼‰ã€‚CMS ç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯ CPU ä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚ Parallel Scavenge æ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ï¼Œå¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£ï¼Œæ‰‹å·¥ä¼˜åŒ–å­˜åœ¨å›°éš¾çš„æ—¶å€™ï¼Œä½¿ç”¨ Parallel Scavenge æ”¶é›†å™¨é…åˆè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼ŒæŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ul><li>Serialï¼ˆå•çº¿ç¨‹ï¼‰<ul><li>Serial æ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£</li><li>Serial Old æ”¶é›†å™¨ï¼šè€å¹´ä»£</li></ul></li><li>Parnewï¼ˆå¤šçº¿ç¨‹ï¼‰<ul><li>Parnew æ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£ï¼ˆå…¶å®å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼‰</li></ul></li><li>Parallelï¼ˆå¤šçº¿ç¨‹ï¼‰<ul><li>Parallel Scavenge æ”¶é›†å™¨ï¼šæ–°ç”Ÿä»£</li><li>Parallel Old æ”¶é›†å™¨ï¼šè€å¹´ä»£</li></ul></li></ul><p>å¯¹äºä»¥ä¸Šä¸‰ç§ï¼Œ<strong>æ–°ç”Ÿä»£éƒ½æ˜¯é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œ</strong>éƒ½ä¼šå¯¼è‡´ STWç°è±¡ã€‚</p><p>JDK 8 é»˜è®¤ä½¿ç”¨ Parallel Scavenge å’Œ Parallel Oldã€‚</p><h2 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h2><p>ä¸‹å›¾æ˜¯ ParNew å’Œ CMS é…åˆä½¿ç”¨</p><p><img src="/./Resources/image-20230925101008435.png" alt="image-20230925101008435"></p><p>CMS æ”¶é›†è¿‡ç¨‹å¦‚ä¸‹</p><p><img src="/./Resources/cms-garbage-collector-1695607889588-1.png" alt="CMS æ”¶é›†å™¨"></p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong> æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œå¹¶è®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« ï¼›</li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong> åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼š</strong> é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li><li><strong>å¹¶å‘æ¸…é™¤ï¼š</strong> å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li><strong>å¯¹ CPU èµ„æºæ•æ„Ÿï¼›</strong></li><li><strong>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›</strong></li><li><strong>å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•-â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚</strong></li></ul><h2 id="G1-æ”¶é›†å™¨"><a href="#G1-æ”¶é›†å™¨" class="headerlink" title="G1 æ”¶é›†å™¨"></a>G1 æ”¶é›†å™¨</h2><p>G1 æ”¶é›†è¿‡ç¨‹å¦‚ä¸‹</p><p><img src="/./Resources/g1-garbage-collector.png" alt="G1 æ”¶é›†å™¨"></p><ul><li><strong>åˆå§‹æ ‡è®°</strong></li><li><strong>å¹¶å‘æ ‡è®°</strong></li><li><strong>æœ€ç»ˆæ ‡è®°</strong></li><li><strong>ç­›é€‰å›æ”¶</strong></li></ul><h2 id="ZGC-æ”¶é›†å™¨"><a href="#ZGC-æ”¶é›†å™¨" class="headerlink" title="ZGC æ”¶é›†å™¨"></a>ZGC æ”¶é›†å™¨</h2><p>ä¸ CMS ä¸­çš„ ParNew å’Œ G1 ç±»ä¼¼ï¼ŒZGC ä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œä¸è¿‡ ZGC å¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ã€‚</p><p>åœ¨ ZGC ä¸­å‡ºç° Stop The World çš„æƒ…å†µä¼šæ›´å°‘ï¼</p><p>Java11 çš„æ—¶å€™ ï¼ŒZGC è¿˜åœ¨è¯•éªŒé˜¶æ®µã€‚ç»è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œä¸æ–­çš„å®Œå–„å’Œä¿®å¤é—®é¢˜ï¼ŒZGC åœ¨ Java 15 å·²ç»å¯ä»¥æ­£å¼ä½¿ç”¨äº†ï¼</p><p>ä¸è¿‡ï¼Œé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ä¾ç„¶æ˜¯ G1ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°å¯åŠ¨ ZGCï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ java -XX:+UseZGC className<br></code></pre></td></tr></table></figure><p>å…³äº ZGC æ”¶é›†å™¨çš„è¯¦ç»†ä»‹ç»æ¨èé˜…è¯»ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„ <a href="https://tech.meituan.com/2020/08/06/new-zgc-practice-in-meituan.html">æ–°ä¸€ä»£åƒåœ¾å›æ”¶å™¨ ZGC çš„æ¢ç´¢ä¸å®è·µopen in new window</a> è¿™ç¯‡æ–‡ç« ã€‚</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://javaguide.cn/">Java é¢è¯•æŒ‡å— | JavaGuide(Javaé¢è¯• + å­¦ä¹ æŒ‡å—)</a></li><li><a href="https://www.bilibili.com/video/BV1sp4y1Y7ap">https://www.bilibili.com/video/BV1sp4y1Y7ap</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åƒåœ¾æ”¶é›†å™¨&quot;&gt;&lt;a href=&quot;#åƒåœ¾æ”¶é›†å™¨&quot; class=&quot;headerlink&quot; title=&quot;åƒåœ¾æ”¶é›†å™¨&quot;&gt;&lt;/a&gt;åƒåœ¾æ”¶é›†å™¨&lt;/h1&gt;&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="JVM" scheme="http://conquers.github.io/categories/Java/JVM/"/>
    
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Volatile</title>
    <link href="http://conquers.github.io/posts/73afee0.html"/>
    <id>http://conquers.github.io/posts/73afee0.html</id>
    <published>2023-09-13T10:47:24.000Z</published>
    <updated>2023-09-19T01:28:40.949Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h1><h2 id="volatile-ä½œç”¨"><a href="#volatile-ä½œç”¨" class="headerlink" title="volatile ä½œç”¨"></a>volatile ä½œç”¨</h2><ol><li>ä¿è¯æœ‰åºæ€§ï¼šé˜²æ­¢æŒ‡ä»¤é‡æ’åº</li><li>ä¿è¯å¯è§æ€§ï¼šä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§</li></ol><h2 id="ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯æœ‰åºæ€§ï¼ˆé˜²æ­¢é‡æ’åºï¼‰"><a href="#ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯æœ‰åºæ€§ï¼ˆé˜²æ­¢é‡æ’åºï¼‰" class="headerlink" title="ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯æœ‰åºæ€§ï¼ˆé˜²æ­¢é‡æ’åºï¼‰"></a>ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯æœ‰åºæ€§ï¼ˆé˜²æ­¢é‡æ’åºï¼‰</h2><h3 id="ä¸ºä»€ä¹ˆè¦é‡æ’åº"><a href="#ä¸ºä»€ä¹ˆè¦é‡æ’åº" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é‡æ’åº"></a>ä¸ºä»€ä¹ˆè¦é‡æ’åº</h3><p><img src="/./Resources/image-20230913185055524.png" alt="image-20230913185055524"></p><ul><li>å›¾ä¸­å·¦ä¾§æ˜¯ 3 è¡Œ Java ä»£ç ï¼Œå³ä¾§æ˜¯è¿™ 3 è¡Œä»£ç å¯èƒ½è¢«è½¬åŒ–æˆçš„æŒ‡ä»¤ã€‚</li><li>å¯ä»¥çœ‹å‡º a &#x3D; 100 å¯¹åº”çš„æ˜¯ Load aã€Set to 100ã€Store aï¼Œæ„å‘³ç€ä»ä¸»å­˜ä¸­è¯»å– a çš„å€¼ï¼Œç„¶åæŠŠå€¼è®¾ç½®ä¸º 100ï¼Œå¹¶å­˜å‚¨å›å»ï¼ŒåŒç†ï¼Œ b &#x3D; 5 å¯¹åº”çš„æ˜¯ä¸‹é¢ä¸‰è¡Œ Load bã€Set to 5ã€Store bï¼Œæœ€åçš„ a &#x3D; a + 10ï¼Œå¯¹åº”çš„æ˜¯ Load aã€Set to 110ã€Store aã€‚</li><li>å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç°è¿™é‡Œæœ‰ä¸¤æ¬¡â€œLoad aâ€å’Œä¸¤æ¬¡â€œStore aâ€ï¼ˆå›¾ä¸­é»‘çº¿ï¼‰ï¼Œè¯´æ˜å­˜åœ¨ä¸€å®šçš„é‡æ’åºçš„ä¼˜åŒ–ç©ºé—´ã€‚</li></ul><p><strong>ä¼˜åŒ–ï¼š</strong></p><p><img src="/./Resources/image-20230913185125737.png" alt="image-20230913185125737"></p><ul><li>é‡æ’åºåï¼Œ a çš„ä¸¤æ¬¡æ“ä½œè¢«æ”¾åˆ°ä¸€èµ·ï¼ŒæŒ‡ä»¤æ‰§è¡Œæƒ…å†µå˜ä¸º Load aã€Set to 100ã€Set to 110ã€ Store aã€‚</li><li>ä¸‹é¢å’Œ b ç›¸å…³çš„æŒ‡ä»¤ä¸å˜ï¼Œä»å¯¹åº” Load bã€ Set to 5ã€Store bã€‚</li><li>å¯ä»¥çœ‹å‡ºï¼Œé‡æ’åºå a çš„ç›¸å…³æŒ‡ä»¤å‘ç”Ÿäº†å˜åŒ–ï¼ŒèŠ‚çœäº†ä¸€æ¬¡ Load a å’Œä¸€æ¬¡ Store aã€‚</li><li>é‡æ’åºé€šè¿‡å‡å°‘æ‰§è¡ŒæŒ‡ä»¤ï¼Œä»è€Œæé«˜æ•´ä½“çš„è¿è¡Œé€Ÿåº¦ï¼Œè¿™å°±æ˜¯é‡æ’åºå¸¦æ¥çš„ä¼˜åŒ–å’Œå¥½å¤„ã€‚</li></ul><p><strong>å³æŒ‡ä»¤é‡æ’åºæ˜¯åœ¨ä¸å½±å“å•çº¿ç¨‹ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œè®¡ç®—æœºä¸ºäº†æœ€å¤§é™åº¦çš„å‘æŒ¥æœºå™¨æ€§èƒ½ï¼Œä¼šå¯¹æœºå™¨æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</strong></p><p><img src="/./Resources/image-20230918192654886.png" alt="image-20230918192654886"></p><p>ä½†é‡æ’åºä¼šéµå¾ª <code>as-if-serial</code> ä¸ <code>happens-before</code> åŸåˆ™ï¼›</p><h3 id="é‡æ’åºå¸¦æ¥çš„é—®é¢˜"><a href="#é‡æ’åºå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="é‡æ’åºå¸¦æ¥çš„é—®é¢˜"></a>é‡æ’åºå¸¦æ¥çš„é—®é¢˜</h3><p>å•çº¿ç¨‹ä¸‹ï¼Œé‡æ’åºæ—¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸‹å°±ä¼šå‡ºç°é—®é¢˜</p><p><strong>ä¾‹å¦‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>, a = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        Set&lt;String&gt; res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000000</span>; i++) &#123;<br>            x = <span class="hljs-number">0</span>;<br>            y = <span class="hljs-number">0</span>;<br>            a = <span class="hljs-number">0</span>;<br>            b = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-type">Thread</span> <span class="hljs-variable">one</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                a = y; <span class="hljs-comment">// 1</span><br>                x = <span class="hljs-number">1</span>; <span class="hljs-comment">// 2</span><br>            &#125;);<br><br>            <span class="hljs-type">Thread</span> <span class="hljs-variable">two</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                b = x; <span class="hljs-comment">// 3</span><br>                y = <span class="hljs-number">1</span>; <span class="hljs-comment">// 4</span><br>            &#125;);<br>            one.start();<br>            two.start();<br>            one.join();<br>            two.join();<br>            res.add(<span class="hljs-string">&quot;a=&quot;</span> + a + <span class="hljs-string">&quot;,&quot;</span> + <span class="hljs-string">&quot;b=&quot;</span> + b);<br>            System.out.println(res);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼šå‡ºç°ç»“æœï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">[<span class="hljs-attribute">a</span>=0,b=0, <span class="hljs-attribute">a</span>=1,b=0, <span class="hljs-attribute">a</span>=0,b=1, <span class="hljs-attribute">a</span>=1,b=1]<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œæœ€åä¸€ä¸ªå°±æ˜¯æŒ‡ä»¤é‡æ’åºçš„ç»“æœï¼Œå³å°† 2 æ’åœ¨äº† 1 å‰é¢ï¼Œ4 æ’åœ¨äº† 3å‰é¢ã€‚</p><h3 id="æ€ä¹ˆé˜²æ­¢é‡æ’åº"><a href="#æ€ä¹ˆé˜²æ­¢é‡æ’åº" class="headerlink" title="æ€ä¹ˆé˜²æ­¢é‡æ’åº"></a>æ€ä¹ˆé˜²æ­¢é‡æ’åº</h3><p>å¯¹äº volatile ä¿®é¥°çš„å˜é‡ï¼Œä¼šä½¿ç”¨å†…å­˜å±éšœé˜»æ­¢é‡æ’åºï¼Œå†…å­˜å±éšœä½¿ç”¨äº† lock å‰ç¼€çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè¯¥æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯é€šè¿‡ç¡¬ä»¶é˜»æ­¢é‡æ’åºï¼ˆè§ lock æ±‡ç¼–æŒ‡ä»¤ç¬¬ä¸€æ¡ï¼‰</p><p><strong>Java è§„èŒƒå®šä¹‰çš„å†…å­˜å±éšœ</strong></p><table><thead><tr><th>å±éšœç±»å‹</th><th>æŒ‡ä»¤ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>LoadLoad</td><td>Load1;LoadLoad;Load2</td><td>ä¿è¯ Load1 çš„è¯»å–æ“ä½œåœ¨ Load2 åŠåç»­è¯»å–æ“ä½œä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>StoreStore</td><td>Store1;StoreStore;Store2</td><td>åœ¨ Store2 åŠå…¶åçš„å†™æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ Store1 çš„å†™æ“ä½œå·²åˆ·æ–°åˆ°ä¸»å†…å­˜</td></tr><tr><td>LoadStore</td><td>Load1;LoadStore;Store2</td><td>åœ¨ Store2 åŠå…¶åçš„å†™æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ Load1 çš„è¯»æ“ä½œå·²è¯»å–ç»“æŸ</td></tr><tr><td>StoreLoad</td><td>Store1;StoreLoad;Load2</td><td>ä¿è¯ Load1 çš„å†™æ“ä½œå·²åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼ŒLoad2 åŠå…¶åçš„è¯»æ“ä½œæ‰èƒ½æ‰§è¡Œ</td></tr></tbody></table><blockquote><p>Loadï¼šè¯»å–</p><p>Storeï¼šå†™å…¥</p></blockquote><p><strong>Java è§„å®š volatile éœ€è¦å®ç°çš„å†…å­˜å±éšœ</strong></p><ul><li>å†™<ul><li>åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚</li><li>åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚</li><li><img src="/./Resources/image-20230918205948041.png" alt="image-20230918205948041"></li></ul></li><li>è¯»<ul><li>åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚</li><li>åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœ</li><li><img src="/./Resources/image-20230918205952756.png" alt="image-20230918205952756"></li></ul></li></ul><h2 id="ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯å¯è§æ€§"><a href="#ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯å¯è§æ€§" class="headerlink" title="ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯å¯è§æ€§"></a>ä¸ºä»€ä¹ˆå¯ä»¥ä¿è¯å¯è§æ€§</h2><p>å¯¹äº volatile ä¿®é¥°çš„å˜é‡ï¼Œä¼šå¢åŠ ä¸€æ¡ lock å‰ç¼€çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè¯¥æ¡æŒ‡ä»¤çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹çš„å·¥ä½œå†…å­˜å†™å…¥ä¸»å­˜ï¼ˆè§ lock æ±‡ç¼–æŒ‡ä»¤ç¬¬ä¸‰æ¡ï¼‰</p><p><img src="/./Resources/image-20230918185709446.png" alt="image-20230918185709446"></p><h2 id="ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§"></a>ä¸ºä»€ä¹ˆä¸èƒ½ä¿è¯åŸå­æ€§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        i++;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">+ 0 getstatic #2 &lt;Main.i : I&gt;</span><br><span class="hljs-addition">+ 3 iconst_1</span><br><span class="hljs-addition">+ 4 iadd</span><br><span class="hljs-addition">+ 5 putstatic #2 &lt;Main.i : I&gt;</span><br>8 return<br></code></pre></td></tr></table></figure><ul><li><p>å‚è€ƒã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ï¼ši ++ å¯¹åº”çš„æ“ä½œå¯¹åº”ç»¿è‰²éƒ¨åˆ†ï¼Œå½“ getstatic æŒ‡ä»¤æŠŠ i çš„å€¼å–åˆ°æ“ä½œæ ˆé¡¶æ—¶ï¼Œvolatile å…³é”®å­—ä¿è¯äº† i çš„å€¼åœ¨æ­¤æ—¶æ˜¯æ­£ç¡®çš„ï¼Œä½†åœ¨æ‰§è¡Œ iconst_1, iadd è¿™äº›æŒ‡ä»¤çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½å·²ç»æŠŠ i çš„å€¼æ”¹å˜äº†ï¼Œè€Œæ“ä½œæ ˆé¡¶çš„å€¼å°±å˜æˆäº†è¿‡æœŸçš„æ•°æ®ï¼Œæ‰€ä»¥ putstatic æŒ‡ä»¤æ‰§è¡Œåå°±å¯èƒ½æŠŠè¾ƒå°çš„ i å€¼åŒæ­¥å›ä¸»å­˜ä¹‹ä¸­ã€‚</p></li><li><p>å‚è€ƒã€Š<a href="https://www.cnblogs.com/simpleDi/p/11517150.html">ä¸ºä»€ä¹ˆvolatileèƒ½ä¿è¯æœ‰åºæ€§ä¸èƒ½ä¿è¯åŸå­æ€§</a>ã€‹ï¼ši ++ï¼Œå®é™…ä¸Šæ˜¯ 3 æ­¥æ“ä½œï¼Œé¦–å…ˆè¯»å– i çš„å€¼ï¼Œç„¶åå°† i + 1 èµ‹å€¼ç»™ä¸­é—´å˜é‡ï¼Œæœ€åå°†ä¸­é—´å˜é‡çš„å€¼èµ‹ç»™ iï¼›å› æ­¤å³ä½¿æ˜¯ä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¹Ÿåªèƒ½ä¿è¯ç¬¬ä¸€æ­¥å¼ºåˆ¶ä»ä¸»å­˜è·å– i çš„å€¼ï¼Œå‡è®¾ä¸¤ä¸ªçº¿ç¨‹ï¼ˆAå’ŒBï¼‰éƒ½å·²ç»è·å–åˆ°äº† i çš„å€¼ï¼Œä¹Ÿå°† i + 1 çš„å€¼èµ‹ç»™äº†ä¸­é—´å˜é‡ï¼Œå³ä½¿çº¿ç¨‹ A ä¿®æ”¹å®Œæˆåï¼Œå¹¶é€šçŸ¥å…¶ä»–çº¿ç¨‹ i çš„å€¼å·²ç»å¤±æ•ˆï¼Œéœ€è¦é‡æ–°ä»ä¸»å­˜ä¸­è·å–ï¼Œä½†æ˜¯çº¿ç¨‹ B å·²ç»èµ°åˆ°äº†ç¬¬äºŒæ­¥ï¼Œi çš„å€¼æ›´æ”¹æˆä»€ä¹ˆï¼Œéƒ½å·²ç»æ™šäº†ï¼Œæ¢å¥è¯è¯´ï¼Œvolatile ç¡®å®æ˜¯ä¿è¯äº†å¯è§æ€§ï¼Œä½†è¿™ä¸ªå¯è§æ€§æ¥çš„å¤ªæ™šäº†ä¸€äº›ï¼›</p></li></ul><p><strong>ä¿è¯åŸå­æ€§éœ€è¦ç”¨åˆ°é”æœºåˆ¶ï¼›</strong></p><h2 id="as-if-serial"><a href="#as-if-serial" class="headerlink" title="as-if-serial"></a>as-if-serial</h2><p>as-if-serial è¯­ä¹‰çš„æ„æ€æ˜¯ï¼š<strong>ä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦)ï¼Œ(å•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜</strong>ã€‚ç¼–è¯‘å™¨ã€runtime å’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆ as-if-serial è¯­ä¹‰ã€‚</p><p>ä¸ºäº†éµå®ˆ as-if-serial è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨<strong>ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åº</strong>ï¼Œå› ä¸ºè¿™ç§é‡æ’åºä¼šæ”¹å˜æ‰§è¡Œç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¿™äº›æ“ä½œå°±å¯èƒ½è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºã€‚</p><h2 id="happens-before"><a href="#happens-before" class="headerlink" title="happens-before"></a>happens-before</h2><p>Java å†…å­˜æ¨¡å‹å…·å¤‡ä¸€äº›å…ˆå¤©çš„â€œæœ‰åºæ€§â€ï¼Œå³ä¸éœ€è¦é€šè¿‡ä»»ä½•åŒæ­¥æ‰‹æ®µï¼ˆvolatileã€synchronized ç­‰ï¼‰å°±èƒ½å¤Ÿå¾—åˆ°ä¿è¯çš„å®‰å…¨ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿç§°ä¸º <code>happens-before</code> åŸåˆ™ï¼Œå®ƒæ˜¯å¯è§æ€§ä¸æœ‰åºæ€§çš„ä¸€å¥—è§„åˆ™æ€»ç»“</p><p>ä¸ç¬¦åˆ <code>happens-before</code> è§„åˆ™ï¼Œ<code>JMM</code> å¹¶ä¸èƒ½ä¿è¯ä¸€ä¸ªçº¿ç¨‹çš„å¯è§æ€§å’Œæœ‰åºæ€§</p><ol><li><p>ç¨‹åºæ¬¡åºè§„åˆ™ (<code>Program Order Rule</code>)ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼Œé€»è¾‘ä¸Šä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œ ï¼Œå› ä¸º<strong>å¤šä¸ªæ“ä½œä¹‹é—´æœ‰å…ˆåä¾èµ–å…³ç³»</strong>ï¼Œåˆ™ä¸å…è®¸å¯¹è¿™äº›æ“ä½œè¿›è¡Œé‡æ’åº</p></li><li><p>é”å®šè§„åˆ™ (<code>Monitor Lock Rule</code>)ï¼šä¸€ä¸ª unlock æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢ï¼ˆæ—¶é—´çš„å…ˆåï¼‰å¯¹åŒä¸€ä¸ªé”çš„ lock æ“ä½œï¼Œæ‰€ä»¥çº¿ç¨‹è§£é” m ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼ˆè§£é”å‰ä¼šåˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼‰ï¼Œå¯¹äºæ¥ä¸‹æ¥å¯¹ m åŠ é”çš„å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§</p></li><li><p><strong>volatile å˜é‡è§„åˆ™</strong>  (<code>Volatile Variable Rule</code>)ï¼šå¯¹ volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»</p></li><li><p>ä¼ é€’è§„åˆ™ (<code>Transitivity</code>)ï¼šå…·æœ‰ä¼ é€’æ€§ï¼Œå¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Bï¼Œè€Œæ“ä½œ B åˆå…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ C</p></li><li><p>çº¿ç¨‹å¯åŠ¨è§„åˆ™ (<code>Thread Start Rule</code>)ï¼šThread å¯¹è±¡çš„ <code>start()</code> æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹ä¸­çš„æ¯ä¸€ä¸ªæ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<span class="hljs-comment">//çº¿ç¨‹ start å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹è¯¥çº¿ç¨‹å¼€å§‹åå¯¹è¯¥å˜é‡çš„è¯»å¯è§</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;System.out.println(x);&#125;,<span class="hljs-string">&quot;t1&quot;</span>).start();<br></code></pre></td></tr></table></figure></li><li><p>çº¿ç¨‹ä¸­æ–­è§„åˆ™ (<code>Thread Interruption Rule</code>)ï¼šå¯¹çº¿ç¨‹ <code>interrupt()</code> æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿ</p></li><li><p>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ (<code>Thread Termination Rule</code>)ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡ <code>Thread.join()</code> æ–¹æ³•ç»“æŸã€<code>Thread.isAlive()</code> çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œ</p></li><li><p>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼ˆ<code>Finaizer Rule</code>ï¼‰ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„ <code>finalize()</code> æ–¹æ³•çš„å¼€å§‹</p></li></ol><h2 id="å¯¹æ¯”äº-synchronized"><a href="#å¯¹æ¯”äº-synchronized" class="headerlink" title="å¯¹æ¯”äº synchronized"></a>å¯¹æ¯”äº synchronized</h2><p>volatile åªèƒ½è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§ï¼›</p><p>synchronized å¯ä»¥è§£å†³åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ï¼›</p><ul><li>åŸå­æ€§ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸è¢«æ‰“æ–­çš„ç‰¹æ€§ã€‚è¢« synchronized ä¿®é¥°çš„ä»£ç æ˜¯å…·æœ‰åŸå­æ€§çš„ï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½èƒ½æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆéƒ½ä¸æˆåŠŸã€‚</li><li>å¯è§æ€§ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹æ”¹å˜äº†å…±äº«å˜é‡ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çŸ¥é“è¿™ä¸ªå˜é‡è¢«ä¿®æ”¹ã€‚æˆ‘ä»¬çŸ¥é“åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œä¸åŒçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼Œè€Œæœ¬åœ°å†…å­˜æ˜¯ä¸»å†…å­˜çš„å‰¯æœ¬ã€‚å¦‚æœçº¿ç¨‹ä¿®æ”¹äº†æœ¬åœ°å†…å­˜è€Œæ²¡æœ‰å»æ›´æ–°ä¸»å†…å­˜ï¼Œé‚£ä¹ˆå°±æ— æ³•ä¿è¯å¯è§æ€§ã€‚synchronizedåœ¨ä¿®æ”¹äº†æœ¬åœ°å†…å­˜ä¸­çš„å˜é‡åï¼Œè§£é”å‰ä¼šå°†æœ¬åœ°å†…å­˜ä¿®æ”¹çš„å†…å®¹åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œç¡®ä¿äº†å…±äº«å˜é‡çš„å€¼æ˜¯æœ€æ–°çš„ï¼Œä¹Ÿå°±ä¿è¯äº†å¯è§æ€§ã€‚</li><li>æœ‰åºæ€§ï¼šæŒ‡çš„æ˜¯ç¨‹åºæŒ‰ç…§ä»£ç å…ˆåé¡ºåºæ‰§è¡Œã€‚synchronizedæ˜¯èƒ½å¤Ÿä¿è¯æœ‰åºæ€§çš„ã€‚æ ¹æ® as-if-serial è¯­ä¹‰ï¼Œæ— è®ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€ä¹ˆä¼˜åŒ–æˆ–æŒ‡ä»¤é‡æ’ï¼Œå•çº¿ç¨‹ä¸‹çš„è¿è¡Œç»“æœä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚è€Œsynchronizedä¿è¯äº†å•çº¿ç¨‹ç‹¬å CPUï¼Œä¹Ÿå°±ä¿è¯äº†æœ‰åºæ€§ã€‚</li></ul><h2 id="lock-æ±‡ç¼–æŒ‡ä»¤"><a href="#lock-æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="lock æ±‡ç¼–æŒ‡ä»¤"></a>lock æ±‡ç¼–æŒ‡ä»¤</h2><p>ä¸åŒçš„åº•å±‚ç¡¬ä»¶å¯¹äº lock æŒ‡ä»¤æ˜¯ä¸åŒçš„ï¼Œå¯¹äº IA-32 å’Œ Intel 64 æ¶æ„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œä¸­çš„è§£é‡Šæ˜¯</p><ol><li><p><strong>ä¼šå°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®ç«‹å³å†™å›åˆ°ç³»ç»Ÿå†…å­˜</strong></p></li><li><p>è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šå¼•èµ·åœ¨å…¶ä»– CPU é‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆ( MESI åè®®ï¼‰ï¼Œå…³äº MESI åè®®ï¼Œå‚é˜…ï¼š<a href="https://zhuanlan.zhihu.com/p/351550104">CPUç¼“å­˜ä¸€è‡´æ€§åè®®MESI </a>ã€‚</p></li><li><p>æä¾›<strong>å†…å­˜å±éšœ</strong>åŠŸèƒ½ï¼Œä½¿ lock å‰åæŒ‡ä»¤<strong>ä¸èƒ½é‡æ’åº</strong>ï¼ˆå¦ä¸€ä¸ªä½œç”¨ï¼Œé˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼‰</p></li></ol><blockquote><p>Lock å‰ç¼€ï¼ŒLock ä¸æ˜¯ä¸€ç§å†…å­˜å±éšœï¼Œä½†æ˜¯å®ƒèƒ½å®Œæˆç±»ä¼¼å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚Lock ä¼šå¯¹ CPU æ€»çº¿å’Œé«˜é€Ÿç¼“å­˜åŠ é”ï¼Œå¯ä»¥ç†è§£ä¸º CPU æŒ‡ä»¤çº§çš„ä¸€ç§é”ã€‚</p></blockquote><h2 id="JDK-æºç å®ç°"><a href="#JDK-æºç å®ç°" class="headerlink" title="JDK æºç å®ç°"></a>JDK æºç å®ç°</h2><p>å½“å˜é‡åæœ‰ volatile ä¿®é¥°æ—¶ï¼Œèµ‹å€¼ç»“æŸä¹‹åå°±ä¼šåŠ ä¸Š <code>storeload</code> </p><p><img src="/./Resources/image-20230918212145420.png" alt="image-20230918212145420"></p><p><code>storeload</code> å®ç°å°±æ˜¯åŠ ä¸Š lock å‰ç¼€çš„æ±‡ç¼–æŒ‡ä»¤</p><p><img src="/./Resources/image-20230918212438427.png" alt="image-20230918212438427"></p><p>å›¾ä¸€çš„ç±»å’Œå›¾äºŒçš„æºç å¦‚ä¸‹<br><img src="/./Resources/image-20230918212653647.png" alt="image-20230918212653647"></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://gee.cs.oswego.edu/dl/jmm/cookbook.html">The JSR-133 Cookbook (oswego.edu)</a></li><li><a href="https://blog.csdn.net/weixin_37841366/article/details/113086438">ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åºï¼Ÿä¸ºä»€ä¹ˆè¦é‡æ’åºï¼Ÿ_HCH996çš„åšå®¢-CSDNåšå®¢</a></li><li><a href="https://blog.csdn.net/qq_32273417/article/details/109148693">å­—èŠ‚é¢è¯•å®˜ï¼šsynchronizedèƒ½ä¿è¯å¯è§æ€§å—_sychorinized èƒ½ä¿è¯å¯è§æ€§å—_SKYæŠ€æœ¯ä¿®ç‚¼æŒ‡å—çš„åšå®¢-CSDNåšå®¢</a></li><li><a href="https://blog.csdn.net/pang5356/article/details/109226307">volatileç¦æ­¢é‡æ’åºçš„åŸç†-å†…å­˜å±éšœ_volitileç¦æ­¢æŒ‡ä»¤é‡æ’çš„åŸç†_bingaPangçš„åšå®¢-CSDNåšå®¢</a></li><li><a href="https://blog.csdn.net/ly262173911/article/details/106063924">javaå¹¶å‘ç¼–ç¨‹(äºŒ)-volatileå†™æ“ä½œå‰ä¸ºä»€ä¹ˆä¸åŠ LoadStoreå±éšœ_å¤§è‡­å¤ªè‡­çš„åšå®¢-CSDNåšå®¢</a></li><li><a href="https://www.bilibili.com/video/BV1fD4y1e79C/?p=13">https://www.bilibili.com/video/BV1fD4y1e79C/?p=13</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Volatile&quot;&gt;&lt;a href=&quot;#Volatile&quot; class=&quot;headerlink&quot; title=&quot;Volatile&quot;&gt;&lt;/a&gt;Volatile&lt;/h1&gt;&lt;h2 id=&quot;volatile-ä½œç”¨&quot;&gt;&lt;a href=&quot;#volatile-ä½œç”¨&quot; class</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="JUC" scheme="http://conquers.github.io/categories/Java/JUC/"/>
    
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java ä»£ç†æ¨¡å¼è¯¦è§£</title>
    <link href="http://conquers.github.io/posts/55890944.html"/>
    <id>http://conquers.github.io/posts/55890944.html</id>
    <published>2023-07-31T07:31:13.000Z</published>
    <updated>2023-08-16T07:32:57.495Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h1><h2 id="ä¸€ã€ä»£ç†æ¨¡å¼"><a href="#ä¸€ã€ä»£ç†æ¨¡å¼" class="headerlink" title="ä¸€ã€ä»£ç†æ¨¡å¼"></a>ä¸€ã€ä»£ç†æ¨¡å¼</h2><p>ä»£ç†è®¾è®¡æ¨¡å¼çš„åŸç†</p><p>ä½¿ç”¨ä¸€ä¸ªä»£ç†å°†å¯¹è±¡åŒ…è£…èµ·æ¥, ç„¶åç”¨è¯¥ä»£ç†å¯¹è±¡å–ä»£åŸå§‹å¯¹è±¡ã€‚ä»»ä½•å¯¹åŸå§‹å¯¹è±¡çš„è°ƒç”¨éƒ½è¦é€šè¿‡ä»£ç†ã€‚ä»£ç†å¯¹è±¡å†³å®šæ˜¯å¦ä»¥åŠä½•æ—¶å°†æ–¹æ³•è°ƒç”¨è½¬åˆ°åŸå§‹å¯¹è±¡ä¸Šã€‚</p><h2 id="äºŒã€é™æ€ä»£ç†"><a href="#äºŒã€é™æ€ä»£ç†" class="headerlink" title="äºŒã€é™æ€ä»£ç†"></a>äºŒã€é™æ€ä»£ç†</h2><p>ä¹‹å‰ç¼–å†™è¿‡ä»£ç†æœºåˆ¶çš„æ“ä½œï¼Œå±äºé™æ€ä»£ç†ï¼Œç‰¹å¾æ˜¯ä»£ç†ç±»å’Œç›®æ ‡å¯¹è±¡çš„ç±»éƒ½æ˜¯åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šä¸‹æ¥ï¼Œä¸åˆ©äºç¨‹åºçš„æ‰©å±•ã€‚åŒæ—¶ï¼Œæ¯ä¸€ä¸ªä»£ç†ç±»åªèƒ½ä¸ºä¸€ä¸ªæ¥å£æœåŠ¡ï¼Œè¿™æ ·ä¸€æ¥ç¨‹åºå¼€å‘ä¸­å¿…ç„¶äº§ç”Ÿè¿‡å¤šçš„ä»£ç†ã€‚å‚è€ƒï¼š<a href="Java-1-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B.md#6.3%E3%80%81%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%9A%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F(Proxy)">æ¥å£çš„åº”ç”¨ï¼šä»£ç†æ¨¡å¼(Proxy)</a>ã€‚</p><p>é™æ€ä»£ç†å®ç°æ­¥éª¤:</p><ol><li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li><li>åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŒæ ·å®ç°è¿™ä¸ªæ¥å£</li><li>å°†ç›®æ ‡å¯¹è±¡æ³¨å…¥è¿›ä»£ç†ç±»ï¼Œç„¶ååœ¨ä»£ç†ç±»çš„å¯¹åº”æ–¹æ³•è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„å¯¹åº”æ–¹æ³•ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»£ç†ç±»å±è”½å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰ååšä¸€äº›è‡ªå·±æƒ³åšçš„äº‹æƒ…ã€‚</li></ol><p>ä¸¾ä¾‹1ï¼š<a href="Java-1-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B.md#6.3%E3%80%81%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%9A%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F(Proxy)">æ¥å£çš„åº”ç”¨ï¼šä»£ç†æ¨¡å¼(Proxy)</a></p><p>ä¸¾ä¾‹2ï¼š</p><p><strong>1.å®šä¹‰å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SmsService</span> &#123;<br>    String <span class="hljs-title function_">send</span><span class="hljs-params">(String message)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>2.å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmsService</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">(String message)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;send message:&quot;</span> + message);<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>3.åˆ›å»ºä»£ç†ç±»å¹¶åŒæ ·å®ç°å‘é€çŸ­ä¿¡çš„æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmsService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SmsService smsService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SmsProxy</span><span class="hljs-params">(SmsService smsService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.smsService = smsService;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">(String message)</span> &#123;<br>        <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;before method send()&quot;</span>);<br>        smsService.send(message);<br>        <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;after method send()&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>4.å®é™…ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">SmsService</span> <span class="hljs-variable">smsService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsServiceImpl</span>();<br>        <span class="hljs-type">SmsProxy</span> <span class="hljs-variable">smsProxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsProxy</span>(smsService);<br>        smsProxy.send(<span class="hljs-string">&quot;java&quot;</span>);<br>        <span class="hljs-comment">// smsService.send(&quot;java&quot;) ç›´æ¥è°ƒç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†ä»£ç†æ¨¡å¼å¯ä»¥åœ¨å‰ååšä¸€äº›å…¶ä»–çš„æ“ä½œï¼Œå³ä¸ä»…å¯ä»¥æ§åˆ¶å¯¹åŸæœ‰å¯¹è±¡çš„è®¿é—®ï¼Œè¿˜å¯ä»¥åœ¨åŸæœ‰å¯¹è±¡çš„è®¿é—®çš„åŸºç¡€ä¸Šåšä¸€äº›é¢å¤–çš„èƒ½åŠ›</span><br>        <span class="hljs-comment">// è¾“å‡ºç»“æœï¼šsend message:java</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ä¹‹åï¼Œæ§åˆ¶å°æ‰“å°å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">before method send()<br>send message:java<br>after method send()<br></code></pre></td></tr></table></figure><p>å¯ä»¥è¾“å‡ºç»“æœçœ‹å‡ºï¼Œæˆ‘ä»¬å·²ç»å¢åŠ äº† <code>SmsServiceImpl</code> çš„<code>send()</code>æ–¹æ³•ã€‚</p><h2 id="ä¸‰ã€åŠ¨æ€ä»£ç†"><a href="#ä¸‰ã€åŠ¨æ€ä»£ç†" class="headerlink" title="ä¸‰ã€åŠ¨æ€ä»£ç†"></a>ä¸‰ã€åŠ¨æ€ä»£ç†</h2><p>ç›¸æ¯”äºé™æ€ä»£ç†æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ã€‚æˆ‘ä»¬ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½å•ç‹¬åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œå¹¶ä¸”ä¹Ÿä¸éœ€è¦æˆ‘ä»¬å¿…é¡»å®ç°æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»( <em>CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶</em>)ã€‚</p><p><strong>ä» JVM è§’åº¦æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</strong></p><p>è¯´åˆ°åŠ¨æ€ä»£ç†ï¼ŒSpring AOPã€RPC æ¡†æ¶åº”è¯¥æ˜¯ä¸¤ä¸ªä¸å¾—ä¸æçš„ï¼Œå®ƒä»¬çš„å®ç°éƒ½ä¾èµ–äº†åŠ¨æ€ä»£ç†ã€‚</p><p><strong>åŠ¨æ€ä»£ç†åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„ç›¸å¯¹è¾ƒå°‘ï¼Œä½†æ˜¯åœ¨æ¡†æ¶ä¸­çš„å‡ ä¹æ˜¯å¿…ç”¨çš„ä¸€é—¨æŠ€æœ¯ã€‚å­¦ä¼šäº†åŠ¨æ€ä»£ç†ä¹‹åï¼Œå¯¹äºæˆ‘ä»¬ç†è§£å’Œå­¦ä¹ å„ç§æ¡†æ¶çš„åŸç†ä¹Ÿéå¸¸æœ‰å¸®åŠ©ã€‚</strong></p><p>å°± Java æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ <strong>JDK åŠ¨æ€ä»£ç†</strong>ã€<strong>CGLIB åŠ¨æ€ä»£ç†</strong>ç­‰ç­‰ã€‚</p><h3 id="3-1-JDK-åŠ¨æ€ä»£ç†æœºåˆ¶"><a href="#3-1-JDK-åŠ¨æ€ä»£ç†æœºåˆ¶" class="headerlink" title="3.1. JDK åŠ¨æ€ä»£ç†æœºåˆ¶"></a>3.1. JDK åŠ¨æ€ä»£ç†æœºåˆ¶</h3><h4 id="3-1-1-ä»‹ç»"><a href="#3-1-1-ä»‹ç»" class="headerlink" title="3.1.1. ä»‹ç»"></a>3.1.1. ä»‹ç»</h4><p><strong>åœ¨ Java åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ <code>InvocationHandler</code> æ¥å£å’Œ <code>Proxy</code> ç±»æ˜¯æ ¸å¿ƒã€‚</strong></p><p><code>Proxy</code> ç±»ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ–¹æ³•æ˜¯ï¼š<code>newProxyInstance()</code> ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">newProxyInstance</span><span class="hljs-params">(ClassLoader loader,</span><br><span class="hljs-params">                                      Class&lt;?&gt;[] interfaces,</span><br><span class="hljs-params">                                      InvocationHandler h)</span><br>    <span class="hljs-keyword">throws</span> IllegalArgumentException<br>&#123;<br>    ......<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¸€å…±æœ‰ 3 ä¸ªå‚æ•°ï¼š</p><ol><li><code>ClassLoader loaderr</code> :ç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†å¯¹è±¡ã€‚</li><li><code>Class&lt;?&gt;[] interfaces</code>: è¢«ä»£ç†ç±»å®ç°çš„ä¸€äº›æ¥å£ï¼›</li><li><code>InvocationHandler h</code>: å®ç°äº† <code>InvocationHandler</code> æ¥å£çš„å¯¹è±¡ï¼›</li></ol><p>è¦å®ç°åŠ¨æ€ä»£ç†çš„è¯ï¼Œè¿˜å¿…é¡»éœ€è¦å®ç° <code>InvocationHandler</code>  æ¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚ å½“æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘åˆ°å®ç° <code>InvocationHandler</code> æ¥å£ç±»çš„ <code>invoke</code> æ–¹æ³•æ¥è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“ä½ ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•çš„æ—¶å€™å®é™…ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span><br>        <span class="hljs-keyword">throws</span> Throwable;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-1-2-JDK-åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤"><a href="#3-1-2-JDK-åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤" class="headerlink" title="3.1.2. JDK åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤"></a>3.1.2. JDK åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤</h4><ol><li>å®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»ï¼›</li><li>è‡ªå®šä¹‰ <code>InvocationHandler</code> å¹¶é‡å†™<code>invoke</code>æ–¹æ³•ï¼Œåœ¨ <code>invoke</code> æ–¹æ³•ä¸­æˆ‘ä»¬ä¼šè°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼ˆè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼‰å¹¶è‡ªå®šä¹‰ä¸€äº›å¤„ç†é€»è¾‘ï¼›</li><li>é€šè¿‡ <code>Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)</code> æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡ï¼›</li></ol><h4 id="3-1-3-ä»£ç ç¤ºä¾‹"><a href="#3-1-3-ä»£ç ç¤ºä¾‹" class="headerlink" title="3.1.3. ä»£ç ç¤ºä¾‹"></a>3.1.3. ä»£ç ç¤ºä¾‹</h4><ol><li><p>æ¥å£ä¸å®ç°ç±»ä¸ä¸Šé¢ä¸€è‡´ï¼›</p></li><li><p>è‡ªå®šä¹‰<code>InvocationHandler</code> å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»£ç†ç±»ä¸­çš„çœŸå®å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyInvocationHandler</span><span class="hljs-params">(Object target)</span> &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;before method &quot;</span> + method.getName());<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(target, args);<span class="hljs-comment">// è§åé¢çš„è¡¥å……éƒ¨åˆ†</span><br>        <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;after method &quot;</span> + method.getName());<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>invoke()</code> æ–¹æ³•ï¼šå½“æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†å¯¹è±¡è°ƒç”¨åŸç”Ÿæ–¹æ³•çš„æ—¶å€™ï¼Œæœ€ç»ˆå®é™…ä¸Šè°ƒç”¨åˆ°çš„æ˜¯ <code>invoke()</code> æ–¹æ³•ï¼Œç„¶å <code>invoke()</code> æ–¹æ³•ä»£æ›¿æˆ‘ä»¬å»è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡çš„åŸç”Ÿæ–¹æ³•ã€‚</p><p>æœ¬è´¨ä¸Šæ˜¯é€šè¿‡åå°„è°ƒç”¨åŸå¯¹è±¡çš„æ–¹æ³•ï¼Œå‚è€ƒåå°„éƒ¨åˆ†ï¼š<a href="%E7%AC%AC17%E7%AB%A0%20%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6.md#4.3.2%20%E8%B0%83%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84%E6%96%B9%E6%B3%95">é€šè¿‡åå°„è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•</a></p></li><li><p>è·å–ä»£ç†å¯¹è±¡çš„å·¥å‚ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyFactory</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getProxy</span><span class="hljs-params">(Object target)</span> &#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(<br>                target.getClass().getClassLoader(), <span class="hljs-comment">// ç›®æ ‡ç±»çš„ç±»åŠ è½½å™¨</span><br>                target.getClass().getInterfaces(),  <span class="hljs-comment">// ä»£ç†éœ€è¦å®ç°çš„æ¥å£ï¼Œå¯æŒ‡å®šå¤šä¸ª</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">DebugInvocationHandler</span>(target)  <span class="hljs-comment">// ä»£ç†å¯¹è±¡å¯¹åº”çš„è‡ªå®šä¹‰ InvocationHandler</span><br>        );<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>getProxy()</code>ï¼šä¸»è¦é€šè¿‡<code>Proxy.newProxyInstanceï¼ˆï¼‰</code>æ–¹æ³•è·å–æŸä¸ªç±»çš„ä»£ç†å¯¹è±¡</p></li><li><p>å®é™…ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SmsService</span> <span class="hljs-variable">smsService</span> <span class="hljs-operator">=</span> (SmsService) ProxyFactory.getProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsServiceImpl</span>());<br>smsService.send(<span class="hljs-string">&quot;java&quot;</span>);<br></code></pre></td></tr></table></figure></li></ol><p>è¿è¡Œä¸Šè¿°ä»£ç ä¹‹åï¼Œæ§åˆ¶å°æ‰“å°å‡ºï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs text">before method send<br>send message:java<br>after method send<br></code></pre></td></tr></table></figure><blockquote><p>ğŸ””è¡¥å……ï¼šç¬¬ä¸‰æ­¥çš„å·¥å‚ç±»å¯ä»¥çœç•¥ï¼Œç›´æ¥ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br><span class="hljs-type">SmsServiceImpl</span> <span class="hljs-variable">smsService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsServiceImpl</span>();<br>      <span class="hljs-type">SmsService</span> <span class="hljs-variable">sms</span> <span class="hljs-operator">=</span> (SmsService) Proxy.newProxyInstance(smsService.getClass().getClassLoader(),<br>              smsService.getClass().getInterfaces(),<br>              <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyInvocationHandler</span>(smsService));<br>      sms.send(<span class="hljs-string">&quot;java&quot;</span>);<br>  &#125;<br></code></pre></td></tr></table></figure></blockquote><h3 id="3-2-CGLIB-åŠ¨æ€ä»£ç†æœºåˆ¶"><a href="#3-2-CGLIB-åŠ¨æ€ä»£ç†æœºåˆ¶" class="headerlink" title="3.2. CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶"></a>3.2. CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶</h3><h4 id="3-2-1-ä»‹ç»"><a href="#3-2-1-ä»‹ç»" class="headerlink" title="3.2.1. ä»‹ç»"></a>3.2.1. ä»‹ç»</h4><p><strong>JDK åŠ¨æ€ä»£ç†æœ‰ä¸€ä¸ªæœ€è‡´å‘½çš„é—®é¢˜æ˜¯å…¶åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ã€‚</strong></p><p><strong>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶æ¥é¿å…ã€‚</strong></p><p><a href="https://github.com/cglib/cglib">CGLIB</a>(<em>Code Generation Library</em>)æ˜¯ä¸€ä¸ªåŸºäº<a href="http://www.baeldung.com/java-asm">ASM</a>çš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚CGLIB é€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚å¾ˆå¤šçŸ¥åçš„å¼€æºæ¡†æ¶éƒ½ä½¿ç”¨åˆ°äº†<a href="https://github.com/cglib/cglib">CGLIB</a>ï¼Œ ä¾‹å¦‚ Spring ä¸­çš„ AOP æ¨¡å—ä¸­ï¼šå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œåˆ™é»˜è®¤é‡‡ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦åˆ™é‡‡ç”¨ CGLIB åŠ¨æ€ä»£ç†ã€‚</p><p><strong>åœ¨ CGLIB åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ <code>MethodInterceptor</code> æ¥å£å’Œ <code>Enhancer</code> ç±»æ˜¯æ ¸å¿ƒã€‚</strong></p><p>ä½ éœ€è¦è‡ªå®šä¹‰ <code>MethodInterceptor</code> å¹¶é‡å†™ <code>intercept</code> æ–¹æ³•ï¼Œ<code>intercept</code> ç”¨äºæ‹¦æˆªå¢å¼ºè¢«ä»£ç†ç±»çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MethodInterceptor</span><br><span class="hljs-keyword">extends</span> <span class="hljs-title class_">Callback</span>&#123;<br>    <span class="hljs-comment">// æ‹¦æˆªè¢«ä»£ç†ç±»ä¸­çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, java.lang.reflect.Method method, Object[] args,MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><strong>obj</strong> : è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆéœ€è¦å¢å¼ºçš„å¯¹è±¡ï¼‰</li><li><strong>method</strong> : è¢«æ‹¦æˆªçš„æ–¹æ³•ï¼ˆéœ€è¦å¢å¼ºçš„æ–¹æ³•ï¼‰</li><li><strong>args</strong> : æ–¹æ³•å…¥å‚</li><li><strong>proxy</strong> : ç”¨äºè°ƒç”¨åŸå§‹æ–¹æ³•</li></ol><p>ä½ å¯ä»¥é€šè¿‡ <code>Enhancer</code>ç±»æ¥åŠ¨æ€è·å–è¢«ä»£ç†ç±»ï¼Œå½“ä»£ç†ç±»è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ <code>MethodInterceptor</code> ä¸­çš„ <code>intercept</code> æ–¹æ³•ã€‚</p><h4 id="3-2-2-CGLIB-åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤"><a href="#3-2-2-CGLIB-åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤" class="headerlink" title="3.2.2. CGLIB åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤"></a>3.2.2. CGLIB åŠ¨æ€ä»£ç†ç±»ä½¿ç”¨æ­¥éª¤</h4><ol><li>å®šä¹‰ä¸€ä¸ªç±»ï¼›</li><li>è‡ªå®šä¹‰ <code>MethodInterceptor</code> å¹¶é‡å†™ <code>intercept</code> æ–¹æ³•ï¼Œ<code>intercept</code> ç”¨äºæ‹¦æˆªå¢å¼ºè¢«ä»£ç†ç±»çš„æ–¹æ³•ï¼Œå’Œ JDK åŠ¨æ€ä»£ç†ä¸­çš„ <code>invoke</code> æ–¹æ³•ç±»ä¼¼ï¼›</li><li>é€šè¿‡ <code>Enhancer</code> ç±»çš„ <code>create()</code>åˆ›å»ºä»£ç†ç±»ï¼›</li></ol><h4 id="3-2-3-ä»£ç ç¤ºä¾‹"><a href="#3-2-3-ä»£ç ç¤ºä¾‹" class="headerlink" title="3.2.3. ä»£ç ç¤ºä¾‹"></a>3.2.3. ä»£ç ç¤ºä¾‹</h4><p>ä¸åŒäº JDK åŠ¨æ€ä»£ç†ä¸éœ€è¦é¢å¤–çš„ä¾èµ–ã€‚<a href="https://github.com/cglib/cglib">CGLIB</a>(<em>Code Generation Library</em>) å®é™…æ˜¯å±äºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¦‚æœä½ è¦ä½¿ç”¨å®ƒçš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ç›¸å…³ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1.å®ç°ä¸€ä¸ªä½¿ç”¨é˜¿é‡Œäº‘å‘é€çŸ­ä¿¡çš„ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> github.javaguide.dynamicProxy.cglibDynamicProxy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AliSmsService</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">(String message)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;send message:&quot;</span> + message);<br>        <span class="hljs-keyword">return</span> message;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>2.è‡ªå®šä¹‰ <code>MethodInterceptor</code>ï¼ˆæ–¹æ³•æ‹¦æˆªå™¨ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodInterceptor;<br><span class="hljs-keyword">import</span> net.sf.cglib.proxy.MethodProxy;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰MethodInterceptor</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugMethodInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> o           è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆéœ€è¦å¢å¼ºçš„å¯¹è±¡ï¼‰</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> method      è¢«æ‹¦æˆªçš„æ–¹æ³•ï¼ˆéœ€è¦å¢å¼ºçš„æ–¹æ³•ï¼‰</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args        æ–¹æ³•å…¥å‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> methodProxy ç”¨äºè°ƒç”¨åŸå§‹æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;before method &quot;</span> + method.getName());<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> methodProxy.invokeSuper(o, args);<br>        <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ·»åŠ è‡ªå·±çš„æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;after method &quot;</span> + method.getName());<br>        <span class="hljs-keyword">return</span> object;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>3.è·å–ä»£ç†ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> net.sf.cglib.proxy.Enhancer;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyFactory</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getProxy</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºåŠ¨æ€ä»£ç†å¢å¼ºç±»</span><br>        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();<br>        <span class="hljs-comment">// è®¾ç½®ç±»åŠ è½½å™¨</span><br>        enhancer.setClassLoader(clazz.getClassLoader());<br>        <span class="hljs-comment">// è®¾ç½®è¢«ä»£ç†ç±»</span><br>        enhancer.setSuperclass(clazz);<br>        <span class="hljs-comment">// è®¾ç½®æ–¹æ³•æ‹¦æˆªå™¨</span><br>        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DebugMethodInterceptor</span>());<br>        <span class="hljs-comment">// åˆ›å»ºä»£ç†ç±»</span><br>        <span class="hljs-keyword">return</span> enhancer.create();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>4.å®é™…ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AliSmsService</span> <span class="hljs-variable">aliSmsService</span> <span class="hljs-operator">=</span> (AliSmsService) CglibProxyFactory.getProxy(AliSmsService.class);<br>aliSmsService.send(<span class="hljs-string">&quot;java&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ä»£ç ä¹‹åï¼Œæ§åˆ¶å°æ‰“å°å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">before method send<br>send message:java<br>after method send<br></code></pre></td></tr></table></figure><h3 id="3-3-JDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-åŠ¨æ€ä»£ç†å¯¹æ¯”"><a href="#3-3-JDK-åŠ¨æ€ä»£ç†å’Œ-CGLIB-åŠ¨æ€ä»£ç†å¯¹æ¯”" class="headerlink" title="3.3. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†å¯¹æ¯”"></a>3.3. JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†å¯¹æ¯”</h3><ol><li><strong>JDK åŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»æˆ–è€…ç›´æ¥ä»£ç†æ¥å£ï¼Œè€Œ CGLIB å¯ä»¥ä»£ç†æœªå®ç°ä»»ä½•æ¥å£çš„ç±»ã€‚</strong> å¦å¤–ï¼Œ CGLIB åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»æ¥æ‹¦æˆªè¢«ä»£ç†ç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œå› æ­¤ä¸èƒ½ä»£ç†å£°æ˜ä¸º final ç±»å‹çš„ç±»å’Œæ–¹æ³•ã€‚</li><li>å°±äºŒè€…çš„æ•ˆç‡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯ JDK åŠ¨æ€ä»£ç†æ›´ä¼˜ç§€ï¼Œéšç€ JDK ç‰ˆæœ¬çš„å‡çº§ï¼Œè¿™ä¸ªä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚</li></ol><h2 id="å››ã€åŠ¨æ€ä»£ç†åŸç†åˆ†æ"><a href="#å››ã€åŠ¨æ€ä»£ç†åŸç†åˆ†æ" class="headerlink" title="å››ã€åŠ¨æ€ä»£ç†åŸç†åˆ†æ"></a>å››ã€åŠ¨æ€ä»£ç†åŸç†åˆ†æ</h2><p>ä¸Šé¢æˆ‘ä»¬åˆ©ç”¨ Proxy ç±»çš„ newProxyInstance æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª<strong>åŠ¨æ€ä»£ç†å¯¹è±¡</strong>ï¼ŒæŸ¥çœ‹è¯¥æ–¹æ³•çš„æºç ï¼Œå‘ç°å®ƒåªæ˜¯å°è£…äº†åˆ›å»ºåŠ¨æ€ä»£ç†ç±»çš„æ­¥éª¤(<font color= 'red'>çº¢è‰²æ ‡æ³¨éƒ¨åˆ†</font>)ï¼š</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs diff">@CallerSensitive<br>public static Object newProxyInstance(ClassLoader loader,<br>                                      Class&lt;?&gt;[] interfaces,<br>                                      InvocationHandler h)<br>    throws IllegalArgumentException<br>&#123;<br>    Objects.requireNonNull(h);<br><br>    final Class&lt;?&gt;[] intfs = interfaces.clone();<br>    final SecurityManager sm = System.getSecurityManager();<br>    if (sm != null) &#123;<br>        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);<br>    &#125;<br><br>    /*<br>     * Look up or generate the designated proxy class.<br>     */<br><span class="hljs-deletion">-    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><br>    /*<br>     * Invoke its constructor with the designated invocation handler.<br>     */<br>    try &#123;<br>        if (sm != null) &#123;<br>            checkNewProxyPermission(Reflection.getCallerClass(), cl);<br>        &#125;<br><br><span class="hljs-deletion">-        final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br>        final InvocationHandler ih = h;<br>        if (!Modifier.isPublic(cl.getModifiers())) &#123;<br>            AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;<br>                public Void run() &#123;<br>                    cons.setAccessible(true);<br>                    return null;<br>                &#125;<br>            &#125;);<br>        &#125;<br><span class="hljs-deletion">-        return cons.newInstance(new Object[]&#123;h&#125;);</span><br>    &#125; catch (IllegalAccessException|InstantiationException e) &#123;<br>        throw new InternalError(e.toString(), e);<br>    &#125; catch (InvocationTargetException e) &#123;<br>        Throwable t = e.getCause();<br>        if (t instanceof RuntimeException) &#123;<br>            throw (RuntimeException) t;<br>        &#125; else &#123;<br>            throw new InternalError(t.toString(), t);<br>        &#125;<br>    &#125; catch (NoSuchMethodException e) &#123;<br>        throw new InternalError(e.toString(), e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®ï¼Œæˆ‘ä»¬æœ€åº”è¯¥å…³æ³¨çš„æ˜¯ <code>Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</code> è¿™å¥ï¼Œè¿™é‡Œäº§ç”Ÿäº†ä»£ç†ç±»ï¼Œåé¢ä»£ç ä¸­çš„æ„é€ å™¨ä¹Ÿæ˜¯é€šè¿‡è¿™é‡Œäº§ç”Ÿçš„ç±»æ¥è·å¾—ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç±»çš„äº§ç”Ÿå°±æ˜¯æ•´ä¸ªåŠ¨æ€ä»£ç†çš„å…³é”®ï¼Œç”±äºæ˜¯åŠ¨æ€ç”Ÿæˆçš„ç±»æ–‡ä»¶ï¼Œ<del>æˆ‘è¿™é‡Œä¸å…·ä½“è¿›å…¥åˆ†æå¦‚ä½•äº§ç”Ÿçš„è¿™ä¸ªç±»æ–‡ä»¶</del>ï¼Œè¿™ä¸ªæ–‡ä»¶çš„äº§ç”Ÿè§åé¢è¡¥å……éƒ¨åˆ†ä»£ç†ç±»å¦‚ä½•è¢«ç”Ÿæˆçš„ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ªç±»æ–‡ä»¶æ—¶ç¼“å­˜åœ¨ Java è™šæ‹Ÿæœºä¸­çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•å°†å…¶æ‰“å°åˆ°æ–‡ä»¶é‡Œé¢ï¼Œä¸€ç¹çœŸå®¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>    <span class="hljs-type">byte</span>[] classFile = ProxyGenerator.generateProxyClass(<span class="hljs-string">&quot;$Proxy0&quot;</span>, SmsServiceImpl.class.getInterfaces());<br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\Project\\proxy\\src\\main\\java\\org\\example\\proxy\\SmsProxyClassFile.class&quot;</span>;<br>    <span class="hljs-keyword">try</span>(<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(path)) &#123;<br>        fos.write(classFile);<br>        fos.flush();<br>        System.out.println(<span class="hljs-string">&quot;ä»£ç†ç±»classæ–‡ä»¶å†™å…¥æˆåŠŸ&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        System.out.println(<span class="hljs-string">&quot;å†™æ–‡ä»¶é”™è¯¯&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹è¿™ä¸ª classæ–‡ä»¶è¿›è¡Œ<a href="http://java-decompiler.github.io/">åç¼–è¯‘</a>ï¼Œæˆ‘ä»¬çœ‹çœ‹ jdk ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†ä»€ä¹ˆæ ·çš„å†…å®¹ï¼š</p><blockquote><p>ç”¨è¿™ä¸ªè½¯ä»¶ä¸èƒ½ç›´æ¥åç¼–è¯‘ï¼Œéœ€è¦å‹ç¼©æˆå‹ç¼©åŒ…æ‰èƒ½æ‰“å¼€</p><p><img src="/./Resources/image-20230731185717146.png" alt="image-20230731185717146"></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.lang.reflect.UndeclaredThrowableException;<br><span class="hljs-keyword">import</span> org.example.proxy.SmsService;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy0</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmsService</span> &#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m1;<br>  <br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m2;<br>  <br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m3;<br>  <br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m0;<br>  <br>     <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *æ³¨æ„è¿™é‡Œæ˜¯ç”Ÿæˆä»£ç†ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ä¸ºInvocationHandlerç±»å‹ï¼Œçœ‹åˆ°è¿™ï¼Œæ˜¯ä¸æ˜¯å°±æœ‰ç‚¹æ˜ç™½</span><br><span class="hljs-comment">     *ä¸ºä½•ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•éƒ½æ˜¯æ‰§è¡ŒInvocationHandlerä¸­çš„invokeæ–¹æ³•ï¼Œè€ŒInvocationHandleråˆæŒæœ‰ä¸€ä¸ª</span><br><span class="hljs-comment">     *è¢«ä»£ç†å¯¹è±¡çš„å®ä¾‹ï¼Œä¸ç¦ä¼šæƒ³éš¾é“æ˜¯....ï¼Ÿ æ²¡é”™ï¼Œå°±æ˜¯ä½ æƒ³çš„é‚£æ ·ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     *super(paramInvocationHandler)ï¼Œæ˜¯è°ƒç”¨çˆ¶ç±»Proxyçš„æ„é€ æ–¹æ³•ã€‚</span><br><span class="hljs-comment">     *çˆ¶ç±»æŒæœ‰ï¼šprotected InvocationHandler h;</span><br><span class="hljs-comment">     *Proxyæ„é€ æ–¹æ³•ï¼š</span><br><span class="hljs-comment">     *    protected Proxy(InvocationHandler h) &#123;</span><br><span class="hljs-comment">     *         Objects.requireNonNull(h);</span><br><span class="hljs-comment">     *         this.h = h;</span><br><span class="hljs-comment">     *     &#125;</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy0</span><span class="hljs-params">(InvocationHandler paramInvocationHandler)</span> &#123;<br>    <span class="hljs-built_in">super</span>(paramInvocationHandler);<br>  &#125;<br>  <br>     <span class="hljs-comment">//è¿™ä¸ªé™æ€å—æœ¬æ¥æ˜¯åœ¨æœ€åçš„ï¼Œæˆ‘æŠŠå®ƒæ‹¿åˆ°å‰é¢æ¥ï¼Œæ–¹ä¾¿æè¿°</span><br>  <span class="hljs-keyword">static</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">//çœ‹çœ‹è¿™å„¿é™æ€å—å„¿é‡Œé¢æœ‰ä»€ä¹ˆï¼Œæ˜¯ä¸æ˜¯æ‰¾åˆ°äº† send æ–¹æ³•ã€‚è¯·è®°ä½ send é€šè¿‡åå°„å¾—åˆ°çš„åå­—m3ï¼Œå…¶ä»–çš„å…ˆä¸ç®¡</span><br>      m1 = Class.forName(<span class="hljs-string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="hljs-string">&quot;equals&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; Class.forName(<span class="hljs-string">&quot;java.lang.Object&quot;</span>) &#125;);<br>      m2 = Class.forName(<span class="hljs-string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="hljs-string">&quot;toString&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>]);<br>      m3 = Class.forName(<span class="hljs-string">&quot;org.example.proxy.SmsService&quot;</span>).getMethod(<span class="hljs-string">&quot;send&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; Class.forName(<span class="hljs-string">&quot;java.lang.String&quot;</span>) &#125;);<br>      m0 = Class.forName(<span class="hljs-string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="hljs-string">&quot;hashCode&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>]);<br>      <span class="hljs-keyword">return</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException noSuchMethodException) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchMethodError</span>(noSuchMethodException.getMessage());<br>    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException classNotFoundException) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoClassDefFoundError</span>(classNotFoundException.getMessage());<br>    &#125; <br>  &#125;<br>    <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object paramObject)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> ((Boolean)<span class="hljs-built_in">this</span>.h.invoke(<span class="hljs-built_in">this</span>, m1, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; paramObject &#125;)).booleanValue();<br>    &#125; <span class="hljs-keyword">catch</span> (Error|RuntimeException error) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(throwable);<br>    &#125; <br>  &#125;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> (String)<span class="hljs-built_in">this</span>.h.invoke(<span class="hljs-built_in">this</span>, m2, <span class="hljs-literal">null</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (Error|RuntimeException error) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(throwable);<br>    &#125; <br>  &#125;<br>  <br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * </span><br><span class="hljs-comment">  *è¿™é‡Œè°ƒç”¨ä»£ç†å¯¹è±¡çš„ send æ–¹æ³•ï¼Œç›´æ¥å°±è°ƒç”¨äº†InvocationHandlerä¸­çš„invokeæ–¹æ³•ï¼Œå¹¶æŠŠm3ä¼ äº†è¿›å»ã€‚</span><br><span class="hljs-comment">  *this.h.invoke(this, m3, null);è¿™é‡Œç®€å•ï¼Œæ˜äº†ã€‚</span><br><span class="hljs-comment">  *æ¥ï¼Œå†æƒ³æƒ³ï¼Œä»£ç†å¯¹è±¡æŒæœ‰ä¸€ä¸ªInvocationHandlerå¯¹è±¡ï¼ŒInvocationHandlerå¯¹è±¡æŒæœ‰ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡ï¼Œ</span><br><span class="hljs-comment">  *å†è”ç³»åˆ°InvacationHandlerä¸­çš„invokeæ–¹æ³•ã€‚å—¯ï¼Œå°±æ˜¯è¿™æ ·ã€‚</span><br><span class="hljs-comment">  */</span><br>    <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">send</span><span class="hljs-params">(String paramString)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> (String)<span class="hljs-built_in">this</span>.h.invoke(<span class="hljs-built_in">this</span>, m3, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; paramString &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (Error|RuntimeException error) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(throwable);<br>    &#125; <br>  &#125;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> ((Integer)<span class="hljs-built_in">this</span>.h.invoke(<span class="hljs-built_in">this</span>, m0, <span class="hljs-literal">null</span>)).intValue();<br>    &#125; <span class="hljs-keyword">catch</span> (Error|RuntimeException error) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable throwable) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(throwable);<br>    &#125; <br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>Jdk ä¸ºæˆ‘ä»¬çš„ç”Ÿæˆäº†ä¸€ä¸ªå« <code>$Proxy0</code>ï¼ˆè¿™ä¸ªåå­—åé¢çš„0æ˜¯ç¼–å·ï¼Œæœ‰å¤šä¸ªä»£ç†ç±»ä¼šä¸€æ¬¡é€’å¢ï¼‰çš„ä»£ç†ç±»ï¼Œè¿™ä¸ªç±»æ–‡ä»¶æ—¶æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä»£ç†å¯¹è±¡æ—¶ï¼Œå°±æ˜¯é€šè¿‡åå°„è·å¾—è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ï¼Œç„¶ååˆ›å»ºçš„ä»£ç†å®ä¾‹ã€‚é€šè¿‡å¯¹è¿™ä¸ªç”Ÿæˆçš„ä»£ç†ç±»æºç çš„æŸ¥çœ‹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºï¼ŒåŠ¨æ€ä»£ç†å®ç°çš„å…·ä½“è¿‡ç¨‹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¯¹ InvocationHandler çœ‹åšä¸€ä¸ªä¸­ä»‹ç±»ï¼Œä¸­ä»‹ç±»æŒæœ‰ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡ï¼Œåœ¨ invoke æ–¹æ³•ä¸­è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡çš„ç›¸åº”æ–¹æ³•ã€‚é€šè¿‡èšåˆæ–¹å¼æŒæœ‰è¢«ä»£ç†å¯¹è±¡çš„å¼•ç”¨ï¼ŒæŠŠå¤–éƒ¨å¯¹ invoke çš„è°ƒç”¨æœ€ç»ˆéƒ½è½¬ä¸ºå¯¹è¢«ä»£ç†å¯¹è±¡çš„è°ƒç”¨ã€‚</p><p>ä»£ç†ç±»è°ƒç”¨è‡ªå·±æ–¹æ³•æ—¶ï¼Œé€šè¿‡è‡ªèº«æŒæœ‰çš„ä¸­ä»‹ç±»å¯¹è±¡æ¥è°ƒç”¨ä¸­ä»‹ç±»å¯¹è±¡çš„invokeæ–¹æ³•ï¼Œä»è€Œè¾¾åˆ°ä»£ç†æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ¨æ€ä»£ç†é€šè¿‡ä¸­ä»‹ç±»å®ç°äº†å…·ä½“çš„ä»£ç†åŠŸèƒ½ã€‚</p><blockquote><ul><li><p>å°ç»“</p><ul><li><p>ä»£ç†ç±»ç”Ÿæˆæµç¨‹ï¼š</p><ol><li>åœ¨ <code>Proxy.newProxyInstance</code> ä¸­çš„ 719 è¡Œ <code>Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</code></li><li>åœ¨è¯¥æ–¹æ³•çš„ 419 è¡Œå¤„ <code>return proxyClassCache.get(loader, interfaces);</code> ä¸Šé¢æ³¨é‡Šä¸º <code>If the proxy class defined by the given loader implementing,the given interfaces exists, this will simply return the cached copy;otherwise, it will create the proxy class via the ProxyClassFactory</code>: å¦‚æœç”±ç»™å®šçš„åŠ è½½å™¨å®šä¹‰çš„ä»£ç†ç±»å®ç°ï¼Œåˆ™ç»™å®šçš„æ¥å£å­˜åœ¨ï¼Œè¿™å°†ç®€å•åœ°è¿”å›ç¼“å­˜çš„å‰¯æœ¬ï¼›å¦åˆ™ï¼Œå®ƒå°†é€šè¿‡ <code>ProxyClassFactory</code> åˆ›å»ºä»£ç†ç±»</li><li>åœ¨<code>ProxyClassFactory</code>çš„  639 è¡Œå¤„ï¼Œ<code>byte[] proxyClassFile = ProxyGenerator.generateProxyClass(...</code>ï¼Œä¸Šé¢æ³¨é‡Šä¸º <code>Generate the specified proxy class</code></li></ol></li><li><p>å³ä»£ç†ç±»æ˜¯é€šè¿‡ <code>ProxyGenerator.generateProxyClass()</code> æ¥ç”Ÿæˆçš„ã€‚</p></li></ul></li></ul></blockquote><h2 id="äº”ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯”"><a href="#äº”ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯”" class="headerlink" title="äº”ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯”"></a>äº”ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„å¯¹æ¯”</h2><ol><li><strong>çµæ´»æ€§</strong>ï¼šåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»ï¼Œä¸éœ€è¦å¿…é¡»å®ç°æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä»£ç†å®ç°ç±»ï¼Œå¹¶ä¸”å¯ä»¥ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡ç±»éƒ½åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ã€‚å¦å¤–ï¼Œé™æ€ä»£ç†ä¸­ï¼Œæ¥å£ä¸€æ—¦æ–°å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯éå¸¸éº»çƒ¦çš„ï¼</li><li><strong>JVM å±‚é¢</strong>ï¼šé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å°†æ¥å£ã€å®ç°ç±»ã€ä»£ç†ç±»è¿™äº›éƒ½å˜æˆäº†ä¸€ä¸ªä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚è€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ° JVM ä¸­çš„ã€‚</li></ol><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« ä¸­ä¸»è¦ä»‹ç»äº†ä»£ç†æ¨¡å¼çš„ä¸¤ç§å®ç°ï¼šé™æ€ä»£ç†ä»¥åŠåŠ¨æ€ä»£ç†ã€‚æ¶µç›–äº†é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†å®æˆ˜ã€é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ã€JDK åŠ¨æ€ä»£ç†å’Œ Cglib åŠ¨æ€ä»£ç†åŒºåˆ«ç­‰å†…å®¹ã€‚</p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><blockquote><p>æ–‡ç« å‚è€ƒï¼š</p><p><a href="https://javaguide.cn/java/basis/proxy.html">Java ä»£ç†æ¨¡å¼è¯¦è§£ | JavaGuide(Javaé¢è¯• + å­¦ä¹ æŒ‡å—)</a></p><p><a href="https://www.bilibili.com/video/BV1cz41187Dk">https://www.bilibili.com/video/BV1cz41187Dk</a></p><p><a href="https://www.cnblogs.com/gonjan-blog/p/6685611.html">javaåŠ¨æ€ä»£ç†å®ç°ä¸åŸç†è¯¦ç»†åˆ†æ - Gonjian - åšå®¢å›­ (cnblogs.com)</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä»£ç†æ¨¡å¼&quot;&gt;&lt;a href=&quot;#ä»£ç†æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;ä»£ç†æ¨¡å¼&quot;&gt;&lt;/a&gt;ä»£ç†æ¨¡å¼&lt;/h1&gt;&lt;h2 id=&quot;ä¸€ã€ä»£ç†æ¨¡å¼&quot;&gt;&lt;a href=&quot;#ä¸€ã€ä»£ç†æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€ä»£ç†æ¨¡</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/Java/"/>
    
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>EsåŠŸèƒ½å®ç°æ¡ˆä¾‹</title>
    <link href="http://conquers.github.io/posts/98542065.html"/>
    <id>http://conquers.github.io/posts/98542065.html</id>
    <published>2023-07-18T02:28:41.000Z</published>
    <updated>2023-07-20T02:36:58.403Z</updated>
    
    <content type="html"><![CDATA[<h2 id="EsåŠŸèƒ½å®ç°æ¡ˆä¾‹"><a href="#EsåŠŸèƒ½å®ç°æ¡ˆä¾‹" class="headerlink" title="EsåŠŸèƒ½å®ç°æ¡ˆä¾‹"></a>EsåŠŸèƒ½å®ç°æ¡ˆä¾‹</h2><ul><li>éœ€æ±‚ï¼š<ul><li>è®¾ç½®ä¸€å¼ ä¼˜æƒ åˆ¸æ»¡è¶³Aå‡ºç‰ˆç¤¾ï¼ŒBç±»åˆ«ï¼Œæ’é™¤idä¸º1çš„å•†å“ï¼Œé¢å¤–æ·»åŠ idä¸º2çš„å•†å“ï¼Œåœ¨ç»“æœä¸­å¯ä»¥ç»§ç»­æœç´¢ï¼Œç­›é€‰ï¼Œæ’åºç­‰</li></ul></li><li>å®ç°<ul><li>sql</li><li>Es</li></ul></li></ul><h3 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">ç»“æœ<span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">search</span> <span class="hljs-keyword">where</span> publisher_name <span class="hljs-operator">=</span> A <span class="hljs-keyword">and</span> class_name <span class="hljs-operator">=</span> B<br>ç»“æœ<span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">search</span> <span class="hljs-keyword">where</span> product_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>ç»“æœ <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">search</span> <span class="hljs-keyword">from</span> (ç»“æœ<span class="hljs-number">1</span> <span class="hljs-keyword">union</span> ç»“æœ<span class="hljs-number">2</span>) <span class="hljs-keyword">where</span> product_id <span class="hljs-operator">!=</span> <span class="hljs-number">2</span><br><br>å®ç°æ’åºï¼š<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (ç»“æœ) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> (æ’åºæ¡ä»¶)<br>å®ç°ä½¿ç”¨åå­—å†æ¬¡æœç´¢ï¼š<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (ç»“æœ) <span class="hljs-keyword">where</span> title <span class="hljs-keyword">like</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%title%&#x27;</span><br>å®ç°ç­›é€‰ï¼š<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (ç»“æœ) <span class="hljs-keyword">where</span> (ç­›é€‰æ¡ä»¶)<br><br></code></pre></td></tr></table></figure><h3 id="Es-Java"><a href="#Es-Java" class="headerlink" title="Es(Java)"></a>Es(Java)</h3><p>åœ¨ <code>sql</code>  ä¸­å¯ä»¥ä½¿ç”¨ <code>union</code> å’Œå­æŸ¥è¯¢ï¼Œåœ¨ <code>Es</code> ä¸­ï¼Œåƒè¿™ç±»é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨å¤šä¸ª <code>boolQuery</code> ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br><span class="hljs-comment">// æ’é™¤å•†å“</span><br>boolQueryBuilder.mustNot(QueryBuilders.termsQuery(<span class="hljs-string">&quot;productId&quot;</span>, notUseGoodsIdByCouponId));<br><br><span class="hljs-comment">// æ»¡è¶³Aå‡ºç‰ˆç¤¾ï¼ŒBç±»åˆ«ï¼Œé¢å¤–æ·»åŠ idä¸º2çš„å•†å“</span><br>boolQueryBuilder.must(QueryBuilders.boolQuery()<br>        .should(QueryBuilders.boolQuery()<br>                .must(QueryBuilders.termsQuery(<span class="hljs-string">&quot;className&quot;</span>, classTypeByCoupon))<br>                .must(QueryBuilders.termsQuery(<span class="hljs-string">&quot;publisherName&quot;</span>, publisherByCoupon)))<br>        .should(QueryBuilders.termsQuery(<span class="hljs-string">&quot;productId&quot;</span>, goodsIdByCouponId)));<br><br>å®ç°æ’åºï¼šçœç•¥<br>å®ç°ä½¿ç”¨åå­—å†æ¬¡æœç´¢ï¼šboolQueryBuilder.must(QueryBuilders.wildcardQuery(<span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;*&quot;</span> + title + <span class="hljs-string">&quot;*&quot;</span>));<br>å®ç°ç­›é€‰ï¼šboolQueryBuilder.must(QueryBuilders.matchQuery(<span class="hljs-string">&quot;ç­›é€‰å­—æ®µ&quot;</span>, ç­›é€‰æ¡ä»¶));<br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>å¦‚æœå‡ºç‰ˆç¤¾ä¸ºç©ºï¼Œç±»åˆ«ä¸ºç©ºï¼Œä¼šå‡ºç°æ²¡æœ‰ç»“æœçš„é—®é¢˜<br>é—®é¢˜åˆ†æï¼šæŸ¥çœ‹ <code>DSL</code> è¯­å¥å‘ç°å‚æ•°ä¸ºç©º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">&quot;terms&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;className&quot;</span> : [ ],<br>  <span class="hljs-string">&quot;boost&quot;</span> : 1.0<br>&#125;<br>æˆ–è€…<br><span class="hljs-string">&quot;terms&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;publisherName&quot;</span> : [ ],<br>  <span class="hljs-string">&quot;boost&quot;</span> : 1.0<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>é—®é¢˜è§£å†³ï¼šæš´åŠ›çš„åŠæ³•ï¼Œåº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(classTypeByCoupon.isEmpty())&#123;<br>    boolQueryBuilder.must(QueryBuilders.boolQuery()<br>            .should(QueryBuilders.boolQuery()<br>                    .must(QueryBuilders.termsQuery(<span class="hljs-string">&quot;publisherName&quot;</span>, publisherByCoupon)))<br>            .should(QueryBuilders.termsQuery(<span class="hljs-string">&quot;productId&quot;</span>, goodsIdByCouponId)));<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(publisherByCoupon.isEmpty())&#123;<br>    boolQueryBuilder.must(QueryBuilders.boolQuery()<br>            .should(QueryBuilders.boolQuery()<br>                    .must(QueryBuilders.termsQuery(<span class="hljs-string">&quot;className&quot;</span>, classTypeByCoupon)))<br>            .should(QueryBuilders.termsQuery(<span class="hljs-string">&quot;productId&quot;</span>, goodsIdByCouponId)));<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    boolQueryBuilder.must(QueryBuilders.boolQuery()<br>            .should(QueryBuilders.boolQuery()<br>                    .must(QueryBuilders.termsQuery(<span class="hljs-string">&quot;className&quot;</span>, classTypeByCoupon))<br>                    .must(QueryBuilders.termsQuery(<span class="hljs-string">&quot;publisherName&quot;</span>, publisherByCoupon)))<br>            .should(QueryBuilders.termsQuery(<span class="hljs-string">&quot;productId&quot;</span>, goodsIdByCouponId)));<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;EsåŠŸèƒ½å®ç°æ¡ˆä¾‹&quot;&gt;&lt;a href=&quot;#EsåŠŸèƒ½å®ç°æ¡ˆä¾‹&quot; class=&quot;headerlink&quot; title=&quot;EsåŠŸèƒ½å®ç°æ¡ˆä¾‹&quot;&gt;&lt;/a&gt;EsåŠŸèƒ½å®ç°æ¡ˆä¾‹&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;éœ€æ±‚ï¼š&lt;ul&gt;
&lt;li&gt;è®¾ç½®ä¸€å¼ ä¼˜æƒ åˆ¸æ»¡è¶³Aå‡ºç‰ˆç¤¾ï¼ŒBç±»åˆ«ï¼Œæ’é™¤idä¸º1çš„å•†å“ï¼Œ</summary>
      
    
    
    
    <category term="Database" scheme="http://conquers.github.io/categories/Database/"/>
    
    <category term="ElasticSearch" scheme="http://conquers.github.io/categories/Database/ElasticSearch/"/>
    
    
    <category term="ElasticSearch" scheme="http://conquers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>MySQL OverView</title>
    <link href="http://conquers.github.io/posts/359ea42e.html"/>
    <id>http://conquers.github.io/posts/359ea42e.html</id>
    <published>2023-06-26T06:54:45.000Z</published>
    <updated>2023-07-18T02:51:12.375Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä½¿ç”¨çš„ç¯å¢ƒä¸º é˜¿é‡Œäº‘äº‘æœåŠ¡å™¨ã€<code>MySQL 5.7</code> å’Œ <code>MySQL 8</code>ï¼Œå‡ä½¿ç”¨ <code>Docker</code> å®‰è£…ï¼Œé™¤éç‰¹åˆ«è¯´æ˜ï¼Œé»˜è®¤ä½¿ç”¨<code>MySQL 5.7</code>ã€‚</p><p>å¦‚æœå‡ºç°ç»“æœä¸ä¸€è‡´ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå³å¯ï¼Œå› ä¸ºå¯è§†åŒ–è½¯ä»¶ä¼šè‡ªåŠ¨è¯·æ±‚ä¸€äº›å…¶ä»–å†…å®¹ã€‚</p></blockquote><ul><li>åŸºç¡€ç¯‡<ul><li><a href="http://conquers.github.io/posts/e967e26.html">Mysql åŸºç¡€ç¯‡</a></li></ul></li><li>é«˜çº§ç¯‡<ul><li>æ¶æ„ç¯‡<ul><li><a href="http://conquers.github.io/posts/2237bb15.html">ç¬¬04ç«  é€»è¾‘æ¶æ„</a></li><li><a href="http://conquers.github.io/posts/8d469f79.html">ç¬¬05ç«  å­˜å‚¨å¼•æ“</a></li></ul></li><li>ç´¢å¼•åŠè°ƒä¼˜ç¯‡<ul><li>6-12</li><li><a href="http://conquers.github.io/posts/98817d56.html">ç¬¬06ç«  ç´¢å¼•çš„æ•°æ®ç»“æ„</a></li><li><a href="http://conquers.github.io/posts/69ea2410.html">ç¬¬08ç«  ç´¢å¼•çš„åˆ›å»ºä¸è®¾è®¡åŸåˆ™</a></li><li><a href="http://conquers.github.io/posts/43d93e27.html">ç¬¬09ç«  æ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨</a></li><li><a href="http://conquers.github.io/posts/ada7f77e.html">ç¬¬10ç«  ç´¢å¼•ä¼˜åŒ–ä¸æŸ¥è¯¢ä¼˜åŒ–</a></li></ul></li><li>äº‹åŠ¡ç¯‡<ul><li><a href="http://conquers.github.io/posts/dfe5e713.html">ç¬¬13ç«  äº‹åŠ¡åŸºç¡€çŸ¥è¯†</a></li><li><a href="http://conquers.github.io/posts/fa7ec77e.html">ç¬¬14ç«  MySQL æ—¥å¿—</a></li><li><a href="http://conquers.github.io/posts/b7d439cb.html">ç¬¬15ç«  é”</a></li><li><a href="http://conquers.github.io/posts/99914452.html">ç¬¬16ç«  å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</a></li></ul></li><li>æ—¥å¿—ä¸å¤‡ä»½ç¯‡<ul><li><a href="http://conquers.github.io/posts/1c2dcbdd.html">ç¬¬17ç«  å…¶ä»–æ•°æ®åº“æ—¥å¿—</a></li><li><a href="http://conquers.github.io/posts/f71f2862.html">ç¬¬18ç«  ä¸»ä»å¤åˆ¶</a></li><li><a href="http://conquers.github.io/posts/be31b856.html">ç¬¬19ç«  æ•°æ®åº“å¤‡ä»½ä¸æ¢å¤</a></li></ul></li><li>æ¶æ„ç¯‡</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä½¿ç”¨çš„ç¯å¢ƒä¸º é˜¿é‡Œäº‘äº‘æœåŠ¡å™¨ã€&lt;code&gt;MySQL 5.7&lt;/code&gt; å’Œ &lt;code&gt;MySQL 8&lt;/code&gt;ï¼Œå‡ä½¿ç”¨ &lt;code&gt;Docker&lt;/code&gt; å®‰è£…ï¼Œé™¤éç‰¹åˆ«è¯´æ˜ï¼Œé»˜è®¤ä½¿ç”¨&lt;code&gt;MySQL 5.7&lt;/code&gt;ã€‚</summary>
      
    
    
    
    <category term="Database" scheme="http://conquers.github.io/categories/Database/"/>
    
    <category term="MySQL" scheme="http://conquers.github.io/categories/Database/MySQL/"/>
    
    
    <category term="MySQL" scheme="http://conquers.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Maven</title>
    <link href="http://conquers.github.io/posts/7273cdc.html"/>
    <id>http://conquers.github.io/posts/7273cdc.html</id>
    <published>2023-04-18T11:44:51.000Z</published>
    <updated>2023-10-25T01:52:43.558Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0ã€ç›®å½•æ¦‚è¿°"><a href="#0ã€ç›®å½•æ¦‚è¿°" class="headerlink" title="0ã€ç›®å½•æ¦‚è¿°"></a>0ã€ç›®å½•æ¦‚è¿°</h2><p><img src="/Resources/Pasted%20image%2020230418194747.png"></p><h2 id="1ã€Mavenæ¦‚è¿°"><a href="#1ã€Mavenæ¦‚è¿°" class="headerlink" title="1ã€Mavenæ¦‚è¿°"></a>1ã€Mavenæ¦‚è¿°</h2><h3 id="1-1ã€Mavenæ˜¯ä»€ä¹ˆ"><a href="#1-1ã€Mavenæ˜¯ä»€ä¹ˆ" class="headerlink" title="1.1ã€Mavenæ˜¯ä»€ä¹ˆ"></a>1.1ã€Mavenæ˜¯ä»€ä¹ˆ</h3><ul><li><p><strong>Mavençš„æœ¬è´¨æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå°†é¡¹ç›®å¼€å‘å’Œç®¡ç†è¿‡ç¨‹æŠ½è±¡æˆä¸€ä¸ªé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆPOMï¼‰</strong></p></li><li><p>Mavenæ˜¯ç”¨<strong>Javaè¯­è¨€</strong>ç¼–å†™çš„ã€‚ä»–ç®¡ç†çš„ä¸œè¥¿ç»Ÿç»Ÿä»¥é¢å‘å¯¹è±¡çš„å½¢å¼è¿›è¡Œè®¾è®¡ï¼Œæœ€ç»ˆå®ƒæŠŠä¸€ä¸ªé¡¹ç›®çœ‹æˆä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å«åš **POM(project object model)**ï¼Œå³é¡¹ç›®å¯¹è±¡æ¨¡å‹ã€‚</p></li></ul><h3 id="1-2ã€Mavençš„ä½œç”¨"><a href="#1-2ã€Mavençš„ä½œç”¨" class="headerlink" title="1.2ã€Mavençš„ä½œç”¨"></a>1.2ã€Mavençš„ä½œç”¨</h3><p>ï¼ˆ1ï¼‰é¡¹ç›®æ„å»ºï¼šæä¾›æ ‡å‡†çš„ï¼Œè·¨å¹³å°çš„è‡ªåŠ¨åŒ–æ„å»ºé¡¹ç›®çš„æ–¹å¼ã€‚</p><p>ï¼ˆ2ï¼‰ä¾èµ–ç®¡ç†ï¼šæ–¹ä¾¿å¿«æ·çš„ç®¡ç†é¡¹ç›®ä¾èµ–çš„èµ„æºï¼ˆjaråŒ…ï¼‰ï¼Œé¿å…èµ„æºé—´çš„ç‰ˆæœ¬å†²çªç­‰é—®é¢˜ã€‚ï¼ˆæœ€ç›´è§‚çš„æ„Ÿå—å°±æ˜¯ä¸éœ€è¦å»å„å¤§ç½‘ç«™å»æ‰‹åŠ¨ä¸‹è½½jaråŒ…ï¼Œåªéœ€è¦å»ä¸­å¤®ä»“åº“è·å¾—åæ ‡ï¼Œå³å¯å¼•å…¥ï¼‰</p><p>ï¼ˆ3ï¼‰ç»Ÿä¸€å¼€å‘ç»“æ„ï¼šæä¾›æ ‡å‡†çš„ï¼Œç»Ÿä¸€çš„é¡¹ç›®å¼€å‘ç»“æ„ã€‚</p><h2 id="2ã€ä¸‹è½½å®‰è£…Maven"><a href="#2ã€ä¸‹è½½å®‰è£…Maven" class="headerlink" title="2ã€ä¸‹è½½å®‰è£…Maven"></a>2ã€ä¸‹è½½å®‰è£…Maven</h2><p><a href="https://maven.apache.org/">Maven â€“ Welcome to Apache Maven</a></p><h3 id="2-1-æœ€æ–°ç‰ˆä¸‹è½½"><a href="#2-1-æœ€æ–°ç‰ˆä¸‹è½½" class="headerlink" title="2.1 æœ€æ–°ç‰ˆä¸‹è½½"></a>2.1 æœ€æ–°ç‰ˆä¸‹è½½</h3><p><img src="/Resources/Pasted%20image%2020230418200656.png"></p><h3 id="2-2ã€æ—§ç‰ˆä¸‹è½½"><a href="#2-2ã€æ—§ç‰ˆä¸‹è½½" class="headerlink" title="2.2ã€æ—§ç‰ˆä¸‹è½½"></a>2.2ã€æ—§ç‰ˆä¸‹è½½</h3><p>æ—§ç‰ˆæœ¬ä¸‹è½½æ­¥éª¤ï¼šæˆ‘ä»¬ä»¥3.6.1ç‰ˆæœ¬ä¸ºä¾‹<br><img src="/Resources/Pasted%20image%2020230418200518.png"></p><p>ç‚¹å‡» sources<br><img src="/Resources/Pasted%20image%2020230418200525.png"></p><h3 id="2-3ã€å®‰è£…"><a href="#2-3ã€å®‰è£…" class="headerlink" title="2.3ã€å®‰è£…"></a>2.3ã€å®‰è£…</h3><p>mavenæ˜¯ä¸€ä¸ªç»¿è‰²è½¯ä»¶ï¼Œè§£å‹å³å®‰è£…ï¼Œéå¸¸å®¹æ˜“ï¼Œæˆ‘ä»¬å°†ä¸‹è½½å¥½çš„<code>apache-maven-3.6.1-bin.zip</code>ç›´æ¥è§£å‹åˆ°ç›®å½•ä¸‹å³å¯</p><p>å„ç›®å½•ç»“æ„è¯´æ˜ï¼š</p><ul><li><p>binï¼šå¯æ‰§è¡Œç¨‹åºç›®å½•ï¼Œ</p></li><li><p>bootï¼šmavenè‡ªèº«çš„å¯åŠ¨åŠ è½½å™¨</p></li><li><p>confï¼šmavené…ç½®æ–‡ä»¶çš„å­˜æ”¾ç›®å½•</p></li><li><p>libï¼šmavenè¿è¡Œæ‰€éœ€åº“çš„å­˜æ”¾ç›®å½•</p></li></ul><h3 id="2-4ã€é…ç½®"><a href="#2-4ã€é…ç½®" class="headerlink" title="2.4ã€é…ç½®"></a>2.4ã€é…ç½®</h3><p>çœç•¥ï¼Œä¸‹æ¬¡éœ€è¦é‡æ–°é…ç½®çš„æ—¶å€™ï¼Œå†å†™<br><strong>Maven éœ€è¦ä½¿ç”¨Javaæ‰èƒ½è¿è¡Œï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦é…ç½®JAVA_HOMEç»™å®ƒä½¿ç”¨</strong></p><h2 id="3ã€MavenåŸºç¡€æ¦‚å¿µ"><a href="#3ã€MavenåŸºç¡€æ¦‚å¿µ" class="headerlink" title="3ã€MavenåŸºç¡€æ¦‚å¿µ"></a>3ã€MavenåŸºç¡€æ¦‚å¿µ</h2><h3 id="3-1ã€ä»“åº“"><a href="#3-1ã€ä»“åº“" class="headerlink" title="3.1ã€ä»“åº“"></a>3.1ã€ä»“åº“</h3><p>ä»“åº“ï¼šç”¨äºå­˜å‚¨èµ„æºï¼Œä¸»è¦æ˜¯å„ç§jaråŒ…<br><img src="/Resources/Pasted%20image%2020230418201332.png"></p><ul><li><p><strong>ä¸­å¤®ä»“åº“</strong>ï¼šmavenå›¢é˜Ÿè‡ªèº«ç»´æŠ¤çš„ä»“åº“ï¼Œå±äºå¼€æºçš„ï¼ˆ<a href="https://mvnrepository.com/">Maven Repository: Search&#x2F;Browse&#x2F;Explore</a>ï¼‰</p></li><li><p><strong>ç§æœ</strong>ï¼šå„å…¬å¸&#x2F;éƒ¨é—¨ç­‰å°èŒƒå›´å†…å­˜å‚¨èµ„æºçš„ä»“åº“ï¼Œç§æœä¹Ÿå¯ä»¥ä»ä¸­å¤®ä»“åº“è·å–èµ„æºï¼ˆç‹­ä¹‰ç†è§£ï¼šç›¸å½“äºç°åœ¨ä½¿ç”¨çš„aliyuné•œåƒä»“åº“ï¼‰</p></li><li><p><strong>æœ¬åœ°ä»“åº“</strong>ï¼šå¼€å‘è€…è‡ªå·±ç”µè„‘ä¸Šå­˜å‚¨èµ„æºçš„ä»“åº“ï¼Œä¹Ÿå¯ä»è¿œç¨‹ä»“åº“è·å–èµ„æº</p></li><li><p>ç§æœçš„ä½œç”¨ï¼š</p><ul><li>ï¼ˆ1ï¼‰ä¿å­˜å…·æœ‰ç‰ˆæƒçš„èµ„æºï¼ŒåŒ…å«è´­ä¹°æˆ–è‡ªä¸»ç ”å‘çš„jar</li><li>ï¼ˆ2ï¼‰ä¸€å®šèŒƒå›´å†…å…±äº«èµ„æºï¼Œèƒ½åšåˆ°ä»…å¯¹å†…ä¸å¯¹å¤–å¼€æ”¾</li></ul></li></ul><h3 id="3-2ã€åæ ‡"><a href="#3-2ã€åæ ‡" class="headerlink" title="3.2ã€åæ ‡"></a>3.2ã€åæ ‡</h3><p><strong>åæ ‡</strong>ï¼šmavenä¸­çš„åæ ‡ç”¨äºæè¿°ä»“åº“ä¸­èµ„æºçš„ä½ç½®</p><p>mavenåæ ‡çš„ä¸»è¦ç»„æˆå¦‚ä¸‹ï¼š</p><ul><li><p>groupIdï¼šå®šä¹‰å½“å‰èµ„æº<strong>éš¶å±ç»„ç»‡</strong>åç§°ï¼ˆé€šå¸¸æ˜¯åŸŸååå†™ï¼Œå¦‚ï¼šorg.mybatisï¼‰</p></li><li><p>artifactIdï¼šå®šä¹‰å½“å‰èµ„æºçš„åç§°ï¼ˆé€šå¸¸æ˜¯<strong>é¡¹ç›®æˆ–æ¨¡å—åç§°</strong>ï¼Œå¦‚ï¼šcrmï¼Œsmsï¼‰</p></li><li><p>versionï¼šå®šä¹‰å½“å‰èµ„æºçš„<strong>ç‰ˆæœ¬å·</strong></p></li><li><p>packagingï¼šå®šä¹‰èµ„æºçš„æ‰“åŒ…æ–¹å¼ï¼Œå–å€¼ä¸€èˆ¬æœ‰å¦‚ä¸‹ä¸‰ç§</p><ul><li>jarï¼šè¯¥èµ„æºæ‰“æˆjaråŒ…ï¼Œé»˜è®¤æ˜¯jarï¼Œjavaå·¥ç¨‹æ‰“åŒ…ä¸ºjar</li><li>warï¼šè¯¥èµ„æºæ‰“æˆwaråŒ…ï¼Œwebå·¥ç¨‹æ‰“åŒ…ä¸ºwar</li><li>pomï¼šè¯¥èµ„æºæ˜¯ä¸€ä¸ªçˆ¶èµ„æºï¼ˆè¡¨æ˜ä½¿ç”¨mavenåˆ†æ¨¡å—ç®¡ç†ï¼‰ï¼Œæ‰“åŒ…æ—¶åªç”Ÿæˆä¸€ä¸ªpom.xmlä¸ç”Ÿæˆjaræˆ–å…¶ä»–åŒ…ç»“æ„</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--æŒ‡å®špomçš„æ¨¡å‹ç‰ˆæœ¬--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--æ‰“åŒ…æ–¹å¼ webå·¥ç¨‹æ‰“åŒ…ä¸ºwar javaå·¥ç¨‹æ‰“åŒ…ä¸ºjar--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!--ç»„ç»‡id--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itheima<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--é¡¹ç›®åç§°--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>web01<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ç‰ˆæœ¬id  releaseä»£è¡¨å®Œæˆç‰ˆ,SNAPSHOTä»£è¡¨å¿«ç…§ï¼ˆå¼€å‘ï¼‰ç‰ˆ--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!--è®¾ç½®å½“å‰å·¥ç¨‹çš„æ‰€æœ‰ä¾èµ–--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--å…·ä½“çš„ä¾èµ–--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="4ã€åˆ›å»ºä¸€ä¸ªMavenWebé¡¹ç›®"><a href="#4ã€åˆ›å»ºä¸€ä¸ªMavenWebé¡¹ç›®" class="headerlink" title="4ã€åˆ›å»ºä¸€ä¸ªMavenWebé¡¹ç›®"></a>4ã€åˆ›å»ºä¸€ä¸ªMavenWebé¡¹ç›®</h2><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Augenstern_QXL/article/details/118443858">MavenæŠ€æœ¯å¿«é€Ÿå…¥é—¨</a></p><h2 id="5ã€åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Mavené¡¹ç›®"><a href="#5ã€åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Mavené¡¹ç›®" class="headerlink" title="5ã€åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Mavené¡¹ç›®"></a>5ã€åˆ›å»ºä¸€ä¸ªæ™®é€šçš„Mavené¡¹ç›®</h2><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Augenstern_QXL/article/details/118443858">MavenæŠ€æœ¯å¿«é€Ÿå…¥é—¨</a></p><h2 id="6ã€Mavenä¾èµ–ç®¡ç†"><a href="#6ã€Mavenä¾èµ–ç®¡ç†" class="headerlink" title="6ã€Mavenä¾èµ–ç®¡ç†"></a>6ã€Mavenä¾èµ–ç®¡ç†</h2><h3 id="6-1ã€ä¾èµ–é…ç½®ä¸ä¾èµ–ä¼ é€’"><a href="#6-1ã€ä¾èµ–é…ç½®ä¸ä¾èµ–ä¼ é€’" class="headerlink" title="6.1ã€ä¾èµ–é…ç½®ä¸ä¾èµ–ä¼ é€’"></a>6.1ã€ä¾èµ–é…ç½®ä¸ä¾èµ–ä¼ é€’</h3><p><strong>ä¾èµ–é…ç½®</strong><br>ä¾èµ–æ˜¯æŒ‡åœ¨å½“å‰é¡¹ç›®ä¸­è¿è¡Œæ‰€éœ€çš„jarï¼Œä¾èµ–é…ç½®çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è®¾ç½®å½“å‰é¡¹ç›®æ‰€ä¾èµ–çš„æ‰€æœ‰jar--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--è®¾ç½®å…·ä½“çš„ä¾èµ–--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ä¾èµ–æ‰€å±ç¾¤ç»„id--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>Junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ä¾èµ–æ‰€å±é¡¹ç›®id--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--ä¾èµ–ç‰ˆæœ¬å·--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><strong>ä¾èµ–ä¼ é€’ï¼š</strong><br>ä¾èµ–å…·æœ‰ä¼ é€’æ€§ï¼Œåˆ†ä¸¤ç§</p><p>ï¼ˆ1ï¼‰ç›´æ¥ä¾èµ–ï¼šåœ¨å½“å‰é¡¹ç›®ä¸­é€šè¿‡ä¾èµ–é…ç½®å»ºç«‹çš„ä¾èµ–å…³ç³»</p><p>ï¼ˆ2ï¼‰é—´æ¥ä¾èµ–ï¼šè¢«ä¾èµ–çš„èµ„æºå¦‚æœä¾èµ–å…¶ä»–èµ„æºï¼Œåˆ™è¡¨æ˜å½“å‰é¡¹ç›®é—´æ¥ä¾èµ–å…¶ä»–èµ„æº</p><h4 id="6-1-1ã€ä¾èµ–ä¼ é€’å†²çª"><a href="#6-1-1ã€ä¾èµ–ä¼ é€’å†²çª" class="headerlink" title="6.1.1ã€ä¾èµ–ä¼ é€’å†²çª"></a>6.1.1ã€ä¾èµ–ä¼ é€’å†²çª</h4><p><strong>ä¾èµ–ä¼ é€’çš„å†²çªé—®é¢˜ï¼š</strong></p><p><img src="/Resources/Pasted%20image%2020230419154239.png"></p><p>ä»¥ä¸€ä¸ªé¡¹ç›®ä¸ºæ ¹ï¼Œç›´æ¥ä¾èµ–ç§°ä¸º1åº¦èµ„æºï¼Œç›´æ¥ä¾èµ–çš„ç›´æ¥ä¾èµ–ç§°ä¸º2åº¦èµ„æºï¼Œç›´æ¥ä¾èµ–çš„ç›´æ¥ä¾èµ–çš„ç›´æ¥ä¾èµ–ç§°ä¸º3åº¦èµ„æºã€‚</p><p>åœ¨ä¾èµ–ä¼ é€’è¿‡ç¨‹ä¸­äº§ç”Ÿäº†å†²çªï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§ä¼˜å…ˆæ³•åˆ™</p><ul><li><p>ï¼ˆ1ï¼‰<strong>è·¯å¾„ä¼˜å…ˆ</strong>ï¼šå½“ä¾èµ–ä¸­å‡ºç°ç›¸åŒèµ„æºæ—¶ï¼Œå±‚çº§è¶Šæ·±ï¼Œä¼˜å…ˆçº§è¶Šä½ï¼Œåä¹‹åˆ™è¶Šé«˜<br><img src="/Resources/Pasted%20image%2020230419154959.png"></p></li><li><p>ï¼ˆ2ï¼‰<strong>å£°æ˜ä¼˜å…ˆ</strong>ï¼šå½“èµ„æºåœ¨ç›¸åŒå±‚çº§è¢«ä¾èµ–æ—¶ï¼Œé…ç½®é¡ºåºé å‰çš„è¦†ç›–é åçš„<br><img src="/Resources/Pasted%20image%2020230419155139.png"></p></li><li><p>ï¼ˆ3ï¼‰<strong>ç‰¹æ®Šä¼˜å…ˆ</strong>ï¼šå½“åŒçº§é…ç½®äº†ç›¸åŒèµ„æºçš„ä¸åŒç‰ˆæœ¬æ—¶ï¼Œåé…ç½®çš„è¦†ç›–å…ˆé…ç½®çš„<br><img src="/Resources/Pasted%20image%2020230419155238.png"></p></li></ul><h4 id="6-1-2ã€å¯é€‰ä¾èµ–"><a href="#6-1-2ã€å¯é€‰ä¾èµ–" class="headerlink" title="6.1.2ã€å¯é€‰ä¾èµ–"></a>6.1.2ã€å¯é€‰ä¾èµ–</h4><p>å¯é€‰ä¾èµ–æŒ‡çš„æ˜¯å¯¹å¤–éšè—å½“å‰æ‰€ä¾èµ–çš„èµ„æºâ¡ä¸é€æ˜</p><ul><li>åŠ ä¸€ä¸ª<code>&lt;optional&gt;</code>Â æ ‡ç­¾<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>Junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="6-1-3ã€æ’é™¤ä¾èµ–"><a href="#6-1-3ã€æ’é™¤ä¾èµ–" class="headerlink" title="6.1.3ã€æ’é™¤ä¾èµ–"></a>6.1.3ã€æ’é™¤ä¾èµ–</h4><p>æ’é™¤ä¾èµ–æŒ‡ä¸»åŠ¨æ–­å¼€ä¾èµ–çš„èµ„æºï¼Œè¢«æ’é™¤çš„èµ„æºæ— éœ€æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>Junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="6-2ã€ä¾èµ–èŒƒå›´"><a href="#6-2ã€ä¾èµ–èŒƒå›´" class="headerlink" title="6.2ã€ä¾èµ–èŒƒå›´"></a>6.2ã€ä¾èµ–èŒƒå›´</h3><p>ä¾èµ–çš„jaré»˜è®¤æƒ…å†µå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å¯ç”¨ï¼Œå¯ä»¥é€šè¿‡<code>scope</code>æ ‡ç­¾è®¾å®šå…¶ä½œç”¨èŒƒå›´</p><p>è¿™é‡Œçš„èŒƒå›´ä¸»è¦æ˜¯æŒ‡ä»¥ä¸‹ä¸‰ç§èŒƒå›´</p><ul><li><p>ï¼ˆ1ï¼‰ä¸»ç¨‹åºèŒƒå›´æœ‰æ•ˆï¼ˆsrc&#x2F;mainç›®å½•èŒƒå›´å†…ï¼‰</p></li><li><p>ï¼ˆ2ï¼‰æµ‹è¯•ç¨‹åºèŒƒå›´å†…æœ‰æ•ˆï¼ˆsrc&#x2F;testç›®å½•èŒƒå›´å†…ï¼‰</p></li><li><p>ï¼ˆ3ï¼‰æ˜¯å¦å‚ä¸æ‰“åŒ…ï¼ˆpackageæŒ‡ä»¤èŒƒå›´å†…ï¼‰</p></li></ul><p>æ­¤å¤–ï¼š<code>scope</code>æ ‡ç­¾çš„å–å€¼æœ‰å››ç§ï¼š<code>compile,test,provided,runtime</code></p><p>è¿™å››ç§å–å€¼ä¸èŒƒå›´çš„å¯¹åº”æƒ…å†µå¦‚ä¸‹ï¼š<br><img src="/Resources/Pasted%20image%2020230419155846.png"></p><h2 id="7ã€Mavenç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶"><a href="#7ã€Mavenç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶" class="headerlink" title="7ã€Mavenç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶"></a>7ã€Mavenç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶</h2><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Augenstern_QXL/article/details/118443858">MavenæŠ€æœ¯å¿«é€Ÿå…¥é—¨</a></p><h2 id="8ã€åˆ†æ¨¡å—å¼€å‘ä¸è®¾è®¡"><a href="#8ã€åˆ†æ¨¡å—å¼€å‘ä¸è®¾è®¡" class="headerlink" title="8ã€åˆ†æ¨¡å—å¼€å‘ä¸è®¾è®¡"></a>8ã€åˆ†æ¨¡å—å¼€å‘ä¸è®¾è®¡</h2><p><img src="/Resources/Pasted%20image%2020230419161942.png"></p><h2 id="9ã€èšåˆ"><a href="#9ã€èšåˆ" class="headerlink" title="9ã€èšåˆ"></a>9ã€èšåˆ</h2><p>èšåˆçš„ç›®çš„æ˜¯ä¸ºäº†ï¼šä¸€æ¬¡æ„ä»¶å¤šä¸ªé¡¹ç›®ã€‚<br>å¤šæ¨¡å—æ„å»ºç»´æŠ¤ï¼šåŸºäºç¬¬8éƒ¨åˆ†çš„æ€æƒ³ï¼Œå°†ä¸åŒæ¨¡å—åˆ’åˆ†æˆä¸åŒçš„æ¨¡å—ï¼ˆæœåŠ¡ï¼‰ã€‚</p><p>é¡¹ç›®ç»“æ„ï¼š</p><ul><li>MavenAggregationï¼šæ€»çš„é¡¹ç›®ï¼ˆä¹Ÿå¯ä»¥ä¸ç”¨å»ºè¿™ä¸ªï¼Œç›´æ¥å»ºParentä¹Ÿå¯ä»¥,ï¼Œä½†æ˜¯è¿™æ ·çœ‹èµ·æ¥æ¸…æ™°ä¸€äº›ï¼‰</li><li>Parent çˆ¶é¡¹ç›®<ul><li>Child1 æ¨¡å—1</li><li>Child2 æ¨¡å—2</li></ul></li></ul><p>åˆ›å»ºé¡¹ç›® <code>MavenTest (emtpy project)</code><br><img src="/Resources/Pasted%20image%2020230419171949.png"></p><p><code>new Module -&gt; Parent (Spring Initializr)</code> åï¼Œåˆ é™¤æ— ç”¨å†…å®¹ï¼Œåªä¿ç•™ <code>pom.xml</code><br><img src="/Resources/Pasted%20image%2020230419163310.png"></p><p>ä¿®æ”¹ <code>pom.xml</code> æ–‡ä»¶ï¼Œä¸è‡ªåŠ¨åˆ›å»ºçš„æ–‡ä»¶ç›¸æ¯”ï¼Œåªå¤šäº†<code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Parent<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Parent<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><span class="hljs-comment">&lt;!-- æ‰‹åŠ¨æ·»åŠ è¿™å¥è¯ï¼Œä»£è¡¨è¯¥é¡¹ç›®åªç”¨ä½œæ„å»ºç®¡ç†ï¼Œåªæä¾›pomæ–‡ä»¶--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>å¼•å…¥ä¸º <code>maven</code> é¡¹ç›®<br><img src="/Resources/Pasted%20image%2020230419172117.png"></p><p>åˆ›å»ºå­é¡¹ç›® <code>new Module -&gt; Child1 (Spring Initializr)</code> ï¼Œ<code>new Module -&gt; Child2 (Spring Initializr)</code> </p><p>é¡¹ç›®ç»“æ„ï¼š<br><img src="/Resources/Pasted%20image%2020230419172847.png"></p><p>å®šä¹‰çˆ¶é¡¹ç®¡ç†çš„å­é¡¹ç›®ï¼šåœ¨ <code>pom.xml</code> æ–‡ä»¶æ·»åŠ ä»¥ä¸‹è¯­å¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ç®¡ç†çš„å·¥ç¨‹åˆ—è¡¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å…·ä½“çš„å·¥ç¨‹åç§°--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../Child1<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>../Child2<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ <code>Maven</code> é¡¹ç›®ç»“æ„å°±ä¼šå˜æˆçˆ¶ä¸å­çš„å…³ç³»<br><img src="/Resources/Pasted%20image%2020230419193203.png"></p><p>æ­¤æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡å¯¹çˆ¶é¡¹ç›®çš„æ“ä½œï¼Œç»Ÿä¸€å¯¹æ‰€æœ‰çš„å­é¡¹ç›®è¿›è¡Œæ“ä½œï¼Œå³åŒæ—¶æ‰§è¡Œç”Ÿå‘½å‘¨æœŸæŒ‡ä»¤ï¼šå¦‚ <code>compile</code><br><img src="/Resources/Pasted%20image%2020230419193451.png"></p><p>æ‰€æœ‰æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">[INFO] Scanning <span class="hljs-keyword">for</span> projects...<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Reactor Build Order:<br>[INFO] <br>[INFO] Child1                                                             [jar]<br>[INFO] Child2                                                             [jar]<br>[INFO] Parent                                                             [pom]<br>[INFO] <br>[INFO] -------------------------&lt; com.example:Child1 &gt;-------------------------<br>[INFO] Building Child1 0.0.1-SNAPSHOT                                     [1/3]<br>[INFO] --------------------------------[ jar ]---------------------------------<br>[INFO] <br>[INFO] --- maven-resources-plugin:3.2.0:resources (default-resources) @ Child1 ---<br>[INFO] Using <span class="hljs-string">&#x27;UTF-8&#x27;</span> encoding to copy filtered resources.<br>[INFO] Using <span class="hljs-string">&#x27;UTF-8&#x27;</span> encoding to copy filtered properties files.<br>[INFO] Copying 1 resource<br>[INFO] Copying 0 resource<br>[INFO] <br>[INFO] --- maven-compiler-plugin:3.10.1:compile (default-compile) @ Child1 ---<br>[INFO] Changes detected - recompiling the module!<br>[INFO] Compiling 1 <span class="hljs-built_in">source</span> file to E:\Projects\MavenAggregation\Child1\target\classes<br>[INFO] <br>[INFO] -------------------------&lt; com.example:Child2 &gt;-------------------------<br>[INFO] Building Child2 0.0.1-SNAPSHOT                                     [2/3]<br>[INFO] --------------------------------[ jar ]---------------------------------<br>[INFO] <br>[INFO] --- maven-resources-plugin:3.2.0:resources (default-resources) @ Child2 ---<br>[INFO] Using <span class="hljs-string">&#x27;UTF-8&#x27;</span> encoding to copy filtered resources.<br>[INFO] Using <span class="hljs-string">&#x27;UTF-8&#x27;</span> encoding to copy filtered properties files.<br>[INFO] Copying 1 resource<br>[INFO] Copying 0 resource<br>[INFO] <br>[INFO] --- maven-compiler-plugin:3.10.1:compile (default-compile) @ Child2 ---<br>[INFO] Changes detected - recompiling the module!<br>[INFO] Compiling 1 <span class="hljs-built_in">source</span> file to E:\Projects\MavenAggregation\Child2\target\classes<br>[INFO] <br>[INFO] -------------------------&lt; com.example:Parent &gt;-------------------------<br>[INFO] Building Parent 0.0.1-SNAPSHOT                                     [3/3]<br>[INFO] --------------------------------[ pom ]---------------------------------<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Reactor Summary <span class="hljs-keyword">for</span> Parent 0.0.1-SNAPSHOT:<br>[INFO] <br>[INFO] Child1 ............................................. SUCCESS [  2.427 s]<br>[INFO] Child2 ............................................. SUCCESS [  0.076 s]<br>[INFO] Parent ............................................. SUCCESS [  0.001 s]<br>[INFO] ------------------------------------------------------------------------<br>[INFO] BUILD SUCCESS<br>[INFO] ------------------------------------------------------------------------<br>[INFO] Total time:  2.726 s<br>[INFO] Finished at: 2023-04-19T19:33:27+08:00<br>[INFO] ------------------------------------------------------------------------<br></code></pre></td></tr></table></figure><h2 id="10ã€ç»§æ‰¿"><a href="#10ã€ç»§æ‰¿" class="headerlink" title="10ã€ç»§æ‰¿"></a>10ã€ç»§æ‰¿</h2><p>ç»§æ‰¿çš„ç›®çš„æ˜¯ä¸ºäº†ï¼šæ¶ˆé™¤é‡å¤çš„é…ç½®ã€‚<br>åœ¨ <code>Java</code> ä¸­å¯ä»¥é€šè¿‡ <code>extends</code> ç»§æ‰¿ï¼Œå¾—åˆ°çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œåœ¨ <code>Maven</code> ä¸­å¯ä»¥é€šè¿‡åœ¨ <code>pom.xml</code> ä¸­ä½¿ç”¨<code>&lt;parent&gt;xxxxx&lt;/parent&gt;</code> ç»§æ‰¿çˆ¶é¡¹ç›®ï¼Œå…·ä½“åœ°ï¼š</p><p>åˆ›å»ºé¡¹ç›® <code>MavenTest (emtpy project)</code>ï¼Œ<code>new Module -&gt; MavenParent (Spring Initializr)</code> </p><p>æŸ¥çœ‹ <code>MavenParent</code> çš„ <code>pom.xml</code> æ–‡ä»¶å¯ä»¥å‘ç°ï¼Œå·²ç»ç»§æ‰¿äº† <code>spring-boot-starter-parent</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>MavenParent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>MavenParent<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>MavenParent<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- æ‰‹åŠ¨æ·»åŠ è¿™å¥è¯ï¼Œä»£è¡¨è¯¥é¡¹ç›®åªç”¨ä½œæ„å»ºç®¡ç†ï¼Œåªæä¾›pomæ–‡ä»¶--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ä¸å†éœ€è¦æŒ‡å®šä¾èµ–çš„ç‰ˆæœ¬ï¼Œå› ä¸ºå·²ç»åœ¨<code>spring-boot-starter-parent</code>ä¸­å®šä¹‰è¿‡ã€‚åœ¨<code>dependencies</code>é‡Œçš„éƒ¨åˆ†é…ç½®å¯ä»¥ä¸ç”¨å¡«å†™<code>version</code>ä¿¡æ¯ï¼Œè¿™äº›versionä¿¡æ¯ä¼šä»<code>spring-boot-dependencies</code>é‡Œå¾—åˆ°ç»§æ‰¿ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ <code>MavenParent</code> åŒçº§ç›®å½•ä¸‹ï¼Œ<code>new Module -&gt; MavenChild1 (Spring Initializr)ï¼ŒMavenChild2 (Spring Initializr)</code></p><p>å°†å­é¡¹ç›® <code>MavenChild2</code> å’Œ <code>MavenChild1</code> çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­ <code>parent</code> æ ‡ç­¾å†…çš„å†…å®¹æ›´æ¢ä¸ºå¦‚ä¸‹å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>MavenParent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-comment">&lt;!-- è§ä¸‹é¢æ ‡ç­¾è§£é‡Š --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼›<strong>å…¶ä¸­å·²æœ‰çš„ä¸¤ä¸ªä¾èµ–æ˜¯è‡ªåŠ¨å¼•å…¥çš„</strong><br><img src="/Resources/Pasted%20image%2020230418164047.png"></p><p>åœ¨çˆ¶é¡¹ç›®ä¸­å¼•å…¥æ–°çš„ä¾èµ–åï¼Œå­é¡¹ç›®å°±æˆåŠŸå¼•å…¥äº† parent ä¸­å¼•å…¥çš„ä¾èµ–<br><img src="/Resources/Pasted%20image%2020230418164219.png"></p><p>æœ‰äº›æ—¶å€™ï¼Œä¸æ˜¯æ‰€æœ‰çš„å­é¡¹ç›®éƒ½æƒ³è¦ä¾èµ– parent ä¸­çš„ä¾èµ–ï¼Œmaven è¿˜æ”¯æŒåœ¨ parent ä¸­å®šä¹‰ä¾èµ–ï¼Œå­é¡¹ç›®å¯ä»¥æœ‰é€‰æ‹©æ€§çš„å¼•å…¥ parent çš„ä¾èµ–ï¼Œå°†ä¿®æ”¹ web åŒ…æ”¾åˆ° dependencyManagement ä¸‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-comment">&lt;!-- å¿…é¡»åŠ ä¸Šç‰ˆæœ¬å·ï¼Œä¸ç„¶ä¼šå› ä¸ºæ‰¾ä¸åˆ°ç‰ˆæœ¬æŠ¥é”™--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å’ŒåŸå§‹ç‰ˆæœ¬ç›¸æ¯”ï¼Œè¿™é‡Œå”¯ä¸€çš„å˜åŒ–æ˜¯å°†Â <code>dependencies</code>Â å…ƒç´ ç§»åˆ°äº†Â <code>dependencyManagement</code>Â å…ƒç´ å†…éƒ¨ã€‚ä¿®æ”¹Â <code>MavenChild1</code>Â é¡¹ç›®å¦‚ä¸‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020230418193357.png"><br>è¿™æ—¶ <code>MavenParent</code> å’Œ <code>MavenChild2</code> ä¸­çš„ä¾èµ–éƒ½å·²ç»ä¸è§äº†ï¼Œåªæœ‰æˆ‘ä»¬æ˜¾å¼åœ¨ <code>MavenChild1</code> ä¸­å®šä¹‰çš„ä¾èµ–è¿˜åœ¨ã€‚</p><p>é™¤äº† dependencies ä¾èµ–ä¸ dependencyManagement ä¾èµ–ç‰ˆæœ¬çš„ç»§æ‰¿ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–å¯ä»¥ç»§æ‰¿çš„å…ƒç´ ï¼š<br><img src="/Resources/Pasted%20image%2020230419204107.png"></p><p>è¯¦ç»†å†…å®¹å¯å‚è€ƒï¼š<a href="https://blog.csdn.net/zzuhkp/article/details/123518287">Spring Boot ç¬¬ä¸‰ç¯‡ï¼šç†è§£ spring-boot-starter-parent_å¤§é¹coolçš„åšå®¢-CSDNåšå®¢</a></p><h2 id="11ã€èšåˆä¸ç»§æ‰¿çš„å…³ç³»"><a href="#11ã€èšåˆä¸ç»§æ‰¿çš„å…³ç³»" class="headerlink" title="11ã€èšåˆä¸ç»§æ‰¿çš„å…³ç³»"></a>11ã€èšåˆä¸ç»§æ‰¿çš„å…³ç³»</h2><p>ä½œç”¨</p><ul><li>èšåˆç”¨äºå¿«é€Ÿæ„å»ºé¡¹ç›®</li><li>ç»§æ‰¿ç”¨äºå¿«é€Ÿé…ç½®</li></ul><p>ç›¸åŒç‚¹</p><ul><li>èšåˆä¸ç»§æ‰¿çš„pom.xmlæ–‡ä»¶æ‰“åŒ…æ–¹å¼å‡ä¸ºpomï¼Œå¯ä»¥å°†ä¸¤ç§å…³ç³»åˆ¶ä½œåˆ°åŒä¸€ä¸ªpomæ–‡ä»¶ä¸­</li><li>èšåˆä¸ç»§æ‰¿å‡å±äºè®¾è®¡å‹æ¨¡å—ï¼Œå¹¶æ— å®é™…çš„æ¨¡å—å†…å®¹</li></ul><p>ä¸åŒç‚¹</p><ul><li>èšåˆæ˜¯åœ¨å½“å‰æ¨¡å—ä¸­é…ç½®å…³ç³»ï¼Œèšåˆå¯ä»¥æ„ŸçŸ¥åˆ°å‚ä¸èšåˆçš„æ¨¡å—æœ‰å“ªäº›</li><li>ç»§æ‰¿æ˜¯åœ¨å­æ¨¡å—ä¸­é…ç½®å…³ç³»ï¼Œçˆ¶æ¨¡å—æ— æ³•æ„ŸçŸ¥å“ªäº›å­æ¨¡å—ç»§æ‰¿äº†è‡ªå·±</li><li>èšåˆæ˜¯èšåˆæ¨¡å—é€šè¿‡moduleå¼•ç”¨è¢«èšåˆæ¨¡å—ï¼Œè€Œç»§æ‰¿æ˜¯å­æ¨¡å—é€šè¿‡parentå¼•ç”¨çˆ¶æ¨¡å—ã€‚</li></ul><p><strong>å®é™…é¡¹ç›®ä¸­é€šå¸¸æŠŠèšåˆå’Œç»§æ‰¿ç»“åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨ã€‚parenté¡¹ç›®æ—¢æ˜¯èšåˆæ¨¡å—ï¼Œä¹Ÿæ˜¯çˆ¶æ¨¡å—ã€‚</strong></p><h2 id="12ã€å±æ€§"><a href="#12ã€å±æ€§" class="headerlink" title="12ã€å±æ€§"></a>12ã€å±æ€§</h2><p>ç­‰åŒäºå®šä¹‰å˜é‡ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç»´æŠ¤ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">å®šä¹‰ï¼šä¸€èˆ¬ç”¨ `æŠ€æœ¯å` + `.version`<br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xxxxx.version</span>&gt;</span>ç‰ˆæœ¬å·<span class="hljs-tag">&lt;/<span class="hljs-name">xxxx.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>ä½¿ç”¨ï¼š<br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>xxxx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxxx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;xxxxx.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="13ã€å·¥ç¨‹ç‰ˆæœ¬"><a href="#13ã€å·¥ç¨‹ç‰ˆæœ¬" class="headerlink" title="13ã€å·¥ç¨‹ç‰ˆæœ¬"></a>13ã€å·¥ç¨‹ç‰ˆæœ¬</h2><p><img src="/Resources/Pasted%20image%2020230419205408.png"><br><img src="/Resources/Pasted%20image%2020230419205601.png"></p><h2 id="14ã€æ ‡ç­¾ï¼šç”¨åˆ°äº†ï¼Œä¸æ‡‚å†ç»§ç»­æ·»åŠ "><a href="#14ã€æ ‡ç­¾ï¼šç”¨åˆ°äº†ï¼Œä¸æ‡‚å†ç»§ç»­æ·»åŠ " class="headerlink" title="14ã€æ ‡ç­¾ï¼šç”¨åˆ°äº†ï¼Œä¸æ‡‚å†ç»§ç»­æ·»åŠ "></a>14ã€æ ‡ç­¾ï¼šç”¨åˆ°äº†ï¼Œä¸æ‡‚å†ç»§ç»­æ·»åŠ </h2><blockquote><p><code>&lt;relativePath&gt; &lt;/relativePath&gt;</code></p></blockquote><p>ä½œç”¨æŒ‡å®šparentçš„pomæ–‡ä»¶çš„è·¯å¾„ï¼ŒMavenæ„å»ºjaråŒ…æ—¶å€™æŸ¥æ‰¾é¡ºåºï¼šrelativePathå…ƒç´ ä¸­çš„åœ°å€&gt;æœ¬åœ°ä»“åº“&gt;è¿œç¨‹ä»“åº“</p><p><strong>å†™æ–‡æ¡£çš„æ—¶å€™ï¼Œ1å’Œ2çš„ç»“æœå¥½åƒæ˜¯ä¸€è‡´çš„ï¼Œåœ¨ä½¿ç”¨2çš„æ—¶å€™ï¼Œåªè¦æ”¹å˜çˆ¶é¡¹ç›®ä¸­å®šä¹‰çš„ç‰ˆæœ¬å·ï¼Œå­é¡¹ç›®å°±ä¼šè·Ÿç€æ”¹ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨ç¬¬3ç§</strong></p><p>1ã€<code>é»˜è®¤å€¼</code><br>é»˜è®¤æˆ‘ä»¬ä¸ç”¨å†™<code>&lt;relativePath&gt;</code>ï¼Œé‚£é»˜è®¤å€¼å°±æ˜¯ ..&#x2F;pom.xmlï¼Œä¼šä»æœ¬åœ°è·¯å¾„ä¸­è·å–parentçš„pomï¼Œæˆ‘ä»¬å»ºå¤šæ¨¡å—çš„é¡¹ç›®å°±æ˜¯è¿™ä¸ªæƒ…å†µã€‚</p><p>2ã€<code>&lt;relativePath/&gt;è®¾å®šç©ºå€¼</code><br>ä¹Ÿå°±æ˜¯è¯´æˆ‘æŒ‡å®šäº†relativePathï¼Œä½†å€¼æ˜¯ç©ºçš„ï¼Œè®¾å®šä¸€ä¸ªç©ºå€¼å°†å§‹ç»ˆä»ä»“åº“ä¸­è·å–ï¼Œä¸ä»æœ¬åœ°è·¯å¾„è·å–ã€‚å¾ˆå¸¸è§çš„åœºæ™¯å°±æ˜¯ä½¿ç”¨ springboot çš„æ—¶å€™</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>3ã€<code>&lt;relativePath&gt;æŸä¸ªpomçš„è·¯å¾„&lt;relativePath/&gt;</code><br>æŒ‡å®šæœ¬åœ°çš„è·¯å¾„ï¼Œä»æœ¬åœ°è·¯å¾„è·å–parentçš„pomã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>***<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>***<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>***<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>***<span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p><code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></p></blockquote><ul><li>pomï¼šä¸“é—¨ç”¨äºèšåˆå·¥ç¨‹ç”¨</li><li>jarï¼š</li><li>warï¼šwebå·¥ç¨‹</li></ul><blockquote><p><code>&lt;type&gt;pom&lt;/type&gt;</code></p></blockquote><p>dependencyä¸­typeé»˜è®¤ä¸ºjarå³å¼•å…¥ä¸€ä¸ªç‰¹å®šçš„jaråŒ…ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰typeä¸ºpomå‘¢?å½“æˆ‘ä»¬éœ€è¦å¼•å…¥å¾ˆå¤šjaråŒ…çš„æ—¶å€™ä¼šå¯¼è‡´pom.xmlè¿‡å¤§ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ªçˆ¶é¡¹ç›®ï¼Œä½†æ˜¯çˆ¶é¡¹ç›®åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´çˆ¶é¡¹ç›®çš„pom.xmlæ–‡ä»¶è¿‡å¤§ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¼•è¿›æ¥ä¸€ä¸ªtypeä¸ºpomï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„jaråŒ…æ‰“åŒ…æˆä¸€ä¸ªpomï¼Œç„¶åæˆ‘ä»¬ä¾èµ–äº†pomï¼Œå³å¯ä»¥ä¸‹è½½ä¸‹æ¥æ‰€æœ‰ä¾èµ–çš„jaråŒ…</p><blockquote><p><code>&lt;scope&gt;import&lt;/scope&gt;</code></p></blockquote><p>ä¸ä¸Šé¢çš„æ ‡ç­¾ä¸€èµ·ä½¿ç”¨ã€‚<br>å°†SpringCloudçš„ä¾èµ–æ‹·è´å¼•ç”¨è¿‡æ¥äº†è¿™æ ·å°±è§£å†³äº†å•ç»§æ‰¿çš„é—®é¢˜ã€‚è¦æ³¨æ„çš„æ˜¯  <scope>import</scope>å¿…é¡»åœ¨<code>&lt;dependencyManagement&gt;</code>ä¸‹ä½¿ç”¨å¹¶ä¸”å¿…é¡»å£°æ˜<code>&lt;type&gt;pom&lt;/type&gt;</code>ï¼Œé‚£ä¹ˆ<code>&lt;scope&gt;import&lt;/scope&gt;</code>çš„ä½œç”¨æˆ‘å°±å¯ä»¥ç†è§£ä¸ºå½“å‰ä¾èµ–æ˜¯å¼•ç”¨æ‹·è´æ¥çš„ä¸å—å•ç»§æ‰¿å½±å“ã€‚<br>å‚è€ƒè¯´æ˜ï¼š<a href="https://blog.csdn.net/HD243608836/article/details/129321636">mavenä¸­ï¼œscopeï¼importï¼œ&#x2F;scopeï¼æ ‡ç­¾ï¼œtypeï¼pomï¼œ&#x2F;typeï¼æ ‡ç­¾çš„å«ä¹‰_pomæ–‡ä»¶typeæ ‡ç­¾_HD243608836çš„åšå®¢-CSDNåšå®¢</a></p><blockquote><p><code>&lt;exclusion&gt;</code></p></blockquote><p>é˜²æ­¢ä¾èµ–ä¼šé€ æˆå†²çª<br><img src="/Resources/Pasted%20image%2020230418153201.png"></p><h2 id="99ã€å¯¼å…¥ä¾èµ–æ—¶å‡ºç°çš„é”™è¯¯"><a href="#99ã€å¯¼å…¥ä¾èµ–æ—¶å‡ºç°çš„é”™è¯¯" class="headerlink" title="99ã€å¯¼å…¥ä¾èµ–æ—¶å‡ºç°çš„é”™è¯¯"></a>99ã€å¯¼å…¥ä¾èµ–æ—¶å‡ºç°çš„é”™è¯¯</h2><blockquote><p>Failure to transfer â€¦..</p></blockquote><p>å‡ºç°è¿™ç§å†…å«<code>Failure to transfer......</code>é”™è¯¯çš„åŸå› æ˜¯æˆ‘ä»¬é€šè¿‡åæ ‡ä¾èµ–å¯¼å…¥çš„<br>jaråŒ…æ²¡æœ‰å®Œå…¨ä¸‹è½½ï¼Œä¹Ÿå°±æ˜¯ä¸‹è½½äº†ä¸€åŠå°±åœäº†ï¼Œæ˜¯ä¸ªä¸‹è½½ç±»å‹çš„æ–‡ä»¶è€Œä¸æ˜¯çœŸæ­£çš„jaråŒ…ï¼Œå‡ºç°è¿™ç§é”™è¯¯çš„åŸå› å…¸å‹çš„å°±æ¯”å¦‚æˆ‘è¿™ç§æƒ…å†µæ­£åœ¨ä¸‹è½½çš„æ—¶å€™æ–­ç½‘äº†ï¼Œç„¶åè¿™ä¸ªç½‘ç»œé“¾æ¥çªç„¶ä¸­æ–­ï¼Œæ­¤æ—¶æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæŸåçš„åŠæˆå“ï¼Œ<code>Maven</code>ä¸­çš„ä»£ç ä¼¼ä¹ä¸èƒ½åƒè¿…é›·é‚£æ ·ç»§ç»­ä¸‹è½½ï¼Œä½†æ˜¯åˆèƒ½æ£€æµ‹åˆ°å®ƒçš„å­˜åœ¨ï¼Œå› æ­¤æˆ‘ä»¬å†æ¬¡ç‚¹å‡»è¿™ä¸ªåŠ è½½ï¼Œè¿˜æ˜¯æŠ¥é”™ã€‚</p><p>è§£å†³åŠæ³•ä¸ºæ‰¾åˆ°æœ¬åœ°Mavenä»“åº“ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½çŸ¥é“åœ¨å“ªï¼Œå¦‚æœå¿˜äº†å¯ä»¥è¿›å…¥æˆ‘ä»¬çš„Mavenä¸­çš„settings.xmlä¸­çœ‹ä¸€ä¸‹ï¼Œæ‰“å¼€ä¹‹åæˆ‘ä»¬ç”¨windowsçš„æœç´¢åŠŸèƒ½æŸ¥æ‰¾<code>*.lastUpdated</code>ï¼Œè¿™å°±æ˜¯é‚£ç§æŸåçš„åŠæˆå“æ–‡ä»¶çš„åç¼€ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œåˆ é™¤ä¹‹åå†é‡æ–°å¯¼å…¥ä¾èµ–å°±å¥½äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0ã€ç›®å½•æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#0ã€ç›®å½•æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;0ã€ç›®å½•æ¦‚è¿°&quot;&gt;&lt;/a&gt;0ã€ç›®å½•æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/Resources/Pasted%20image%2020230418194747.p</summary>
      
    
    
    
    
    <category term="Maven" scheme="http://conquers.github.io/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot</title>
    <link href="http://conquers.github.io/posts/6f2612a2.html"/>
    <id>http://conquers.github.io/posts/6f2612a2.html</id>
    <published>2022-08-17T10:54:29.000Z</published>
    <updated>2023-07-25T02:35:31.983Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://spring.io/projects/spring-boot/">Spring Boot</a></p><h2 id="SpringBootçš„å¼•è¨€"><a href="#SpringBootçš„å¼•è¨€" class="headerlink" title="SpringBootçš„å¼•è¨€"></a>SpringBootçš„å¼•è¨€</h2><p>Spring Bootæ˜¯ç”±Pivotalå›¢é˜Ÿæä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥<strong>ç®€åŒ–Springåº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹</strong>ã€‚è¯¥æ¡†æ¶ä½¿ç”¨äº†<strong>ç‰¹å®šçš„æ–¹å¼æ¥è¿›è¡Œé…ç½®</strong>ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜ä¸å†éœ€è¦å®šä¹‰æ ·æ¿åŒ–çš„é…ç½®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒSpring Bootè‡´åŠ›äºåœ¨è“¬å‹ƒå‘å±•çš„å¿«é€Ÿåº”ç”¨å¼€å‘é¢†åŸŸ(rapid application development)æˆä¸ºé¢†å¯¼è€…ã€‚</p><p><strong>springboot</strong>(å¾®æ¡†æ¶) &#x3D; <strong>springmvc</strong>(æ§åˆ¶å™¨) + <strong>spring core</strong>(é¡¹ç›®ç®¡ç†)</p><h2 id="SpringBootçš„ä¼˜åŠ¿"><a href="#SpringBootçš„ä¼˜åŠ¿" class="headerlink" title="SpringBootçš„ä¼˜åŠ¿"></a>SpringBootçš„ä¼˜åŠ¿</h2><ol><li>åˆ›å»ºå®Œæ•´çš„ç‹¬ç«‹çš„ <code>Spring</code> åº”ç”¨ç¨‹åº<ul><li><code>springmvc</code> + <code>spring</code></li></ul></li><li>åµŒå…¥çš„ <code>Tomcat</code> ï¼Œæ— éœ€éƒ¨ç½² <code>WAR</code> æ–‡ä»¶<ul><li>å†…åµŒ <code>Tomcat</code></li></ul></li><li>ç®€åŒ– <code>Maven</code> é…ç½®ï¼Œè‡ªåŠ¨é…ç½® <code>Spring</code> ï¼Œæ²¡æœ‰ <code>XM</code> Lé…ç½®</li></ol><h2 id="SpringBootçº¦å®š"><a href="#SpringBootçº¦å®š" class="headerlink" title="SpringBootçº¦å®š"></a>SpringBootçº¦å®š</h2><p><strong>é¡¹ç›®ç»“æ„å›¾</strong><br><img src="/Resources/Pasted%20image%2020220817195034.png"></p><ol><li><p>springbootçº¦å®šspringbooté¡¹ç›®ä¸­æœ‰ä¸”åªèƒ½å­˜åœ¨ä¸€ä¸ªå…¥å£ç±»(Class)<br>ç±»åï¼šæ¨è<strong>xxx(é¡¹ç›®å)Application.java</strong></p><ul><li>a. å…¥å£ç±»å¿…é¡»åœ¨æ‰€æœ‰å­åŒ…ä¹‹ä¸Š</li><li>b. å…¥å£ç±»ä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ªå¯åŠ¨é¡¹ç›®é¡¹ç›®mainå‡½æ•°</li></ul></li><li><p>springbooté¡¹ç›®çº¦å®šå¿…é¡»åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­å­˜åœ¨ä¸€ä¸ªåå­—ä¸º<code>application.yml</code> l <code>application.properties</code> é…ç½®æ–‡ä»¶</p></li></ol><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p><strong>ç¯å¢ƒè¦æ±‚</strong></p><table><thead><tr><th>è½¯ä»¶</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>JDK</td><td>1.8+</td></tr><tr><td>MAVEN</td><td>3.2+</td></tr><tr><td>SpringBoot</td><td>2.7.2</td></tr></tbody></table><blockquote><p>2022-8-17 SpringBootæœ€æ–°ç‰ˆ</p></blockquote><p><strong>æ–°å»ºé¡¹ç›®ä¸­å¼•å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç»§æ‰¿springbootçš„çˆ¶é¡¹ç›® ä¾¿äºç»´æŠ¤ç‰ˆæœ¬--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--        springboot-boot-starter-web--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p><code>&lt;parent&gt;</code>ç»§æ‰¿çˆ¶é¡¹ç›®ä¸å¯¼å…¥ä»»ä½•ä¾èµ–ï¼Œåªæ˜¯å¯¹ä¸‹é¢çš„ä¾èµ–è¿›è¡Œä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶<br>åŸå› ï¼šå„ä¸ªä¾èµ–æœ‰ç€ä¸¥æ ¼çš„ç‰ˆæœ¬é™åˆ¶ï¼Œå¹¶ä¸”æ–¹ä¾¿ç»´æŠ¤ã€‚</p><p><code>&lt;version&gt;</code> SpringBoot ç‰ˆæœ¬å·åœ¨ 2.4.x ä»¥å‰ç»“å°¾æœ‰ä¸€ä¸ªRELEASEï¼Œä» 2.4.x ä»¥ååªä»¥æ•°å­—å‘½åã€‚</p></blockquote><p><strong>åœ¨resourcesç›®å½•ä¸­åˆ›å»º<code>application.yml</code></strong></p><blockquote><p>è¿™é‡Œä¹Ÿå¯ä»¥ä¸ç”¨å†™âœï¼Œé»˜è®¤8080ç«¯å£ã€‚<del>å»ºéƒ½å»ºäº†ï¼Œä¸å†™ç‚¹ä¸œè¥¿ï¼Œä¸åˆé€‚</del></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8989</span><br></code></pre></td></tr></table></figure><p><strong>åˆ›å»ºspringbootå…¥å£ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * å¯åŠ¨springbootåº”ç”¨</span><br><span class="hljs-comment">         * å‚æ•°1:æŒ‡å®šå…¥å£ç±»çš„ç±»å¯¹è±¡.class(ç±»çš„å¯¹è±¡æ˜¯new xxx)</span><br><span class="hljs-comment">         * å‚æ•°2:mainå‡½æ•°å‚æ•°</span><br><span class="hljs-comment">         */</span><br>        SpringApplication.run(Application.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ³¨è§£è¯´æ˜"><a href="#æ³¨è§£è¯´æ˜" class="headerlink" title="æ³¨è§£è¯´æ˜"></a>æ³¨è§£è¯´æ˜</h3><p>â­<code>@SpringBootApplication</code><br>ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨ç±»ä¸Šåªèƒ½ç”¨åœ¨å…¥å£ç±»ä¸Šåªèƒ½å‡ºç°ä¸€æ¬¡<br>ä½œç”¨ï¼šæ ‡è¯†è¿™ä¸ªç±»æ˜¯ä¸€ä¸ª <code>springboot</code> å…¥å£ç±»ï¼ˆå¯åŠ¨æ•´ä¸ª <code>springboot</code> é¡¹ç›®çš„æ€»å…¥å£ï¼‰</p><p><code>@SpringBootApplication</code> ç”±å¤šä¸ªæ³¨è§£æ„æˆï¼Œ4ä¸ªå…ƒæ³¨è§£ï¼Œç”± <code>Java</code> æä¾›ï¼Œ</p><table><thead><tr><th>æ³¨è§£å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>@Target(&#123;ElementType.TYPE&#125;)</code></td><td>æŒ‡å®šæ³¨è§£ä½œç”¨èŒƒå›´</td></tr><tr><td><code>@Retention(RetentionPolicy.RUNTIME) </code></td><td>æŒ‡å®šæ³¨è§£ä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯è¿è¡Œæ—¶</td></tr><tr><td><code>@Documented</code></td><td></td></tr><tr><td><code>@Inherited</code></td><td></td></tr><tr><td>â­<code>@SpringBootConfiguration</code></td><td>ç”¨æ¥è‡ªåŠ¨é…ç½® <code>spring springmvc</code> ç›¸å…³ç¯å¢ƒ<br>ç»„åˆäº† <code>@Configuration</code> æ³¨è§£ï¼Œä¹Ÿå°±æ˜¯ <code>@SpringBootConfiguration</code> ä¿®é¥°çš„ç±»å°±æ˜¯ <code>Java</code> é…ç½®ç±»</td></tr><tr><td>â­<code>@EnableAutoConfiguration</code></td><td>å¼€å¯è‡ªåŠ¨é…ç½® <br><code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­åŠ è½½éœ€è¦è‡ªåŠ¨æ³¨å…¥çš„ <code>Java</code> ç±»<br><strong>è‡ªåŠ¨é…ç½®æ ¸å¿ƒæ³¨è§£</strong><br><strong>è‡ªåŠ¨é…ç½®springç›¸å…³ç¯å¢ƒ</strong><br><strong>è‡ªåŠ¨ä¸é¡¹ç›®ä¸­å¼•å…¥çš„ç¬¬ä¸‰æ–¹æŠ€æœ¯è‡ªåŠ¨é…ç½®å…¶ç¯å¢ƒ</strong></td></tr><tr><td>â­<code>@ComponentScan</code></td><td>ç»„ä»¶æ‰«æï¼Œé»˜è®¤æ‰«æ <code>@SpringBootApplication</code> æ³¨è§£çš„ç±»çš„å½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹é¢æ‰€æœ‰è¢« <code>@Compoent</code> æ³¨è§£ä¿®é¥°çš„ <code>Java</code> ç±»</td></tr></tbody></table><p><strong>è¿è¡Œ</strong><br><img src="/Resources/Pasted%20image%2020220817201942.png"><br><img src="/Resources/Pasted%20image%2020220817202007.png"></p><blockquote><p><code>SpringApplication.run(Application.class,args);</code><br>å¯åŠ¨springbootåº”ç”¨æ—¶å€™éœ€è¦ä¼ é€’mainå‡½æ•°å‚æ•°ä½œä¸ºå¯åŠ¨çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š<br>æ€ä¹ˆä¼ å‚ï¼šé€šè¿‡ideaé‡Œé¢çš„vm optionså¯ä»¥è¦†ç›–æ‰æŸäº›é…ç½®ï¼Œä¾‹å¦‚ä¸‹å›¾ï¼Œå¯ä»¥è¦†ç›–ç«¯å£<br><img src="/Resources/%E6%9C%AA%E5%91%BD%E5%90%8D%E7%BB%98%E5%9B%BE.drawio.png"></p></blockquote><h3 id="æµ‹è¯•é¡¹ç›®"><a href="#æµ‹è¯•é¡¹ç›®" class="headerlink" title="æµ‹è¯•é¡¹ç›®"></a>æµ‹è¯•é¡¹ç›®</h3><p><strong>å»ºåŒ…å¹¶åˆ›å»ºæ§åˆ¶å™¨(controller)</strong><br><img src="/Resources/Pasted%20image%2020220817202555.png"></p><blockquote><p>ä¹‹å‰åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€ç›´ç–‘æƒ‘çš„ç‚¹ï¼šRequestMappingå‰é¢çš„æ–œçº¿éœ€ä¸éœ€è¦åŠ <br>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/hehuihh/article/details/117371593">æ³¨è§£RequestMappingä¸­çš„URIè·¯å¾„æœ€å‰é¢åˆ°åº•éœ€ä¸éœ€è¦åŠ æ–œçº¿ï¼Ÿ</a><br><img src="/Resources/Pasted%20image%2020220817202819.png"></p></blockquote><p>æµ‹è¯•åœ°å€ï¼š<code>http://localhost:ç«¯å£å·/è¯·æ±‚è·¯å¾„</code>      <a href="http://localhost:8989/hello">http://localhost:8989/hello</a></p><blockquote><p>ä¿®æ”¹ç«¯å£å·è§ä¸Šé¢åˆ›å»º<code>application.yml</code>çš„æ—¶å€™<br><img src="/Resources/Pasted%20image%2020220817202616.png"></p></blockquote><p><strong>ä¿®æ”¹é¡¹ç›®å</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8989</span> <span class="hljs-comment"># ä¿®æ”¹å†…åµŒæœåŠ¡å™¨ç«¯å£å·</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/springboot</span> <span class="hljs-comment">#ä¿®æ”¹é¡¹ç›®åæ³¨æ„:é¡¹ç›®åå¿…é¡»&quot;/&quot;å¼€å¤´</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•åœ°å€ï¼š<a href="http://localhost:8989/springboot/hello">http://localhost:8989/springboot/hello</a></p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><h3 id="é…ç½®æ–‡ä»¶çš„æ‹†åˆ†"><a href="#é…ç½®æ–‡ä»¶çš„æ‹†åˆ†" class="headerlink" title="é…ç½®æ–‡ä»¶çš„æ‹†åˆ†"></a>é…ç½®æ–‡ä»¶çš„æ‹†åˆ†</h3><p>è¯´æ˜ï¼šåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒæœ‰å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› æ­¤å°†ç”Ÿäº§ä¸­çš„é…ç½®å’Œå¼€å‘ä¸­çš„é…ç½®æ‹†åˆ†å¼€ï¼Œæ˜¯éå¸¸å¿…è¦çš„ã€‚åœ¨springbootä¸­ä¹Ÿæä¾›äº†é…ç½®æ–‡ä»¶æ‹†åˆ†çš„æ–¹å¼ï¼Œè¿™é‡Œä»¥ç”Ÿäº§ä¸­é¡¹ååç§°ä¸å¼€å‘é¡¹ç›®åç§°ä¸ä¸€è‡´ä¸ºä¾‹ï¼š<br>å¼€å‘çš„æ—¶å€™é¡¹ç›®åä¸ºspringbootï¼Œç”Ÿäº§çš„æ—¶å€™é¡¹ç›®åä¸ºspringboot_prodï¼Œ</p><p>ä¸»é…ç½®æ–‡ä»¶<code>application.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># å…¬å…±é…ç½®</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8989</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-comment"># éœ€è¦ä½¿ç”¨å“ªå¥—ç¯å¢ƒå°±ç”¨è°ï¼Œæ³¨æ„æ˜¯ ç¯å¢ƒ-åé¢çš„xxx</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span><br></code></pre></td></tr></table></figure><blockquote><p>åŒºåˆ«äºä¸»é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶å‘½ä»¤çš„è¦æ±‚ä¸º<code>application-xxx.yml</code></p></blockquote><p>å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶<code>application-dev.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/springboot</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220818183340.png"></p><p>ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶<code>application-prod.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/springboot_prod</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220818183418.png"></p><h3 id="åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶"><a href="#åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶" class="headerlink" title="åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶"></a>åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶</h3><p>åœ¨é¡¹ç›®å¤–åˆ›å»º<code>application-local-prod.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/spring</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/%E5%8A%A0%E8%BD%BD%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.drawio.png"></p><blockquote><p>ç­‰åŒäºå‘½ä»¤è¡Œ<code>java -jar --spring.config.location=æˆ‘æ˜¯ç»å¯¹è·¯å¾„ xxxx.jar</code></p></blockquote><p>å¯ä»¥å‘ç°å¤–éƒ¨é…ç½®æ–‡ä»¶å·²ç»ç”Ÿæ•ˆ<br><img src="/Resources/Pasted%20image%2020220818184446.png"></p><h2 id="å¿«é€Ÿåˆ›å»ºé¡¹ç›®"><a href="#å¿«é€Ÿåˆ›å»ºé¡¹ç›®" class="headerlink" title="å¿«é€Ÿåˆ›å»ºé¡¹ç›®"></a>å¿«é€Ÿåˆ›å»ºé¡¹ç›®</h2><blockquote><p>åŒºåˆ«äºä¹‹å‰çš„2.7.2 è¿™é‡Œçš„spring bootç‰ˆæœ¬å˜ä¸ºäº†2.7.3ï¼Œçªç„¶æ›´æ–°äº†ã€‚</p></blockquote><p>é™¤äº†ä»¥ä¸Šæœ€å¼€å§‹çš„åˆ›å»ºé¡¹ç›®çš„æ–¹å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>Springboot init</code> å¿«é€Ÿåˆå§‹åŒ–<br><a href="../../%E8%BD%AF%E4%BB%B6/IDEA.md#%E4%BD%BF%E7%94%A8IDEA%E5%88%9B%E5%BB%BASPRINGBOOT%E9%A1%B9%E7%9B%AE">ä½¿ç”¨IDEAåˆ›å»ºSPRINGBOOTé¡¹ç›®</a></p><h2 id="å·¥å‚åˆ›å»ºå¯¹è±¡"><a href="#å·¥å‚åˆ›å»ºå¯¹è±¡" class="headerlink" title="å·¥å‚åˆ›å»ºå¯¹è±¡"></a>å·¥å‚åˆ›å»ºå¯¹è±¡</h2><h3 id="åˆ›å»ºå•ä¸ªå¯¹è±¡"><a href="#åˆ›å»ºå•ä¸ªå¯¹è±¡" class="headerlink" title="åˆ›å»ºå•ä¸ªå¯¹è±¡"></a>åˆ›å»ºå•ä¸ªå¯¹è±¡</h3><p>åœ¨springbootä¸­å¯ä»¥ç®¡ç†å•ä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>spring</code> æ¡†æ¶ä¸­æ³¨è§£å½¢å¼åˆ›å»ºã€‚</p><ul><li><code>@Component</code>ï¼šåˆ›å»º<strong>é€šç”¨å¯¹è±¡</strong><ul><li><code>@Controller</code>ï¼šåˆ›å»º<strong>æ§åˆ¶å±‚å¯¹è±¡</strong></li><li><code>@Service</code>ï¼š      åˆ›å»º<strong>ä¸šåŠ¡å±‚å¯¹è±¡</strong></li><li><code>@Repository</code>ï¼šåˆ›å»º<strong>DAOå±‚å¯¹è±¡</strong><ul><li>åœ¨å·¥å‚ä¸­åˆ›å»ºå¯¹è±¡ï¼Œé»˜è®¤å·¥å‚ä¸­çš„åç§°ä¸ºç±»åé¦–å­—æ¯å°å†™</li><li>ä»¥ä¸Šæ³¨è§£éƒ½æœ‰valueå±æ€§ï¼Œ valueå±æ€§ç”¨æ¥æŒ‡æ˜è¢«æ ‡æ³¨çš„ç±»åœ¨å·¥å‚ä¸­çš„åç§°ã€‚å³å¦‚æœä¸åŠ ï¼Œå·¥å‚ä¸­çš„åç§°ä¸ºç±»åé¦–å­—æ¯å°å†™ã€‚åŠ äº†ï¼Œå·¥å‚ä¸­çš„åç§°ä¸ºæŒ‡æ˜çš„åç§°ã€‚<br>  å›¾ç¤º</li></ul></li></ul></li></ul><blockquote><p>åœ¨<code>DemoServiceImpl</code>æ·»åŠ <code>@Service</code>æ³¨è§£åï¼Œspringå·¥å‚å°±ä¼šæœ‰è¿™ä¸ªå¯¹è±¡ï¼Œé€šè¿‡<code>@Autowired</code> è‡ªåŠ¨æ³¨å…¥ï¼ˆå‘å·¥å‚æ‹¿<code>DemoService</code>å¯¹è±¡ï¼‰ï¼Œä»¥ä½¿ç”¨<code>DemoService</code><br><img src="/Resources/Pasted%20image%2020220818194412.png"></p></blockquote><h3 id="åˆ›å»ºå¤šä¸ªå¯¹è±¡"><a href="#åˆ›å»ºå¤šä¸ªå¯¹è±¡" class="headerlink" title="åˆ›å»ºå¤šä¸ªå¯¹è±¡"></a>åˆ›å»ºå¤šä¸ªå¯¹è±¡</h3><p>åœ¨SpringBootä¸­ä¹Ÿæä¾›äº†å¦‚<code>@configuration</code> + <code>@Bean</code>æ³¨è§£è¿›è¡Œåˆ›å»º</p><ul><li><code>@Configuration</code> ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨ç±»ä¸Šï¼ˆç›¸å½“äº<code>spring.xml</code>ï¼‰ï¼Œä½œç”¨ï¼šä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ª <code>springboot</code> ä¸­é…ç½®ç±»ã€‚<ul><li><code>@Bean</code> åˆ›å»ºå¯¹è±¡ï¼Œç›¸å½“äº<code>spring.xml</code>ä¸­çš„beanæ ‡ç­¾<ul><li>é»˜è®¤ä½¿ç”¨ <code>@Bean</code> åˆ›å»ºå¯¹è±¡åœ¨å·¥å‚ä¸­å”¯ä¸€æ ‡è¯†ä¸ºæ–¹æ³•åç§°</li><li>ä¿®æ”¹åœ¨å·¥å‚ä¸­å¯¹è±¡æ ‡è¯†å¯ä»¥åœ¨ä½¿ç”¨ <code>@Bean(&quot;å·¥å‚ä¸­åå­—&quot;)</code> æŒ‡å®šä¸€ä¸ªåå­—</li></ul></li></ul></li></ul><p><img src="/Resources/Pasted%20image%2020220818200142.png"></p><h2 id="å±æ€§æ³¨å…¥"><a href="#å±æ€§æ³¨å…¥" class="headerlink" title="å±æ€§æ³¨å…¥"></a>å±æ€§æ³¨å…¥</h2><h3 id="åŸºæœ¬å±æ€§æ³¨å…¥"><a href="#åŸºæœ¬å±æ€§æ³¨å…¥" class="headerlink" title="åŸºæœ¬å±æ€§æ³¨å…¥"></a>åŸºæœ¬å±æ€§æ³¨å…¥</h3><h4 id="Value-â­"><a href="#Value-â­" class="headerlink" title="@Value â­"></a>@Value â­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectionController</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;wtt&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;inject&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">inject</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;inject ok&quot;</span> + name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220819111052.png"></p><blockquote><p>ä½†æ˜¯è¿™æ ·çš„æ–¹å¼ï¼Œå¹¶ä¸åˆ©äºè§£è€¦ï¼Œä¸”ä½œç”¨ç­‰åŒäºèµ‹å€¼ã€‚<br>æ³¨ï¼šç«¯å£å·ä¿®æ”¹ä¸ºäº†8989</p></blockquote><p><strong>ä¼˜åŒ–æ–¹å¼ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰æ³¨å…¥å€¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectionController</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;name&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;age&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> Integer age;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;bir&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> Date bir;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;price&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> Double price;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;sex&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> Boolean sex;<br><br>    <span class="hljs-comment">/* --------------------------------------------------------------------------------------------------------------*/</span><br><br><span class="hljs-comment">// æ³¨å…¥æ•°ç»„</span><br>    <span class="hljs-meta">@Value(&quot;$&#123;qqs&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String[] qqs;<br><br><span class="hljs-comment">// æ³¨å…¥list</span><br>    <span class="hljs-meta">@Value(&quot;$&#123;lists&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; lists;<br><br><span class="hljs-comment">// æ³¨å…¥map</span><br>    <span class="hljs-meta">@Value(&quot;#&#123;$&#123;maps&#125;&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> Map&lt;String,String&gt; maps;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;inject&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">inject</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;inject ok:&quot;</span> + name + age + bir + price + sex + <span class="hljs-string">&quot;----&quot;</span> + Arrays.toString(qqs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8989</span>  <br>  <br><span class="hljs-comment"># å£°æ˜æ³¨å…¥çš„å€¼  </span><br><span class="hljs-attr">name:</span> <span class="hljs-string">wtt</span>  <br><span class="hljs-attr">age:</span> <span class="hljs-number">23</span>  <br><span class="hljs-attr">price:</span> <span class="hljs-number">23.23</span>  <br><span class="hljs-comment"># æ—¥æœŸé»˜è®¤æ ¼å¼ä¸ºYYYY/mm/dd HH/MM/ss  </span><br><span class="hljs-attr">bir:</span> <span class="hljs-number">2022</span><span class="hljs-string">/12/12</span> <span class="hljs-number">12</span><span class="hljs-string">:12:12</span><br><span class="hljs-attr">sex:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># æ³¨å…¥æ•°ç»„ï¼Œå¤šä¸ªå…ƒç´ ç”¨&quot;,&quot;éš”å¼€</span><br><span class="hljs-attr">qqs:</span> <span class="hljs-number">6099</span><span class="hljs-string">,7088,8009</span><br><span class="hljs-comment"># æ³¨å…¥listï¼Œå¤šä¸ªå…ƒç´ ç”¨&quot;,&quot;éš”å¼€ï¼ˆä¸æ³¨å…¥æ•°ç»„ä¸€è‡´ï¼‰</span><br><span class="hljs-attr">lists:</span> <span class="hljs-number">6099</span><span class="hljs-string">,7088,8009</span><br><span class="hljs-comment"># æ³¨å…¥mapï¼Œä½¿ç”¨jsonæ ¼å¼ï¼Œæ³¨å…¥çš„æ—¶å€™å¿…é¡»ä½¿ç”¨&quot;#&#123;$&#123;å±æ€§&#125;&#125;&quot;è¿›è¡Œæ³¨å…¥</span><br><span class="hljs-string">maps:&quot;&#123;&#x27;aa&#x27;:&#x27;bb&#x27;,&#x27;cc&#x27;:&#x27;dd&#x27;&#125;&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220819111907.png"></p><h3 id="å¯¹è±¡æ³¨å…¥"><a href="#å¯¹è±¡æ³¨å…¥" class="headerlink" title="å¯¹è±¡æ³¨å…¥"></a>å¯¹è±¡æ³¨å…¥</h3><h4 id="ConfigurationProperties-â­"><a href="#ConfigurationProperties-â­" class="headerlink" title="@ConfigurationProperties â­"></a>@ConfigurationProperties â­</h4><p><strong>å†æ¬¡ä¼˜åŒ–æ–¹å¼ï¼šä»¥å¯¹è±¡çš„æ–¹å¼ä¸€æ¬¡æ€§æ³¨å…¥</strong></p><blockquote><p>è¿™é‡Œçš„ä»£ç ä¼šå‡ºç°é—®é¢˜ï¼Œæ­£ç¡®ä»£ç è§ä¸‹ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¼•å…¥<strong>æ³¨æ„ç‚¹</strong>ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># å£°æ˜å¯¹è±¡æ–¹å¼çš„æ³¨å…¥</span><br><span class="hljs-attr">users:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">wtt</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">23</span><br>  <span class="hljs-attr">sex:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;users&quot;)</span><span class="hljs-comment">//ä¿®é¥°èŒƒå›´:ç”¨åœ¨ç±»ä¸Šï¹ä½œç”¨:ç”¨æ¥å°†æŒ‡å®šå‰ç¼€çš„å±æ€§æ³¨å…¥åˆ°å½“å‰å¯¹è±¡ä¸­å±æ€§åä¸€è‡´å±æ€§çš„å±æ€§</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectionObjectController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Boolean sex;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;injectObject&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">injectObject</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;inject Object OK...&quot;</span> + name + age + sex;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ğŸ’¡è¡¥å……ï¼š<br><img src="/Resources/Pasted%20image%2020220822160459.png"><br>ä¸è®ºæ˜¯valueè¿˜æ˜¯prefix éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºåœ¨æºç ä¸­ï¼Œä¸¤è€…æ˜¯ç­‰åŒçš„æ¦‚å¿µã€‚<br><img src="/Resources/Pasted%20image%2020220822160530.png"></p></blockquote><p>æµ‹è¯•ï¼š<br>â—<strong>è¿™é‡Œå¹¶æ²¡æœ‰æ‹¿åˆ°å¯¹åº”çš„å±æ€§å€¼</strong>ï¼Œæ˜¯ç”±äºæ²¡æœ‰è®¾ç½®setæ–¹æ³•ã€‚<img src="/Resources/Pasted%20image%2020220822160841.png"></p><ul><li><strong>æŒ‰ç…§ä»¥ä¸‹ä»£ç ç¼–å†™setä»£ç å³å¯</strong> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@ConfigurationProperties(&quot;users&quot;)</span><span class="hljs-comment">//ä¿®é¥°èŒƒå›´:ç”¨åœ¨ç±»ä¸Šï¹ä½œç”¨:ç”¨æ¥å°†æŒ‡å®šå‰ç¼€çš„å±æ€§æ³¨å…¥åˆ°å½“å‰å¯¹è±¡ä¸­å±æ€§åä¸€è‡´å±æ€§çš„å±æ€§</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectionObjectController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> Boolean sex;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(Integer age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSex</span><span class="hljs-params">(Boolean sex)</span> &#123;<br>        <span class="hljs-built_in">this</span>.sex = sex;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;injectObject&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">injectObject</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;inject Object OK...&quot;</span> + name + age + sex;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>â—<strong>ä¸Šé¢çš„ç™½æ¡†é‡Œé¢çš„å†…å®¹</strong>ï¼Œ<a href="https://docs.spring.io/spring-boot/docs/2.7.3/reference/html/configuration-metadata.html#appendix.configuration-metadata.annotation-processor">Open documentationâ€¦</a><br>ç®€è€Œè¨€ä¹‹ï¼šå¼•å…¥<code>spring-boot-configuration-processor</code> è¿™ä¸ªjaråŒ…ï¼Œé‡å¯é¡¹ç›®åå³å¯ï¼ˆä½†æ˜¯æˆ‘é‡å¯äº†æ²¡ç”¨ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬åŠ ä¸Šæ³¨è§£ä¹‹åï¼Œå†ç¼–å†™ymlæ–‡ä»¶çš„æ—¶å€™ä¼šæœ‰æç¤ºå¯¹åº”çš„å±æ€§ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>ã€<br>    <span class="hljs-comment">&lt;!--ä»£è¡¨æ•´ä¸ªä¾èµ–ä¸ä¼šè¢«ä¼ é€’ï¼Œå³ä¸ä¼šä¼ ç»™å­é¡¹ç›®--&gt;</span><br>    <span class="hljs-comment">&lt;!--å‡è®¾Aå¯¼å…¥äº†Bï¼ŒBå¼•å…¥äº†ä¸€ä¸ªåŒ…ï¼Œå…¶ä¸­optionalå±æ€§ä¸åŠ æˆ–è€…ä¸ºfalseï¼Œé‚£ä¹ˆAå°±å¼•å…¥è¯¥åŒ…--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="æœ¬åœ°æµ‹è¯•"><a href="#æœ¬åœ°æµ‹è¯•" class="headerlink" title="æœ¬åœ°æµ‹è¯•"></a>æœ¬åœ°æµ‹è¯•</h2><h3 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–å†™æµ‹è¯•ç±»"><a href="#ç¼–å†™æµ‹è¯•ç±»" class="headerlink" title="ç¼–å†™æµ‹è¯•ç±»"></a>ç¼–å†™æµ‹è¯•ç±»</h3><p>åœ¨serviceçš„æŸä¸ªç±»ä¸Šï¼Œctrl + shift + T<br><img src="/Resources/Pasted%20image%2020220822200810.png"></p><p><img src="/Resources/Pasted%20image%2020220822200823.png"><br>æµ‹è¯•ä»£ç å³å¯ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>        userDao.test();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><p>æ¯æ¬¡æµ‹è¯•ä¸€ä¸ªæ–°çš„æµ‹è¯•ç±»éƒ½è¦åŠ ä¸Š<code>@SpringBootTest</code>æ³¨è§£ï¼Œå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicTests</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BasicTests</span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        userDao.test();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="çƒ­éƒ¨ç½²å·¥å…·"><a href="#çƒ­éƒ¨ç½²å·¥å…·" class="headerlink" title="çƒ­éƒ¨ç½²å·¥å…·"></a>çƒ­éƒ¨ç½²å·¥å…·</h2><p>ä¸ºäº†è¿›ä¸€æ­¥æé«˜å¼€å‘æ•ˆç‡ï¼Œspringbootä¸ºæˆ‘ä»¬æä¾›äº†<strong>å…¨å±€é¡¹ç›®çƒ­éƒ¨ç½²</strong>ï¼Œä»¥ååœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¿®æ”¹äº†éƒ¨åˆ†ä»£ç ä»¥åŠç›¸å…³é…ç½®æ–‡ä»¶åï¼Œ<strong>ä¸éœ€è¦æ¯æ¬¡é‡å¯ä½¿ä¿®æ”¹ç”Ÿæ•ˆ</strong>ï¼Œåœ¨é¡¹ç›®ä¸­å¼€å¯äº†springbootå…¨å±€çƒ­éƒ¨ç½²ä¹‹ååªéœ€è¦åœ¨ä¿®æ”¹ä¹‹å<strong>ç­‰å¾…å‡ ç§’å³å¯ä½¿ä¿®æ”¹ç”Ÿæ•ˆ</strong>ã€‚</p><p>å‰ç½®ï¼š<a href="../../%E8%BD%AF%E4%BB%B6/IDEA.md#%E4%BD%BF%E7%94%A8IDEA%E5%BC%80%E5%90%AF%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91">ä½¿ç”¨IDEAå¼€å¯è‡ªåŠ¨ç¼–è¯‘</a></p><h3 id="å¯¼å…¥ä¾èµ–-1"><a href="#å¯¼å…¥ä¾èµ–-1" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–å†™æµ‹è¯•ä»£ç "><a href="#ç¼–å†™æµ‹è¯•ä»£ç " class="headerlink" title="ç¼–å†™æµ‹è¯•ä»£ç "></a>ç¼–å†™æµ‹è¯•ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;demo&quot;)</span>  <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">demo</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;demo&quot;</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨é¡¹ç›®"><a href="#å¯åŠ¨é¡¹ç›®" class="headerlink" title="å¯åŠ¨é¡¹ç›®"></a>å¯åŠ¨é¡¹ç›®</h3><p>ğŸ¨ä¿¡æ¯ä»Mainå˜æˆäº†restartedMain<br><img src="/Resources/Pasted%20image%2020220822202451.png"></p><p>å‘é€è¯·æ±‚<br><img src="/Resources/Pasted%20image%2020220822202651.png"></p><p>æ­¤æ—¶æˆ‘ä»¬ä¿®æ”¹æµ‹è¯•ä»£ç å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;demo&quot;)</span>  <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">demo</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;demo123&quot;</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220822205010.png"></p><p>æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯<br><img src="/Resources/Pasted%20image%2020220822205002.png"></p><h2 id="æ—¥å¿—å¤„ç†"><a href="#æ—¥å¿—å¤„ç†" class="headerlink" title="æ—¥å¿—å¤„ç†"></a>æ—¥å¿—å¤„ç†</h2><p>springbootæ¡†æ¶é›†æˆæ—¥å¿— <strong>logback</strong> æ—¥å¿—ã€‚</p><p>Logbackæ˜¯ç”±log4jåˆ›å§‹äººè®¾è®¡çš„åˆä¸€ä¸ªå¼€æºæ—¥å¿—ç»„ä»¶ã€‚ç›®å‰ï¼Œlogbackåˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼šlogback-coreï¼Œlogback-classicå’Œlogback-accessã€‚æ˜¯å¯¹log4jæ—¥å¿—å±•ç¤ºè¿›ä¸€æ­¥æ”¹è¿›!</p><h3 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h3><p><code>All &lt; Trace &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; Fatal &lt; OFF</code></p><ul><li>OFF<br>å…³é—­ï¼šæœ€é«˜çº§åˆ«ï¼Œ<strong>ä¸æ‰“å°æ—¥å¿—</strong>ã€‚</li><li>FATAL<br>è‡´å‘½ï¼š<strong>æŒ‡æ˜éå¸¸ä¸¥é‡çš„</strong>å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç»ˆæ­¢æ‰§è¡Œé”™è¯¯<strong>äº‹ä»¶</strong>ã€‚</li><li>ERROR<br>é”™è¯¯ï¼š<strong>æŒ‡æ˜é”™è¯¯äº‹ä»¶</strong>ï¼Œä½†åº”ç”¨å¯èƒ½è¿˜èƒ½ç»§ç»­è¿è¡Œã€‚</li><li>WARN<br>è­¦å‘Šï¼šæŒ‡æ˜å¯èƒ½<strong>æ½œåœ¨çš„å±é™©</strong>çŠ¶å†µã€‚</li><li>INFO<br>ä¿¡æ¯ï¼šæŒ‡æ˜æè¿°ä¿¡æ¯ï¼Œä»ç²—ç²’åº¦ä¸Š<strong>æè¿°</strong>äº†åº”ç”¨<strong>è¿è¡Œè¿‡ç¨‹</strong>ã€‚</li><li>DEBUG<br>è°ƒè¯•ï¼šæŒ‡æ˜<strong>ç»†è‡´çš„äº‹ä»¶ä¿¡æ¯</strong>ï¼Œå¯¹è°ƒè¯•åº”ç”¨æœ€æœ‰ç”¨ã€‚</li><li>TRACE<br>è·Ÿè¸ªï¼šæŒ‡æ˜<strong>ç¨‹åºè¿è¡Œè½¨è¿¹</strong>ï¼Œæ¯”DEBUGçº§åˆ«çš„ç²’åº¦æ›´ç»†ã€‚</li><li>ALL<br>æ‰€æœ‰ï¼š<strong>æ‰€æœ‰æ—¥å¿—</strong>çº§åˆ«ï¼ŒåŒ…æ‹¬å®šåˆ¶çº§åˆ«ã€‚<blockquote><p>æ—¥å¿—çº§åˆ«ç”±ä½åˆ°é«˜:<code>æ—¥å¿—çº§åˆ«è¶Šé«˜è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯è¶Šå°‘</code></p></blockquote></li></ul><h3 id="æ—¥å¿—åˆ†ç±»"><a href="#æ—¥å¿—åˆ†ç±»" class="headerlink" title="æ—¥å¿—åˆ†ç±»"></a>æ—¥å¿—åˆ†ç±»</h3><ul><li>rootLoggerï¼šç”¨æ¥ç›‘å¬é¡¹ç›®ä¸­æ‰€æœ‰çš„è¿è¡Œæ—¥å¿—åŒ…æ‹¬å¼•å…¥ä¾èµ–jarä¸­çš„æ—¥å¿—</li><li>loggerï¼šç”¨æ¥ç›‘å¬é¡¹ç›®ä¸­æŒ‡å®šåŒ…ä¸­çš„æ—¥å¿—ä¿¡æ¯</li></ul><h3 id="é…ç½®æ—¥å¿—"><a href="#é…ç½®æ—¥å¿—" class="headerlink" title="é…ç½®æ—¥å¿—"></a>é…ç½®æ—¥å¿—</h3><blockquote><p>æ³¨æ„:SpringBootæ¡†æ¶ä¸­é»˜è®¤æ ¹æ—¥å¿—ä¸ºINFO<br><img src="/Resources/Pasted%20image%2020220823091739.png"></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># æ—¥å¿—</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-comment"># æŒ‡å®šæ ¹æ—¥å¿—çº§åˆ«(ä¸€èˆ¬ä¸æ¨èä¿®æ”¹æ ¹æ—¥å¿—,è¾“å‡ºä¿¡æ¯å¤ªå¤š,æ¨èä½¿ç”¨å­æ—¥å¿—)</span><br>    <span class="hljs-comment"># root: debug</span><br>    <span class="hljs-comment"># æŒ‡å®šæŸä¸ªåŒ…ä¸­æ—¥å¿—</span><br>    <span class="hljs-attr">com.cqupt.dao:</span> <span class="hljs-string">debug</span><br>  <span class="hljs-attr">file:</span><br>    <span class="hljs-comment"># æ—¥å¿—åç§°</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">log.log</span><br>    <span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">./</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ—¥å¿—"><a href="#ä½¿ç”¨æ—¥å¿—" class="headerlink" title="ä½¿ç”¨æ—¥å¿—"></a>ä½¿ç”¨æ—¥å¿—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å£°æ˜ä¸€ä¸ªæ—¥å¿—å¯¹è±¡</span><br><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(UserService.class);<br><br><br><span class="hljs-comment">//æ‰“å°æŸäº›æ—¥å¿—ä¿¡æ¯</span><br>log.debug(<span class="hljs-string">&quot;&quot;</span>);<br>log.error(<span class="hljs-string">&quot;&quot;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>ç®€åŒ–æ“ä½œï¼šä¼˜åŒ–éœ€è¦æ¯æ¬¡æ‰‹åŠ¨å£°æ˜æ—¥å¿—å¯¹è±¡<br><img src="/Resources/Pasted%20image%2020220823092741.png"><br><img src="/Resources/Pasted%20image%2020220823092801.png"><br><img src="/Resources/Pasted%20image%2020220823093036.png"><br>ğŸ”–ä½¿ç”¨çš„æ—¶å€™å¦‚æœæƒ³debugï¼Œå°±logdï¼Œå¦‚æœæƒ³infoï¼Œå°±logiï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></blockquote><h2 id="AOP-é¢å‘åˆ‡é¢ç¼–ç¨‹"><a href="#AOP-é¢å‘åˆ‡é¢ç¼–ç¨‹" class="headerlink" title="AOP é¢å‘åˆ‡é¢ç¼–ç¨‹"></a>AOP é¢å‘åˆ‡é¢ç¼–ç¨‹</h2><p>springbootæ˜¯å¯¹åŸæœ‰é¡¹ç›®ä¸­springæ¡†æ¶å’Œspringmvcçš„è¿›ä¸€æ­¥å°è£…ï¼Œå› æ­¤åœ¨springbootä¸­åŒæ ·æ”¯æŒspringæ¡†æ¶ä¸­AOPåˆ‡é¢ç¼–ç¨‹ï¼Œä¸è¿‡åœ¨springbootä¸­ä¸ºäº†å¿«é€Ÿå¼€å‘ä»…ä»…æä¾›äº†æ³¨è§£æ–¹å¼çš„åˆ‡é¢ç¼–ç¨‹ã€‚<br><a href="../Spring5/Spring5.md#%E4%B8%89%E3%80%81Aop">Springä¸­çš„Aop</a></p><p>Aspectï¼ˆåˆ‡é¢ï¼‰&#x3D; <strong>Advice</strong>ï¼ˆé€šçŸ¥ï¼‰+ <strong>Pointcut</strong>ï¼ˆåˆ‡å…¥ç‚¹ï¼‰<br>Adviceï¼ˆé€šçŸ¥ï¼‰ï¼šä¸šåŠ¡é€»è¾‘ä¸­ä¸€äº›<strong>é™„åŠ æ“ä½œ</strong>ç§°ä¹‹ä¸ºé€šçŸ¥<br>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰ï¼š<strong>é…ç½®é€šçŸ¥</strong>åº”ç”¨äºé¡¹ç›®ä¸­é‚£äº›ä¸šåŠ¡æ“ä½œ</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ‡é¢ç¼–ç¨‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ‡é¢ç¼–ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ‡é¢ç¼–ç¨‹"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ‡é¢ç¼–ç¨‹</h3><p>åœ¨æŸä¸ªæ¨¡å—ä¸šåŠ¡é€»è¾‘ä¸­æœ‰ä¸‰ç§æ–¹æ³•</p><blockquote><p>ä»…ä½œæ¼”ç¤ºï¼Œä¸ç¬¦åˆä¸šåŠ¡é€»è¾‘</p></blockquote><p><code>service</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">queryById</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­å¯¹åº”çš„å®ç°ç±»ä¸­<br><code>serviceImpl</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span>()</span>&#123;<br>dao.save();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span>()</span>&#123;<br>dao.delete();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">queryById</span>()</span>&#123;<br>dao.queryById();<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€æ±‚ï¼šè°ƒç”¨<code>dao.save();</code> <code>dao.delete();</code> <code>dao.queryById();</code>ä¹‹å‰ï¼Œå…ˆåšæŸäº›æ“ä½œï¼ˆä¸€è‡´çš„æ“ä½œæˆ–è€…æ˜¯å°è£…èµ·æ¥çš„æŸäº›æ–¹æ³•ï¼‰<br>é‚£ä¹ˆï¼Œå¯¹åº”çš„å®ç°ç±»ä¸­<br><code>serviceImpl</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span>()</span>&#123;<br>xxxxx;<br>dao.save();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">delete</span>()</span>&#123;<br>xxxxx;<br>dao.delete();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">queryById</span>()</span>&#123;<br>xxxxx;<br>dao.queryById();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯è§ï¼šè¿™æ ·çš„è¯ï¼Œä»£ç ä¼šæœ‰<strong>å†—ä½™</strong>å¹¶ä¸”å½“ä¸šåŠ¡è¶³å¤Ÿå¤šæ—¶ï¼Œæ¯ä¸ªéƒ½éœ€è¦å»æ‰‹åŠ¨æ·»åŠ ï¼Œæ¯”è¾ƒ<strong>éº»çƒ¦</strong>ï¼Œä¸åˆ©äºåæœŸé¡¹ç›®ç»´æŠ¤ï¼</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p><strong>å¼•å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç¼–å†™ä¸šåŠ¡ä»£ç </strong><br><code>UserService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryById</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>UserServiceImpl</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,è°ƒç”¨dao.save()&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,è°ƒç”¨dao.delete()&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryById</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,è°ƒç”¨dao.queryById()&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨UserServiceä¸Šctrl + shift + T æ–°å»ºæµ‹è¯•ç±»<br><img src="/Resources/Pasted%20image%2020220823141237.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> &#123;<br>        userService.save();<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        userService.delete();<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryById</span><span class="hljs-params">()</span> &#123;<br>        userService.queryById();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åœ¨springbooté¡¹ç›®ä¸­æ–°å»ºconfig(é…ç½®)åŒ…</strong><br><img src="/Resources/Pasted%20image%2020220823140646.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Aspect</span> ä¿®é¥°èŒƒå›´:åªèƒ½ç”¨åœ¨ç±»ä¸Š.ä½œç”¨:ä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Configuration</span> é…ç½®ç±»</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspectConfig</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@Before</span>():ä»£è¡¨è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå‰ç½®é™„åŠ æ“ä½œ,æ‹¬å·å†…å¡«åˆ‡å…¥ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Before(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ“ä½œ1&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@After</span>():ä»£è¡¨è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªåç½®é™„åŠ æ“ä½œ,æ‹¬å·å†…å¡«åˆ‡å…¥ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@After(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ“ä½œ2&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•Beforeå’ŒAfter"><a href="#æµ‹è¯•Beforeå’ŒAfter" class="headerlink" title="æµ‹è¯•Beforeå’ŒAfter"></a>æµ‹è¯•Beforeå’ŒAfter</h3><p>æµ‹è¯•<code>@Before</code>å’Œ<code>@After</code><br><img src="/Resources/Pasted%20image%2020220823142122.png"></p><p>ğŸ“Œæ³¨æ„ï¼šä½¿ç”¨<code>@Before</code>å’Œ <code>@After</code>æ³¨è§£å£°æ˜æ–¹æ³•ä¸Šå¯ä»¥å®šä¹‰ä¸€ä¸ªå‚æ•°<code>JoinPoint</code>æ¥è·å–ä¸€äº›å†…å®¹ä¿¡æ¯ã€‚å‰ç½®é€šçŸ¥å’Œåç½®é€šçŸ¥éƒ½<strong>æ²¡æœ‰è¿”å›å€¼</strong>ã€‚<br><img src="/Resources/Pasted%20image%2020220823152935.png"></p><p>ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">(JoinPoint joinPoint)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;å½“å‰æ‰§è¡Œçš„ç±»:&quot;</span>+joinPoint.getTarget());<br>    System.out.println(<span class="hljs-string">&quot;å½“å‰æ‰§è¡Œçš„ç±»çš„æ–¹æ³•:&quot;</span>+joinPoint.getSignature().getName());<br>    System.out.println(<span class="hljs-string">&quot;æ“ä½œ1&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220823143151.png"></p><h3 id="æµ‹è¯•Around"><a href="#æµ‹è¯•Around" class="headerlink" title="æµ‹è¯•Around"></a>æµ‹è¯•Around</h3><p>Aroundç±»ä¼¼æ–¹æ³•æ‹¦æˆªå™¨ï¼Œå½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå…ˆç»è¿‡Aroundï¼ŒAroundé€šè¿‡åï¼Œå†è¿›å»æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œç»“æŸåï¼Œå†ç»è¿‡Aroundï¼›<br><img src="/Resources/Pasted%20image%2020220823144110.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Around</span>():ä»£è¡¨è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªç¯ç»•é™„åŠ æ“ä½œ,æ‹¬å·å†…å¡«åˆ‡å…¥ç‚¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Around(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">()</span> &#123;<br>   System.out.println(<span class="hljs-string">&quot;ç¯ç»•çš„å‰ç½®æ“ä½œ&quot;</span>);<br>   <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220823144445.png"></p><blockquote><p>è¿™é‡Œä¸ä¼šè§¦å‘æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒåŸå› æ˜¯å› ä¸ºæ²¡æœ‰èµ°ç¬¬3æ­¥ï¼Œç¬¬4æ­¥æµç¨‹ï¼Œç¬¬3æ­¥ï¼Œç¬¬4æ­¥è§ä¸‹ã€‚</p></blockquote><p>ğŸ“Œæ³¨æ„ï¼šä½¿ç”¨ <code>Around</code> æ³¨è§£å£°æ˜æ–¹æ³•ä¸Šå¯ä»¥å®šä¹‰ä¸€ä¸ªå‚æ•°<code>ProceedingJoinPoint</code>æ¥è·å–ä¸€äº›å†…å®¹ä¿¡æ¯å’Œ<strong>æ”¾è¡ŒåŠæ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘</strong>ã€‚ç¯ç»•é€šçŸ¥<strong>å­˜åœ¨è¿”å›å€¼</strong>ï¼Œå‚æ•°ä¸ºProceedingJoinPointï¼Œå¦‚æœæ‰§è¡Œæ”¾è¡Œï¼Œæ‰ä¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œä¸€æ—¦æ”¾è¡Œå¿…é¡»å°†ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼è¿”å›ï¼Œå¦åˆ™è°ƒç”¨è€…æ— æ³•æ¥å—è¿”å›æ•°æ®</p><p>æµç¨‹<br><img src="/Resources/Pasted%20image%2020220823150600.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Around(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</span>  <br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;  <br>    System.out.println(<span class="hljs-string">&quot;ç¯ç»•çš„å‰ç½®æ“ä½œ&quot;</span>);  <br>    System.out.println(<span class="hljs-string">&quot;å½“å‰æ‰§è¡Œçš„ç±»:&quot;</span> + proceedingJoinPoint.getTarget());  <br>    System.out.println(<span class="hljs-string">&quot;å½“å‰æ‰§è¡Œçš„ç±»çš„æ–¹æ³•:&quot;</span> + proceedingJoinPoint.getSignature().getName());  <br>    <span class="hljs-type">Object</span> <span class="hljs-variable">proceed</span> <span class="hljs-operator">=</span> proceedingJoinPoint.proceed();  <br>    System.out.println(<span class="hljs-string">&quot;ç¯ç»•çš„åç½®æ“ä½œ&quot;</span>);  <br>    <span class="hljs-keyword">return</span> proceed;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"><a href="#åˆ‡å…¥ç‚¹è¡¨è¾¾å¼" class="headerlink" title="åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"></a>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h3><ol><li>executionæ–¹æ³•çº§åˆ«åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šæ§åˆ¶è¶Šç»†è¿è¡Œæ•ˆç‡è¶Šä½<br><code>(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</code></li><li>withinç±»çº§åˆ«åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šæ§åˆ¶è¶Šç²—è¿è¡Œæ•ˆç‡è¶Šé«˜<br><code>(&quot;within(com.cqupt.service.*.*)&quot;)</code></li><li>åŸºäºæ³¨è§£çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼<br><code>@annotation(com.cqupt.annotations.xxx)</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Retention</span>(RetentionPolicy.RUNTIME) è¿è¡Œæ—¶ç”Ÿæ•ˆ  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Target</span>(ElementType.METHOD) ä½œç”¨åœ¨æ–¹æ³•ç±»å‹  </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>  <br><span class="hljs-meta">@Target(ElementType.METHOD)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyAdvice &#123;  <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Aspect ä¿®é¥°èŒƒå›´:åªèƒ½ç”¨åœ¨ç±»ä¸Š</span><br><span class="hljs-comment"> * ä½œç”¨:ä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspectConfig</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@Around</span>():ä»£è¡¨è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªç¯ç»•é™„åŠ æ“ä½œ,æ‹¬å·å†…å¡«åˆ‡å…¥ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//@Around(&quot;execution(* com.cqupt.service.*.*(..))&quot;)</span><br>    <span class="hljs-comment">//@Around(&quot;within(com.cqupt.service.*.*)&quot;)</span><br>    <span class="hljs-meta">@Around(&quot;@annotation(com.cqupt.annotations.MyAdvice)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•çš„å‰ç½®æ“ä½œ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;å½“å‰æ‰§è¡Œçš„ç±»:&quot;</span> + proceedingJoinPoint.getTarget());<br>        System.out.println(<span class="hljs-string">&quot;å½“å‰æ‰§è¡Œçš„ç±»çš„æ–¹æ³•:&quot;</span> + proceedingJoinPoint.getSignature().getName());<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">proceed</span> <span class="hljs-operator">=</span> proceedingJoinPoint.proceed();<br><br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•çš„åç½®æ“ä½œ&quot;</span>);<br>        <span class="hljs-keyword">return</span> proceed;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-meta">@Test</span><br>   <span class="hljs-meta">@MyAdvice</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">findById</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> userService.findById();<br>       System.out.println(name);<br>   &#125;<br>   <br>   <span class="hljs-meta">@MyAdvice</span> åœ°æ–¹å†™é”™äº†<br>------------------ä¿®æ­£------------------<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-meta">@MyAdvice</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">findById</span><span class="hljs-params">()</span> &#123;<br>       System.out.println(<span class="hljs-string">&quot;æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,è°ƒç”¨dao.findById()&quot;</span>);<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;findById&quot;</span>;<br>   &#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä½†æ˜¯è¿™é‡Œæ²¡æœ‰èµ·ä½œç”¨ï¼Œæ˜¯ç”±äºä½ç½®å†™é”™äº†ï¼</p></blockquote><h2 id="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½</h2><h3 id="æ–‡ä»¶ä¸Šä¼ ï¼ˆå·²ç»ä¸é€‚ç”¨äº†ï¼‰"><a href="#æ–‡ä»¶ä¸Šä¼ ï¼ˆå·²ç»ä¸é€‚ç”¨äº†ï¼‰" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ï¼ˆå·²ç»ä¸é€‚ç”¨äº†ï¼‰"></a>æ–‡ä»¶ä¸Šä¼ ï¼ˆå·²ç»ä¸é€‚ç”¨äº†ï¼‰</h3><p>ç”¨æˆ·è®¿é—®å½“å‰ç³»ç»Ÿï¼Œå°†è‡ªå·±æœ¬åœ°è®¡ç®—æœºä¸­æ–‡ä»¶é€šè¿‡æµè§ˆå™¨ä¸Šä¼ åˆ°å½“å‰ç³»ç»Ÿæ‰€åœ¨çš„æœåŠ¡å™¨è¿‡ç¨‹ä¸­ç§°ä¹‹ä¸ºæ–‡ä»¶çš„ä¸Šä¼ </p><h4 id="å‡†å¤‡ä¸Šä¼ é¡µé¢"><a href="#å‡†å¤‡ä¸Šä¼ é¡µé¢" class="headerlink" title="å‡†å¤‡ä¸Šä¼ é¡µé¢"></a>å‡†å¤‡ä¸Šä¼ é¡µé¢</h4><blockquote><p>jspçš„ä½ç½®ä½äºmainä¸‹<br><img src="/Resources/Pasted%20image%2020220823165618.png"></p></blockquote><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;  <br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;  <br>&lt;head&gt;  <br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;  <br>    &lt;title&gt;Title&lt;/title&gt;  <br>&lt;/head&gt;  <br>&lt;body&gt;  <br>&lt;h1&gt;æµ‹è¯•æ–‡ä»¶ä¸Šä¼ &lt;/h1&gt;  <br>&lt;form method=<span class="hljs-string">&quot;post&quot;</span> action=<span class="hljs-string">&quot;$&#123;pageContext.request.contextPath&#125;/file/upload&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;  <br>    &lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span>&gt;  <br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;ä¸Šä¼ æ–‡ä»¶&quot;</span>&gt;  <br>&lt;/form&gt;  <br>&lt;/body&gt;  <br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h4 id="ç¼–å†™åç«¯ä»£ç "><a href="#ç¼–å†™åç«¯ä»£ç " class="headerlink" title="ç¼–å†™åç«¯ä»£ç "></a>ç¼–å†™åç«¯ä»£ç </h4><p><strong>å¯¼å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--        è§£æjspçš„ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ›´æ”¹ideaä¸­å·¥ä½œç›®å½•ä»¥åŠ è½½web-appæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹</strong><br><img src="/Resources/Pasted%20image%2020220823161934.png"></p><p>ç¼–å†™ä¸šåŠ¡ä»£ç </p><blockquote><p>ğŸ“¢ ä½¿ç”¨@Controllerï¼Œä¸è¦ä½¿ç”¨@RestControllerï¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>  <br><span class="hljs-meta">@RequestMapping(&quot;/file&quot;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileController</span> &#123;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * æµ‹è¯•æ–‡ä»¶ä¸Šä¼   </span><br><span class="hljs-comment">     *  </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> file    æ–‡ä»¶  </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request è¯·æ±‚  </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  </span><br><span class="hljs-comment">     */</span>    <span class="hljs-meta">@RequestMapping(&quot;/upload&quot;)</span>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<span class="hljs-comment">//å®šä¹‰:æ¥æ”¶æ–‡ä»¶å¯¹è±¡multipartFile fileå˜é‡åè¦ä¸formä¸­input type=&quot;file&quot;æ ‡ç­¾nameå±æ€§åä¸€è‡´  </span><br>        System.out.println(<span class="hljs-string">&quot;ä¸Šä¼ çš„æ–‡ä»¶åå­—:&quot;</span> + file.getOriginalFilename());  <br>        System.out.println(<span class="hljs-string">&quot;ä¸Šä¼ çš„æ–‡ä»¶å¤§å°:&quot;</span> + file.getSize());  <br>  <br>        <span class="hljs-comment">// 1.è·å–ç»å¯¹è·¯å¾„(çœŸå®è·¯å¾„)  </span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">realPath</span> <span class="hljs-operator">=</span> request.getSession().getServletContext().getRealPath(<span class="hljs-string">&quot;/upload&quot;</span>);  <br>        System.out.println(realPath);  <br>        <span class="hljs-comment">// 2. ä¸Šä¼ æ–‡ä»¶   å‚æ•°1:å°†æ–‡ä»¶å†™å…¥åˆ°é‚£ä¸ªç›®å½•  </span><br>        file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(realPath, file.getOriginalFilename()));  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/upload.jsp&quot;</span>;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä¸Šä¼ å›¾ç‰‡æˆåŠŸï¼ä½†æ˜¯ä¸Šä¼ å¤§æ–‡ä»¶ä¸å¯ä»¥ï¼</p><blockquote><p>å›¾ç‰‡çš„æ–‡ä»¶å¤§å°æ¯”è¾ƒå°ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿé”™è¯¯ï¼<br>é”™è¯¯ä¿¡æ¯ä¸ºï¼šå½“å‰æ–‡ä»¶çš„å¤§å°æ˜¯xxxï¼Œä½†æ˜¯æœåŠ¡å™¨å…è®¸çš„å¤§å°ä¸º10M</p></blockquote><p><img src="/Resources/Pasted%20image%2020220823171344.png"></p><p>è§£å†³åŠæ³•</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">100MB</span>  <span class="hljs-comment">#è¿è¡Œè¯·æ±‚ä¼ é€’æ–‡ä»¶å¤§å°æœ€å¤§ä¸º10M</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">100MB</span>     <span class="hljs-comment">#è¿è¡ŒæœåŠ¡å™¨å¯ä»¥å¤„ç†çš„æœ€å¤§æ–‡ä»¶å¤§å°</span><br></code></pre></td></tr></table></figure><h4 id="ä¼˜åŒ–-1"><a href="#ä¼˜åŒ–-1" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><p>ç°åœ¨çš„æ‰“åŒ…æ–¹å¼å·²ç»ä»warå˜æˆäº†jarï¼Œå› æ­¤ä¸Šè¿°çš„æ–‡ä»¶ä¸Šä¼ çš„æ–¹å¼å·²ç»ä¸å†é€‚ç”¨äº†ã€‚å› æ­¤ç°åœ¨æ˜¯é€šè¿‡æ³¨å…¥ç›®å½•çš„æ–¹å¼ï¼ŒæŠŠç›®å½•å†™åˆ°æœåŠ¡å™¨çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:\\&quot;</span>, file.getOriginalFilename()));<br><br><span class="hljs-comment">//æˆ–è€…ä½¿ç”¨å±æ€§æ³¨å…¥çš„æ–¹å¼</span><br><span class="hljs-meta">@Value(&quot;$&#123;realPath&#125;&quot;)</span>  <br><span class="hljs-keyword">private</span> String realPath;<br>file.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(realPath, file.getOriginalFilename()));<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220823192504.png"></p><h3 id="æ–‡ä»¶ä¸‹è½½"><a href="#æ–‡ä»¶ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸‹è½½"></a>æ–‡ä»¶ä¸‹è½½</h3><h4 id="å‡†å¤‡ä¸‹è½½é¡µé¢"><a href="#å‡†å¤‡ä¸‹è½½é¡µé¢" class="headerlink" title="å‡†å¤‡ä¸‹è½½é¡µé¢"></a>å‡†å¤‡ä¸‹è½½é¡µé¢</h4><blockquote><p><img src="/Resources/Pasted%20image%2020220823195227.png"></p></blockquote><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;Title&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h1&gt;æµ‹è¯•æ–‡ä»¶ä¸‹è½½&lt;/h1&gt;<br>&lt;a href=<span class="hljs-string">&quot;$&#123;pageContext.request.contextPath&#125;/file/download?filename=HELP.MD&quot;</span>&gt; HELP.MD&lt;/a&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h4 id="ç¼–å†™åç«¯ä»£ç -1"><a href="#ç¼–å†™åç«¯ä»£ç -1" class="headerlink" title="ç¼–å†™åç«¯ä»£ç "></a>ç¼–å†™åç«¯ä»£ç </h4><p><strong>å¯¼å…¥ä¾èµ–</strong></p><p><strong>æ›´æ”¹ideaä¸­å·¥ä½œç›®å½•ä»¥åŠ è½½web-appæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹</strong></p><p>ç¼–å†™ä¸šåŠ¡ä»£ç </p><blockquote><p>ğŸ“¢ ä½¿ç”¨@Controllerï¼Œä¸è¦ä½¿ç”¨@RestControllerï¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>  <br><span class="hljs-meta">@RequestMapping(&quot;/file&quot;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileController</span> &#123;  <br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æµ‹è¯•æ–‡ä»¶ä¸‹è½½</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filename æ–‡ä»¶åå­—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/download&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">download</span><span class="hljs-params">(String filename, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;å½“å‰ä¸‹è½½æ–‡ä»¶çš„åå­—:&quot;</span> + filename);<br>        <span class="hljs-comment">// 1.å»æŒ‡å®šç›®å½•ä¸­è¯»å–æ–‡ä»¶</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:\\Projects\\springboot_study\\springboot_day05\\src\\main\\webapp\\download&quot;</span>, filename);<br>        <span class="hljs-comment">// 2.å°†æ–‡ä»¶è¯»å–ä¸ºæ–‡ä»¶è¾“å…¥æµ</span><br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file);<br>        <span class="hljs-comment">// 2.5è·å–å“åº”æµä¹‹å‰ä¸€å®šè¦è®¾ç½®ä»¥é™„ä»¶å½¢å¼ä¸‹è½½</span><br>        response.setHeader(<span class="hljs-string">&quot;content-disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span> + filename);<br>        <span class="hljs-comment">// 3.è·å–å“åº”è¾“å‡ºæµ</span><br>        <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>        <span class="hljs-comment">// 4.è¾“å…¥æµå¤åˆ¶ç»™è¾“å‡ºæµ</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">byte</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            len = fileInputStream.read(b);<br>            <span class="hljs-keyword">if</span> (len == -<span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            outputStream.write(b, <span class="hljs-number">0</span>, len);<br>        &#125;<br>        <span class="hljs-comment">// 5.é‡Šæ”¾èµ„æº</span><br>        fileInputStream.close();<br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><ul><li><p><code>filter</code>ï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼šè¿‡æ»¤å™¨å¯ä»¥æ‹¦æˆª<code>javaweb</code>ä¸­è¯·æ±‚ï¼Œæ”¾è¡Œï¼Œä¸­æ–­</p></li><li><p><code>interceptor</code>ï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼šç±»ä¼¼äºjavawebä¸­<code>filter</code>åŠŸèƒ½</p></li></ul><p><strong>æ‹¦æˆªå™¨ï¼šåªèƒ½æ‹¦æˆªå™¨controllerç›¸å…³çš„è¯·æ±‚ï¼</strong></p><blockquote><p>ğŸ”” æ‹¦æˆªå™¨çš„åº•å±‚å®ç°å°±æ˜¯AOPï¼ åœ¨<a href="SpringBoot.md#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B">AOP</a>ä¸­ï¼Œè¯´æ˜äº†ä¸ºä»€ä¹ˆéœ€è¦åˆ‡é¢ç¼–ç¨‹ã€‚<strong>æ‹¦æˆªå™¨ä¹Ÿæ˜¯ä¸€æ ·çš„ä½œç”¨</strong>ã€‚</p><ol><li>å°†controllerä¸­å…±æœ‰ä»£ç æ”¾å…¥åˆ°æ‹¦æˆªå™¨ä¸­æ‰§è¡Œï¼Œå‡å°‘controllerä¸­ä»£ç å†—ä½™ã€‚</li><li>æ‹¦æˆªå™¨å¯ä»¥ä¸­æ–­è¯·æ±‚è½¨è¿¹ã€‚</li><li>è¯·æ±‚ä¹‹å‰å¦‚æœè¯¥è¯·æ±‚é…ç½®äº†æ‹¦æˆªå™¨ï¼Œè¯·æ±‚ä¼šå…ˆç»è¿‡æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨æ”¾è¡Œä¹‹åæ‰§è¡Œè¯·æ±‚çš„controllerï¼Œcontrolleræ‰§è¡Œå®Œæˆä¹‹åä¼šå›åˆ°æ‹¦æˆªå™¨ç»§ç»­æ‰§è¡Œæ‹¦æˆªå™¨ä¸­çš„ä»£ç ï¼ˆğŸ’«<strong>ç¯ç»•é€šçŸ¥</strong>ï¼ï¼‰</li></ol></blockquote><h3 id="å¼€å‘æ‹¦æˆªå™¨"><a href="#å¼€å‘æ‹¦æˆªå™¨" class="headerlink" title="å¼€å‘æ‹¦æˆªå™¨"></a>å¼€å‘æ‹¦æˆªå™¨</h3><blockquote><p>åœ¨Springbootä¸­ï¼ŒHandlerInterceptorå·²ç»åšäº†é»˜è®¤å®ç°ï¼ŒæŒ‰éœ€ä½¿ç”¨ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•å³å¯ã€‚<br>è¿™é‡Œä¹‹å‰å·²ç»åšè¿‡ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ²¡æœ‰å®è·µä»£ç ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰æ‹¦æˆªå™¨1</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> kioo</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœ€å…ˆæ‰§è¡Œçš„æ–¹æ³•</span><br><span class="hljs-comment">     * è¿”å›å€¼ä¸ºtrueæ—¶,æ”¾è¡Œ - &gt; æ‰§è¡Œcontrollerä¸­çš„ä¸šåŠ¡ä»£ç </span><br><span class="hljs-comment">     * è¿”å›å€¼ä¸ºfalseæ—¶,ä¸­æ–­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;=====================================1=====================================&quot;</span>);<br>        <span class="hljs-keyword">return</span> HandlerInterceptor.<span class="hljs-built_in">super</span>.preHandle(request, response, handler);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“controlleræ‰§è¡Œå®Œæ¯•å,ä¼šæ‰§è¡Œè¯¥æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;=====================================2=====================================&quot;</span>);<br>        HandlerInterceptor.<span class="hljs-built_in">super</span>.postHandle(request, response, handler, modelAndView);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœ€åå®Œæˆ:å½“å“åº”ç»“æŸä¹‹åä¼šæ‰§è¡Œæ‹¦æˆªå™¨ä¸­è¿™ä¸ªæ–¹æ³•å†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;=====================================3=====================================&quot;</span>);<br>        HandlerInterceptor.<span class="hljs-built_in">super</span>.afterCompletion(request, response, handler, ex);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰æ‹¦æˆªå™¨2</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> kioo</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyInterceptor2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœ€å…ˆæ‰§è¡Œçš„æ–¹æ³•</span><br><span class="hljs-comment">     * è¿”å›å€¼ä¸ºtrueæ—¶,æ”¾è¡Œ - &gt; æ‰§è¡Œcontrollerä¸­çš„ä¸šåŠ¡ä»£ç </span><br><span class="hljs-comment">     * è¿”å›å€¼ä¸ºfalseæ—¶,ä¸­æ–­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;=====================================4=====================================&quot;</span>);<br>        <span class="hljs-keyword">return</span> HandlerInterceptor.<span class="hljs-built_in">super</span>.preHandle(request, response, handler);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“controlleræ‰§è¡Œå®Œæ¯•å,ä¼šæ‰§è¡Œè¯¥æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;=====================================5=====================================&quot;</span>);<br>        HandlerInterceptor.<span class="hljs-built_in">super</span>.postHandle(request, response, handler, modelAndView);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœ€åå®Œæˆ:å½“å“åº”ç»“æŸä¹‹åä¼šæ‰§è¡Œæ‹¦æˆªå™¨ä¸­è¿™ä¸ªæ–¹æ³•å†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;=====================================6=====================================&quot;</span>);<br>        HandlerInterceptor.<span class="hljs-built_in">super</span>.afterCompletion(request, response, handler, ex);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyInterceptor</span>()) <span class="hljs-comment">// æ‹¦æˆªå™¨</span><br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)              <span class="hljs-comment">// æ‹¦æˆªè·¯å¾„</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/file/**&quot;</span>)     <span class="hljs-comment">// æ’é™¤è·¯å¾„</span><br>                .order(<span class="hljs-number">1</span>);                           <span class="hljs-comment">// æ‰§è¡Œé¡ºåº</span><br><br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyInterceptor2</span>()) <span class="hljs-comment">// æ‹¦æˆªå™¨</span><br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)              <span class="hljs-comment">// æ‹¦æˆªè·¯å¾„</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/file/**&quot;</span>)     <span class="hljs-comment">// æ’é™¤è·¯å¾„</span><br>                .order(<span class="hljs-number">2</span>);                           <span class="hljs-comment">// æ‰§è¡Œé¡ºåº</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šorderç”¨æ¥æ‰§è¡Œå¤šä¸ªæ æˆªå™¨çš„æ‰§è¡Œé¡ºåº, orderé‡Œé¢å†™è‡ªç„¶æ•°ï¼ŒæŒ‰ç…§è‡ªç„¶æ•°é¡ºåºæ‰§è¡Œ<br><img src="/Resources/interceptor.drawio%202.png"></p></blockquote><h3 id="ç¼–å†™ä¸šåŠ¡ä»£ç "><a href="#ç¼–å†™ä¸šåŠ¡ä»£ç " class="headerlink" title="ç¼–å†™ä¸šåŠ¡ä»£ç "></a>ç¼–å†™ä¸šåŠ¡ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoController</span> &#123;  <br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;abc&quot;</span>;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•éªŒè¯æ‹¦æˆªå™¨åŠæ‹¦æˆªå™¨çš„é¡ºåº"><a href="#æµ‹è¯•éªŒè¯æ‹¦æˆªå™¨åŠæ‹¦æˆªå™¨çš„é¡ºåº" class="headerlink" title="æµ‹è¯•éªŒè¯æ‹¦æˆªå™¨åŠæ‹¦æˆªå™¨çš„é¡ºåº"></a>æµ‹è¯•éªŒè¯æ‹¦æˆªå™¨åŠæ‹¦æˆªå™¨çš„é¡ºåº</h3><p><img src="/Resources/Pasted%20image%2020220824205701.png"></p><h2 id="Springbootéƒ¨ç½²æ–¹å¼"><a href="#Springbootéƒ¨ç½²æ–¹å¼" class="headerlink" title="Springbootéƒ¨ç½²æ–¹å¼"></a>Springbootéƒ¨ç½²æ–¹å¼</h2><h3 id="WAR"><a href="#WAR" class="headerlink" title="WAR"></a>WAR</h3><h4 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h4><p><strong>ä¸€å¼€å§‹å°±æŒ‡å®šWARæ‰“åŒ…</strong><br>æŒ‡å®šé¡¹ç›®æ‰“åŒ…çš„æ–¹å¼ä¸ºWAR</p><blockquote><p>æœ€åä¸€ä¸ªpackaging æ¢æˆWarï¼<br><img src="/./Resources/image-20230718113952695.png" alt="image-20230718113952695"></p></blockquote><h4 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h4><p><strong>ä¹‹åå°†JARæ‰“åŒ…æ–¹å¼ä¿®æ”¹æˆWAR</strong><br>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>å»é™¤å†…åµŒçš„TOMCATä¾èµ–</strong><br><img src="/Resources/Pasted%20image%2020220825091550.png"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!--providedå½“å‰ideaç¯å¢ƒå¯ç”¨ï¼Œä¸å‚ä¸æ‰“åŒ…--&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>åœ¨æ’ä»¶ä¸­æŒ‡å®šå…¥å£ç±»</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">fork</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">fork</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">jvmArguments</span>&gt;</span>-Dfile.encoding-UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">jvmArguments</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.cqupt.SpringbootDay06Application<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>é…ç½®å…¥å£ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringbootDay06Application</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SpringBootServletInitializer</span> &#123;<br>    <span class="hljs-comment">// SpringBootServletInitializer: ä¸å†ä½¿ç”¨å†…åµŒå®¹å™¨å¯åŠ¨ï¼Œä½¿ç”¨å¤–éƒ¨webå®¹å™¨(tomcat)å¯åŠ¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SpringbootDay06Application.class, args);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é…ç½®å…¥å£ç±»</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> SpringApplicationBuilder <span class="hljs-title function_">configure</span><span class="hljs-params">(SpringApplicationBuilder builder)</span> &#123;<br>        <span class="hljs-keyword">return</span> builder.sources(SpringbootDay06Application.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ‰“åŒ…æµ‹è¯•"><a href="#æ‰“åŒ…æµ‹è¯•" class="headerlink" title="æ‰“åŒ…æµ‹è¯•"></a>æ‰“åŒ…æµ‹è¯•</h4><p><a href="../../%E8%BD%AF%E4%BB%B6/IDEA.md#%E4%BD%BF%E7%94%A8IDEA%E6%89%93%E5%8C%85SPRINGBOOT%E9%A1%B9%E7%9B%AE">ä½¿ç”¨IDEAæ‰“åŒ…SPRINGBOOTé¡¹ç›®</a><br><img src="/Resources/Pasted%20image%2020220825090335.png"></p><blockquote><p>å¸¦ <code>.original</code> çš„æ˜¯ä¸å«ä¾èµ–åŒ…çš„<br>å‚è€ƒï¼š<a href="../../%E8%BD%AF%E4%BB%B6/IDEA.md#%E4%BD%BF%E7%94%A8IDEA%E6%89%93%E5%8C%85SPRINGBOOT%E9%A1%B9%E7%9B%AE">ä½¿ç”¨IDEAæ‰“åŒ…SPRINGBOOTé¡¹ç›®</a></p></blockquote><p>ä¸€æ—¦ä½¿ç”¨waråŒ…éƒ¨ç½²æ³¨æ„ï¼š</p><ul><li><ol><li><code>application.yml</code>ä¸­é…ç½®<code>port, context-path</code>å¤±æ•ˆ</li></ol></li><li><ol start="2"><li>è®¿é—®æ—¶ä½¿ç”¨æ‰“æˆwaråŒ…çš„åå­—å’Œå¤–éƒ¨tomcatç«¯å£å·è¿›è¡Œè®¿é—®é¡¹ç›®<blockquote><p><strong>éƒ¨ç½²</strong>ï¼šçœç•¥</p></blockquote></li></ol></li></ul><h3 id="JAR"><a href="#JAR" class="headerlink" title="JAR"></a>JAR</h3><h4 id="ç¬¬ä¸€ç§-1"><a href="#ç¬¬ä¸€ç§-1" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h4><p><strong>ä¸€å¼€å§‹å°±æŒ‡å®šJARæ‰“åŒ…</strong></p><blockquote><p>æœ€åä¸€ä¸ªpackaging ç‚¹Jarï¼<br><img src="/Resources/Pasted%20image%2020220822194842.png"></p></blockquote><h4 id="ç¬¬äºŒç§-1"><a href="#ç¬¬äºŒç§-1" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h4><p><strong>ä¹‹åå°†JARæ‰“åŒ…æ–¹å¼ä¿®æ”¹æˆWAR</strong><br>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æ‰“åŒ…æµ‹è¯•-1"><a href="#æ‰“åŒ…æµ‹è¯•-1" class="headerlink" title="æ‰“åŒ…æµ‹è¯•"></a>æ‰“åŒ…æµ‹è¯•</h4><p><a href="../../%E8%BD%AF%E4%BB%B6/IDEA.md#%E4%BD%BF%E7%94%A8IDEA%E6%89%93%E5%8C%85SPRINGBOOT%E9%A1%B9%E7%9B%AE">ä½¿ç”¨IDEAæ‰“åŒ…SPRINGBOOTé¡¹ç›®</a><br><img src="/Resources/Pasted%20image%2020220825093115.png"></p><blockquote><p>å¸¦ <code>.original</code> çš„æ˜¯ä¸å«ä¾èµ–åŒ…çš„<br>å‚è€ƒï¼š<a href="../../%E8%BD%AF%E4%BB%B6/IDEA.md#%E4%BD%BF%E7%94%A8IDEA%E6%89%93%E5%8C%85SPRINGBOOT%E9%A1%B9%E7%9B%AE">ä½¿ç”¨IDEAæ‰“åŒ…SPRINGBOOTé¡¹ç›®</a></p></blockquote><p><strong>å¯åŠ¨é¡¹ç›®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar xxxx.jar<br></code></pre></td></tr></table></figure><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><p>springbooté¡¹ç›®åœ¨ä½¿ç”¨jspæ¨¡æ¿æ—¶ï¼ŒjaråŒ…éƒ¨ç½²é»˜è®¤æ— æ³•æ‰¾åˆ°jspé¡µé¢</p><p><strong>è§£å†³</strong><br>ä¿®æ”¹æ’ä»¶ç‰ˆæœ¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æŒ‡å®šjapæ‰“åŒ…é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-comment">&lt;!--æ‰“åŒ…æ—¶å°†jspæ–‡ä»¶æ‹·è´åˆ°META-INFç›®å½•ä¸‹--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br><span class="hljs-comment">&lt;!--æŒ‡å®šresourcesæ’ä»¶å¤„ç†å“ªä¸ªç›®å½•ä¸‹çš„èµ„æºæ–‡ä»¶--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/webapp<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br><span class="hljs-comment">&lt;!--æŒ‡å®šå¿…é¡»è¦æ”¾åœ¨æ­¤ç›®å½•ä¸‹æ‰èƒ½è¢«è®¿é—®åˆ°--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">targetPath</span>&gt;</span>META-INF/resources<span class="hljs-tag">&lt;/<span class="hljs-name">targetPath</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/**<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/**<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="RestFul"><a href="#RestFul" class="headerlink" title="RestFul"></a>RestFul</h2><p><strong>REST</strong>ï¼š<strong>è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–</strong>(Representational State Transfer)ï¼Œå¦‚æœä¸€ä¸ªæ¶æ„ç¬¦åˆRESTåŸåˆ™ï¼Œå°±ç§°å®ƒä¸º RestFul æ¶æ„é£æ ¼ã€‚</p><p><strong>èµ„æº</strong>ï¼šæ‰€è°“â€èµ„æºâ€ï¼Œå°±æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå®ä½“ï¼Œæˆ–è€…è¯´æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå…·ä½“ä¿¡æ¯ã€‚</p><p><strong>è¡¨ç°å±‚</strong>ï¼šæˆ‘ä»¬æŠŠâ€èµ„æºâ€å…·ä½“å‘ˆç°å‡ºæ¥çš„å½¢å¼ï¼Œå«åšå®ƒçš„â€è¡¨ç°å±‚â€(Representation)ã€‚</p><p>çŠ¶æ€è½¬åŒ–(State Transfer)ï¼šå¦‚æœå®¢æˆ·ç«¯æƒ³è¦æ“ä½œæœåŠ¡å™¨ï¼Œå¿…é¡»é€šè¿‡æŸç§æ‰‹æ®µï¼Œè®©æœåŠ¡å™¨ç«¯å‘ç”Ÿâ€çŠ¶æ€è½¬åŒ–â€(State Transfer)ã€‚è€Œè¿™ç§è½¬åŒ–æ˜¯å»ºç«‹åœ¨è¡¨ç°å±‚ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥å°±æ˜¯â€è¡¨ç°å±‚çŠ¶æ€è½¬åŒ–â€ã€‚</p><ul><li><em>ä¼ ç»Ÿurl</em>ï¼š<code>http://localhost:8080/é¡¹ç›®å/user/findById?id=21</code></li><li><em>Resturl</em>ï¼š<code>http://localhost:8080/é¡¹ç›®å/user/findById/21</code></li></ul><blockquote><p>RESTåŸåˆ™å°±æ˜¯æŒ‡ä¸€ä¸ªURLä»£è¡¨ä¸€ä¸ªå”¯ä¸€èµ„æºï¼Œå¹¶ä¸”é€šè¿‡HTTPåè®®é‡Œé¢å››ä¸ªåŠ¨è¯ï¼š<strong>GET</strong>ã€<strong>POST</strong>ã€<strong>PUT</strong>ã€<strong>DELETE</strong>å¯¹åº”å››ç§æœåŠ¡å™¨ç«¯çš„åŸºæœ¬æ“ä½œï¼šGETç”¨æ¥è·å–èµ„æºï¼ŒPOSTç”¨æ¥æ·»åŠ èµ„æº(ä¹Ÿå¯ä»¥ç”¨äºæ›´æ–°èµ„æº)ï¼ŒPUTç”¨æ¥æ›´æ–°èµ„æºï¼ŒDELETEç”¨æ¥åˆ é™¤èµ„æºã€‚</p></blockquote><p>æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span> <br><span class="hljs-comment">// 1.æ ‡è¯†å½“å‰æœåŠ¡æ˜¯åŸºäºrestfulçš„æ¶æ„é£æ ¼</span><br><span class="hljs-comment">// 2.@responseBody + @controllerç»„åˆ</span><br><span class="hljs-comment">// ç”¨äº†@responseBodyå°±è¡¨ç¤ºåªæ¥å—jsonæ•°æ®</span><br><span class="hljs-meta">@RequestMapping(&quot;/rest&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestFulController</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Restä½¿ç”¨åŸåˆ™ï¼š</span><br><span class="hljs-comment">     * 1. ä½¿ç”¨RestURL æ›¿æ¢ ä¼ ç»ŸURLå‚æ•°ä½œä¸º URLæ•´ä½“</span><br><span class="hljs-comment">     * 2. ä½¿ç”¨å››ç§httpåŠ¨è¯ get post put delete</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@GetMapping</span> <span class="hljs-doctag">@PostMapping</span> <span class="hljs-doctag">@PutMapping</span> <span class="hljs-doctag">@DeleteMapping</span></span><br><span class="hljs-comment">     * 3. é€šå¸¸æœåŠ¡è¿”å›çš„æ•°æ®éƒ½æ˜¯jsonæ ¼å¼æˆ–è€…xmlæ ¼å¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;findOne/&#123;id&#125;/&#123;name&#125;/&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">findOne</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id, <span class="hljs-meta">@PathVariable(&quot;name&quot;)</span> String name)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Ok&quot;</span> + id;<br>    &#125;<br><br><br>    <span class="hljs-meta">@PutMapping(&quot;saveOne&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">addOne</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Ok&quot;</span>;<br>    &#125;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;updateOne&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">updateOne</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Ok&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@DeleteMapping(&quot;delOne/&#123;id&#125;/&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">deleteOne</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Ok&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä¸€æ—¦éµå¾ªReståŸåˆ™ï¼Œé‚£ä¹ˆå¿…é¡»å‘<strong>å¯¹åº”çš„è¯·æ±‚</strong>ï¼å¹¶ä¸”è·¯å¾„ä¹Ÿå¿…é¡»<strong>åŒ¹é…è§„åˆ™</strong>ï¼<br>æµè§ˆå™¨åªä¼šå‘é€getè¯·æ±‚ï¼Œå› æ­¤ä¼šæŠ¥é”™ï¼<br><img src="/Pasted%20image%2020220720111001.png" alt="Pasted image 20220720111001.png"><br><strong>å°‘ä¸€ä¸ªæ–œæ </strong>éƒ½ä¸è¡Œï¼<br><img src="/Pasted%20image%2020220720111024.png" alt="Pasted image 20220720111024.png"></p></blockquote><blockquote><p>è¡¥å……ï¼šè¿™é‡Œçš„ç¬”è®°å‡ºè‡ªESä¸­çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰æŒ‰ç…§è§†é¢‘ä¸­çš„èµ°ï¼ŒåŸºæœ¬ä¸Šè·³è¿‡äº†è§†é¢‘çš„éƒ¨åˆ†ã€‚è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1Cv411p7cQ?p=47">RESTFULçš„ä½¿ç”¨</a>ï¼Œä»¥åå¦‚æœéœ€è¦ç”¨åˆ°RESTFULå¼€å‘ï¼Œå†æ·±å…¥äº†è§£RESTFULã€‚</p></blockquote><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><blockquote><p><strong>ä»…çœ‹äº†å‰åç«¯åˆ†ç¦»çš„å¼‚å¸¸å¤„ç†</strong>ï¼Œä¼ ç»Ÿæ–¹æ³•å¼€å‘çš„å¼‚å¸¸å¤„ç†ä»…å¤åˆ¶äº†ç¬”è®°ï¼Œç”¨ä½œå‚è€ƒã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•è§ï¼š<a href="https://www.bilibili.com/video/BV1Cv411p7cQ?p=49">å¼‚å¸¸å¤„ç†&amp;ä¼ ç»Ÿæ–¹å¼å¼‚å¸¸å¤„ç†</a>ã€‚</p></blockquote><h4 id="ä¼ ç»Ÿå¼€å‘çš„å¼‚å¸¸å¤„ç†"><a href="#ä¼ ç»Ÿå¼€å‘çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="ä¼ ç»Ÿå¼€å‘çš„å¼‚å¸¸å¤„ç†"></a>ä¼ ç»Ÿå¼€å‘çš„å¼‚å¸¸å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å…¨å±€å¼‚å¸¸å¤„ç†ä¹‹ä¼ ç»Ÿwebå¼€å‘</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerExceptionResolver</span> &#123;<br>    <span class="hljs-comment">//å‚æ•°1:å½“å‰è¯·æ±‚å¯¹è±¡</span><br>    <span class="hljs-comment">//å‚æ•°2:å½“å‰è¯·æ±‚çš„å“åº”å¯¹è±¡</span><br>    <span class="hljs-comment">//å‚æ•°3:å½“å‰å‡ºç°å¼‚å¸¸çš„æ§å‰²å™¨å¯¹è±¡</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title function_">resolveException</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> &#123;<br>        <span class="hljs-comment">//å¼‚å¸¸å¤„ç†...</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModelAndView</span>(<span class="hljs-string">&quot;500&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="RestFulçš„å¼‚å¸¸å¤„ç†"><a href="#RestFulçš„å¼‚å¸¸å¤„ç†" class="headerlink" title="RestFulçš„å¼‚å¸¸å¤„ç†"></a>RestFulçš„å¼‚å¸¸å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å…¨å±€å¼‚å¸¸å¤„ç†ä¹‹RestFul</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandlerRest</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(value = Exception.class)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">exceptionHandler</span><span class="hljs-params">(Exception e)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>&lt;&gt;(e.getMessage(), HttpStatus.INTERNAL_SERVER_ERROR);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CORSè·¨åŸŸ"><a href="#CORSè·¨åŸŸ" class="headerlink" title="CORSè·¨åŸŸ"></a>CORSè·¨åŸŸ</h2><p><strong>CORS</strong></p><ul><li>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€<strong>è·¨åŸŸèµ„æºå…±äº«</strong>â€œï¼ˆCross-origin resource sharingï¼‰ã€‚</li><li>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚</li></ul><h2 id="åŒæºç­–ç•¥-åŒæºç­–ç•¥-same-origin-policy-æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œä¸åŒæºçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹èµ„æºã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨å®‰å…¨çš„åŸºçŸ³ã€‚"><a href="#åŒæºç­–ç•¥-åŒæºç­–ç•¥-same-origin-policy-æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œä¸åŒæºçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹èµ„æºã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨å®‰å…¨çš„åŸºçŸ³ã€‚" class="headerlink" title="åŒæºç­–ç•¥- åŒæºç­–ç•¥[same origin policy]æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œä¸åŒæºçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹èµ„æºã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨å®‰å…¨çš„åŸºçŸ³ã€‚"></a><strong>åŒæºç­–ç•¥</strong><br>- åŒæºç­–ç•¥[same origin policy]æ˜¯æµè§ˆå™¨çš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œä¸åŒæºçš„å®¢æˆ·ç«¯è„šæœ¬åœ¨æ²¡æœ‰æ˜ç¡®æˆæƒçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½è¯»å†™å¯¹æ–¹èµ„æºã€‚åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨å®‰å…¨çš„åŸºçŸ³ã€‚</h2><p><strong>æº</strong></p><ul><li>æº[origin]å°±æ˜¯åè®®ã€åŸŸåå’Œç«¯å£å·ã€‚ä¾‹å¦‚ï¼š<code>http://www.baidu.com:80</code>è¿™ä¸ªURLã€‚</li></ul><p><strong>åŒæº</strong></p><ul><li>è‹¥åœ°å€é‡Œé¢çš„åè®®ã€åŸŸåå’Œç«¯å£å·å‡ç›¸åŒåˆ™å±äºåŒæºã€‚</li></ul><p><img src="/Resources/Pasted%20image%2020220825102617.png"></p><h2 id="å“ªäº›æ“ä½œä¸å—åŒæºé™åˆ¶-é¡µé¢ä¸­çš„é“¾æ¥ï¼Œé‡å®šå‘ä»¥åŠè¡¨å•æäº¤æ˜¯ä¸ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶çš„ï¼›-è·¨åŸŸèµ„æºçš„å¼•å…¥æ˜¯å¯ä»¥çš„ã€‚å¦‚åµŒå…¥åˆ°é¡µé¢ä¸­çš„-lt-script-src-quot-quot-gt-lt-script-gt-lt-img-gt-lt-link-gt-lt-iframe-gt-ç­‰ã€‚"><a href="#å“ªäº›æ“ä½œä¸å—åŒæºé™åˆ¶-é¡µé¢ä¸­çš„é“¾æ¥ï¼Œé‡å®šå‘ä»¥åŠè¡¨å•æäº¤æ˜¯ä¸ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶çš„ï¼›-è·¨åŸŸèµ„æºçš„å¼•å…¥æ˜¯å¯ä»¥çš„ã€‚å¦‚åµŒå…¥åˆ°é¡µé¢ä¸­çš„-lt-script-src-quot-quot-gt-lt-script-gt-lt-img-gt-lt-link-gt-lt-iframe-gt-ç­‰ã€‚" class="headerlink" title="å“ªäº›æ“ä½œä¸å—åŒæºé™åˆ¶- é¡µé¢ä¸­çš„é“¾æ¥ï¼Œé‡å®šå‘ä»¥åŠè¡¨å•æäº¤æ˜¯ä¸ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶çš„ï¼›- è·¨åŸŸèµ„æºçš„å¼•å…¥æ˜¯å¯ä»¥çš„ã€‚å¦‚åµŒå…¥åˆ°é¡µé¢ä¸­çš„&lt;script src=&quot; ...&quot;&gt;&lt;/script&gt;, &lt;img&gt;, &lt;link&gt;, &lt;iframe&gt;ç­‰ã€‚"></a><strong>å“ªäº›æ“ä½œä¸å—åŒæºé™åˆ¶</strong><br>- é¡µé¢ä¸­çš„é“¾æ¥ï¼Œé‡å®šå‘ä»¥åŠè¡¨å•æäº¤æ˜¯ä¸ä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶çš„ï¼›<br>- è·¨åŸŸèµ„æºçš„å¼•å…¥æ˜¯å¯ä»¥çš„ã€‚å¦‚åµŒå…¥åˆ°é¡µé¢ä¸­çš„<code>&lt;script src=&quot; ...&quot;&gt;&lt;/script&gt;, &lt;img&gt;, &lt;link&gt;, &lt;iframe&gt;</code>ç­‰ã€‚</h2><p><strong>å“ªäº›æ“ä½œå—åˆ°åŒæºé™åˆ¶</strong></p><ul><li>åœ¨æµè§ˆå™¨ä¸­å‘èµ·ä¸€ä¸ªAJAXè¯·æ±‚ï¼Œä¼šå—åˆ°åŒæºç­–ç•¥é™åˆ¶ã€‚</li><li>å‡ºç°é”™è¯¯:Access-Control-Allow-0rigin<br>![[Pasted image 20220621095746.png]]</li></ul><h3 id="è§£å†³è·¨åŸŸ"><a href="#è§£å†³è·¨åŸŸ" class="headerlink" title="è§£å†³è·¨åŸŸ"></a>è§£å†³è·¨åŸŸ</h3><p>ç¬¬ä¸€ç§<br>åœ¨controllerä¸Šé¢æ·»åŠ @CrossOriginæ³¨è§£</p><p>ç¬¬äºŒç§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¸‹é¢çš„ä¸¤ç§æ„Ÿè§‰éƒ½å¯ä»¥ï¼Œæœ‰æ—¶å€™ç¬¬ä¸€ç§å¯ä»¥ï¼Œæœ‰æ—¶å€™ç¬¬äºŒç§å¯ä»¥ï¼Œæœ‰æ—¶å€™éƒ½å¯ä»¥</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> &#123;<br>        registry.addMapping(<span class="hljs-string">&quot;/**&quot;</span>)<br>                .allowCredentials(<span class="hljs-literal">false</span>)<br>                .allowedMethods(<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;DELETE&quot;</span>,<span class="hljs-string">&quot;PUT&quot;</span>,<span class="hljs-string">&quot;OPTIONS&quot;</span>)<br>                .allowedOrigins(<span class="hljs-string">&quot;*&quot;</span>)<br>        ;<br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CorsConfig</span> &#123;<br><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> CorsWebFilter <span class="hljs-title function_">corsWebFilter</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">UrlBasedCorsConfigurationSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBasedCorsConfigurationSource</span>();<br><br><span class="hljs-type">CorsConfiguration</span> <span class="hljs-variable">corsConfiguration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsConfiguration</span>();<br>corsConfiguration.addAllowedHeader(<span class="hljs-string">&quot;*&quot;</span>);<br>corsConfiguration.addAllowedMethod(<span class="hljs-string">&quot;*&quot;</span>);<br>corsConfiguration.addAllowedOrigin(<span class="hljs-string">&quot;*&quot;</span>);<br>corsConfiguration.setAllowCredentials(<span class="hljs-literal">true</span>);<br>source.registerCorsConfiguration(<span class="hljs-string">&quot;/**&quot;</span>, corsConfiguration);<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorsWebFilter</span>(source);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Jasypt-åŠ å¯†"><a href="#Jasypt-åŠ å¯†" class="headerlink" title="Jasypt åŠ å¯†"></a>Jasypt åŠ å¯†</h2><p>â€¦</p><h2 id="åœ¨SpringBootä¸­é›†æˆMybatis"><a href="#åœ¨SpringBootä¸­é›†æˆMybatis" class="headerlink" title="åœ¨SpringBootä¸­é›†æˆMybatis"></a>åœ¨SpringBootä¸­é›†æˆMybatis</h2><p>å•ç‹¬ä½¿ç”¨å‚è€ƒï¼š[[MyBatis]]</p><p>åˆå§‹åŒ–ä¸€ä¸ªSpringbootåº”ç”¨ï¼Œä¾èµ–é€‰spring-webï¼Œä¸å†èµ˜è¿°ã€‚</p><h3 id="å¯¼å…¥ä¾èµ–-2"><a href="#å¯¼å…¥ä¾èµ–-2" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><p><code>pom.xml</code></p><blockquote><p>ä¾èµ–å‚è€ƒï¼Œå¦‚æœåˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ²¡æœ‰é€‰æ‹©spring-webï¼Œå¯ä»¥å…¨éƒ¨å¤åˆ¶å¯¼å…¥<br>ğŸ’¡ï¼šå¦‚æœæ˜¯mysqlç‰ˆæœ¬ç”¨çš„æ˜¯8çš„è¯ï¼Œéœ€è¦å¯¼8çš„ä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®é…ç½®æ–‡ä»¶"><a href="#é…ç½®é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®é…ç½®æ–‡ä»¶"></a>é…ç½®é…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8989</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/springboot_day04</span><br><br><span class="hljs-comment"># æ•´åˆmybatisç›¸å…³é…ç½®</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.153.135:3306/yingxue?characterEncoding=UTF-8&amp;useSSL=false</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span><br><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-comment">#mapperé…ç½®æ–‡ä»¶çš„ä½ç½®</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:com/cqupt/mapper/*.xml</span><br>  <span class="hljs-comment">#åˆ«å</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.cqupt.entity</span><br></code></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ï¼šå¦‚æœæ˜¯mysqlä¾èµ–ç‰ˆæœ¬ç”¨çš„æ˜¯8çš„è¯ï¼Œ<code>driver-class-name: com.mysql.jdbc.Driver</code>æ¢æˆ<code>driver-class-name: com.mysql.cj.jdbc.Driver</code></p><p>â—ï¼šåˆ›å»ºmapperğŸ“‚æ—¶ï¼Œæ³¨æ„éœ€è¦ä½¿ç”¨ <code>/</code> çš„æ–¹å¼ï¼Œä¸è¦ä½¿ç”¨ <code>.</code> çš„æ–¹å¼ï¼Œå¦åˆ™è®¤ä¸ºä¸€å±‚ç›®å½•ã€‚æœ€åå¯¼è‡´æ‰¾ä¸åˆ°mapperæ–‡ä»¶ã€‚<br><img src="/Resources/Pasted%20image%2020220822191755.png"></p></blockquote><h3 id="ç¼–å†™ä¸šåŠ¡å±‚ä»£ç "><a href="#ç¼–å†™ä¸šåŠ¡å±‚ä»£ç " class="headerlink" title="ç¼–å†™ä¸šåŠ¡å±‚ä»£ç "></a>ç¼–å†™ä¸šåŠ¡å±‚ä»£ç </h3><blockquote><p>å¯ä»¥æ ¹æ®æ•°æ®åº“å­—æ®µè‡ªå·±ç¼–å†™ï¼Œä½†æ˜¯ç°åœ¨å¯ä»¥ä½¿ç”¨å…¶ä»–å·¥å…·æ¥ç¼–å†™ç®€åŒ–æ“ä½œ</p></blockquote><h4 id="ä½¿ç”¨MyBatis-Generatorï¼ˆä¸å»ºè®®ï¼‰"><a href="#ä½¿ç”¨MyBatis-Generatorï¼ˆä¸å»ºè®®ï¼‰" class="headerlink" title="ä½¿ç”¨MyBatis Generatorï¼ˆä¸å»ºè®®ï¼‰"></a>ä½¿ç”¨MyBatis Generatorï¼ˆä¸å»ºè®®ï¼‰</h4><p>æ ¹æ®æ•°æ®åº“ä¸­çš„è¡¨ï¼Œè‡ªåŠ¨çš„ç”ŸæˆJavaBeanæ–‡ä»¶ã€å¯¹åº”çš„mapperæ¥å£ã€ä»¥åŠå¯¹åº”çš„mapperé…ç½®æ–‡ä»¶ä¸­å¤§éƒ¨åˆ†æŸ¥è¯¢è¯­å¥ã€‚</p><h5 id="å¯¼å…¥ä¾èµ–-3"><a href="#å¯¼å…¥ä¾èµ–-3" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h5><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.generator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;last.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--mybatisçš„ä»£ç ç”Ÿæˆå™¨çš„é…ç½®ç­–ç•¥æ–‡ä»¶--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configurationFile</span>&gt;</span>mybatis-generator-config.xml<span class="hljs-tag">&lt;/<span class="hljs-name">configurationFile</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="é…ç½®ä»£ç ç”Ÿæˆç›¸å…³çš„ç­–ç•¥æ–‡ä»¶-mybatis-generator-config-xml"><a href="#é…ç½®ä»£ç ç”Ÿæˆç›¸å…³çš„ç­–ç•¥æ–‡ä»¶-mybatis-generator-config-xml" class="headerlink" title="é…ç½®ä»£ç ç”Ÿæˆç›¸å…³çš„ç­–ç•¥æ–‡ä»¶ mybatis-generator-config.xml"></a>é…ç½®ä»£ç ç”Ÿæˆç›¸å…³çš„ç­–ç•¥æ–‡ä»¶ mybatis-generator-config.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">generatorConfiguration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- jdbcè¿æ¥ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">jdbcConnection</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">jdbcConnection</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- schemaä¸ºæ•°æ®åº“åï¼ŒtableNameä¸ºå¯¹åº”çš„æ•°æ®åº“è¡¨å --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ³¨é‡Š --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">commentGenerator</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">commentGenerator</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç±»å‹è½¬æ¢ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">javaTypeResolver</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">javaTypeResolver</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç”Ÿæˆå®ä½“ç±»é…ç½® --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">javaModelGenerator</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">javaModelGenerator</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç”ŸæˆMapper.xmlæ–‡ä»¶é…ç½® --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">sqlMapGenerator</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">sqlMapGenerator</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç”ŸæˆMapper.java æ¥å£--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">javaClientGenerator</span>&gt;</span> ... <span class="hljs-tag">&lt;/<span class="hljs-name">javaClientGenerator</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">context</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">generatorConfiguration</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¼ºç‚¹</p><ol><li>æ¯æ¬¡ä»£ç ç”Ÿæˆéœ€è¦é…ç½®å¯¹åº”çš„ mybatis-generator-config é€šè¿‡ XML çš„å½¢å¼é…ç½®ç›¸å…³ç”Ÿæˆå±æ€§å’Œè§„åˆ™</li><li>æ— æ³•ç”Ÿæˆé€šç”¨çš„ Controllerã€Service ç±»ï¼Œæ— æ³•è‡ªå®šä¹‰æ¨¡æ¿ç­‰<br>ç»¼ä¸Šä¸¤ç‚¹ï¼š mybatis-generator ä½¿ç”¨éå¸¸ä¸æ–¹ä¾¿ã€‚</li></ol><h4 id="ä½¿ç”¨EasyCodeï¼ˆæ¨èï¼‰"><a href="#ä½¿ç”¨EasyCodeï¼ˆæ¨èï¼‰" class="headerlink" title="ä½¿ç”¨EasyCodeï¼ˆæ¨èï¼‰"></a>ä½¿ç”¨EasyCodeï¼ˆæ¨èï¼‰</h4><blockquote><p>ä¸‹é¢çš„æˆªå›¾æ¥è‡ªå¾®æœåŠ¡çš„å®æˆ˜</p></blockquote><p><a href="IDEA#%E4%BD%BF%E7%94%A8IDEA%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93">ä½¿ç”¨IDEAè¿æ¥æ•°æ®åº“</a></p><p>ä½¿ç”¨EasyCodeï¼ˆIDEAä¸­çš„æ’ä»¶ï¼‰å¿«é€Ÿç”Ÿæˆä»£ç <br><img src="/./Resources/image-20230718114042119.png" alt="image-20230718114042119"></p><p><img src="/./Resources/image-20230718114048107.png" alt="image-20230718114048107"></p><p>è¿™é‡Œçš„mapperä¸çŸ¥é“ä¸ºä»€ä¹ˆå»äº†adminçš„srcç›®å½•ä¸‹ï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹è·¯å¾„<br>å¹¶å°†mapperæ–‡ä»¶å¤¹çš„åå­—æ”¹ä¸º<code>com.cqupt.mapper</code></p><p>è°ƒæ•´å®Œåé¡¹ç›®ç»“æ„å›¾å¦‚ä¸‹<br><img src="/./Resources/image-20230718114056565.png" alt="image-20230718114056565"></p><p>æ‰«æMapper</p><ul><li>åœ¨å…¥å£ç±»ä¸ŠåŠ å…¥<code>@MapperScan(&quot;com.cqupt.dao&quot;)</code><br>ä¿®é¥°èŒƒå›´ï¼šç”¨åœ¨ç±»ä¸Šï¼Œç”¨æ¥æ‰«ædaoæ¥å£æ‰€åœ¨åŒ…ï¼ŒåŒæ—¶å°†æ‰€æœ‰daoæ¥å£åœ¨å·¥å‚ä¸­åˆ›å»ºå¯¹è±¡</li><li>åœ¨Mapperç±»ä¸ŠåŠ å…¥<code>@Mapper</code><blockquote><p>ä»¥ä¸Šé€‰æ‹©ä»»æ„ä¸€ä¸ªçš†å¯</p></blockquote></li></ul><h2 id="åœ¨Springbootä¸­é›†æˆMybatis-Plus"><a href="#åœ¨Springbootä¸­é›†æˆMybatis-Plus" class="headerlink" title="åœ¨Springbootä¸­é›†æˆMybatis-Plus"></a>åœ¨Springbootä¸­é›†æˆMybatis-Plus</h2><h3 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h3><blockquote><p>ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œå‡†å¤‡ä¸€å¼ æµ‹è¯•è¡¨</p></blockquote><p>å¯¹åº”çš„è¡¨ç»“æ„![[Pasted image 20220620200304.png]]</p><p>å¯¹åº”çš„sqlè„šæœ¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- MySQL dump 10.13  Distrib 5.7.38, for osx10.17 (x86_64)</span><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Host: 127.0.0.1    Database: ms</span><br><span class="hljs-comment">-- ------------------------------------------------------</span><br><span class="hljs-comment">-- Server version5.7.38</span><br><br><span class="hljs-comment">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span>;<br><span class="hljs-comment">/*!40101 SET NAMES utf8 */</span>;<br><span class="hljs-comment">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span>;<br><span class="hljs-comment">/*!40103 SET TIME_ZONE=&#x27;+00:00&#x27; */</span>;<br><span class="hljs-comment">/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span>;<br><span class="hljs-comment">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span>;<br><span class="hljs-comment">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#x27;NO_AUTO_VALUE_ON_ZERO&#x27; */</span>;<br><span class="hljs-comment">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span>;<br><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Table structure for table `sys_user`</span><br><span class="hljs-comment">--</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `sys_user`;<br><span class="hljs-comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;<br><span class="hljs-comment">/*!40101 SET character_set_client = utf8 */</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_user` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `nickname` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `address` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `create_time` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `user_id_uindex` (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><span class="hljs-comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;<br><br><span class="hljs-comment">--</span><br><span class="hljs-comment">-- Dumping data for table `sys_user`</span><br><span class="hljs-comment">--</span><br><br>LOCK TABLES `sys_user` WRITE;<br><span class="hljs-comment">/*!40000 ALTER TABLE `sys_user` DISABLE KEYS */</span>;<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `sys_user` (`id`, `username`, `password`, `nickname`, `email`, `phone`, `address`, `create_time`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-string">&#x27;ç®¡ç†å‘˜&#x27;</span>,<span class="hljs-string">&#x27;admin@mail.com&#x27;</span>,<span class="hljs-string">&#x27;123&#x27;</span>,<span class="hljs-string">&#x27;ä¸Šæµ·å¸‚æ™®é™€åŒºé‡‘æ²™æ±Ÿè·¯ 1518 å¼„&#x27;</span>,<span class="hljs-string">&#x27;2022-06-20 09:04:56&#x27;</span>),(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;wt&#x27;</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>,<span class="hljs-keyword">NULL</span>);<br><span class="hljs-comment">/*!40000 ALTER TABLE `sys_user` ENABLE KEYS */</span>;<br>UNLOCK TABLES;<br><span class="hljs-comment">/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */</span>;<br><br><span class="hljs-comment">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span>;<br><span class="hljs-comment">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span>;<br><span class="hljs-comment">/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */</span>;<br><span class="hljs-comment">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span>;<br><span class="hljs-comment">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span>;<br><span class="hljs-comment">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span>;<br><span class="hljs-comment">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span>;<br><br><span class="hljs-comment">-- Dump completed on 2022-06-20 20:03:25</span><br><br></code></pre></td></tr></table></figure><h3 id="å¯¼å…¥ä¾èµ–-4"><a href="#å¯¼å…¥ä¾èµ–-4" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--        MybatisPlus--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–å†™é…ç½®æ–‡ä»¶"><a href="#ç¼–å†™é…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–å†™é…ç½®æ–‡ä»¶"></a>ç¼–å†™é…ç½®æ–‡ä»¶</h3><p><code>application.yml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"># DataSource Config<br>spring:<br>  datasource:<br>    driver-class-name: com.mysql.cj.jdbc.Driver<br>    url: jdbc:mysql://localhost:3306/ms?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai<br>    username: root<br>    password: root<br>server:<br>  port: 8081<br>mybatis-plus:<br>  mapper-locations: classpath*:/mapper/**Mapper.xml<br></code></pre></td></tr></table></figure><p><code>MybatisPlusConfig</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@MapperScan(&quot;scan.cqupt.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));<br>        <span class="hljs-keyword">return</span> interceptor;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨MybatisPlus-generator-è‡ªåŠ¨ç”Ÿæˆ"><a href="#ä½¿ç”¨MybatisPlus-generator-è‡ªåŠ¨ç”Ÿæˆ" class="headerlink" title="ä½¿ç”¨MybatisPlus-generator è‡ªåŠ¨ç”Ÿæˆ"></a>ä½¿ç”¨MybatisPlus-generator è‡ªåŠ¨ç”Ÿæˆ</h3><p>å®˜æ–¹å¼€å‘æ–‡æ¡£ï¼š<br>ç¤ºä¾‹ï¼š<a href="https://baomidou.com/pages/779a6e/#%E4%BD%BF%E7%94%A8">ä»£ç ç”Ÿæˆå™¨ï¼ˆæ–°ï¼‰ | MyBatis-Plus</a></p><h4 id="å¯¼å…¥ä¾èµ–-5"><a href="#å¯¼å…¥ä¾èµ–-5" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h4><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--        MybatisPlus--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--        mpä»£ç ç”Ÿæˆå™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--        æ¨¡æ¿å¼•æ“--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ç¼–å†™MybatisPlusCodeAutoGeneration"><a href="#ç¼–å†™MybatisPlusCodeAutoGeneration" class="headerlink" title="ç¼–å†™MybatisPlusCodeAutoGeneration"></a>ç¼–å†™MybatisPlusCodeAutoGeneration</h4><p>é…ç½®è¯´æ˜ï¼š<a href="https://baomidou.com/pages/981406/#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE-datasourceconfig">ä»£ç ç”Ÿæˆå™¨é…ç½®æ–° | MyBatis-Plus</a><br>ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦ç”¨æˆ·åï¼Œå¯†ç ï¼Œæ•°æ®åº“åœ°å€ï¼Œè¡¨åå­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusCodeAutoGeneration</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/vueblog&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">USERNAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è‡ªåŠ¨ç”Ÿæˆä»£ç è¾“å‡ºç›®å½•ï¼Œè¿™é‡Œé»˜è®¤ç±»è·¯å¾„ä¸‹çš„src/main/java/com.cqupt/</span><br><span class="hljs-comment">     * System.getProperty(&quot;user.dir&quot;) - &gt; é¡¹ç›®ç›®å½•</span><br><span class="hljs-comment">     * File.separator - &gt; /</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">OUTPUT_DIR</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>) + File.separator + <span class="hljs-string">&quot;src/main/java&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        FastAutoGenerator.create(URL, USERNAME, PASSWORD)<br>                .globalConfig(builder -&gt; builder<br>                        .author(<span class="hljs-string">&quot;wangtaotao&quot;</span>)<span class="hljs-comment">// è®¾ç½®ä½œè€…</span><br>                        .fileOverride()<span class="hljs-comment">// è¦†ç›–å·²ç”Ÿæˆæ–‡ä»¶</span><br>                        .disableOpenDir()<span class="hljs-comment">//ç¦ç”¨ä»£ç ç”Ÿæˆåæ‰“å¼€è¾“å‡ºç›®å½•å¯¹è¯æ¡†</span><br>                        .outputDir(OUTPUT_DIR))<br>                .packageConfig(builder -&gt; builder<br>                        .parent(<span class="hljs-string">&quot;com.cqupt&quot;</span>)<span class="hljs-comment">// è®¾ç½®çˆ¶åŒ…å</span><br>                        .entity(<span class="hljs-string">&quot;entity&quot;</span>))<span class="hljs-comment">//å¯ä»¥æŒ‡å®šå®ä½“(DO)æ‰€åœ¨çš„åŒ…å</span><br>                .strategyConfig(builder -&gt; builder<br>                        <span class="hljs-comment">//addIncludeæŒ‡å®šåŒ…å«çš„è¡¨åï¼Œä¸è°ƒç”¨è¯¥æ–¹æ³•é»˜è®¤ä¸ºæ‰€æœ‰è¡¨ç”Ÿæˆä»£ç </span><br>                        <span class="hljs-comment">//addTablePrefixå¯ä»¥è¿‡æ»¤è¡¨å‰ç¼€ï¼Œå³t_userå˜æˆuser</span><br>                        .addInclude(<span class="hljs-string">&quot;m_user&quot;</span>).addTablePrefix(<span class="hljs-string">&quot;m_&quot;</span>)<br>                        .addInclude(<span class="hljs-string">&quot;m_blog&quot;</span>).addTablePrefix(<span class="hljs-string">&quot;m_&quot;</span>)<br>                        <span class="hljs-comment">// ç¦ç”¨ä¸ºå®ä½“ç±»ç”Ÿæˆåºåˆ—åŒ–IDï¼›formatFileNameæ ¼å¼åŒ–ç”Ÿæˆçš„å®ä½“ç±»åç§°ï¼Œå³t_user -&gt; UserDO</span><br>                        <span class="hljs-comment">//.entityBuilder().disableSerialVersionUID().formatFileName(&quot;%sDO&quot;)</span><br>                        <span class="hljs-comment">// formatMapperFileNameæ ¼å¼åŒ–Mapperæ¥å£åç§°ï¼Œå³t_user -&gt; UserMapper</span><br>                        <span class="hljs-comment">// formatXmlFileNameæ ¼å¼åŒ–Mapper.xmlæ–‡ä»¶åç§°ï¼Œå³t_user -&gt; UserMapper.xml</span><br>                        .mapperBuilder()<br>                        .formatMapperFileName(<span class="hljs-string">&quot;%sMapper&quot;</span>)<br>                        .formatXmlFileName(<span class="hljs-string">&quot;%sMapper&quot;</span>)<br>                        .serviceBuilder()<br>                        .formatServiceFileName(<span class="hljs-string">&quot;%sService&quot;</span>)<br>                        .build()<br>                )<br>                <span class="hljs-comment">// MyBatis-Plusä»£ç ç”Ÿæˆå™¨æ˜¯é€šè¿‡æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“æ–‡ä»¶çš„ï¼Œé»˜è®¤æ¨¡æ¿å¼•æ“æ˜¯Velocityï¼Œæ ¹æ®ä¾èµ–æˆ‘ä»¬ä½¿ç”¨Freemarker</span><br>                .templateEngine(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FreemarkerTemplateEngine</span>())<br>                .execute();<br>    &#125;<br><br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆç»“æœï¼š<br>![[Pasted image 20220620183018.png|250]]</p><h5 id="MybatisPlus-generator-ç›¸å…³é—®é¢˜"><a href="#MybatisPlus-generator-ç›¸å…³é—®é¢˜" class="headerlink" title="MybatisPlus-generator ç›¸å…³é—®é¢˜"></a>MybatisPlus-generator ç›¸å…³é—®é¢˜</h5><ol><li><p><code>Cannot resolve symbol â€˜FastAutoGeneratorâ€™</code><br>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_45203988/article/details/123756905">æ–°ç‰ˆæœ¬ä»£ç è‡ªåŠ¨ç”Ÿæˆ(MybatisPlus-generator) ä»£ç ç¤ºä¾‹+é—®é¢˜è§£å†³_å»ºæ¡¥ä¹‹é­‚çš„åšå®¢-CSDNåšå®¢</a><br>åŸå› ï¼šmybatis-plus-generatorç‰ˆæœ¬å¤ªä½ï¼Œæ¢æ–°çš„</p></li><li><p>å¦‚æœéœ€è¦æ˜¾ç¤ºjsonå›æ˜¾åˆ°æµè§ˆå™¨ï¼Œåˆ™éœ€è¦åœ¨ControlleræŠŠ<code>@Controller</code>æ”¹æˆ<code>@RestController</code></p></li></ol><h3 id="å®ç°å¢åˆ æ”¹æŸ¥"><a href="#å®ç°å¢åˆ æ”¹æŸ¥" class="headerlink" title="å®ç°å¢åˆ æ”¹æŸ¥"></a>å®ç°å¢åˆ æ”¹æŸ¥</h3><p>MybatisPluså·²ç»å®ç°äº†å¤§éƒ¨åˆ†CRUDæ“ä½œï¼Œå› æ­¤ï¼Œåªéœ€è¦ç›´æ¥ä½¿ç”¨å³å¯ã€‚</p><blockquote><p>controller -&gt; service -&gt; serviceImpl -&gt; mapper</p><p>controlleræ˜¯ä¸ºå‰ç«¯æä¾›çš„è®¿é—®å…¥å£ï¼Œä¸ç”¨å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æ”¾åœ¨äº†serviceImplé‡Œï¼Œcontrolleråªéœ€è°ƒç”¨å®ƒå°è£…å¥½çš„æ–¹æ³•å³å¯ã€‚</p><p>serviceæä¾›ä¸šåŠ¡é€»è¾‘è¦ç”¨åˆ°çš„æ–¹æ³•ï¼ŒserviceImplæä¾›æ–¹æ³•çš„å…·ä½“å®ç°ã€‚è¯´äººè¯ï¼ŒServiceImplè´Ÿè´£äº†ä¸»è¦çš„åŠŸèƒ½ç¼–å†™ï¼ŒControlleræä¾›äº†ä½¿ç”¨çš„å…¥å£ã€‚</p><p>mapperä¸ºserviceImplæä¾›æ“ä½œæ•°æ®çš„æ–¹æ³•ï¼Œä½†æ–¹æ³•çš„å…·ä½“å®ç°(ä¹Ÿå°±æ˜¯SQLè¯­å¥)æ”¾åœ¨äº†mapperä¸‹çš„xmlæ–‡ä»¶é‡Œã€‚</p></blockquote><h5 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h5><p><code>UserController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &lt;p&gt;</span><br><span class="hljs-comment"> * å‰ç«¯æ§åˆ¶å™¨</span><br><span class="hljs-comment"> * &lt;/p&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2022-06-20</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.getById(id);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>![[Pasted image 20220620190924.png]]</p><h5 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>    <span class="hljs-keyword">return</span> userService.save(user);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>@RequestBodyï¼šé€šè¿‡è·å–postè¯·æ±‚ä¸­çš„è¯·æ±‚ä½“</p></blockquote><p>![[Pasted image 20220620195105.png]]</p><h5 id="å¢åˆ æŸ¥æ”¹å…¨éƒ¨ä»£ç "><a href="#å¢åˆ æŸ¥æ”¹å…¨éƒ¨ä»£ç " class="headerlink" title="å¢åˆ æŸ¥æ”¹å…¨éƒ¨ä»£ç "></a>å¢åˆ æŸ¥æ”¹å…¨éƒ¨ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &lt;p&gt;</span><br><span class="hljs-comment"> * å‰ç«¯æ§åˆ¶å™¨</span><br><span class="hljs-comment"> * &lt;/p&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 2022-06-20</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/findById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.getById(id);<br>    &#125;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addById</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.save(user);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;deleteById/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.removeById(id);<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/update&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.updateById(user);<br>    &#125;<br>    <span class="hljs-meta">@GetMapping(&quot;getAll&quot;)</span>  <br> <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span>&#123;  <br>     <span class="hljs-keyword">return</span> userService.list();  <br>&#125;<br><br><span class="hljs-comment">// åˆ†é¡µæŸ¥è¯¢</span><br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> IPage&lt;User&gt; <span class="hljs-title function_">findPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Integer pageNum,</span><br><span class="hljs-params">                                <span class="hljs-meta">@RequestParam</span> Integer pageSize)</span> &#123;<br>        IPage&lt;User&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageNum, pageSize);<br>        <span class="hljs-keyword">return</span> userService.page(page);<br>    &#125;<br><br> <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢ åŒ¹é…ç”¨æˆ·åä½¿ç”¨QueryWrapper</span><br>    <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> IPage&lt;User&gt; <span class="hljs-title function_">findPage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Integer pageNum,</span><br><span class="hljs-params">                                <span class="hljs-meta">@RequestParam</span> Integer pageSize,</span><br><span class="hljs-params">                                <span class="hljs-meta">@RequestParam(defaultValue = &quot;&quot;)</span> String username)</span> &#123;<br>        IPage&lt;User&gt; page = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageNum, pageSize);<br>        QueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        queryWrapper.like(<span class="hljs-string">&quot;username&quot;</span>, username);<br>        <span class="hljs-keyword">return</span> userService.page(page, queryWrapper);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="åœ¨SpringBootä¸­é›†æˆSwagger"><a href="#åœ¨SpringBootä¸­é›†æˆSwagger" class="headerlink" title="åœ¨SpringBootä¸­é›†æˆSwagger"></a>åœ¨SpringBootä¸­é›†æˆSwagger</h2><h3 id="å‰åç«¯åˆ†ç¦»"><a href="#å‰åç«¯åˆ†ç¦»" class="headerlink" title="å‰åç«¯åˆ†ç¦»"></a>å‰åç«¯åˆ†ç¦»</h3><ul><li>åç«¯ï¼šåç«¯æ§åˆ¶å±‚ï¼ŒæœåŠ¡å±‚ï¼Œæ•°æ®è®¿é—®å±‚</li><li>å‰ç«¯ï¼šå‰ç«¯æ§åˆ¶å±‚ï¼Œè§†å›¾å±‚</li></ul><p>å‰ç«¯æµ‹è¯•åç«¯å·¥å…·Postman</p><p>åç«¯æä¾›æ¥å£ï¼Œéœ€è¦æ—¶æ—¶æ›´æ–°æ¶ˆæ¯å’Œæ”¹åŠ¨</p><h3 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h3><ul><li>Apiæ¡†æ¶</li><li>RestFul Api æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆå·¥å…· &#x3D;&gt; <strong>Apiæ–‡æ¡£ä¸Apiå®šä¹‰åŒæ­¥æ›´æ–°</strong></li><li>åœ¨çº¿æµ‹è¯•Apiæ¥å£</li><li>æ”¯æŒå¤šç§è¯­è¨€</li></ul><h3 id="åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Swaggeréœ€è¦springfox"><a href="#åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Swaggeréœ€è¦springfox" class="headerlink" title="åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Swaggeréœ€è¦springfox"></a>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Swaggeréœ€è¦springfox</h3><ul><li>swagger2</li><li>ui</li></ul><h3 id="SpringBooté›†æˆSwagger3ï¼ˆæ–°ç‰ˆï¼‰"><a href="#SpringBooté›†æˆSwagger3ï¼ˆæ–°ç‰ˆï¼‰" class="headerlink" title="SpringBooté›†æˆSwagger3ï¼ˆæ–°ç‰ˆï¼‰"></a>SpringBooté›†æˆSwagger3ï¼ˆæ–°ç‰ˆï¼‰</h3><blockquote><p>æ³¨æ„ï¼šä¸è¦åŒæ—¶å¯¼å…¥2å’Œ3ï¼Œä¼šæŠ¥é”™</p></blockquote><h4 id="å¯¼ä¾èµ–"><a href="#å¯¼ä¾èµ–" class="headerlink" title="å¯¼ä¾èµ–"></a>å¯¼ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ç¼–å†™é…ç½®æ–‡ä»¶-1"><a href="#ç¼–å†™é…ç½®æ–‡ä»¶-1" class="headerlink" title="ç¼–å†™é…ç½®æ–‡ä»¶"></a>ç¼–å†™é…ç½®æ–‡ä»¶</h4><blockquote><p>è·Ÿ2ä¸€æ ·ï¼Œåªæ˜¯æ³¨è§£æ¢äº†ä¸€ä¸ª</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: Swagger3Config &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: &lt;br/&gt;</span><br><span class="hljs-comment"> * date: 2022/6/20 21:20&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableOpenApi</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     é…ç½®Swaggerçš„Docketçš„Beanå®ä¾‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>                .apiInfo(apiInfo())<br>                .select()<br>                <span class="hljs-comment">//ä¸ºå½“å‰åŒ…ä¸‹controllerç”ŸæˆAPIæ–‡æ¡£</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.cqupt.controller&quot;</span>))<br>                .paths(PathSelectors.any())<br>                .build();<br>        <span class="hljs-comment">//æ·»åŠ ç™»å½•è®¤è¯</span><br><span class="hljs-comment">//                .securitySchemes(securitySchemes())</span><br><span class="hljs-comment">//                .securityContexts(securityContexts());</span><br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     é…ç½®Swaggerä¿¡æ¯ = apiInfo</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br>                <span class="hljs-comment">/*</span><br><span class="hljs-comment">                ä½œè€…ä¿¡æ¯</span><br><span class="hljs-comment">                 */</span><br>                .title(<span class="hljs-string">&quot;Apiæ–‡æ¡£&quot;</span>)<br>                .description(<span class="hljs-string">&quot;Apiæ–‡æ¡£&quot;</span>)<br>                .contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;wtt&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>))<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .build();<br>    &#125;<br><br><span class="hljs-comment">//    private List&lt;ApiKey&gt; securitySchemes() &#123;</span><br><span class="hljs-comment">//        //è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯</span><br><span class="hljs-comment">//        List&lt;ApiKey&gt; result = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        ApiKey apiKey = new ApiKey(&quot;Authorization&quot;, &quot;Authorization&quot;, &quot;header&quot;);</span><br><span class="hljs-comment">//        result.add(apiKey);</span><br><span class="hljs-comment">//        return result;</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    private List&lt;SecurityContext&gt; securityContexts() &#123;</span><br><span class="hljs-comment">//        //è®¾ç½®éœ€è¦ç™»å½•è®¤è¯çš„è·¯å¾„</span><br><span class="hljs-comment">//        List&lt;SecurityContext&gt; result = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        result.add(getContextByPath(&quot;/brand/.*&quot;));</span><br><span class="hljs-comment">//        return result;</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    private SecurityContext getContextByPath(String pathRegex)&#123;</span><br><span class="hljs-comment">//        return SecurityContext.builder()</span><br><span class="hljs-comment">//                .securityReferences(defaultAuth())</span><br><span class="hljs-comment">//                .forPaths(PathSelectors.regex(pathRegex))</span><br><span class="hljs-comment">//                .build();</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    private List&lt;SecurityReference&gt; defaultAuth() &#123;</span><br><span class="hljs-comment">//        List&lt;SecurityReference&gt; result = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        AuthorizationScope authorizationScope = new AuthorizationScope(&quot;global&quot;, &quot;accessEverything&quot;);</span><br><span class="hljs-comment">//        AuthorizationScope[] authorizationScopes = new AuthorizationScope[1];</span><br><span class="hljs-comment">//        authorizationScopes[0] = authorizationScope;</span><br><span class="hljs-comment">//        result.add(new SecurityReference(&quot;Authorization&quot;, authorizationScopes));</span><br><span class="hljs-comment">//        return result;</span><br><span class="hljs-comment">//    &#125;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•è®¿é—®"><a href="#æµ‹è¯•è®¿é—®" class="headerlink" title="æµ‹è¯•è®¿é—®"></a>æµ‹è¯•è®¿é—®</h4><p><code>http://localhost:ç«¯å£å·/swagger-ui/index.html#/</code></p><h3 id="SpringBooté›†æˆSwagger2"><a href="#SpringBooté›†æˆSwagger2" class="headerlink" title="SpringBooté›†æˆSwagger2"></a>SpringBooté›†æˆSwagger2</h3><h4 id="å¯¼å…¥ä¾èµ–-6"><a href="#å¯¼å…¥ä¾èµ–-6" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Swagger-UI APIæ–‡æ¡£ç”Ÿäº§å·¥å…·--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ç¼–å†™é…ç½®æ–‡ä»¶-2"><a href="#ç¼–å†™é…ç½®æ–‡ä»¶-2" class="headerlink" title="ç¼–å†™é…ç½®æ–‡ä»¶"></a>ç¼–å†™é…ç½®æ–‡ä»¶</h4><p><code>SwaggerConfig.java</code></p><blockquote><p>è¿™é‡Œæ³¨é‡Šæ‰äº†ç™»å½•è®¤è¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: SwaggerConfig &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: &lt;br/&gt;</span><br><span class="hljs-comment"> * date: 2022/6/20 20:32&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwaggerConfig</span> &#123;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> é…ç½®Swaggerçš„Docketçš„Beanå®ä¾‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> Docket <span class="hljs-title function_">createRestApi</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Docket</span>(DocumentationType.SWAGGER_2)<br>.apiInfo(apiInfo())<br>.select()<br><span class="hljs-comment">//ä¸ºå½“å‰åŒ…ä¸‹controllerç”ŸæˆAPIæ–‡æ¡£</span><br>.apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;com.cqupt.controller&quot;</span>))<br>.paths(PathSelectors.any())<br>.build();<br><span class="hljs-comment">//æ·»åŠ ç™»å½•è®¤è¯</span><br><span class="hljs-comment">//                .securitySchemes(securitySchemes())</span><br><span class="hljs-comment">//                .securityContexts(securityContexts());</span><br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> é…ç½®Swaggerä¿¡æ¯ = apiInfo</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title function_">apiInfo</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiInfoBuilder</span>()<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">ä½œè€…ä¿¡æ¯</span><br><span class="hljs-comment"> */</span><br>.title(<span class="hljs-string">&quot;Apiæ–‡æ¡£&quot;</span>)<br>.description(<span class="hljs-string">&quot;Apiæ–‡æ¡£&quot;</span>)<br>.contact(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Contact</span>(<span class="hljs-string">&quot;wtt&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>))<br>.version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>.build();<br>&#125;<br><br><span class="hljs-comment">//    private List&lt;ApiKey&gt; securitySchemes() &#123;</span><br><span class="hljs-comment">//        //è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯</span><br><span class="hljs-comment">//        List&lt;ApiKey&gt; result = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        ApiKey apiKey = new ApiKey(&quot;Authorization&quot;, &quot;Authorization&quot;, &quot;header&quot;);</span><br><span class="hljs-comment">//        result.add(apiKey);</span><br><span class="hljs-comment">//        return result;</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    private List&lt;SecurityContext&gt; securityContexts() &#123;</span><br><span class="hljs-comment">//        //è®¾ç½®éœ€è¦ç™»å½•è®¤è¯çš„è·¯å¾„</span><br><span class="hljs-comment">//        List&lt;SecurityContext&gt; result = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        result.add(getContextByPath(&quot;/brand/.*&quot;));</span><br><span class="hljs-comment">//        return result;</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    private SecurityContext getContextByPath(String pathRegex)&#123;</span><br><span class="hljs-comment">//        return SecurityContext.builder()</span><br><span class="hljs-comment">//                .securityReferences(defaultAuth())</span><br><span class="hljs-comment">//                .forPaths(PathSelectors.regex(pathRegex))</span><br><span class="hljs-comment">//                .build();</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    private List&lt;SecurityReference&gt; defaultAuth() &#123;</span><br><span class="hljs-comment">//        List&lt;SecurityReference&gt; result = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">//        AuthorizationScope authorizationScope = new AuthorizationScope(&quot;global&quot;, &quot;accessEverything&quot;);</span><br><span class="hljs-comment">//        AuthorizationScope[] authorizationScopes = new AuthorizationScope[1];</span><br><span class="hljs-comment">//        authorizationScopes[0] = authorizationScope;</span><br><span class="hljs-comment">//        result.add(new SecurityReference(&quot;Authorization&quot;, authorizationScopes));</span><br><span class="hljs-comment">//        return result;</span><br><span class="hljs-comment">//    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•è®¿é—®-1"><a href="#æµ‹è¯•è®¿é—®-1" class="headerlink" title="æµ‹è¯•è®¿é—®"></a>æµ‹è¯•è®¿é—®</h4><p><code>http://localhost:ç«¯å£å·/swagger-ui.html</code>è®¿é—®</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringBoot&quot;&gt;&lt;a href=&quot;#SpringBoot&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot&quot;&gt;&lt;/a&gt;SpringBoot&lt;/h1&gt;&lt;p&gt;å®˜æ–¹ç½‘ç«™ï¼š&lt;a href=&quot;https://spring.io/projec</summary>
      
    
    
    
    <category term="Java" scheme="http://conquers.github.io/categories/Java/"/>
    
    <category term="Spring" scheme="http://conquers.github.io/categories/Java/Spring/"/>
    
    <category term="Spring Boot" scheme="http://conquers.github.io/categories/Java/Spring/Spring-Boot/"/>
    
    
    <category term="SpringBoot" scheme="http://conquers.github.io/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜</title>
    <link href="http://conquers.github.io/posts/a53e2688.html"/>
    <id>http://conquers.github.io/posts/a53e2688.html</id>
    <published>2022-08-08T08:45:02.000Z</published>
    <updated>2023-07-18T06:59:50.440Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜"><a href="#Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜" class="headerlink" title="Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜"></a>Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜</h1><h2 id="ä½¿ç”¨æ²™ç®±ç¯å¢ƒ"><a href="#ä½¿ç”¨æ²™ç®±ç¯å¢ƒ" class="headerlink" title="ä½¿ç”¨æ²™ç®±ç¯å¢ƒ"></a>ä½¿ç”¨æ²™ç®±ç¯å¢ƒ</h2><h3 id="è¿›å…¥æ”¯ä»˜å®å¼€å‘å¹³å°â€”æ²™ç®±ç¯å¢ƒ"><a href="#è¿›å…¥æ”¯ä»˜å®å¼€å‘å¹³å°â€”æ²™ç®±ç¯å¢ƒ" class="headerlink" title="è¿›å…¥æ”¯ä»˜å®å¼€å‘å¹³å°â€”æ²™ç®±ç¯å¢ƒ"></a>è¿›å…¥æ”¯ä»˜å®å¼€å‘å¹³å°â€”æ²™ç®±ç¯å¢ƒ</h3><ul><li>æ²™ç®±ç¯å¢ƒé…ç½®ï¼š<a href="https://opendocs.alipay.com/common/02kkv7">https://opendocs.alipay.com/common/02kkv7</a></li></ul><p>å¼€å‘è€…ä½¿ç”¨æ”¯ä»˜å®è´¦å·ç™»å½• <a href="https://openhome.alipay.com/develop/manage">å¼€æ”¾å¹³å°æ§åˆ¶å°</a>ï¼ˆéœ€å®åè®¤è¯çš„æ”¯ä»˜å®è´¦å·ï¼‰ã€‚<br><img src="/Resources/Pasted%20image%2020220808162913.png"></p><h3 id="ç”Ÿæˆåº”ç”¨ç§é’¥å’Œåº”ç”¨å…¬é’¥"><a href="#ç”Ÿæˆåº”ç”¨ç§é’¥å’Œåº”ç”¨å…¬é’¥" class="headerlink" title="ç”Ÿæˆåº”ç”¨ç§é’¥å’Œåº”ç”¨å…¬é’¥"></a>ç”Ÿæˆåº”ç”¨ç§é’¥å’Œåº”ç”¨å…¬é’¥</h3><blockquote><p>è·å–<a href="https://opendocs.alipay.com/common/02kipl">ç”Ÿæˆå¯†é’¥</a>çš„å·¥å…·<br>ä¸‹è½½å®‰è£…-&gt;ç”Ÿæˆå¯†é’¥<br><img src="/Resources/Pasted%20image%2020220809105134.png"></p></blockquote><h3 id="è·å–æ”¯ä»˜å®å…¬é’¥ã€APPIDå’ŒPID"><a href="#è·å–æ”¯ä»˜å®å…¬é’¥ã€APPIDå’ŒPID" class="headerlink" title="è·å–æ”¯ä»˜å®å…¬é’¥ã€APPIDå’ŒPID"></a>è·å–æ”¯ä»˜å®å…¬é’¥ã€APPIDå’ŒPID</h3><p><img src="/Resources/Pasted%20image%2020220809105646.png"></p><p>å°†ä¸Šä¸€æ­¥çš„åº”ç”¨å…¬é’¥å¤åˆ¶è¿›æ¥<br><img src="/Resources/Pasted%20image%2020220809105301.png"></p><p><img src="/Resources/Pasted%20image%2020220809105351.png"></p><h2 id="é…ç½®SpringBoot"><a href="#é…ç½®SpringBoot" class="headerlink" title="é…ç½®SpringBoot"></a>é…ç½®SpringBoot</h2><blockquote><p>é…ç½®ä¸€ä¸ªæäº¤è¡¨å•çš„é¡µé¢<br><img src="/Resources/Pasted%20image%2020220809150035.png"></p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/alipay/pay&quot;</span>&gt;</span><br>    è®¢å•å·ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;tradeNo&quot;</span> <span class="hljs-attr">required</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    è®¢å•åç§°ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;subject&quot;</span> <span class="hljs-attr">required</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    ä»˜æ¬¾é‡‘é¢ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;totalAmount&quot;</span> <span class="hljs-attr">required</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¸‹å•&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;reset&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;é‡ç½®&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ¥å£è¯´æ˜ï¼š<a href="https://opendocs.alipay.com/open/02e7gq?scene=20">appæ”¯ä»˜æ¥å£2.0</a></p><blockquote><p>æ–°å»ºä¸€ä¸ªSpringboot é¡¹ç›®<br>å¯¼å…¥Springwebå’Œalipay-sdkçš„ä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alipay.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>alipay-sdk-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.16.57.ALL<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="å®šä¹‰é…ç½®ç±»"><a href="#å®šä¹‰é…ç½®ç±»" class="headerlink" title="å®šä¹‰é…ç½®ç±»"></a>å®šä¹‰é…ç½®ç±»</h3><blockquote><p>å°†ä»¥ä¸Šè·å–åˆ°çš„æ”¯ä»˜å®å…¬é’¥ã€åº”ç”¨ç§é’¥ã€APPIDå¡«å†™åˆ°å¦‚ä¸‹é…ç½®ç±»ä¸­<br>å˜é‡åçš„å«ä¹‰å·²åœ¨æ³¨é‡Šç»™å‡º</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayConfig</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¯·åœ¨è¿™é‡Œé…ç½®æ‚¨çš„åŸºæœ¬ä¿¡æ¯</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åº”ç”¨ID,æ‚¨çš„APPIDï¼Œæ”¶æ¬¾è´¦å·æ—¢æ˜¯æ‚¨çš„APPIDå¯¹åº”æ”¯ä»˜å®è´¦å·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">app_id</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åº”ç”¨ç§é’¥ï¼Œæ‚¨çš„PKCS8æ ¼å¼RSA2ç§é’¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">merchant_private_key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯ä»˜å®å…¬é’¥,æŸ¥çœ‹åœ°å€ï¼šhttps://openhome.alipay.com/platform/keyManage.html å¯¹åº”APPIDä¸‹çš„æ”¯ä»˜å®å…¬é’¥ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">alipay_public_key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥è·¯å¾„,ä»˜æ¬¾å®Œæ¯•åä¼šå¼‚æ­¥è°ƒç”¨æœ¬é¡¹ç›®çš„æ–¹æ³•,å¿…é¡»ä¸ºå…¬ç½‘åœ°å€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">notify_url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://localhost:8080/alipay/failure&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯ä»˜å®åŒæ­¥é€šçŸ¥è·¯å¾„,ä¹Ÿå°±æ˜¯å½“ä»˜æ¬¾å®Œæ¯•åè·³è½¬æœ¬é¡¹ç›®çš„é¡µé¢,å¯ä»¥ä¸æ˜¯å…¬ç½‘åœ°å€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">return_url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://localhost:8080/alipay/success&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç­¾åæ–¹å¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">sign_type</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RSA2&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å­—ç¬¦ç¼–ç æ ¼å¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">charset</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;utf-8&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯ä»˜å®ç½‘å…³ï¼Œè¿™æ˜¯æ²™ç®±çš„ç½‘å…³</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">gatewayUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://openapi.alipaydev.com/gateway.do&quot;</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ—¥å¿—è·¯å¾„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">log_path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E:\\logs\\&quot;</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å†™æ—¥å¿—ï¼Œæ–¹ä¾¿æµ‹è¯•ï¼ˆçœ‹ç½‘ç«™éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥æ”¹æˆæŠŠè®°å½•å­˜å…¥æ•°æ®åº“ï¼‰</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sWord è¦å†™å…¥æ—¥å¿—é‡Œçš„æ–‡æœ¬å†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logResult</span><span class="hljs-params">(String sWord)</span> &#123;<br>        <span class="hljs-type">FileWriter</span> <span class="hljs-variable">fileWriter</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(log_path + <span class="hljs-string">&quot;alipay_log_&quot;</span> + System.currentTimeMillis() + <span class="hljs-string">&quot;.txt&quot;</span>);<br>            <span class="hljs-keyword">if</span>(!file.exists())&#123;<br>                <span class="hljs-comment">/*</span><br><span class="hljs-comment">                 * è¿™é‡Œçš„getParentFile()è·å–çš„æ˜¯æœ€åä¸€çº§æ–‡ä»¶å‰çš„æ‰€æœ‰ç›®å½•å</span><br><span class="hljs-comment">                 * å³å¦‚æœæ˜¯E:\logs\logs\logs\log.txt,åˆ™getParentFile()çš„ç»“æœæ˜¯E:\logs\logs\logs\</span><br><span class="hljs-comment">                 */</span><br>                file.getParentFile().mkdirs();<br>            &#125;<br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">             * è¿½åŠ </span><br><span class="hljs-comment">             * fileWriter = new FileWriter(file,true);</span><br><span class="hljs-comment">             * è¦†ç›–(é»˜è®¤)</span><br><span class="hljs-comment">             * fileWriter = new FileWriter(file,false);</span><br><span class="hljs-comment">             */</span><br>            fileWriter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(file,<span class="hljs-literal">false</span>);<br>            fileWriter.write(sWord);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (fileWriter != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    fileWriter.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ”¯ä»˜çš„Controllerç±»"><a href="#åˆ›å»ºæ”¯ä»˜çš„Controllerç±»" class="headerlink" title="åˆ›å»ºæ”¯ä»˜çš„Controllerç±»"></a>åˆ›å»ºæ”¯ä»˜çš„Controllerç±»</h3><p>åœ¨Controllerç±»ä¸­åˆ›å»ºç‚¹å‡»æ”¯ä»˜è·³è½¬æ”¯ä»˜å®é¡µé¢çš„æ–¹æ³•ï¼šæ”¯ä»˜æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/alipay&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AlipayService alipayService;<br><br>    <span class="hljs-comment">// æ”¯ä»˜å¤±è´¥</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/failure&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">topay1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ”¯ä»˜å¤±è´¥&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ”¯ä»˜æˆåŠŸ</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/success&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">topay2</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ”¯ä»˜æˆåŠŸ&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æ”¯ä»˜</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/pay&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toPay</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;tradeNo&quot;)</span> String orderNumber, <span class="hljs-meta">@RequestParam(&quot;totalAmount&quot;)</span> String totalAmount, <span class="hljs-meta">@RequestParam(&quot;subject&quot;)</span> String subject, HttpServletResponse response, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> AlipayApiException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">pays</span> <span class="hljs-operator">=</span> alipayService.pay(orderNumber, totalAmount, subject, response, request);<br>    <span class="hljs-comment">// æ”¯ä»˜æˆåŠŸæ·»åŠ æ—¥å¿—</span><br>        AlipayConfig.logResult(pays);<br>        <span class="hljs-keyword">return</span> pays;<br>    &#125;<br><br>    <span class="hljs-comment">// é€€æ¬¾</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/refund&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toRefund</span><span class="hljs-params">(HttpServletResponse response, HttpSession session)</span> <span class="hljs-keyword">throws</span> AlipayApiException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">pay</span> <span class="hljs-operator">=</span> alipayService.refund(response, session);<br>    <span class="hljs-comment">// é€€æ¬¾æˆåŠŸæ·»åŠ æ—¥å¿—</span><br>        AlipayConfig.logResult(pay);<br>        <span class="hljs-keyword">return</span> pay;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ”¯ä»˜çš„Serviceç±»"><a href="#åˆ›å»ºæ”¯ä»˜çš„Serviceç±»" class="headerlink" title="åˆ›å»ºæ”¯ä»˜çš„Serviceç±»"></a>åˆ›å»ºæ”¯ä»˜çš„Serviceç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AlipayService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯ä»˜æ¥å£</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> orderNumber è®¢å•ç¼–å·</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> totalAmount æ€»è®¡é‡‘é¢</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response    å“åº”</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request     è¯·æ±‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> AlipayApiException</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNumber, String totalAmount, String subject, HttpServletResponse response, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> AlipayApiException;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€€æ¬¾æŸ¥è¯¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ï¼ˆå”¯ä¸€ï¼‰</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ï¼ŒåŒä¸€ç¬”äº¤æ˜“å¤šæ¬¡é€€æ¬¾éœ€è¦ä¿è¯å”¯ä¸€ï¼Œå¦‚éœ€éƒ¨åˆ†é€€æ¬¾ï¼Œåˆ™æ­¤å‚æ•°å¿…ä¼ </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">refund</span><span class="hljs-params">(HttpServletResponse response, HttpSession session)</span> <span class="hljs-keyword">throws</span> AlipayApiException;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="åˆ›å»ºæ”¯ä»˜çš„ServiceImplç±»"><a href="#åˆ›å»ºæ”¯ä»˜çš„ServiceImplç±»" class="headerlink" title="åˆ›å»ºæ”¯ä»˜çš„ServiceImplç±»"></a>åˆ›å»ºæ”¯ä»˜çš„ServiceImplç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AlipayService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è°ƒå–æ”¯ä»˜å®æ¥å£ webç«¯æ”¯ä»˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">DefaultAlipayClient</span> <span class="hljs-variable">alipayClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAlipayClient</span>(<br>            AlipayConfig.gatewayUrl, AlipayConfig.app_id, AlipayConfig.merchant_private_key, <span class="hljs-string">&quot;json&quot;</span>, AlipayConfig.charset, AlipayConfig.alipay_public_key, AlipayConfig.sign_type);<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è°ƒå–æ”¯ä»˜å®æ¥å£ appç«¯æ”¯ä»˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">AlipayClient</span> <span class="hljs-variable">alipayClients</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAlipayClient</span>(<br>            AlipayConfig.gatewayUrl, AlipayConfig.app_id, AlipayConfig.merchant_private_key, <span class="hljs-string">&quot;json&quot;</span>, AlipayConfig.charset, AlipayConfig.alipay_public_key, AlipayConfig.sign_type);<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¯ä»˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">pay</span><span class="hljs-params">(String orderNumber, String totalAmount, String subject, HttpServletResponse response, HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> AlipayApiException &#123;<br>        <span class="hljs-type">AlipayTradePagePayRequest</span> <span class="hljs-variable">alipayRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayTradePagePayRequest</span>();<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * åŒæ­¥é€šçŸ¥ï¼Œæ”¯ä»˜å®Œæˆåï¼Œæ”¯ä»˜æˆåŠŸé¡µé¢</span><br><span class="hljs-comment">         */</span><br>        alipayRequest.setReturnUrl(AlipayConfig.return_url);<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * å¼‚æ­¥é€šçŸ¥ï¼Œæ”¯ä»˜å®Œæˆåï¼Œéœ€è¦è¿›è¡Œçš„å¼‚æ­¥å¤„ç†</span><br><span class="hljs-comment">         */</span><br>        alipayRequest.setNotifyUrl(AlipayConfig.notify_url);<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        //å•†æˆ·è®¢å•å·ï¼Œåç«¯å¯ä»¥å†™ä¸€ä¸ªå·¥å…·ç±»ç”Ÿæˆä¸€ä¸ªè®¢å•å·ï¼Œå¿…å¡«</span><br><span class="hljs-comment">        String order_number = new String(&quot;orderNumber&quot;);</span><br><span class="hljs-comment">        //ä»˜æ¬¾é‡‘é¢ï¼Œä»å‰å°è·å–ï¼Œå¿…å¡«</span><br><span class="hljs-comment">        String total_amount = new String(&quot;totalAmount&quot;);</span><br><span class="hljs-comment">        //è®¢å•åç§°/æ ‡é¢˜ï¼Œå¯è‡ªå®šä¹‰</span><br><span class="hljs-comment">        String subject = new String(&quot;æ”¯ä»˜å®æ²™ç®±æµ‹è¯•&quot;);</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-comment">// é™¤äº†éœ€è¦æä¾›ä¹‹å‰è®¾ç½®å¥½çš„ç§æœ‰å±æ€§ï¼ˆURLï¼Œå…¬é’¥ï¼Œç§é’¥ï¼Œç½‘å…³ç­‰ç­‰ï¼‰å¤–ï¼Œè¿˜éœ€è¦æä¾›çš„å‚æ•°</span><br>        <span class="hljs-comment">// outTradeNoï¼Œè®¢å•å·ï¼Œå¿…é¡»ä¸ºString64ä½ï¼Œä¸èƒ½ä¸ºç©ºä¸”ä¸èƒ½é‡å¤</span><br>        <span class="hljs-comment">// totalAmountï¼Œæ”¯ä»˜é‡‘é¢ï¼Œä¸èƒ½ä¸ºç©º</span><br>        <span class="hljs-comment">// subjectï¼Œè®¢å•åç§°ï¼Œä¸èƒ½ä¸ºç©º</span><br>        <span class="hljs-comment">// bodyï¼Œå•†å“æè¿°ï¼Œå¯ä»¥ä¸ºç©º</span><br>        <span class="hljs-comment">// ä¸Šé¢ä¸‰ä¸ªå¿…å¡«å‚æ•°å¾ˆé‡è¦ä¸”å¿…é¡»éµå®ˆæ”¯ä»˜å®çš„è§„å®šï¼Œåœ¨æ‰«ç æ”¯ä»˜çš„æ—¶å€™èƒ½çœ‹åˆ°ä¸”æœ‰ç”¨</span><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">bizContent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();<br>        bizContent.put(<span class="hljs-string">&quot;out_trade_no&quot;</span>,orderNumber);<br>        bizContent.put(<span class="hljs-string">&quot;total_amount&quot;</span>,totalAmount);<br>        bizContent.put(<span class="hljs-string">&quot;subject&quot;</span>,subject);<br>        bizContent.put(<span class="hljs-string">&quot;product_code&quot;</span>,<span class="hljs-string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span>);<br>        alipayRequest.setBizContent(bizContent.toString());<br><span class="hljs-comment">//        String result = alipayClient.pageExecute(alipayRequest).getBody().replace(&#x27;\&quot;&#x27;, &#x27;\&#x27;&#x27;).replace(&#x27;\n&#x27;, &#x27; &#x27;);</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> alipayClient.pageExecute(alipayRequest).getBody();<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">refund</span><span class="hljs-params">(HttpServletResponse response, HttpSession session)</span> <span class="hljs-keyword">throws</span> AlipayApiException &#123;<br>        <span class="hljs-comment">//è®¾ç½®è¯·æ±‚å‚æ•°</span><br>        <span class="hljs-type">AlipayTradeRefundRequest</span> <span class="hljs-variable">alipayRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayTradeRefundRequest</span>();<br>        <span class="hljs-comment">//å•†æˆ·è®¢å•å·ï¼Œå¿…å¡«</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">out_trade_no</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;20200523&quot;</span>);<br>        <span class="hljs-comment">//éœ€è¦é€€æ¬¾çš„é‡‘é¢ï¼Œè¯¥é‡‘é¢ä¸èƒ½å¤§äºè®¢å•é‡‘é¢ï¼Œå¿…å¡«</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">refund_amount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;198&quot;</span>);<br>        <span class="hljs-comment">//æ ‡è¯†ä¸€æ¬¡é€€æ¬¾è¯·æ±‚ï¼ŒåŒä¸€ç¬”äº¤æ˜“å¤šæ¬¡é€€æ¬¾éœ€è¦ä¿è¯å”¯ä¸€ã€‚å¦‚éœ€éƒ¨åˆ†é€€æ¬¾ï¼Œåˆ™æ­¤å‚æ•°å¿…ä¼ ï¼›ä¸ä¼ è¯¥å‚æ•°åˆ™ä»£è¡¨å…¨é¢é€€æ¬¾</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">out_request_no</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(UUID.randomUUID().toString());<br>        <span class="hljs-comment">// å­—ç¬¦è½¬ä¹‰å¾ˆé‡è¦</span><br>        alipayRequest.setBizContent(<span class="hljs-string">&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;</span> + out_trade_no + <span class="hljs-string">&quot;\&quot;,&quot;</span><br>                + <span class="hljs-string">&quot;\&quot;refund_amount\&quot;:\&quot;&quot;</span> + refund_amount + <span class="hljs-string">&quot;\&quot;,&quot;</span><br>                + <span class="hljs-string">&quot;\&quot;out_request_no\&quot;:\&quot;&quot;</span> + out_request_no + <span class="hljs-string">&quot;\&quot;&#125;&quot;</span>);<br>        <span class="hljs-comment">// è¯·æ±‚</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> alipayClient.execute(alipayRequest).getBody();<br>        <span class="hljs-comment">// è¾“å‡º</span><br>        System.out.println(result);<span class="hljs-comment">//ä»¥ä¸‹å†™è‡ªå·±çš„è®¢å•é€€æ¬¾ä»£ç </span><br>        <span class="hljs-comment">// logger.info(&quot;è¿”å›ç»“æœ=&#123;&#125;&quot;,result);</span><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/Resources/Pasted%20image%2020220809150109.png"><br><img src="/Resources/Pasted%20image%2020220809150118.png"><br>è¾“å…¥æ²™ç®±ä¸­æä¾›çš„ä¹°å®¶è´¦æˆ·å¯†ç å³å¯å®Œæˆä»˜æ¬¾ï¼Œè‡³æ­¤æ²™ç®±æ”¯ä»˜å®Œæˆã€‚</p><h3 id="ä¸€äº›è¡¥å……-å…³äºreturnUrlå’ŒnotifyUrl"><a href="#ä¸€äº›è¡¥å……-å…³äºreturnUrlå’ŒnotifyUrl" class="headerlink" title="ä¸€äº›è¡¥å…… å…³äºreturnUrlå’ŒnotifyUrl"></a>ä¸€äº›è¡¥å…… å…³äºreturnUrlå’ŒnotifyUrl</h3><blockquote><p>returnUrl å¼‚æ­¥<br>notifyUrl åŒæ­¥</p></blockquote><h4 id="returnUrl"><a href="#returnUrl" class="headerlink" title="returnUrl"></a>returnUrl</h4><p>å‰é¢ä»˜å®Œæ¬¾ä¹‹åçš„åŒæ­¥å›è°ƒç›´æ¥è¿”å›ä¸€ä¸ªâ€successâ€</p><blockquote><p>è¿™é‡Œçš„successæ˜¯notifyUrl</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/success&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">topay2</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ”¯ä»˜æˆåŠŸ&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œä»˜å®Œæ¬¾åï¼Œæ”¯ä»˜å®ä¼šåé¦ˆä¸€äº›ä¿¡æ¯ï¼Œè¡¥å……ä»£ç å¦‚ä¸‹</p><blockquote><p>å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œçš„ä»£ç å¯ä»¥åœ¨è¯¥æ–¹æ³•ä¸­è¿›è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å¼‚æ­¥å›è°ƒæ–¹æ³•ä¸­è¿›è¡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/success&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">topay2</span><span class="hljs-params">(HttpServletResponse response, HttpServletRequest request)</span> &#123;<br>    Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    Map&lt;String, String[]&gt; requestParams = request.getParameterMap();<br>    requestParams.forEach((key,value)-&gt;&#123;<br>        System.out.println(key);<br>        System.out.println(Arrays.toString(value));<br>    &#125;);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ”¯ä»˜æˆåŠŸ&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220809151035.png"></p><h4 id="notifyUrl"><a href="#notifyUrl" class="headerlink" title="notifyUrl"></a>notifyUrl</h4><ul><li><p>ä¸Šé¢ä¸ºæ”¯ä»˜å®åŒæ­¥è°ƒç”¨å¤„ç†,ä½†æ˜¯å®˜æ–¹å»ºè®®åº”åœ¨å¼‚æ­¥è°ƒç”¨æ–¹æ³•ä¸­å¤„ç†ä»˜æ¬¾æˆåŠŸåçš„æ“ä½œï¼Œä½†å› å¼‚æ­¥è°ƒç”¨çš„è·¯å¾„å¿…é¡»ä¸ºå…¬ç½‘åœ°å€ï¼Œæ”¯ä»˜å®æ‰å¯ä»¥å‘é€è¯·æ±‚ç»™æˆ‘ä»¬,æ•…è¿™é‡Œä¸å†™å¼‚æ­¥è°ƒç”¨çš„æ–¹æ³•äº†,éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼‚æ­¥è°ƒç”¨ä¸ºpostè¯·æ±‚ï¼Œä¸”ä¼ é€’æ¥çš„å‚æ•°ä¼šå¤šä¸€äº›ï¼Œä½†åŸºæœ¬ä¸åŒæ­¥è°ƒç”¨çš„æ“ä½œä¸€è‡´ã€‚</p></li><li><p>å¼‚æ­¥å›è°ƒæ–¹æ³•å¿…é¡»ä¸ºå…¬ç½‘IPï¼Œå› ä¸ºè¿™ä¸ªURLåœ°å€æ˜¯æ”¯ä»˜å®å®˜æ–¹æ¥è°ƒç”¨æˆ‘ä»¬æœ¬æœºçš„ï¼Œæ˜¯æˆ‘ä»¬å®Œæˆæ”¯ä»˜æ“ä½œåï¼Œæ”¯ä»˜å®éœ€è¦è¿›è¡Œä¸€äº›é‡‘é¢çš„å¤„ç†ï¼ˆä¸é“¶è¡Œå¯¹æ¥ï¼‰æ‰€ä»¥éœ€è¦å‡ ç§’çš„æ—¶é—´ï¼Œå½“æ”¯ä»˜å®å¤„ç†å®Œæˆåå¼‚æ­¥çš„è°ƒç”¨æˆ‘ä»¬çš„notifyæ–¹æ³•ï¼ˆä¸€èˆ¬åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œæ•°æ®åº“çš„æ“ä½œï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å¼‚æ­¥è¿›è¡Œï¼Œæ‰€ä»¥ç”¨æˆ·ä¸€èˆ¬æ„Ÿè§‰ä¸åˆ°ï¼ˆç”¨æˆ·æ„Ÿè§‰åˆ°çš„æ˜¯åŒæ­¥è°ƒç”¨çš„æ–¹æ³•ï¼‰ã€‚</p></li><li><p>è®¾ç½®å…¬ç½‘IPæœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œ1ã€å†…ç½‘ç©¿é€ï¼Œ2ã€å°†é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜&quot;&gt;&lt;a href=&quot;#Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜&quot; class=&quot;headerlink&quot; title=&quot;Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜&quot;&gt;&lt;/a&gt;Springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜&lt;/h1&gt;&lt;h2 id=&quot;ä½¿ç”¨æ²™ç®±ç¯</summary>
      
    
    
    
    <category term="æ”¯ä»˜SDK" scheme="http://conquers.github.io/categories/%E6%94%AF%E4%BB%98SDK/"/>
    
    <category term="æ”¯ä»˜å®" scheme="http://conquers.github.io/categories/%E6%94%AF%E4%BB%98SDK/%E6%94%AF%E4%BB%98%E5%AE%9D/"/>
    
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
    <category term="æ”¯ä»˜å®" scheme="http://conquers.github.io/tags/%E6%94%AF%E4%BB%98%E5%AE%9D/"/>
    
    <category term="æ”¯ä»˜" scheme="http://conquers.github.io/tags/%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>æ”¯ä»˜å®æ”¯ä»˜</title>
    <link href="http://conquers.github.io/posts/3338cec1.html"/>
    <id>http://conquers.github.io/posts/3338cec1.html</id>
    <published>2022-08-08T06:21:14.000Z</published>
    <updated>2023-07-18T07:00:37.343Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ”¯ä»˜å®"><a href="#æ”¯ä»˜å®" class="headerlink" title="æ”¯ä»˜å®"></a>æ”¯ä»˜å®</h1><p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://open.alipay.com/">æ”¯ä»˜å®å¼€æ”¾å¹³å°</a><br>å¼€å‘æ–‡æ¡£ï¼š<a href="https://opendocs.alipay.com/open/01bxlm">ç½‘é¡µ&#x2F;ç§»åŠ¨åº”ç”¨æ–‡æ¡£æŒ‡å¼•</a></p><blockquote><p>å¼€å‘æµ‹è¯•å¯ä»¥ç›´æ¥è·³è½¬åˆ°æ²™ç®±ç¯å¢ƒ</p></blockquote><h2 id="æ­£å¼ç¯å¢ƒï¼ˆå¸¸è§„æ¥å…¥æµç¨‹ï¼‰"><a href="#æ­£å¼ç¯å¢ƒï¼ˆå¸¸è§„æ¥å…¥æµç¨‹ï¼‰" class="headerlink" title="æ­£å¼ç¯å¢ƒï¼ˆå¸¸è§„æ¥å…¥æµç¨‹ï¼‰"></a>æ­£å¼ç¯å¢ƒï¼ˆå¸¸è§„æ¥å…¥æµç¨‹ï¼‰</h2><p>è¯¦ç»†çš„å¼€å‘æ–‡æ¡£ï¼š<a href="https://opendocs.alipay.com/open/03k9zr">æŒ‡å—</a><br><img src="/Resources/Pasted%20image%2020220808143344.png"><br><strong>æŒ‡å—å«æœ‰è¯¦ç»†çš„æ“ä½œæ–‡æ¡£ï¼Œä»¥ä¸‹ä»…ä¸ºå®è·µè®°å½•å†…å®¹ï¼ˆæŒ‰ç…§æ“ä½œæŒ‡å—å¼€å‘æ”¯ä»˜åº”ç”¨ï¼‰ã€‚</strong></p><h3 id="åˆ›å»ºåº”ç”¨"><a href="#åˆ›å»ºåº”ç”¨" class="headerlink" title="åˆ›å»ºåº”ç”¨"></a>åˆ›å»ºåº”ç”¨</h3><p>å¼€å‘è€…ä½¿ç”¨æ”¯ä»˜å®è´¦å·ç™»å½• <a href="https://openhome.alipay.com/develop/manage">å¼€æ”¾å¹³å°æ§åˆ¶å°</a>ï¼ˆéœ€å®åè®¤è¯çš„æ”¯ä»˜å®è´¦å·ï¼‰ã€‚</p><h4 id="å¼€å§‹åˆ›å»º"><a href="#å¼€å§‹åˆ›å»º" class="headerlink" title="å¼€å§‹åˆ›å»º"></a>å¼€å§‹åˆ›å»º</h4><p>æœ¬æ–‡ä¸»è¦ä»‹ç» <strong>ç½‘é¡µ&#x2F;ç§»åŠ¨åº”ç”¨</strong> åˆ›å»ºæµç¨‹ï¼Œå°ç¨‹åºã€ç”Ÿæ´»å·å’Œç¬¬ä¸‰æ–¹åº”ç”¨è¯·æŸ¥çœ‹ <a href="https://opendocs.alipay.com/mini/introduce/create">åˆ›å»ºå°ç¨‹åº</a>ã€<a href="https://opendocs.alipay.com/fw/guide">åˆ›å»ºç”Ÿæ´»å·</a>ã€<a href="https://opendocs.alipay.com/isv/03kvcj">åˆ›å»ºç¬¬ä¸‰æ–¹åº”ç”¨</a>ã€‚</p><p><img src="/Resources/Pasted%20image%2020220808143820.png"></p><h4 id="å¡«å†™åº”ç”¨åŸºç¡€ä¿¡æ¯"><a href="#å¡«å†™åº”ç”¨åŸºç¡€ä¿¡æ¯" class="headerlink" title="å¡«å†™åº”ç”¨åŸºç¡€ä¿¡æ¯"></a>å¡«å†™åº”ç”¨åŸºç¡€ä¿¡æ¯</h4><p><img src="/Resources/Pasted%20image%2020220808144650.png"></p><h4 id="äº§å“ç»‘å®š"><a href="#äº§å“ç»‘å®š" class="headerlink" title="äº§å“ç»‘å®š"></a>äº§å“ç»‘å®š</h4><p><img src="/Resources/Pasted%20image%2020220808144812.png"></p><h3 id="ç»‘å®šåº”ç”¨"><a href="#ç»‘å®šåº”ç”¨" class="headerlink" title="ç»‘å®šåº”ç”¨"></a>ç»‘å®šåº”ç”¨</h3><p>ä»¥ä¸‹éœ€è¦ç™»å½•ç™»å½• <a href="https://b.alipay.com/index2.htm">å•†å®¶æœåŠ¡å¹³å°</a> å¼€é€šæ”¯ä»˜æœåŠ¡<br><img src="/Resources/Pasted%20image%2020220808151057.png"></p><p>æŸ¥çœ‹pid<br><img src="/Resources/Pasted%20image%2020220808151139.png"></p><h4 id="å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤ï¼ˆç›®å‰æ¥çœ‹ä¸éœ€è¦äº†ï¼‰"><a href="#å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤ï¼ˆç›®å‰æ¥çœ‹ä¸éœ€è¦äº†ï¼‰" class="headerlink" title="å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤ï¼ˆç›®å‰æ¥çœ‹ä¸éœ€è¦äº†ï¼‰"></a><del>å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤</del>ï¼ˆç›®å‰æ¥çœ‹ä¸éœ€è¦äº†ï¼‰</h4><p>ç¬¬ä¸€æ­¥ï¼šè¿›å…¥å‘èµ·ç»‘å®šå…¥å£<br>ç™»å½• <a href="https://b.alipay.com/page/home">å•†å®¶å¹³å°</a> &gt; <strong>è´¦å·ä¸­å¿ƒ</strong> &gt; <strong>ç»‘å®š</strong> &gt; <strong>APPIDç»‘å®š</strong>ï¼Œç‚¹å‡» <strong>æ·»åŠ ç»‘å®š</strong>ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šæäº¤ç»‘å®šç”³è¯·<br>å¡«å†™åº”ç”¨ APPIDï¼Œç‚¹å‡» <strong>ä¸‹ä¸€æ­¥</strong> å³å¯å®Œæˆç»‘å®šã€‚<br><strong>æ³¨æ„ï¼š</strong>åŒä¸€ä¸»ä½“è´¦å·ç»‘å®šåº”ç”¨ä¸ä¼šé€šçŸ¥å•†å®¶ï¼Œä¸”ä¸åŒä¸»ä½“è´¦å·ä¸æ”¯æŒç»‘å®šåº”ç”¨ã€‚</p><blockquote><p>å®˜æ–¹æ–‡æ¡£æ˜¯éœ€è¦æ·»åŠ ç»‘å®šçš„ï¼Œä½†æ˜¯æˆ‘ç™»å½•è¿›æ¥å°±è‡ªåŠ¨ç»‘å®šäº†</p></blockquote><h3 id="é…ç½®å¯†é’¥"><a href="#é…ç½®å¯†é’¥" class="headerlink" title="é…ç½®å¯†é’¥"></a>é…ç½®å¯†é’¥</h3><p>è¿›è¡Œå¼€å‘è®¾ç½®<br><img src="/Resources/Pasted%20image%2020220808144921.png"></p><p>å…ˆä¸‹è½½å®‰è£…å¥½å¯†é’¥ç”Ÿæˆå™¨<br><img src="/Resources/Pasted%20image%2020220808145634.png"></p><p>æ‰“å¼€åç”Ÿæˆç§é’¥å’Œå…¬é’¥<br><img src="/Resources/Pasted%20image%2020220808145836.png"></p><p>å¤åˆ¶å…¬é’¥<br><img src="/Resources/Pasted%20image%2020220808150104.png"></p><h4 id="å¯é€‰é¡¹"><a href="#å¯é€‰é¡¹" class="headerlink" title="å¯é€‰é¡¹"></a>å¯é€‰é¡¹</h4><p><img src="/Resources/Pasted%20image%2020220808150533.png"><br><img src="/Resources/Pasted%20image%2020220808150541.png"><br><img src="/Resources/Pasted%20image%2020220808150556.png"></p><h3 id="ä¸Šçº¿åº”ç”¨"><a href="#ä¸Šçº¿åº”ç”¨" class="headerlink" title="ä¸Šçº¿åº”ç”¨"></a>ä¸Šçº¿åº”ç”¨</h3><p>æš‚æ—¶çœç•¥</p><h3 id="å¼€é€šäº§å“"><a href="#å¼€é€šäº§å“" class="headerlink" title="å¼€é€šäº§å“"></a>å¼€é€šäº§å“</h3><p>æš‚æ—¶çœç•¥</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ”¯ä»˜å®&quot;&gt;&lt;a href=&quot;#æ”¯ä»˜å®&quot; class=&quot;headerlink&quot; title=&quot;æ”¯ä»˜å®&quot;&gt;&lt;/a&gt;æ”¯ä»˜å®&lt;/h1&gt;&lt;p&gt;å®˜æ–¹ç½‘ç«™ï¼š&lt;a href=&quot;https://open.alipay.com/&quot;&gt;æ”¯ä»˜å®å¼€æ”¾å¹³å°&lt;/a&gt;&lt;br&gt;å¼€å‘æ–‡æ¡£ï¼š&lt;a hre</summary>
      
    
    
    
    <category term="æ”¯ä»˜SDK" scheme="http://conquers.github.io/categories/%E6%94%AF%E4%BB%98SDK/"/>
    
    <category term="æ”¯ä»˜å®" scheme="http://conquers.github.io/categories/%E6%94%AF%E4%BB%98SDK/%E6%94%AF%E4%BB%98%E5%AE%9D/"/>
    
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
    <category term="æ”¯ä»˜" scheme="http://conquers.github.io/tags/%E6%94%AF%E4%BB%98/"/>
    
    <category term="æ”¯ä»˜å®æ”¯ä»˜" scheme="http://conquers.github.io/tags/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearchÂ 7.8å®æˆ˜</title>
    <link href="http://conquers.github.io/posts/7b1830e5.html"/>
    <id>http://conquers.github.io/posts/7b1830e5.html</id>
    <published>2022-08-04T03:09:05.000Z</published>
    <updated>2023-07-18T12:20:29.322Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ElasticSearch7.8ï¼Œä¹‹å‰å­¦çš„æ˜¯6.8çš„è§†é¢‘ï¼Œå¤§éƒ¨åˆ†æ¦‚å¿µæ€§å†…å®¹åœ¨ElasticSearch6.8å·²ç»å†™è¿‡ï¼ˆåŸºæœ¬ä¸Šå¤§å·®ä¸å·®ï¼‰ï¼Œä¸å†èµ˜è¿°ï¼Œä½†æ˜¯7çš„æ¥å£ç›¸è¾ƒäº6å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ï¼Œå› æ­¤æœ¬æ–‡ä¸»è¦æ˜¯å®è·µéƒ¨åˆ†ï¼</p><ul><li><p>æœ€æ–°çš„å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/">Spring Data Elasticsearch - Reference Documentation</a></p></li><li><p>ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š<br><img src="/Resources/Pasted%20image%2020220804165455.png"></p></li></ul><h2 id="0ã€ç¯å¢ƒå‡†å¤‡"><a href="#0ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="0ã€ç¯å¢ƒå‡†å¤‡"></a>0ã€ç¯å¢ƒå‡†å¤‡</h2><table><thead><tr><th>è½¯ä»¶</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>Java</td><td>1.8</td></tr><tr><td>SpringData-ElasticSearch</td><td>4.3.3</td></tr><tr><td>ElasticSearch</td><td>7.8ï¼ˆæ²¡æœ‰ä½¿ç”¨å¯¹åº”çš„7.15.2æ˜¯å› ä¸º7.15.2å¤ªå å†…å­˜ï¼‰</td></tr><tr><td>Sringboot</td><td>2.6.6</td></tr></tbody></table><hr><h2 id="1ã€SpringBooté›†æˆElasticSearch"><a href="#1ã€SpringBooté›†æˆElasticSearch" class="headerlink" title="1ã€SpringBooté›†æˆElasticSearch"></a>1ã€SpringBooté›†æˆElasticSearch</h2><blockquote><p>ä»¥çƒ­è¯è¯é¢‘ç»Ÿè®¡æ¨¡å—ä¸ºåŸºç¡€å®è·µ</p></blockquote><p>æ€è·¯ä¸€ï¼šé€šè¿‡å‰ç«¯ä¼ è¾“çš„æœç´¢å†…å®¹åˆ†è¯ï¼Œå­˜åˆ°redisæˆ–è€…å…¶ä»–åœ°æ–¹è¿›è¡Œè¯é¢‘ç»Ÿè®¡</p><p>æ€è·¯äºŒï¼šé€šè¿‡å‰ç«¯ä¼ è¾“çš„æœç´¢å†…å®¹å­˜åˆ°Esï¼Œæ ¹æ®Esçš„åˆ†è¯ç»“æœï¼ˆè¯é¢‘å’Œè¯ï¼‰å­˜åˆ°redis</p><blockquote><p>ä»¥ä¸‹ä½¿ç”¨æ€è·¯äºŒä¸ºä¸»è¦æ€è·¯</p></blockquote><h3 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h3><h4 id="1ã€é…ç½®æ–‡ä»¶"><a href="#1ã€é…ç½®æ–‡ä»¶" class="headerlink" title="1ã€é…ç½®æ–‡ä»¶"></a>1ã€é…ç½®æ–‡ä»¶</h4><p><code>application.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">elasticsearch:</span><br>      <span class="hljs-attr">repositories:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">elastic</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">elastic</span><br></code></pre></td></tr></table></figure><p><code>RestClientConfig.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractElasticsearchConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title function_">elasticsearchClient</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        å®šä¹‰å®¢æˆ·ç«¯é…ç½®å¯¹è±¡</span><br><span class="hljs-comment">        ç«¯å£ä¸º9200ï¼Œå‰é¢è¯´è¿‡ï¼Œeså¼€æ”¾çš„restç«¯å£ä¸º9200</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">hostAndPort</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;localhost:9200&quot;</span>;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">ClientConfiguration</span> <span class="hljs-variable">clientConfiguration</span> <span class="hljs-operator">=</span> ClientConfiguration.builder()<br>                .connectedTo(hostAndPort)<br>                .withBasicAuth(<span class="hljs-string">&quot;elastic&quot;</span>, <span class="hljs-string">&quot;elastic&quot;</span>)<br>                .build();<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        é€šè¿‡RestClientså¯¹è±¡åˆ›å»º</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">return</span> RestClients.create(clientConfiguration).rest();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ElasticsearchRestTemplate <span class="hljs-title function_">elasticsearchRestTemplate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//è‡ªå®šä¹‰ElasticsearchRestTemplate</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ElasticsearchRestTemplate</span>(elasticsearchClient());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2ã€åˆ›å»ºæ˜ å°„å¯¹è±¡"><a href="#2ã€åˆ›å»ºæ˜ å°„å¯¹è±¡" class="headerlink" title="2ã€åˆ›å»ºæ˜ å°„å¯¹è±¡"></a>2ã€åˆ›å»ºæ˜ å°„å¯¹è±¡</h4><p>å’Œè®¿é—®æ•°æ®åº“ä¸€æ ·ï¼Œç»Ÿç»Ÿä»¥å¯¹è±¡çš„å½¢å¼è®¿é—®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Document(indexName = &quot;searchcontent&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EsSearchContent</span> &#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String id;<br><br>    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = &quot;ik_pinyin_analyzer&quot;)</span><br>    <span class="hljs-keyword">private</span> String content;<br><br>    <span class="hljs-meta">@Field(type = FieldType.Date, format = DateFormat.date_hour_minute_second)</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3ã€åˆ›å»ºç´¢å¼•å³æ˜ å°„"><a href="#3ã€åˆ›å»ºç´¢å¼•å³æ˜ å°„" class="headerlink" title="3ã€åˆ›å»ºç´¢å¼•å³æ˜ å°„"></a>3ã€åˆ›å»ºç´¢å¼•å³æ˜ å°„</h4><p><del>ç¬¬ä¸€ç§ï¼šä½¿ç”¨<code>ElasticsearchRestTemplate</code>åˆ›å»ºç´¢å¼•</del></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ›å»ºç´¢å¼•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreateIndex</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.indexOps(EsSearchContent.class).exists();<br>    <span class="hljs-comment">// å¦‚æœç´¢å¼•å·²å­˜åœ¨,åˆ é™¤ç´¢å¼•</span><br>    <span class="hljs-keyword">if</span> (exists) &#123;<br>        <span class="hljs-comment">// åˆ é™¤ç´¢å¼•</span><br>        elasticsearchRestTemplate.indexOps(EsSearchContent.class).delete();<br>    &#125;<br>    <span class="hljs-comment">// åˆ›å»ºç´¢å¼•</span><br>    elasticsearchRestTemplate.indexOps(EsSearchContent.class).create();<br><br>    <span class="hljs-comment">// åˆ›å»ºæ˜ å°„</span><br>    <span class="hljs-type">Document</span> <span class="hljs-variable">mappings</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.indexOps(EsSearchContent.class).createMapping();<br>    elasticsearchRestTemplate.indexOps(EsSearchContent.class).putMapping(mappings);<br>    System.out.println(<span class="hljs-string">&quot;---æ‰§è¡ŒæˆåŠŸ---&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¡¥å……ï¼šè¿™é‡Œä¸ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨pinyinåˆ†è¯å™¨ï¼Œæ—¥å¸¸ä½¿ç”¨<code>@Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;)</code>è¿™ç§æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ¶‰åŠåˆ°è‡ªå®šä¹‰åˆ†è¯å™¨å°±éº»çƒ¦äº†</p></blockquote><p>ç¬¬äºŒç§ï¼šä½¿ç”¨<code>Kibana</code>åˆ›å»ºç´¢å¼•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT searchcontent<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;analysis&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;analyzer&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;ik_pinyin_analyzer&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;custom&quot;</span>,<br>                    <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>                    <span class="hljs-string">&quot;filter&quot;</span>: <span class="hljs-string">&quot;pinyin_filter&quot;</span><br>                &#125;<br>            &#125;,<br>            <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;pinyin_filter&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;pinyin&quot;</span>,<br>                    <span class="hljs-string">&quot;keep_first_letter&quot;</span> : <span class="hljs-literal">false</span>,<br>                    <span class="hljs-string">&quot;keep_full_pinyin&quot;</span> : <span class="hljs-literal">false</span>,<br>                    <span class="hljs-string">&quot;keep_joined_full_pinyin&quot;</span>:<span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;keep_none_chinese&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;keep_original&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;limit_first_letter_length&quot;</span> : 16,<br>                    <span class="hljs-string">&quot;lowercase&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;keep_none_chinese_in_first_letter&quot;</span> : <span class="hljs-literal">true</span><br>                &#125;<br>            &#125;<br>        &#125;<br>  &#125;,<br><span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br><span class="hljs-string">&quot;content&quot;</span>: &#123;<br><span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br><span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_pinyin_analyzer&quot;</span>,<br><span class="hljs-string">&quot;fielddata&quot;</span>: <span class="hljs-literal">true</span><br>&#125;,<br>  <span class="hljs-string">&quot;createTime&quot;</span>: &#123;<br><span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>&#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4ã€åˆ›å»ºæ¥å£ç±»"><a href="#4ã€åˆ›å»ºæ¥å£ç±»" class="headerlink" title="4ã€åˆ›å»ºæ¥å£ç±»"></a>4ã€åˆ›å»ºæ¥å£ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EsSearchContentService</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String message)</span>;<br><br>    List&lt;String&gt; <span class="hljs-title function_">getHotWords</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5ã€åˆ›å»ºå®ç°ç±»"><a href="#5ã€åˆ›å»ºå®ç°ç±»" class="headerlink" title="5ã€åˆ›å»ºå®ç°ç±»"></a>5ã€åˆ›å»ºå®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EsSearchContentServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EsSearchContentService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ElasticsearchRestTemplate elasticsearchRestTemplate;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RestHighLevelClient restHighLevelClient;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EsSearchContentServiceImpl</span><span class="hljs-params">(ElasticsearchRestTemplate elasticsearchRestTemplate, RestHighLevelClient restHighLevelClient)</span> &#123;<br>        <span class="hljs-built_in">this</span>.elasticsearchRestTemplate = elasticsearchRestTemplate;<br>        <span class="hljs-built_in">this</span>.restHighLevelClient = restHighLevelClient;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String message)</span> &#123;<br>        <span class="hljs-type">IndexQuery</span> <span class="hljs-variable">indexQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexQuery</span>();<br>        <span class="hljs-type">EsSearchContent</span> <span class="hljs-variable">esSearchContent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EsSearchContent</span>();<br>        esSearchContent.setContent(message);<br>        esSearchContent.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        indexQuery.setObject(esSearchContent);<br>        elasticsearchRestTemplate.index(indexQuery, IndexCoordinates.of(<span class="hljs-string">&quot;searchcontent&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getHotWords</span><span class="hljs-params">()</span> &#123;<br>        ArrayList&lt;String&gt; hotWords = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-comment">//åˆ›å»ºsearchè¯·æ±‚</span><br>        <span class="hljs-type">SearchRequest</span> <span class="hljs-variable">searchRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchRequest</span>();<br>        searchRequest.indices(<span class="hljs-string">&quot;searchcontent&quot;</span>);<br>        <span class="hljs-comment">//ç”ŸæˆDSLæŸ¥è¯¢è¯­å¥</span><br>        <span class="hljs-type">SearchSourceBuilder</span> <span class="hljs-variable">searchSourceBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchSourceBuilder</span>();<br>        <span class="hljs-comment">//æ„å»ºæŸ¥è¯¢æ¡ä»¶</span><br>        <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoolQueryBuilder</span>();<br><br>        <span class="hljs-comment">//æ—¶é—´èŒƒå›´çš„è®¾å®š</span><br>        <span class="hljs-type">RangeQueryBuilder</span> <span class="hljs-variable">rangequerybuilder</span> <span class="hljs-operator">=</span> QueryBuilders.rangeQuery(<span class="hljs-string">&quot;createTime&quot;</span>);<br>        rangequerybuilder.gte(<span class="hljs-string">&quot;2022-08-11T11:09:42&quot;</span>);<br>        rangequerybuilder.lte(<span class="hljs-string">&quot;2022-08-11T11:09:42&quot;</span>);<br>        boolQueryBuilder.filter(rangequerybuilder);<br><br>        searchSourceBuilder.query(boolQueryBuilder);<br>        <span class="hljs-type">AggregationBuilder</span> <span class="hljs-variable">aggregation</span> <span class="hljs-operator">=</span> AggregationBuilders.terms(<span class="hljs-string">&quot;count&quot;</span>)<br>                .field(<span class="hljs-string">&quot;content&quot;</span>)<br>                .includeExclude(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IncludeExclude</span>(<span class="hljs-string">&quot;[\u4E00-\u9FA5][\u4E00-\u9FA5].*&quot;</span>, <span class="hljs-literal">null</span>))<br>                .minDocCount(<span class="hljs-number">3</span>);<br>        searchSourceBuilder.aggregation(aggregation);<br><br>        searchRequest.source(searchSourceBuilder);<br><br>        <span class="hljs-comment">//å‘é€è¯·æ±‚</span><br>        <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">searchResponse</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);<br>            <span class="hljs-type">Terms</span> <span class="hljs-variable">terms</span> <span class="hljs-operator">=</span> searchResponse.getAggregations().get(<span class="hljs-string">&quot;count&quot;</span>);<br>            List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Terms</span>.Bucket&gt; elasticBucket = terms.getBuckets();<br>            elasticBucket.forEach(hotWord -&gt; &#123;<br>                System.out.println(hotWord.getKeyAsString());<br>                hotWords.add(hotWord.getKeyAsString());<br><br>                System.out.println(hotWord.getDocCount());<br>            &#125;);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> hotWords;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6ã€æ’å…¥æ•°æ®"><a href="#6ã€æ’å…¥æ•°æ®" class="headerlink" title="6ã€æ’å…¥æ•°æ®"></a>6ã€æ’å…¥æ•°æ®</h4><p>è¿™é‡Œçš„æ’å…¥æ•°æ®ï¼Œå³ä½¿ç”¨æœç´¢æœåŠ¡ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨kibanaæˆ–è€…Springbootå¾€é‡Œé¢ç›´æ¥æ’å…¥æ•°æ®ï¼‰<br>åˆ†åˆ«å‘èµ·ä¸‰æ¬¡æœç´¢ï¼ˆå› ä¸ºä¸Šé¢è¿›è¡Œåˆ†è¯çš„æ—¶å€™æœ€å°‘ä¹Ÿè¦å‡ºç°3æ¬¡ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;<span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;åŸè£…ä¹¦ç±&quot;</span>,...&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020230718145331.png"></p><p>æŸ¥è¯¢ç»“æœ<br><img src="/Resources/Pasted%20image%2020230718145351.png"></p><p>åœ¨Kibanaä¸­æŸ¥çœ‹å­˜å…¥çš„æ•°æ®<br><img src="/Resources/Pasted%20image%2020230718145419.png"></p><hr><h3 id="æµ‹è¯•åŠŸèƒ½"><a href="#æµ‹è¯•åŠŸèƒ½" class="headerlink" title="æµ‹è¯•åŠŸèƒ½"></a>æµ‹è¯•åŠŸèƒ½</h3><h4 id="1ã€ä½¿ç”¨Kibanaè¿›è¡Œè¯é¢‘ç»Ÿè®¡"><a href="#1ã€ä½¿ç”¨Kibanaè¿›è¡Œè¯é¢‘ç»Ÿè®¡" class="headerlink" title="1ã€ä½¿ç”¨Kibanaè¿›è¡Œè¯é¢‘ç»Ÿè®¡"></a>1ã€ä½¿ç”¨Kibanaè¿›è¡Œè¯é¢‘ç»Ÿè®¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /productindexwtt/_search<br>&#123;<br>  <span class="hljs-string">&quot;from&quot;</span>: 0,<br>  <span class="hljs-string">&quot;_source&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [],<br>      <span class="hljs-string">&quot;must_not&quot;</span>: [],<br>      <span class="hljs-string">&quot;should&quot;</span>: []<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;messages&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;size&quot;</span>: 100,<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;content&quot;</span>,<br>        <span class="hljs-string">&quot;min_doc_count&quot;</span>: 3,<br>        <span class="hljs-string">&quot;include&quot;</span>: <span class="hljs-string">&quot;[\u4E00-\u9FA5][\u4E00-\u9FA5].*&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•è¯é¢‘ç»Ÿè®¡<br><img src="/Resources/Pasted%20image%2020230718145452.png"></p><h4 id="2ã€åœ¨Springbootä¸­æµ‹è¯•åŠŸèƒ½"><a href="#2ã€åœ¨Springbootä¸­æµ‹è¯•åŠŸèƒ½" class="headerlink" title="2ã€åœ¨Springbootä¸­æµ‹è¯•åŠŸèƒ½"></a>2ã€åœ¨Springbootä¸­æµ‹è¯•åŠŸèƒ½</h4><p>æ•ˆæœï¼š<br><img src="/Resources/Pasted%20image%2020220804164859.png"></p><hr><h4 id="å‡ºç°çš„é—®é¢˜ï¼š"><a href="#å‡ºç°çš„é—®é¢˜ï¼š" class="headerlink" title="å‡ºç°çš„é—®é¢˜ï¼š"></a>å‡ºç°çš„é—®é¢˜ï¼š</h4><p>ä½¿ç”¨èšåˆæœç´¢æ—¶ï¼Œä½¿ç”¨getAggregations()æ‹¿å–æ•°æ®æ—¶æŠ¥é”™ï¼Œæ’æŸ¥åˆ†æåæ˜¯ç‰ˆæœ¬é—®é¢˜ï¼šå°†Springbootç‰ˆæœ¬é™è‡³2.3.3.RELEASEå³å¯è§£å†³ã€‚</p><blockquote><p>ç”±äºé¡¹ç›®ç‰ˆæœ¬ä¸èƒ½åŠ¨ï¼Œå› æ­¤è¿™é‡Œä¸ä½¿ç”¨ElasticsearchTemplateè¿›è¡Œèšåˆæœç´¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Aggregations</span> <span class="hljs-variable">aggregations</span> <span class="hljs-operator">=</span> searchHits.getAggregations();<br></code></pre></td></tr></table></figure><p>æœ€åæŠ˜ä¸­é€‰æ‹©ä½¿ç”¨äº†RestHighLevelClientï¼Œä»£ç è§ä¸Šã€‚</p><h2 id="2ã€ElasticsearchTemplateçš„ç”¨æ³•"><a href="#2ã€ElasticsearchTemplateçš„ç”¨æ³•" class="headerlink" title="2ã€ElasticsearchTemplateçš„ç”¨æ³•"></a>2ã€ElasticsearchTemplateçš„ç”¨æ³•</h2><blockquote><p>åœ¨6.8ä¸­æœ‰<code>ElasticsearchRepository</code>å’Œ<code>RestHighLevelClient</code>çš„ç”¨æ³•</p></blockquote><h3 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åˆ›å»ºç´¢å¼•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreateIndex</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.indexOps(EsSearchContent.class).exists();<br><span class="hljs-comment">// å¦‚æœç´¢å¼•å·²å­˜åœ¨,åˆ é™¤ç´¢å¼•</span><br><span class="hljs-keyword">if</span> (exists) &#123;<br><span class="hljs-comment">// åˆ é™¤ç´¢å¼•</span><br>elasticsearchRestTemplate.indexOps(EsSearchContent.class).delete();<br>&#125;<br><span class="hljs-comment">// åˆ›å»ºç´¢å¼•</span><br>elasticsearchRestTemplate.indexOps(EsSearchContent.class).create();<br><br><span class="hljs-comment">// åˆ›å»ºæ˜ å°„</span><br><span class="hljs-type">Document</span> <span class="hljs-variable">mappings</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.indexOps(EsSearchContent.class).createMapping();<br>elasticsearchRestTemplate.indexOps(EsSearchContent.class).putMapping(mappings);<br>System.out.println(<span class="hljs-string">&quot;---æ‰§è¡ŒæˆåŠŸ---&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * åˆ é™¤ç´¢å¼•</span><br><span class="hljs-comment">  */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDeleteIndex</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.indexOps(EsSearchContent.class).delete();<br>    System.out.println(<span class="hljs-string">&quot;æ˜¯å¦åˆ é™¤æˆåŠŸ : &quot;</span> + deleted);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ–°å¢æ–‡æ¡£æ•°æ®"><a href="#æ–°å¢æ–‡æ¡£æ•°æ®" class="headerlink" title="æ–°å¢æ–‡æ¡£æ•°æ®"></a>æ–°å¢æ–‡æ¡£æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–°å¢æ–‡æ¡£æ•°æ®</span><br><span class="hljs-comment"> */</span><br> <span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">IndexQuery</span> <span class="hljs-variable">indexQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexQuery</span>();<br><span class="hljs-type">EsSearchContent</span> <span class="hljs-variable">esSearchContent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EsSearchContent</span>();<br>esSearchContent.setContent(<span class="hljs-string">&quot;message&quot;</span>);<br>esSearchContent.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>indexQuery.setObject(esSearchContent);<br>elasticsearchRestTemplate.index(indexQuery, IndexCoordinates.of(<span class="hljs-string">&quot;searchcontent&quot;</span>));<br><span class="hljs-comment">//è¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„save</span><br>elasticsearchRestTemplate.save(esSearchContent);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤æ–‡æ¡£æ•°æ®"><a href="#åˆ é™¤æ–‡æ¡£æ•°æ®" class="headerlink" title="åˆ é™¤æ–‡æ¡£æ•°æ®"></a>åˆ é™¤æ–‡æ¡£æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * åˆ é™¤æ–‡æ¡£æ•°æ®</span><br><span class="hljs-comment">  */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteDoc</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">// è¿”å›è¢«åˆ é™¤çš„æ•°æ®id</span><br><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.delete(<span class="hljs-string">&quot;IYzHaIIBQknQYDuAgCU-&quot;</span>, EsSearchContent.class);<br>System.out.println(result);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢æ–‡æ¡£æ•°æ®"><a href="#æŸ¥è¯¢æ–‡æ¡£æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ–‡æ¡£æ•°æ®"></a>æŸ¥è¯¢æ–‡æ¡£æ•°æ®</h3><p>æŸ¥è¯¢è®¾è®¡åˆ°å¾ˆå¤šæ–¹æ³•ï¼Œä¸‹é¢åˆ—ä¸¾å…¶ä¸­æ¯”è¾ƒå¤æ‚çš„é«˜äº®æŸ¥è¯¢ï¼Œå…¶ä»–çš„çš†å¯ç±»æ¯”</p><blockquote><p>ä»¥ä¸‹æ²¡æœ‰çš„æ–¹æ³•å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹æˆ–è€…é€šè¿‡æœç´¢å¼•æ“æœç´¢å¾—åˆ°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> List&lt;EsProduct&gt; <span class="hljs-title function_">testSearch</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// éœ€è¦æŸ¥è¯¢çš„å­—æ®µ</span><br>        <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery()<br>                .must(QueryBuilders.matchQuery(<span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;æˆ‘æ˜¯æ ‡é¢˜&quot;</span>));<br>        <br>        <span class="hljs-comment">// åˆ†é¡µ ä»ç¬¬0é¡µå¼€å§‹ï¼Œæ¯é¡µ10æ¡æ•°æ®</span><br>        <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageable</span> <span class="hljs-operator">=</span> PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br> <br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        è¿™é‡Œå»ºè®®ç”¨ä¸‹é¢çš„ï¼Œå› ä¸ºå¯èƒ½ä¸éœ€è¦æ’åº</span><br><span class="hljs-comment">        æ„å»ºé«˜äº®æŸ¥è¯¢</span><br><span class="hljs-comment">        NativeSearchQuery searchQuery = new NativeSearchQueryBuilder()</span><br><span class="hljs-comment">                .withQuery(boolQueryBuilder)</span><br><span class="hljs-comment">                .withSorts(SortBuilders.fieldSort(&quot;id&quot;).order(SortOrder.ASC))</span><br><span class="hljs-comment">                .withHighlightFields(</span><br><span class="hljs-comment">                        new HighlightBuilder.Field(&quot;title&quot;))</span><br><span class="hljs-comment">                .withPageable(pageable)</span><br><span class="hljs-comment">                .withHighlightBuilder(new HighlightBuilder().preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;))</span><br><span class="hljs-comment">                .build();</span><br><span class="hljs-comment">        */</span><br>        <br>    <span class="hljs-comment">//æ„å»ºé«˜äº®æŸ¥è¯¢</span><br>        <span class="hljs-type">NativeSearchQueryBuilder</span> <span class="hljs-variable">searchQueryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>();<br>        searchQueryBuilder.withQuery(boolQueryBuilder);<br>        searchQueryBuilder.withHighlightFields( <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.Field(<span class="hljs-string">&quot;title&quot;</span>));<br>        searchQueryBuilder.withPageable(pageable);<br>        searchQueryBuilder.withHighlightBuilder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>().preTags(<span class="hljs-string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>).postTags(<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>));<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * æ’åº</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">if</span>(rangeInDefined(searchSortType,<span class="hljs-number">1</span>,<span class="hljs-number">6</span>))&#123;<br>            sortByCondition(searchQueryBuilder,searchSortType);<br>        &#125;<br>        <br>        <span class="hljs-comment">// æŸ¥è¯¢</span><br>        SearchHits&lt;EsProduct&gt; search = elasticsearchRestTemplate.search(searchQuery, EsProduct.class);<br>        <span class="hljs-comment">// å¾—åˆ°æŸ¥è¯¢è¿”å›çš„å†…å®¹</span><br>        List&lt;SearchHit&lt;EsProduct&gt;&gt; searchHits = search.getSearchHits();<br>        <span class="hljs-comment">// è®¾ç½®ä¸€ä¸ªæœ€åéœ€è¦è¿”å›çš„å®ä½“ç±»é›†åˆ</span><br>        List&lt;EsProduct&gt; esProducts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-comment">// éå†è¿”å›çš„å†…å®¹è¿›è¡Œå¤„ç†</span><br>        <span class="hljs-keyword">for</span> (SearchHit&lt;EsProduct&gt; searchHit : searchHits) &#123;<br>            <span class="hljs-comment">// é«˜äº®çš„å†…å®¹</span><br>            Map&lt;String, List&lt;String&gt;&gt; highlightFields = searchHit.getHighlightFields();<br>            <span class="hljs-comment">// å°†é«˜äº®çš„å†…å®¹å¡«å……åˆ°contentä¸­</span><br>            searchHit.getContent().setTitle(highlightFields.get(<span class="hljs-string">&quot;title&quot;</span>) == <span class="hljs-literal">null</span> ? searchHit.getContent().getTitle() : highlightFields.get(<span class="hljs-string">&quot;title&quot;</span>).get(<span class="hljs-number">0</span>));<br>            searchHit.getContent().setAuthor(highlightFields.get(<span class="hljs-string">&quot;author&quot;</span>) == <span class="hljs-literal">null</span> ? searchHit.getContent().getAuthor() : highlightFields.get(<span class="hljs-string">&quot;author&quot;</span>).get(<span class="hljs-number">0</span>));<br>            <span class="hljs-comment">// æ”¾åˆ°å®ä½“ç±»ä¸­</span><br>            esProducts.add(searchHit.getContent());<br>        &#125;<br>        <span class="hljs-keyword">return</span> esProducts;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h3><h5 id="é—®é¢˜1ï¼šshouldå’Œmustè¿ç”¨ä¸èµ·ä½œç”¨"><a href="#é—®é¢˜1ï¼šshouldå’Œmustè¿ç”¨ä¸èµ·ä½œç”¨" class="headerlink" title="é—®é¢˜1ï¼šshouldå’Œmustè¿ç”¨ä¸èµ·ä½œç”¨"></a>é—®é¢˜1ï¼šshouldå’Œmustè¿ç”¨ä¸èµ·ä½œç”¨</h5><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://blog.csdn.net/qq_39818325/article/details/118578063">elasticsearchä¸­çš„å¯¹è±¡QueryBuilderåŒæ—¶ä½¿ç”¨shouldå’ŒmustæŸ¥è¯¢ä¸æˆåŠŸ</a><br>BoolQueryBuilderä¸­çš„shouldå’Œmustä¸€èµ·ç”¨ä¼šå‡ºç°é—®é¢˜ï¼š<br>è§£å†³é—®é¢˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä»£ç æ‰¿æ¥ä¸Šè¿°é”™è¯¯ä»£ç ï¼Œæ–°å¢ä¸‹é¢ä¸€è¡Œ </span><br>boolQueryBuilder.minimumShouldMatch(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><h5 id="é—®é¢˜2ï¼šrangeQueryä¸èµ·ä½œç”¨"><a href="#é—®é¢˜2ï¼šrangeQueryä¸èµ·ä½œç”¨" class="headerlink" title="é—®é¢˜2ï¼šrangeQueryä¸èµ·ä½œç”¨"></a>é—®é¢˜2ï¼šrangeQueryä¸èµ·ä½œç”¨</h5><p>è§£å†³é—®é¢˜ï¼š<br><strong>æŸ¥çœ‹æ’åºçš„å­—æ®µæ˜¯å¦æ˜¯Integeræˆ–è€…å…¶ä»–æ•°æ®ç±»å‹</strong><br>åˆ›å»ºç´¢å¼•çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯Keywordï¼Œä¿®æ”¹ä¸ºIntegerå¥½äº†</p><h5 id="é—®é¢˜3ï¼šæœ‰æ—¶å€™éœ€è¦æ’åºï¼Œæœ‰æ—¶å€™ä¸éœ€è¦æ’åº"><a href="#é—®é¢˜3ï¼šæœ‰æ—¶å€™éœ€è¦æ’åºï¼Œæœ‰æ—¶å€™ä¸éœ€è¦æ’åº" class="headerlink" title="é—®é¢˜3ï¼šæœ‰æ—¶å€™éœ€è¦æ’åºï¼Œæœ‰æ—¶å€™ä¸éœ€è¦æ’åº"></a>é—®é¢˜3ï¼šæœ‰æ—¶å€™éœ€è¦æ’åºï¼Œæœ‰æ—¶å€™ä¸éœ€è¦æ’åº</h5><p>ä»£ç æ›¿æ¢æˆå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">   <span class="hljs-comment">/*</span><br><span class="hljs-comment">   è¿™é‡Œå»ºè®®ç”¨ä¸‹é¢çš„ï¼Œå› ä¸ºå¯èƒ½ä¸éœ€è¦æ’åº</span><br><span class="hljs-comment">   æ„å»ºé«˜äº®æŸ¥è¯¢</span><br><span class="hljs-comment">   NativeSearchQuery searchQuery = new NativeSearchQueryBuilder()</span><br><span class="hljs-comment">           .withQuery(boolQueryBuilder)</span><br><span class="hljs-comment">           .withSorts(SortBuilders.fieldSort(&quot;id&quot;).order(SortOrder.ASC))</span><br><span class="hljs-comment">           .withHighlightFields(</span><br><span class="hljs-comment">                   new HighlightBuilder.Field(&quot;title&quot;))</span><br><span class="hljs-comment">           .withPageable(pageable)</span><br><span class="hljs-comment">           .withHighlightBuilder(new HighlightBuilder().preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;))</span><br><span class="hljs-comment">           .build();</span><br><span class="hljs-comment">   */</span><br>   <br><span class="hljs-comment">//æ„å»ºé«˜äº®æŸ¥è¯¢</span><br>   <span class="hljs-type">NativeSearchQueryBuilder</span> <span class="hljs-variable">searchQueryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>();<br>   searchQueryBuilder.withQuery(boolQueryBuilder);<br>   searchQueryBuilder.withHighlightFields( <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.Field(<span class="hljs-string">&quot;title&quot;</span>));<br>   searchQueryBuilder.withPageable(pageable);<br>   searchQueryBuilder.withHighlightBuilder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>().preTags(<span class="hljs-string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>).postTags(<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>));<br></code></pre></td></tr></table></figure><h5 id="é—®é¢˜4ï¼šæœ‰äº›å…³é”®è¯ä¸éœ€è¦åˆ†è¯"><a href="#é—®é¢˜4ï¼šæœ‰äº›å…³é”®è¯ä¸éœ€è¦åˆ†è¯" class="headerlink" title="é—®é¢˜4ï¼šæœ‰äº›å…³é”®è¯ä¸éœ€è¦åˆ†è¯"></a>é—®é¢˜4ï¼šæœ‰äº›å…³é”®è¯ä¸éœ€è¦åˆ†è¯</h5><p>ä½¿ç”¨termQuery<br><code>.must(QueryBuilders.termQuery(&quot;title&quot;, &quot;æˆ‘æ˜¯æ ‡é¢˜&quot;));</code><br>å¦‚æœä¸€å®šè¦ä½¿ç”¨matchQueryï¼ŒåŠ ä¸Š<code>.operator(Operator.AND</code><br><code>.must(QueryBuilders.matchQuery(&quot;title&quot;, &quot;æˆ‘æ˜¯æ ‡é¢˜&quot;).operator(Operator.AND));</code></p><h5 id="é—®é¢˜5ï¼šè¿‡æ»¤åˆ†æ•°å¤ªä½çš„ç»“æœ"><a href="#é—®é¢˜5ï¼šè¿‡æ»¤åˆ†æ•°å¤ªä½çš„ç»“æœ" class="headerlink" title="é—®é¢˜5ï¼šè¿‡æ»¤åˆ†æ•°å¤ªä½çš„ç»“æœ"></a>é—®é¢˜5ï¼šè¿‡æ»¤åˆ†æ•°å¤ªä½çš„ç»“æœ</h5><blockquote><p><strong>ä¸è¦ä½¿ç”¨forå¾ªç¯éå†</strong><br>ä½¿ç”¨<code>withMinScore(1)</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">NativeSearchQueryBuilder</span> <span class="hljs-variable">searchQueryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>();<br>searchQueryBuilder.withMinScore(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><h5 id="é—®é¢˜6ï¼š-Testä¸èƒ½ç›´æ¥è¿è¡Œ"><a href="#é—®é¢˜6ï¼š-Testä¸èƒ½ç›´æ¥è¿è¡Œ" class="headerlink" title="é—®é¢˜6ï¼š@Testä¸èƒ½ç›´æ¥è¿è¡Œ"></a>é—®é¢˜6ï¼š@Testä¸èƒ½ç›´æ¥è¿è¡Œ</h5><p>ç±»ä¸Šé¢åŠ äº†<code>@SpringBootTest</code><br>æ–¹æ³•ä¸Šé¢åŠ äº†<code>@Test</code><br>ä½†æ˜¯ä¸èƒ½è¿è¡Œï¼Œæ³¨æ„å¯¼åŒ…çš„è·¯å¾„åº”è¯¥ä¸º<code>import org.junit.jupiter.api.Test;</code><br><strong>å¦åˆ™ä¸èµ·ä½œç”¨</strong></p><h5 id="é—®é¢˜7ï¼šæ—¶é—´æ’åºæ²¡æ•°æ®"><a href="#é—®é¢˜7ï¼šæ—¶é—´æ’åºæ²¡æ•°æ®" class="headerlink" title="é—®é¢˜7ï¼šæ—¶é—´æ’åºæ²¡æ•°æ®"></a>é—®é¢˜7ï¼šæ—¶é—´æ’åºæ²¡æ•°æ®</h5><p>è¿‡æ»¤æœ€å°åˆ†æ•°çš„é—®é¢˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œå»æ‰äº†<code>.withMinScore(1);</code>è§£å†³ï¼Œä½†æ˜¯åˆéœ€è¦è¿‡æ»¤æœ€å°åˆ†æ•°ã€‚<br><img src="/Resources/Pasted%20image%2020220819164536.png"><br>ä½†æ˜¯ä¸ºä»€ä¹ˆæŒ‰ç…§ä»·æ ¼æ’åºï¼Œå´æœ‰æ•°æ®è¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br> <span class="hljs-keyword">public</span> List&lt;SearchDto&gt; <span class="hljs-title function_">searchByKeyTitle</span><span class="hljs-params">(String title, String price, List&lt;String&gt; classType, List&lt;String&gt; publisherList, Integer typeInSearch,</span><br><span class="hljs-params">                                         String storeId, List&lt;String&gt; jointStoreList, <span class="hljs-type">int</span> searchSortType, <span class="hljs-type">int</span> pageNo, <span class="hljs-type">int</span> pageSize, <span class="hljs-type">int</span> packageType, String stockOfStore)</span> &#123;<br><br>     <span class="hljs-comment">// æ„å»ºæœç´¢</span><br>     <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br>     <span class="hljs-type">NativeSearchQueryBuilder</span> <span class="hljs-variable">searchQueryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>();<br><br>     <span class="hljs-comment">// è¿‡æ»¤</span><br>     conditionFilter(boolQueryBuilder, price, classType, publisherList, typeInSearch, storeId, jointStoreList, searchSortType, packageType, stockOfStore);<br>     searchQueryBuilder.withFilter(boolQueryBuilder);<br><br>     <span class="hljs-comment">// åˆ†é¡µ</span><br>     <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageable</span> <span class="hljs-operator">=</span> PageRequest.of(pageNo, pageSize);<br>     searchQueryBuilder.withPageable(pageable);<br><br>     <span class="hljs-comment">// æœç´¢</span><br>     List&lt;FunctionScoreQueryBuilder.FilterFunctionBuilder&gt; filterFunctionBuilders = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>     filterFunctionBuilders.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="hljs-string">&quot;title&quot;</span>, title),<br>             ScoreFunctionBuilders.weightFactorFunction(<span class="hljs-number">5</span>)));<br>     filterFunctionBuilders.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder(QueryBuilders.matchQuery(<span class="hljs-string">&quot;author&quot;</span>, title),<br>             ScoreFunctionBuilders.weightFactorFunction(<span class="hljs-number">10</span>)));<br>     FunctionScoreQueryBuilder.FilterFunctionBuilder[] builders = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctionScoreQueryBuilder</span>.FilterFunctionBuilder[filterFunctionBuilders.size()];<br>     filterFunctionBuilders.toArray(builders);<br>     <span class="hljs-type">FunctionScoreQueryBuilder</span> <span class="hljs-variable">functionScoreQueryBuilder</span> <span class="hljs-operator">=</span> QueryBuilders.functionScoreQuery(builders)<br>             .scoreMode(FunctionScoreQuery.ScoreMode.SUM)<br>             .setMinScore(<span class="hljs-number">2</span>);<br><br>     <span class="hljs-comment">// æ’åº</span><br>     <span class="hljs-comment">/*</span><br><span class="hljs-comment">      * æ’åºç±»å‹å¿…é¡»æ˜¯åœ¨1-7çš„èŒƒå›´å†…ï¼Œå¦åˆ™æ˜¯å‚æ•°é”™è¯¯</span><br><span class="hljs-comment">      */</span><br>     <span class="hljs-keyword">if</span> (rangeInDefined(searchSortType, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>)) &#123;<br>         sortByCondition(searchQueryBuilder, searchSortType);<br>     &#125;<br>     <span class="hljs-comment">/*</span><br><span class="hljs-comment">      * ä¸ç®¡æ˜¯ä»€ä¹ˆæ’åºç±»å‹ï¼Œæœ€åéƒ½è¦æŒ‰ç…§ç›¸å…³åº¦äºŒæ¬¡æ’åº</span><br><span class="hljs-comment">      */</span><br>     searchQueryBuilder.withSorts(SortBuilders.scoreSort().order(SortOrder.DESC));<br><br>     searchQueryBuilder.withQuery(functionScoreQueryBuilder);<br>     searchQueryBuilder.withHighlightFields(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.Field(<span class="hljs-string">&quot;title&quot;</span>));<br>     searchQueryBuilder.withHighlightFields(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.Field(<span class="hljs-string">&quot;author&quot;</span>));<br>     searchQueryBuilder.withHighlightFields(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.Field(<span class="hljs-string">&quot;publisherName&quot;</span>));<br>     searchQueryBuilder.withHighlightBuilder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>().preTags(<span class="hljs-string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>).postTags(<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>));<br><br>     <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">build</span> <span class="hljs-operator">=</span> searchQueryBuilder.build();<br><br>     <span class="hljs-comment">//æŸ¥è¯¢</span><br>     SearchHits&lt;EsProduct&gt; search = elasticsearchRestTemplate.search(build, EsProduct.class);<br>     <span class="hljs-comment">//å¾—åˆ°æŸ¥è¯¢è¿”å›çš„å†…å®¹</span><br>     List&lt;SearchHit&lt;EsProduct&gt;&gt; searchHits = search.getSearchHits();<br>     <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªæœ€åéœ€è¦è¿”å›çš„å®ä½“ç±»é›†åˆ</span><br>     List&lt;SearchDto&gt; accurateSearch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>     <span class="hljs-comment">//éå†è¿”å›çš„å†…å®¹è¿›è¡Œå¤„ç†</span><br>     <span class="hljs-keyword">for</span> (SearchHit&lt;EsProduct&gt; searchHit : searchHits) &#123;<br>         <span class="hljs-comment">//é«˜äº®çš„å†…å®¹</span><br>         Map&lt;String, List&lt;String&gt;&gt; highlightFields = searchHit.getHighlightFields();<br>         <span class="hljs-comment">//å°†é«˜äº®çš„å†…å®¹å¡«å……åˆ°contentä¸­</span><br>         searchHit.getContent().setTitle(highlightFields.get(<span class="hljs-string">&quot;title&quot;</span>) == <span class="hljs-literal">null</span> ? searchHit.getContent().getTitle() : highlightFields.get(<span class="hljs-string">&quot;title&quot;</span>).get(<span class="hljs-number">0</span>));<br>         searchHit.getContent().setAuthor(highlightFields.get(<span class="hljs-string">&quot;author&quot;</span>) == <span class="hljs-literal">null</span> ? searchHit.getContent().getAuthor() : highlightFields.get(<span class="hljs-string">&quot;author&quot;</span>).get(<span class="hljs-number">0</span>));<br>         searchHit.getContent().setPublisherName(highlightFields.get(<span class="hljs-string">&quot;publisherName&quot;</span>) == <span class="hljs-literal">null</span> ? searchHit.getContent().getPublisherName() : highlightFields.get(<span class="hljs-string">&quot;publisherName&quot;</span>).get(<span class="hljs-number">0</span>));<br>         <span class="hljs-comment">// å°é¢å›¾ç‰‡æ‹¼æ¥</span><br>         searchHit.getContent().setCoverPage(StringUtil.urlConnect(searchHit.getContent().getCoverPage(), StringUtil.PICTURE_TYPE_200));<br>         <span class="hljs-comment">//æ”¾åˆ°å®ä½“ç±»ä¸­</span><br>         accurateSearch.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchDto</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Search</span>(searchHit.getContent())));<br>     &#125;<br>     System.out.println(accurateSearch);<br>     <span class="hljs-keyword">return</span> accurateSearch;<br> &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ç”±äºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ElasticSearch7.8ï¼Œä¹‹å‰å­¦çš„æ˜¯6.8çš„è§†é¢‘ï¼Œå¤§éƒ¨åˆ†æ¦‚å¿µæ€§å†…å®¹åœ¨ElasticSearch6.8å·²ç»å†™è¿‡ï¼ˆåŸº</summary>
      
    
    
    
    <category term="Database" scheme="http://conquers.github.io/categories/Database/"/>
    
    <category term="ElasticSearch" scheme="http://conquers.github.io/categories/Database/ElasticSearch/"/>
    
    
    <category term="ElasticSearch" scheme="http://conquers.github.io/tags/ElasticSearch/"/>
    
    <category term="SpringData" scheme="http://conquers.github.io/tags/SpringData/"/>
    
    <category term="SpringBoot" scheme="http://conquers.github.io/tags/SpringBoot/"/>
    
    <category term="Java" scheme="http://conquers.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>å®‰è£…å¼€å‘è™šæ‹Ÿæœº</title>
    <link href="http://conquers.github.io/posts/cb06e7aa.html"/>
    <id>http://conquers.github.io/posts/cb06e7aa.html</id>
    <published>2022-07-20T08:09:50.000Z</published>
    <updated>2023-07-18T06:50:56.459Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1ã€å®‰è£…è™šæ‹Ÿæœº"><a href="#1ã€å®‰è£…è™šæ‹Ÿæœº" class="headerlink" title="1ã€å®‰è£…è™šæ‹Ÿæœº"></a>1ã€å®‰è£…è™šæ‹Ÿæœº</h3><ul><li>å®‰è£…VMware Workstation Proï¼š<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">VMware Workstation Pro | CN</a></li><li>å®‰è£…å…¶ä»–è™šæ‹Ÿæœºè½¯ä»¶</li></ul><h3 id="2ã€è™šæ‹Ÿæœºå®‰è£…æ“ä½œç³»ç»Ÿ"><a href="#2ã€è™šæ‹Ÿæœºå®‰è£…æ“ä½œç³»ç»Ÿ" class="headerlink" title="2ã€è™šæ‹Ÿæœºå®‰è£…æ“ä½œç³»ç»Ÿ"></a>2ã€è™šæ‹Ÿæœºå®‰è£…æ“ä½œç³»ç»Ÿ</h3><h4 id="2-1-CentOs"><a href="#2-1-CentOs" class="headerlink" title="2.1 CentOs"></a>2.1 CentOs</h4><h5 id="1-ä¸‹è½½CentOs"><a href="#1-ä¸‹è½½CentOs" class="headerlink" title="1.ä¸‹è½½CentOs"></a>1.ä¸‹è½½CentOs</h5><ul><li>CentOså®˜ç½‘ï¼š<a href="https://www.centos.org/download/">https://www.centos.org</a></li><li>é•œåƒä¸‹è½½åœ°å€ï¼š<a href="http://mirrors.ustc.edu.cn/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-DVD-2009.iso">iso.mirrors.ustc.edu.cn&#x2F;centos&#x2F;7.9.2009&#x2F;isos&#x2F;x86_64&#x2F;CentOS-7-x86_64-DVD-2009.iso</a></li></ul><h5 id="2-æ‰“å¼€VMwareï¼Œç‚¹å‡»æ–°å»ºè™šæ‹Ÿæœº"><a href="#2-æ‰“å¼€VMwareï¼Œç‚¹å‡»æ–°å»ºè™šæ‹Ÿæœº" class="headerlink" title="2.æ‰“å¼€VMwareï¼Œç‚¹å‡»æ–°å»ºè™šæ‹Ÿæœº"></a>2.æ‰“å¼€VMwareï¼Œç‚¹å‡»æ–°å»ºè™šæ‹Ÿæœº</h5><p><img src="/Resources/Pasted%20image%2020220720160950.png" alt="Resources/Pasted image 20220720160950.png"></p><h5 id="3-é€‰æ‹©å…¸å‹å®‰è£…"><a href="#3-é€‰æ‹©å…¸å‹å®‰è£…" class="headerlink" title="3.é€‰æ‹©å…¸å‹å®‰è£…"></a>3.é€‰æ‹©å…¸å‹å®‰è£…</h5><p><img src="/Resources/Pasted%20image%2020220720160957.png" alt="Resources/Pasted image 20220720160957.png"></p><h5 id="4-é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ"><a href="#4-é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ" class="headerlink" title="4.é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ"></a>4.é€‰æ‹©ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ</h5><p>ä¹Ÿå¯ä»¥é€‰æ‹©ç¬¬äºŒä¸ªï¼Œåªéœ€è¦æ‰¾åˆ°ä¸‹è½½å¥½çš„é•œåƒæ–‡ä»¶å°±è¡Œã€‚<br><img src="/Resources/Pasted%20image%2020220720161003.png" alt="Resources/Pasted image 20220720161003.png"></p><h5 id="5-é€‰æ‹©æ“ä½œç³»ç»Ÿ"><a href="#5-é€‰æ‹©æ“ä½œç³»ç»Ÿ" class="headerlink" title="5.é€‰æ‹©æ“ä½œç³»ç»Ÿ"></a>5.é€‰æ‹©æ“ä½œç³»ç»Ÿ</h5><p>è¿™é‡Œé€‰æ‹©Linuxï¼Œç‰ˆæœ¬æ ¹æ®é•œåƒè‡ªè¡Œå†³å®šï¼Œå› ä¸ºè¿™é‡Œå®‰è£…çš„æ˜¯CentOS 7 ï¼Œæ‰€ä»¥é€‰æ‹©CentOS 7 64ä½<br><img src="/Resources/Pasted%20image%2020220720161010.png" alt="Resources/Pasted image 20220720161010.png"></p><h5 id="6-è™šæ‹Ÿæœºå‘½å"><a href="#6-è™šæ‹Ÿæœºå‘½å" class="headerlink" title="6.è™šæ‹Ÿæœºå‘½å"></a>6.è™šæ‹Ÿæœºå‘½å</h5><p><img src="/Resources/Pasted%20image%2020220720161020.png" alt="Resources/Pasted image 20220720161020.png"></p><h5 id="7-æŒ‡å®šç£ç›˜å®¹é‡"><a href="#7-æŒ‡å®šç£ç›˜å®¹é‡" class="headerlink" title="7.æŒ‡å®šç£ç›˜å®¹é‡"></a>7.æŒ‡å®šç£ç›˜å®¹é‡</h5><p><img src="/Resources/Pasted%20image%2020220720161028.png" alt="Resources/Pasted image 20220720161028.png"></p><h5 id="8-è‡ªå®šä¹‰ç¡¬ä»¶"><a href="#8-è‡ªå®šä¹‰ç¡¬ä»¶" class="headerlink" title="8.è‡ªå®šä¹‰ç¡¬ä»¶"></a>8.è‡ªå®šä¹‰ç¡¬ä»¶</h5><p><img src="/Resources/Pasted%20image%2020220720161036.png" alt="Resources/Pasted image 20220720161036.png"><br><img src="/Resources/Pasted%20image%2020220720161103.png" alt="Resources/Pasted image 20220720161103.png"></p><p><img src="/Resources/Pasted%20image%2020220720161111.png" alt="Resources/Pasted image 20220720161111.png"></p><h5 id="9-å¼€å¯è™šæ‹Ÿæœº"><a href="#9-å¼€å¯è™šæ‹Ÿæœº" class="headerlink" title="9.å¼€å¯è™šæ‹Ÿæœº"></a>9.å¼€å¯è™šæ‹Ÿæœº</h5><p><img src="/Resources/Pasted%20image%2020220720161346.png" alt="Resources/Pasted image 20220720161346.png"></p><h5 id="10-ç³»ç»Ÿå®‰è£…"><a href="#10-ç³»ç»Ÿå®‰è£…" class="headerlink" title="10.ç³»ç»Ÿå®‰è£…"></a>10.ç³»ç»Ÿå®‰è£…</h5><p>å°†é¼ æ ‡ç‚¹å‡»è™šæ‹Ÿæœºä¸­çš„CentOS 7 ç³»ç»Ÿåï¼Œä½¿ç”¨é”®ç›˜çš„ä¸Šä¸‹é”®é€‰æ‹©æ‰§è¡Œä»»åŠ¡ï¼ŒæŒ‰å›è½¦ç¡®å®šã€‚</p><p><strong>ï¼ˆæ³¨ï¼šå®‰è£…è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œå¦‚æœé¼ æ ‡åœ¨è™šæ‹Ÿæœºå†…ï¼Œæ˜¯æ— æ³•ç§»åˆ°è™šæ‹Ÿæœºå¤–é¢çš„ï¼Œå³æ— æ³•ä½¿ç”¨é¼ æ ‡ä¸ç‰©ç†æœºè¿›è¡Œæ“ä½œçš„ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶æŒ‰ä½ctrl+altå¥é‡Šæ”¾é¼ æ ‡ï¼Œè¿™æ—¶ï¼Œå°±å¯ä»¥åœ¨ç‰©ç†æœºè¿›è¡Œæ“ä½œäº†ï¼‰</strong><br><img src="/Resources/Pasted%20image%2020220720161435.png" alt="Resources/Pasted image 20220720161435.png"></p><h5 id="11-é€‰æ‹©è¯­è¨€"><a href="#11-é€‰æ‹©è¯­è¨€" class="headerlink" title="11.é€‰æ‹©è¯­è¨€"></a>11.é€‰æ‹©è¯­è¨€</h5><p><img src="/Resources/Pasted%20image%2020220720161614.png" alt="Resources/Pasted image 20220720161614.png"></p><p><strong>11.è½¯ä»¶é€‰æ‹©</strong></p><p>é»˜è®¤ä¸ºæœ€å°å®‰è£…ï¼Œæœ€å°å®‰è£…çš„ç³»ç»Ÿæ˜¯dosç•Œé¢ï¼ˆåªæœ‰å‘½ä»¤è¡Œçš„ç•Œé¢ï¼Œå’Œcmdä¸€æ ·ï¼‰</p><p><strong>12.å®‰è£…ä½ç½®</strong><br><img src="/Resources/Pasted%20image%2020220720161755.png" alt="Resources/Pasted image 20220720161755.png"><br><img src="/Resources/Pasted%20image%2020220720161845.png" alt="Resources/Pasted image 20220720161845.png"></p><h5 id="12-rootå¯†ç å’Œåˆ›å»ºæ™®é€šç”¨æˆ·"><a href="#12-rootå¯†ç å’Œåˆ›å»ºæ™®é€šç”¨æˆ·" class="headerlink" title="12.rootå¯†ç å’Œåˆ›å»ºæ™®é€šç”¨æˆ·"></a>12.rootå¯†ç å’Œåˆ›å»ºæ™®é€šç”¨æˆ·</h5><p><img src="/Resources/Pasted%20image%2020220720162004.png" alt="Resources/Pasted image 20220720162004.png"><br><img src="/Resources/Pasted%20image%2020220720161943.png" alt="Resources/Pasted image 20220720161943.png"></p><p>å®Œæˆåç­‰å¾…<br><img src="/Resources/Pasted%20image%2020220720162027.png" alt="Resources/Pasted image 20220720162027.png"><br><img src="/Resources/Pasted%20image%2020220720162323.png" alt="Resources/Pasted image 20220720162323.png"></p><h5 id="13-ä½¿ç”¨åˆšåˆšè®¾ç½®çš„å¯†ç å³å¯ç™»å½•"><a href="#13-ä½¿ç”¨åˆšåˆšè®¾ç½®çš„å¯†ç å³å¯ç™»å½•" class="headerlink" title="13.ä½¿ç”¨åˆšåˆšè®¾ç½®çš„å¯†ç å³å¯ç™»å½•"></a>13.ä½¿ç”¨åˆšåˆšè®¾ç½®çš„å¯†ç å³å¯ç™»å½•</h5><p><img src="/Resources/Pasted%20image%2020220720162500.png" alt="Resources/Pasted image 20220720162500.png"></p><h3 id="3ã€SSHè¿æ¥è™šæ‹Ÿæœº"><a href="#3ã€SSHè¿æ¥è™šæ‹Ÿæœº" class="headerlink" title="3ã€SSHè¿æ¥è™šæ‹Ÿæœº"></a>3ã€SSHè¿æ¥è™šæ‹Ÿæœº</h3><h4 id="è™šæ‹Ÿæœºå¼€å¯ç½‘å¡"><a href="#è™šæ‹Ÿæœºå¼€å¯ç½‘å¡" class="headerlink" title="è™šæ‹Ÿæœºå¼€å¯ç½‘å¡"></a>è™šæ‹Ÿæœºå¼€å¯ç½‘å¡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip addr<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220720163319.png" alt="Resources/Pasted image 20220720163319.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/sysconfig/network-scripts/ifcfg-ens33<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220720163216.png" alt="Resources/Pasted image 20220720163216.png"><br><img src="/Resources/Pasted%20image%2020220720163235.png" alt="Resources/Pasted image 20220720163235.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo service network restart<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220720163357.png" alt="Resources/Pasted image 20220720163357.png"></p><h4 id="æŸ¥çœ‹è™šæ‹Ÿæœºçš„ip"><a href="#æŸ¥çœ‹è™šæ‹Ÿæœºçš„ip" class="headerlink" title="æŸ¥çœ‹è™šæ‹Ÿæœºçš„ip"></a>æŸ¥çœ‹è™šæ‹Ÿæœºçš„ip</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip addr<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220720164333.png" alt="Resources/Pasted image 20220720164333.png"></p><h4 id="ä½¿ç”¨Xshellè¿æ¥è™šæ‹Ÿæœº"><a href="#ä½¿ç”¨Xshellè¿æ¥è™šæ‹Ÿæœº" class="headerlink" title="ä½¿ç”¨Xshellè¿æ¥è™šæ‹Ÿæœº"></a>ä½¿ç”¨Xshellè¿æ¥è™šæ‹Ÿæœº</h4><p>å®˜ç½‘ï¼š<a href="https://www.xshell.com/zh/free-for-home-school/">å®¶åº­&#x2F;å­¦æ ¡å…è´¹ - NetSarang Website (xshell.com)</a></p><p><img src="/Resources/Pasted%20image%2020220720164345.png" alt="Resources/Pasted image 20220720164345.png"></p><h4 id="ä½¿ç”¨Final-Shellè¿æ¥è™šæ‹Ÿæœº"><a href="#ä½¿ç”¨Final-Shellè¿æ¥è™šæ‹Ÿæœº" class="headerlink" title="ä½¿ç”¨Final Shellè¿æ¥è™šæ‹Ÿæœº"></a>ä½¿ç”¨Final Shellè¿æ¥è™šæ‹Ÿæœº</h4><p>å®˜ç½‘ï¼š<a href="http://www.hostbuf.com/t/988.html">FinalShell SSHå·¥å…·,æœåŠ¡å™¨ç®¡ç†,è¿œç¨‹æ¡Œé¢åŠ é€Ÿè½¯ä»¶,æ”¯æŒWindows,macOS,Linux,ç‰ˆæœ¬3.9.8,æ›´æ–°æ—¶é—´2023.1.30 - SSHå·¥å…· SSHå®¢æˆ·ç«¯ (hostbuf.com)</a></p><p><strong>è¿æ¥æˆåŠŸ</strong></p><p><img src="/Resources/image-20230415205209311.png" alt="image-20230415205209311"></p><h4 id="å›ºå®šè™šæ‹Ÿæœºçš„ip"><a href="#å›ºå®šè™šæ‹Ÿæœºçš„ip" class="headerlink" title="å›ºå®šè™šæ‹Ÿæœºçš„ip"></a>å›ºå®šè™šæ‹Ÿæœºçš„ip</h4><h5 id="ä¸€ã€æ­å»ºVMnet8è™šæ‹Ÿå±€åŸŸç½‘"><a href="#ä¸€ã€æ­å»ºVMnet8è™šæ‹Ÿå±€åŸŸç½‘" class="headerlink" title="ä¸€ã€æ­å»ºVMnet8è™šæ‹Ÿå±€åŸŸç½‘"></a>ä¸€ã€æ­å»ºVMnet8è™šæ‹Ÿå±€åŸŸç½‘</h5><p>æ‰“å¼€VMwareè½¯ä»¶ï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œç‚¹å‡»åˆ—è¡¨ä¸­çš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨<br>è¿›å…¥è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨é¡µé¢<br>ç‚¹å‡»å³ä¸‹è§’æ›´æ”¹è®¾ç½®ï¼Œé€‰æ‹©VMnet8ã€‚<br><img src="/Resources/Pasted%20image%2020220729152928.png" alt="Resources/Pasted image 20220729152928.png"><br><img src="/Resources/Pasted%20image%2020220729152957.png" alt="Resources/Pasted image 20220729152957.png"><br><img src="/Resources/Pasted%20image%2020220729153059.png"></p><ul><li>é€‰æ‹©NATæ¨¡å¼</li><li>å‹¾é€‰å°†ä¸»æœºè™šæ‹Ÿé€‚é…å™¨è¿æ¥åˆ°æ­¤ç½‘ç»œ</li><li>å–æ¶ˆDHCPæœåŠ¡</li></ul><p>ç‚¹å‡»NATæ¨¡å¼åé¢çš„<strong>NATè®¾ç½®</strong>ã€‚</p><p><img src="/Resources/Pasted%20image%2020220729153453.png"><br>è®¾ç½®<strong>é»˜è®¤ç½‘å…³</strong>ï¼ˆåé¢ä¼šç”¨åˆ°ï¼‰ï¼Œè¯¥ç½‘å…³éœ€è¦å ç”¨ä½ åˆ’åˆ†çš„å­ç½‘é‡Œé¢çš„ä¸€ä¸ªIPåœ°å€ï¼Œå¹¶ä¸”ç½‘å…³å ç”¨ä¹‹åï¼Œä¸èƒ½å†åˆ’åˆ†ç»™è¯¥ç½‘ç»œå†…å…¶ä»–ä¸»æœºã€‚åŒ…æ‹¬å®¿ä¸»æœºå’Œè™šæ‹Ÿæœºã€‚è®°ä½è¯¥ç½‘å…³åœ°å€ï¼Œåœ¨é…ç½®å®¿ä¸»æœºçš„VMnet8ç½‘å¡æ—¶éœ€è¦æŒ‡å®šï¼Œæ·»åŠ ä¸€å°æ–°çš„è™šæ‹Ÿæœºåˆ°è¯¥ç½‘ç»œæ—¶åŒæ ·éœ€è¦æŒ‡å®šã€‚</p><h5 id="äºŒã€ä½¿ç”¨é…ç½®VMnet8è™šæ‹Ÿç½‘å¡"><a href="#äºŒã€ä½¿ç”¨é…ç½®VMnet8è™šæ‹Ÿç½‘å¡" class="headerlink" title="äºŒã€ä½¿ç”¨é…ç½®VMnet8è™šæ‹Ÿç½‘å¡"></a>äºŒã€ä½¿ç”¨é…ç½®VMnet8è™šæ‹Ÿç½‘å¡</h5><p>å®‰è£…VMwareè½¯ä»¶ä¹‹åï¼Œå°±ä¼šæœ‰VMnet8è¿™ä¸ªè™šæ‹Ÿç½‘å¡ã€‚è¿›å…¥æˆ‘ä»¬è‡ªå·±ç”µè„‘çš„<strong>ç½‘ç»œå’ŒInternetè®¾ç½®</strong>(å³å‡»ç½‘ç»œå›¾æ ‡)ï¼Œè¿›å…¥æ›´å¤šç½‘ç»œé€‚é…å™¨é¡µé¢<br><img src="/Resources/Pasted%20image%2020220729153219.png"></p><p>å°±å¯ä»¥çœ‹åˆ°VMnet8è¿™ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œæˆ‘ä»¬é¦–å…ˆé…ç½®ä¸€ä¸‹ç½‘å¡å‚æ•°ã€‚å³å‡»VMnet8ç½‘å¡ï¼Œé€‰æ‹©å±æ€§ï¼ŒåŒå‡»IPv4åè®®è¿›å…¥ç¼–è¾‘é¡µé¢ã€‚</p><p><strong>é»˜è®¤ç½‘å…³é€‰æ‹©åˆšåˆšåœ¨VMä¸­å¡«å†™çš„ç½‘å…³ã€‚</strong></p><blockquote><p>:ä¸‹é¢ä¸å¤ªæ¸…æ¥šipåœ°å€éšä¾¿è®¾äº†ä¸€ä¸ª2ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ<br><del>IPåœ°å€ï¼šè¿™ä¸ªåœ°æ–¹è®¾ç½®çš„IPåœ°å€ï¼Œæ˜¯å®¿ä¸»æœºè®¿é—®VMnet8å±€åŸŸç½‘å†…è™šæ‹Ÿæœºæ—¶ï¼Œå®¿ä¸»æœºä½¿ç”¨çš„IPåœ°å€ï¼Œä»£è¡¨å®¿ä¸»æœºåœ¨VMnet8è™šæ‹Ÿç½‘ç»œä¸­çš„åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä»–å¹¶ä¸æ˜¯ç½‘å…³ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨å·²ç»åˆ†é…ç»™ç½‘å…³çš„åœ°å€ã€‚å®ƒéœ€è¦å•ç‹¬å ç”¨ä¸€ä¸ªVMnet8å±€åŸŸç½‘å†…çš„ä¸»æœºåœ°å€ï¼Œä¾›å®¿ä¸»æœºä½¿ç”¨ã€‚è®©VMnet8ç½‘ç»œä¸­çš„è™šæ‹Ÿæœºå¯ä»¥çœ‹åˆ°å®¿ä¸»æœºï¼Œå®¿ä¸»æœºä¹Ÿå¯ä»¥çœ‹åˆ°è™šæ‹Ÿæœºã€‚</del></p></blockquote><p><img src="/Resources/Pasted%20image%2020220729160532.png"></p><p><img src="/Resources/Pasted%20image%2020230414094919.png"></p><h5 id="ä¸‰ã€é…ç½®è™šæ‹Ÿæœºç½‘å¡"><a href="#ä¸‰ã€é…ç½®è™šæ‹Ÿæœºç½‘å¡" class="headerlink" title="ä¸‰ã€é…ç½®è™šæ‹Ÿæœºç½‘å¡"></a>ä¸‰ã€é…ç½®è™šæ‹Ÿæœºç½‘å¡</h5><p>IP addræŸ¥çœ‹ç½‘å¡åç§°<br><img src="/Resources/Pasted%20image%2020220729161206.png"></p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/sysconfig/network-scripts/ifcfg-ens33<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220729155603.png"></p><blockquote><p>éœ€è¦åŠ ä¸ŠDNS1&#x3D;114.114.114.114, DNS2&#x3D;8.8.8.8ï¼Œä¸ç„¶ä¼šå‡ºç°æŸäº›é—®é¢˜<strong>ï¼ˆä½¿ç”¨dockerï¼Œå¿…é¡»è¦åšè¿™ä¸€æ­¥ï¼Œdockeræ‹‰å–é•œåƒå¤±è´¥ï¼‰</strong></p></blockquote><p>é‡å¯ç½‘ç»œ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart network</span><br></code></pre></td></tr></table></figure><p>å®¿ä¸»æœºè™šæ‹Ÿæœºç›¸äº’ping<br>windowsï¼šæŸ¥çœ‹ipï¼š<code>ipconfig</code><br>centOsï¼šæŸ¥çœ‹ipï¼š<code>ip addr</code></p><h4 id="ipå¤±æ•ˆ"><a href="#ipå¤±æ•ˆ" class="headerlink" title="ipå¤±æ•ˆ"></a>ipå¤±æ•ˆ</h4><p>å°è¯•é‡å¯ç½‘ç»œæŠ¥é”™<br><img src="/Resources/Pasted%20image%2020220817162203.png"></p><blockquote><p>å‚è€ƒè¿æ¥ï¼š<a href="https://blog.csdn.net/VariatioZbw/article/details/107482739">è§£å†³ Linux ç½‘ç»œ â€œJob for network.service failed because the control process exiteâ€é—®é¢˜_zhangbw~çš„åšå®¢-CSDNåšå®¢</a><br><code>service NetworkManager stop</code> è§£å†³</p></blockquote><blockquote><p>VMware ä¸»æœºpingä¸é€šè™šæ‹Ÿæœºçš„è§£å†³æ–¹æ³• ï¼ˆä½†æ˜¯è™šæ‹Ÿæœºå¯ä»¥pingä¸»æœºï¼‰</p></blockquote><p>é‡å¯ä¸€ä¸‹vm net8ç½‘å¡<br><img src="/Resources/Pasted%20image%2020230413232524.png"></p><h3 id="4ã€è™šæ‹Ÿæœºå®‰è£…Java"><a href="#4ã€è™šæ‹Ÿæœºå®‰è£…Java" class="headerlink" title="4ã€è™šæ‹Ÿæœºå®‰è£…Java"></a>4ã€è™šæ‹Ÿæœºå®‰è£…Java</h3><h4 id="å¯åŠ¨è™šæ‹Ÿæœº"><a href="#å¯åŠ¨è™šæ‹Ÿæœº" class="headerlink" title="å¯åŠ¨è™šæ‹Ÿæœº"></a>å¯åŠ¨è™šæ‹Ÿæœº</h4><p>CentOSç³»ç»Ÿé»˜è®¤å®‰è£…äº†openjdkçš„(å¦‚æœæ“ä½œç³»ç»Ÿä¸æ˜¯æœ€å°å®‰è£…)ï¼Œéœ€è¦å¸è½½ã€‚<br><a href="https://www.cnblogs.com/insomina/p/15701444.html">CentOSå®‰è£…Java JDK - å­éé±¼ç¬äº¦éæˆ‘ - åšå®¢å›­</a></p><h4 id="ä½¿ç”¨rpmå®‰è£…"><a href="#ä½¿ç”¨rpmå®‰è£…" class="headerlink" title="ä½¿ç”¨rpmå®‰è£…"></a>ä½¿ç”¨rpmå®‰è£…</h4><p><a href="https://www.oracle.com/java/technologies/downloads/#java8">Java Downloads | Oracle</a><br><img src="/Resources/Pasted%20image%2020220720154430.png" alt="Resources/Pasted image 20220720154430.png"></p><h5 id="1ã€ä¸‹è½½é•œåƒ"><a href="#1ã€ä¸‹è½½é•œåƒ" class="headerlink" title="1ã€ä¸‹è½½é•œåƒ"></a>1ã€ä¸‹è½½é•œåƒ</h5><h5 id="2ã€åˆ›å»ºç›®å½•"><a href="#2ã€åˆ›å»ºç›®å½•" class="headerlink" title="2ã€åˆ›å»ºç›®å½•"></a>2ã€åˆ›å»ºç›®å½•</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/local<br><span class="hljs-built_in">mkdir</span> java<br><span class="hljs-built_in">cd</span> java<br></code></pre></td></tr></table></figure><h5 id="3ã€ä¼ è¾“é•œåƒè‡³è™šæ‹Ÿæœº"><a href="#3ã€ä¼ è¾“é•œåƒè‡³è™šæ‹Ÿæœº" class="headerlink" title="3ã€ä¼ è¾“é•œåƒè‡³è™šæ‹Ÿæœº"></a>3ã€ä¼ è¾“é•œåƒè‡³è™šæ‹Ÿæœº</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># windowså‘linuxè™šæ‹Ÿæœºä¼ è¾“æ–‡ä»¶</span><br>yum install lrzsz -y<br><br>rz<br></code></pre></td></tr></table></figure><h5 id="4ã€ä½¿ç”¨RPMå®‰è£…é•œåƒ"><a href="#4ã€ä½¿ç”¨RPMå®‰è£…é•œåƒ" class="headerlink" title="4ã€ä½¿ç”¨RPMå®‰è£…é•œåƒ"></a>4ã€ä½¿ç”¨RPMå®‰è£…é•œåƒ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">rpm -ivh jdk-8u341-linux-x64.rpm<br><span class="hljs-comment"># å®‰è£…åçš„è·¯å¾„ä¸º: /usr/java/jdk1.8.0_341-amd64</span><br><span class="hljs-comment"># -i = install</span><br><span class="hljs-comment"># vh = æ˜¾ç¤ºå®‰è£…è¿›åº¦</span><br></code></pre></td></tr></table></figure><h5 id="5ã€é…ç½®ç¯å¢ƒå˜é‡"><a href="#5ã€é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="5ã€é…ç½®ç¯å¢ƒå˜é‡"></a>5ã€é…ç½®ç¯å¢ƒå˜é‡</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/profile<br><br>JAVA_HOME=/usr/local/java//usr/java/jdk1.8.0_341-amd64<br>CLASSPATH=.:%JAVA_HOME%/lib:%JAVA_HOME%/jre/lib<br>PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$JAVA_HOME</span>/jre/bin<br><span class="hljs-built_in">export</span> PATH CLASSPATH JAVA_HOME<br></code></pre></td></tr></table></figure><h5 id="6ã€sourceè®©æ–°å¢ç¯å¢ƒç”Ÿæ•ˆ"><a href="#6ã€sourceè®©æ–°å¢ç¯å¢ƒç”Ÿæ•ˆ" class="headerlink" title="6ã€sourceè®©æ–°å¢ç¯å¢ƒç”Ÿæ•ˆ"></a>6ã€sourceè®©æ–°å¢ç¯å¢ƒç”Ÿæ•ˆ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h5 id="7ã€æµ‹è¯•java-version"><a href="#7ã€æµ‹è¯•java-version" class="headerlink" title="7ã€æµ‹è¯•java -version"></a>7ã€æµ‹è¯•java -version</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">java version <span class="hljs-string">&quot;1.8.0_341&quot;</span><br>Java(TM) SE Runtime Environment (build 1.8.0_341-b10)<br>Java HotSpot(TM) 64-Bit Server VM (build 25.341-b10, mixed mode)<br></code></pre></td></tr></table></figure><hr><p>ä»¥ä¸‹æ˜¯åºŸå¼ƒæ–¹æ¡ˆ</p><p><del>ä½¿ç”¨yumå®‰è£…</del><br>å®‰è£…jdk</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install java-1.8.0-openjdk java-1.8.0-openjdk-devel<br></code></pre></td></tr></table></figure><blockquote><p>java-1.8.0-openjdkï¼šåªæœ‰è¿è¡Œç¯å¢ƒï¼Œjavaå®‰è£…ç›®å½•ä¸‹åªæœ‰jreæ–‡ä»¶å¤¹<br>java-1.8.0-openjdk-develï¼šå¼€å‘ç¯å¢ƒ<br>å‚è€ƒï¼š<a href="https://blog.csdn.net/woshimeihuo/article/details/90608081">Fetching Title#ytt6</a></p></blockquote><p>é…ç½®ç¯å¢ƒå˜é‡</p><figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs profile"># java_homeçš„è·¯å¾„å¯èƒ½ä¸åŒï¼Œéœ€è¦åˆ°ä½ ç”µè„‘é‡Œçš„ä½ç½®ï¼Œjava_homeçš„è·¯å¾„ä¸€èˆ¬åœ¨/usr/lib/jvm/ï¼Œæ–‡ä»¶çš„åå­—å¯èƒ½ä¸åŒï¼Œæ”¹æˆä½ é‡Œé¢çš„åå­—å°±å¥½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br>export JAVA_HOME=/usr/lib/jvm/java<span class="hljs-number">-1.8</span><span class="hljs-number">.0</span>-openjdk<span class="hljs-number">-1.8</span><span class="hljs-number">.0</span><span class="hljs-number">.121</span><span class="hljs-number">-0.</span>b13.el7_3.x86_64<br><br>export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar<br> <br>export PATH=$PATH:$JAVA_HOME/bin<br></code></pre></td></tr></table></figure><p>ä¿å­˜å…³é—­åï¼Œæ‰§è¡Œå‘½ä»¤è®©è®¾ç½®ç«‹å³ç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><h3 id="5ã€è™šæ‹Ÿæœºå®‰è£…git"><a href="#5ã€è™šæ‹Ÿæœºå®‰è£…git" class="headerlink" title="5ã€è™šæ‹Ÿæœºå®‰è£…git"></a>5ã€è™šæ‹Ÿæœºå®‰è£…git</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£…git</span><br>yum -y install git<br></code></pre></td></tr></table></figure><h3 id="6ã€è™šæ‹Ÿæœºå®‰è£…Docker"><a href="#6ã€è™šæ‹Ÿæœºå®‰è£…Docker" class="headerlink" title="6ã€è™šæ‹Ÿæœºå®‰è£…Docker"></a>6ã€è™šæ‹Ÿæœºå®‰è£…Docker</h3><h4 id="åœ¨CentOsä¸Šå®‰è£…Docker"><a href="#åœ¨CentOsä¸Šå®‰è£…Docker" class="headerlink" title="åœ¨CentOsä¸Šå®‰è£…Docker"></a>åœ¨CentOsä¸Šå®‰è£…Docker</h4><ul><li><p><a href="https://docs.docker.com/engine/install/centos/">Install Docker Engine on CentOS | Docker Documentation</a></p></li><li><p>å¸è½½åŸå§‹docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum remove docker \<br>                docker-client \<br>                docker-client-latest \<br>                docker-common \<br>                docker-latest \<br>                docker-latest-logrotate \<br>                docker-logrotate \<br>                docker-engine<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y yum-utils<br></code></pre></td></tr></table></figure><p> é‰´äºå›½å†…ç½‘ç»œé—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å›½å†…æºï¼Œå®˜æ–¹æºè¯·åœ¨æ³¨é‡Šä¸­æŸ¥çœ‹ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ·»åŠ Â <code>yum</code>Â è½¯ä»¶æºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum-config-manager \<br>    --add-repo \<br>    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27;</span> /etc/yum.repos.d/docker-ce.repo<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®˜æ–¹æº</span><br><span class="hljs-comment"># $ sudo yum-config-manager \</span><br><span class="hljs-comment">#     --add-repo \</span><br><span class="hljs-comment">#     https://download.docker.com/linux/centos/docker-ce.repo</span><br></code></pre></td></tr></table></figure></li><li><p>æ›´æ–°Â <code>yum</code>Â è½¯ä»¶æºç¼“å­˜ï¼Œå¹¶å®‰è£…Â <code>docker-ce</code>ã€‚</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ Docker</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> docker<br>systemctl start docker<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯• Docker æ˜¯å¦å®‰è£…æ­£ç¡®</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --<span class="hljs-built_in">rm</span> hello-world<br><br>Unable to find image <span class="hljs-string">&#x27;hello-world:latest&#x27;</span> locally<br>latest: Pulling from library/hello-world<br>b8dfde127a29: Pull complete<br>Digest: sha256:308866a43596e83578c7dfa15e27a73011bdd402185a84c5cd7f32a88b501a24<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> hello-world:latest<br><br>Hello from Docker!<br>This message shows that your installation appears to be working correctly.<br><br>To generate this message, Docker took the following steps:<br> 1. The Docker client contacted the Docker daemon.<br> 2. The Docker daemon pulled the <span class="hljs-string">&quot;hello-world&quot;</span> image from the Docker Hub.<br>    (amd64)<br> 3. The Docker daemon created a new container from that image <span class="hljs-built_in">which</span> runs the<br>    executable that produces the output you are currently reading.<br> 4. The Docker daemon streamed that output to the Docker client, <span class="hljs-built_in">which</span> sent it<br>    to your terminal.<br><br>To try something more ambitious, you can run an Ubuntu container with:<br> $ docker run -it ubuntu bash<br><br>Share images, automate workflows, and more with a free Docker ID:<br> https://hub.docker.com/<br><br>For more examples and ideas, visit:<br> https://docs.docker.com/get-started/<br></code></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œdocker runå‘½ä»¤å¸¦<code>--rm</code>å‘½ä»¤é€‰é¡¹ï¼Œç­‰ä»·äºåœ¨å®¹å™¨é€€å‡ºåï¼Œæ‰§è¡Œ<code>docker rm -v</code><br>  è‹¥èƒ½æ­£å¸¸è¾“å‡ºä»¥ä¸Šä¿¡æ¯ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</p></blockquote></li></ul><h4 id="é…ç½®dockeré•œåƒåŠ é€ŸæœåŠ¡"><a href="#é…ç½®dockeré•œåƒåŠ é€ŸæœåŠ¡" class="headerlink" title="é…ç½®dockeré•œåƒåŠ é€ŸæœåŠ¡"></a>é…ç½®dockeré•œåƒåŠ é€ŸæœåŠ¡</h4><p> é˜¿é‡Œäº‘ - æ§åˆ¶å° - å®¹å™¨é•œåƒæœåŠ¡</p><p><img src="/Resources/image-20230601151355484.png" alt="image-20230601151355484"></p><p>ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤<br><img src="/Resources/image-20230601151421570.png" alt="image-20230601151421570"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /etc/docker<br><span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://åœ°å€.mirror.aliyuncs.com&quot;</span>]<br>&#125;<br>EOF<br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>docker info</code> ç¡®è®¤æ˜¯å¦æˆåŠŸ</p><h4 id="docker-å®‰è£…å®¹å™¨"><a href="#docker-å®‰è£…å®¹å™¨" class="headerlink" title="docker å®‰è£…å®¹å™¨"></a>docker å®‰è£…å®¹å™¨</h4><p><a href="https://conquers.github.io/posts/dcb3f659.html">Docker å®‰è£…å®¹å™¨åˆé›†</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1ã€å®‰è£…è™šæ‹Ÿæœº&quot;&gt;&lt;a href=&quot;#1ã€å®‰è£…è™šæ‹Ÿæœº&quot; class=&quot;headerlink&quot; title=&quot;1ã€å®‰è£…è™šæ‹Ÿæœº&quot;&gt;&lt;/a&gt;1ã€å®‰è£…è™šæ‹Ÿæœº&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å®‰è£…VMware Workstation Proï¼š&lt;a href=&quot;https://ww</summary>
      
    
    
    
    
    <category term="è™šæ‹Ÿæœº" scheme="http://conquers.github.io/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch 6.xä½¿ç”¨æ•™ç¨‹</title>
    <link href="http://conquers.github.io/posts/d5bb74c6.html"/>
    <id>http://conquers.github.io/posts/d5bb74c6.html</id>
    <published>2022-07-19T03:31:39.000Z</published>
    <updated>2023-07-18T02:37:49.408Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><p><img src="/Resources/elastic.png"></p><h2 id="ğŸ›¬å…¨æ–‡æ£€ç´¢"><a href="#ğŸ›¬å…¨æ–‡æ£€ç´¢" class="headerlink" title="ğŸ›¬å…¨æ–‡æ£€ç´¢"></a>ğŸ›¬å…¨æ–‡æ£€ç´¢</h2><p><strong>å…¨æ–‡æ£€ç´¢</strong>æ˜¯è®¡ç®—æœºç¨‹åºé€šè¿‡<strong>æ‰«æ</strong>æ–‡ç« ä¸­çš„æ¯ä¸€ä¸ªè¯ï¼Œå¯¹æ¯ä¸€ä¸ªè¯<strong>å»ºç«‹</strong>ä¸€ä¸ªç´¢å¼•ï¼ŒæŒ‡æ˜è¯¥è¯åœ¨æ–‡ç« ä¸­å‡ºç°çš„<strong>æ¬¡æ•°</strong>å’Œ<strong>ä½ç½®</strong>ã€‚å½“ç”¨æˆ·æŸ¥è¯¢æ—¶æ ¹æ®å»ºç«‹çš„ç´¢å¼•æŸ¥æ‰¾ï¼Œç±»ä¼¼äºé€šè¿‡å­—å…¸çš„æ£€ç´¢å­—è¡¨æŸ¥å­—çš„è¿‡ç¨‹ã€‚</p><p>æ£€ç´¢ï¼š</p><ul><li>ç´¢ï¼š(<em>å»ºç«‹</em> ç´¢å¼•) </li><li>æ£€ï¼š(<em>æ£€ç´¢</em> ç´¢å¼•)</li></ul><p>å…¨æ–‡æ£€ç´¢ï¼ˆFull-Text Retrieval(æ£€ç´¢ï¼‰ï¼‰ä»¥æ–‡æœ¬ä½œä¸ºæ£€ç´¢å¯¹è±¡ï¼Œæ‰¾å‡ºå«æœ‰æŒ‡å®šè¯æ±‡çš„æ–‡æœ¬ã€‚<strong>å…¨é¢ã€å‡†ç¡®å’Œå¿«é€Ÿæ˜¯è¡¡é‡å…¨æ–‡æ£€ç´¢ç³»ç»Ÿçš„å…³é”®æŒ‡æ ‡ã€‚</strong></p><p>å…³äºå…¨æ–‡æ£€ç´¢ï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼š</p><ol><li><p>åªå¤„ç†<em>æ–‡æœ¬</em>ã€‚</p></li><li><p>ä¸å¤„ç†<em>è¯­ä¹‰</em>ã€‚</p></li><li><p>æœç´¢æ—¶è‹±æ–‡<em>ä¸åŒºåˆ†å¤§å°å†™</em>ã€‚</p></li><li><p>ç»“æœåˆ—è¡¨æœ‰<em>ç›¸å…³åº¦æ’åº</em>ã€‚</p></li></ol><hr><h2 id="ğŸšElastic-Search"><a href="#ğŸšElastic-Search" class="headerlink" title="ğŸšElastic Search"></a>ğŸšElastic Search</h2><p><img src="/Resources/Pasted%20image%2020220720115306.png" alt="Resources/Pasted image 20220720115306.png"><br>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://www.elastic.co/cn/">å…è´¹ä¸”å¼€æ”¾çš„æœç´¢ï¼šElasticsearchã€ELK å’Œ Kibana çš„å¼€å‘è€… | Elastic</a><br>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/index.html">Elasticsearch Guide | Elastic</a></p><p><strong>ElasticSearch</strong> ç®€ç§° <em>ES</em> ï¼Œæ˜¯<strong>åŸºäºApache Luceneæ„å»ºçš„å¼€æºæœç´¢å¼•æ“ï¼Œæ˜¯å½“å‰æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“ã€‚</strong>Luceneæœ¬èº«å°±å¯ä»¥è¢«è®¤ä¸ºè¿„ä»Šä¸ºæ­¢æ€§èƒ½æœ€å¥½çš„ä¸€æ¬¾å¼€æºæœç´¢å¼•æ“å·¥å…·åŒ…ï¼Œä½†æ˜¯Luceneçš„APIç›¸å¯¹å¤æ‚ï¼Œéœ€è¦æ·±åšçš„æœç´¢ç†è®ºã€‚å¾ˆéš¾é›†æˆåˆ°å®é™…çš„åº”ç”¨ä¸­å»ã€‚<strong>ä½†æ˜¯ESæ˜¯é‡‡ç”¨javaè¯­è¨€ç¼–å†™ï¼Œæä¾›äº†ç®€å•æ˜“ç”¨çš„RestFul APIï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å…¶ç®€å•çš„RestFul APIï¼Œå¼€å‘ç›¸å…³çš„æœç´¢åŠŸèƒ½ï¼Œä»è€Œé¿å…Luceneçš„å¤æ‚æ€§ã€‚</strong></p><h3 id="ESçš„åº”ç”¨åœºæ™¯"><a href="#ESçš„åº”ç”¨åœºæ™¯" class="headerlink" title="ESçš„åº”ç”¨åœºæ™¯"></a>ESçš„åº”ç”¨åœºæ™¯</h3><p><strong>ESä¸»è¦ä»¥è½»é‡çº§JSONä½œä¸ºæ•°æ®å­˜å‚¨æ ¼å¼ï¼Œè¿™ç‚¹ä¸MongoDBæœ‰ç‚¹ç±»ä¼¼ï¼Œä½†å®ƒåœ¨è¯»å†™æ€§èƒ½ä¸Šä¼˜äº MongoDB ã€‚åŒæ—¶ä¹Ÿæ”¯æŒåœ°ç†ä½ç½®æŸ¥è¯¢ï¼Œè¿˜æ–¹ä¾¿åœ°ç†ä½ç½®å’Œæ–‡æœ¬æ··åˆæŸ¥è¯¢ ã€‚ ä»¥åŠåœ¨ç»Ÿè®¡ã€æ—¥å¿—ç±»æ•°æ®å­˜å‚¨å’Œåˆ†æã€å¯è§†åŒ–è¿™æ–¹é¢æ˜¯å¼•é¢†è€…ã€‚</strong></p><ul><li><p>å›½å¤–:<br><em>Wikipedia</em>(ç»´åŸºç™¾ç§‘)ä½¿ç”¨ESæä¾›å…¨æ–‡æœç´¢å¹¶é«˜äº®å…³é”®å­—ã€<em>StackOverflow</em>(ITé—®ç­”ç½‘ç«™)ç»“åˆå…¨æ–‡æœç´¢ä¸åœ°ç†ä½ç½®æŸ¥è¯¢ã€<em>Github</em>ä½¿ç”¨Elasticsearchæ£€ç´¢1300äº¿è¡Œçš„ä»£ç ã€‚</p></li><li><p>å›½å†…:<br>ç™¾åº¦(åœ¨äº‘åˆ†æã€ç½‘ç›Ÿã€é¢„æµ‹ã€æ–‡åº“ã€é’±åŒ…ã€é£æ§ç­‰ä¸šåŠ¡ä¸Šéƒ½åº”ç”¨äº†ESï¼Œå•é›†ç¾¤æ¯å¤©å¯¼å…¥30TB+æ•°æ®ï¼Œ æ€»å…±æ¯å¤©60TB+)ã€æ–°æµª ã€é˜¿é‡Œå·´å·´ã€è…¾è®¯ç­‰å…¬å¸å‡æœ‰å¯¹ESçš„ä½¿ç”¨ã€‚</p></li></ul><p>&#x3D;&#x3D;ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å¹³å°ELK(ElasticSearch, Logstash, Kibana)ã€‚&#x3D;&#x3D;</p><hr><h2 id="ğŸªå®‰è£…ElasticSearch"><a href="#ğŸªå®‰è£…ElasticSearch" class="headerlink" title="ğŸªå®‰è£…ElasticSearch"></a>ğŸªå®‰è£…ElasticSearch</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p><a href="http://localhost:4000/posts/dcb3f659.html#elasticsearch">Docker å®‰è£… Elasticsearch</a></p><hr><h2 id="ğŸŒŒElasticSearch-åŸºæœ¬æ¦‚å¿µ"><a href="#ğŸŒŒElasticSearch-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ğŸŒŒElasticSearch åŸºæœ¬æ¦‚å¿µ"></a>ğŸŒŒElasticSearch åŸºæœ¬æ¦‚å¿µ</h2><ul><li><p><strong>1ã€æ¥è¿‘å®æ—¶(NRT Near Real Time)</strong><br>Elasticsearchæ˜¯ä¸€ä¸ªæ¥è¿‘å®æ—¶çš„æœç´¢å¹³å°ã€‚è¿™æ„å‘³ç€ï¼Œä»ç´¢å¼•ä¸€ä¸ªæ–‡æ¡£ç›´åˆ°è¿™ä¸ªæ–‡æ¡£èƒ½å¤Ÿè¢«æœç´¢åˆ°æœ‰ä¸€ä¸ªè½»å¾®çš„å»¶è¿Ÿ(é€šå¸¸æ˜¯ <em>1ç§’å†…</em> )</p></li><li><p><strong>2ã€ç´¢å¼•(index)</strong><br><em>ä¸€ä¸ªç´¢å¼•å°±æ˜¯ä¸€ä¸ªæ‹¥æœ‰å‡ åˆ†ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£çš„é›†åˆ</em>ã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªå®¢æˆ·æ•°æ®çš„ç´¢å¼•ï¼Œå¦ä¸€ä¸ªäº§å“ç›®å½•çš„ç´¢å¼•ï¼Œè¿˜æœ‰ä¸€ä¸ªè®¢å•æ•°æ®çš„ç´¢å¼•ã€‚ä¸€ä¸ªç´¢å¼•ç”±ä¸€ä¸ªåå­—æ¥æ ‡è¯†ï¼ˆå¿…é¡»å…¨éƒ¨æ˜¯å°å†™å­—æ¯çš„ï¼‰ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬è¦å¯¹è¿™ä¸ªç´¢å¼•ä¸­çš„æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æœç´¢ã€æ›´æ–°å’Œåˆ é™¤çš„æ—¶å€™ï¼Œéƒ½è¦ä½¿ç”¨åˆ°è¿™ä¸ªåå­—ã€‚<em>ç´¢å¼•ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­ Database çš„æ¦‚å¿µ</em>ã€‚åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œå¦‚æœä½ æƒ³ï¼Œå¯ä»¥å®šä¹‰ä»»æ„å¤šçš„ç´¢å¼•ã€‚</p></li><li><p><strong>3ã€ç±»å‹(type)</strong><br><em>åœ¨ä¸€ä¸ªç´¢å¼•ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ç§æˆ–å¤šç§ç±»å‹</em>ã€‚ä¸€ä¸ªç±»å‹æ˜¯ä½ çš„ç´¢å¼•çš„ä¸€ä¸ªé€»è¾‘ä¸Šçš„åˆ†ç±»&#x2F;åˆ†åŒºï¼Œå…¶è¯­ä¹‰å®Œå…¨ç”±ä½ æ¥å®šã€‚é€šå¸¸ï¼Œä¼šä¸ºå…·æœ‰ä¸€ç»„å…±åŒå­—æ®µçš„æ–‡æ¡£å®šä¹‰ä¸€ä¸ªç±»å‹ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å‡è®¾ä½ è¿è¥ä¸€ä¸ªåšå®¢å¹³å°å¹¶ä¸”å°†ä½ æ‰€æœ‰çš„æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªç´¢å¼•ä¸­ã€‚åœ¨è¿™ä¸ªç´¢å¼•ä¸­ï¼Œä½ å¯ä»¥ä¸ºç”¨æˆ·æ•°æ®å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œä¸ºåšå®¢æ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ ä»¥ä¸ºè¯„è®ºæ•°æ®å®šä¹‰å¦ä¸€ä¸ªç±»å‹ã€‚<em>ç±»å‹ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­Tableçš„æ¦‚å¿µ</em>ã€‚</p><blockquote><p>NOTE: åœ¨5.xç‰ˆæœ¬ä»¥å‰å¯ä»¥åœ¨ä¸€ä¸ªç´¢å¼•ä¸­å®šä¹‰å¤šä¸ªç±»å‹,6.xä¹‹åç‰ˆæœ¬ä¹Ÿå¯ä»¥ä½¿ç”¨,ä½†æ˜¯ä¸æ¨è,åœ¨7~8.xç‰ˆæœ¬ä¸­å½»åº•ç§»é™¤ä¸€ä¸ªç´¢å¼•ä¸­åˆ›å»ºå¤šä¸ªç±»å‹</p></blockquote></li><li><p><strong>4ã€æ˜ å°„(Mapping)</strong><br><em>Mapping</em>æ˜¯ESä¸­çš„ä¸€ä¸ªå¾ˆé‡è¦çš„å†…å®¹ï¼Œ<em>å®ƒç±»ä¼¼äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®ä¸­tableçš„schemaï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªç´¢å¼•(index)ä¸­çš„ç±»å‹(type)çš„æ•°æ®çš„ç»“æ„</em>ã€‚ åœ¨ESä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºtype(ç›¸å½“äºtable)å’Œmapping(ç›¸å…³ä¸schema),ä¹Ÿå¯ä»¥é‡‡ç”¨é»˜è®¤åˆ›å»ºæ–¹å¼ã€‚åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒESå¯ä»¥æ ¹æ®æ’å…¥çš„æ•°æ®è‡ªåŠ¨åœ°åˆ›å»ºtypeåŠå…¶mappingã€‚ <em>mappingä¸­ä¸»è¦åŒ…æ‹¬å­—æ®µåã€å­—æ®µæ•°æ®ç±»å‹å’Œå­—æ®µç´¢å¼•ç±»å‹</em></p></li></ul><p><strong>5ã€æ–‡æ¡£(document)</strong><br>ä¸€ä¸ªæ–‡æ¡£æ˜¯ä¸€ä¸ªå¯è¢«ç´¢å¼•çš„<em>åŸºç¡€ä¿¡æ¯å•å…ƒ</em>ï¼Œ<em>ç±»ä¼¼äºè¡¨ä¸­çš„ä¸€æ¡è®°å½•</em>ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥æ‹¥æœ‰æŸä¸€ä¸ªå‘˜å·¥çš„æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥æ‹¥æœ‰æŸä¸ªå•†å“çš„ä¸€ä¸ªæ–‡æ¡£ã€‚æ–‡æ¡£ä»¥é‡‡ç”¨äº†è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼JSON(JavaScript Object Notation)æ¥è¡¨ç¤ºã€‚</p><p><img src="/Resources/Pasted%20image%2020220721085020.png" alt="Resources/Pasted image 20220721085020.png"></p><h3 id="ç´¢å¼•åº“åº•å±‚åŸç†åˆ†æ"><a href="#ç´¢å¼•åº“åº•å±‚åŸç†åˆ†æ" class="headerlink" title="ç´¢å¼•åº“åº•å±‚åŸç†åˆ†æ"></a>ç´¢å¼•åº“åº•å±‚åŸç†åˆ†æ</h3><p>ElasticSearch å¯¹äºä¸åŒçš„æœåŠ¡å»ºç«‹äº†ä¸åŒçš„ç´¢å¼•ï¼Œæ¯ä¸ªç´¢å¼•åˆåˆ›å»ºäº†ç±»å‹ï¼ˆ6ä»¥ååªèƒ½åˆ›å»ºä¸€ä¸ªï¼‰ï¼ŒåŒæ—¶å¯¹ç±»å‹è¿›è¡Œäº†çº¦æŸï¼Œç°åœ¨æˆ‘ä»¬å¾€ESä¸­ç´¢å¼•æ–‡æ¡£ï¼Œå®ƒå†…éƒ¨æ˜¯æ€æ ·å·¥ä½œçš„å‘¢ï¼Ÿ<br><img src="/Resources/Pasted%20image%2020220725114905.png"></p><ul><li><p>ç°åœ¨æˆ‘ä»¬æ·»åŠ æŒ‰ç…§å…¶ç±»å‹çš„çº¦æŸæ·»åŠ â€œå¼ ä¸‰â€è¿™æ¡æ•°æ®ï¼ŒESæ‹¿åˆ°è¿™æ¡æ•°æ®</p></li><li><p>é¦–å…ˆæŠŠæ•´ä¸ªæ–‡æ¡£è¿›è¡Œå‚¨å­˜åœ¨å…ƒæ•°æ®åŒºï¼ŒåŒæ—¶ä¼šç”Ÿæˆå¯¹åº”çš„â€_idâ€ï¼Œæ¯”å¦‚è¿™é‡Œä¸º0ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬æ‹¿0å»æŸ¥è¯¢ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™ä¸ªæ–‡æ¡£ï¼›</p></li><li><p>ç„¶åæŒ‰ç…§åˆ†è¯å™¨ï¼ˆæ‰€è°“åˆ†è¯å™¨å°±æ˜¯å¯¹ä½ è¾“å…¥çš„æ•°æ®ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œåˆ’åˆ†ï¼Œè¿™é‡Œä»¥æ ‡å‡†åˆ†è¯å™¨ä¸ºä¾‹ï¼‰è¿›è¡Œåˆ’åˆ†ï¼Œå› ä¸ºnameå±æ€§æ˜¯â€textâ€ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åˆ†è¯ï¼ŒæŒ‰ç…§è§„åˆ™ï¼Œè¿›è¡Œå•å­—åˆ’åˆ†ï¼Œå…ˆåˆ†â€œå¼ â€ï¼Œç„¶åè®°å½•è¿™ä¸ªå­—åœ¨å³è¾¹å“ªä¸ªæ–‡æ¡£ä¸­å‡ºç°ï¼ŒåŒæ—¶å‡ºç°äº†å‡ æ¬¡ï¼ˆå½“ç„¶è¿™é‡Œåªæ˜¯ç®€å•åˆ—ä¸¾ä¸€ä¸‹ï¼Œå®é™…æƒ…å†µå¯èƒ½æ›´å¤æ‚ï¼‰ï¼Œå†åˆ†â€œä¸‰â€ï¼Œä¸€æ ·çš„æ“ä½œï¼›æ¥ä¸‹æ¥æ˜¯â€ageâ€å±æ€§ï¼Œå› ä¸ºageæ˜¯â€Integerâ€ç±»å‹ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ†è¯ï¼Œç›´æ¥å­˜å‚¨ï¼Œè®°å½•ã€‚ä¸€ç›´å¦‚æ­¤æ“ä½œï¼Œç›´åˆ°å¯¹è¾“å…¥çš„æ•°æ®å®Œæˆâ€¦</p></li><li><p>ç°åœ¨æˆ‘ä»¬è¦æ’å…¥ç¬¬äºŒæ¡æ•°æ®ï¼ŒåŒæ ·æ˜¯ç°åœ¨å…ƒæ•°æ®åŒºè¿›è¡Œå‚¨å­˜ï¼Œä¸ºå…¶åˆ†é…â€_idâ€ï¼Œç„¶åæ˜¯ç´¢å¼•åŒºæ“ä½œï¼Œç°åœ¨â€å¼ â€è¿™ä¸ªå­—ä¸ä»…åœ¨0æ–‡æ¡£å‡ºç°ï¼Œä¹Ÿå‡ºç°åœ¨1æ–‡æ¡£ã€‚</p></li><li><p>éœ€æ±‚ï¼š ç°åœ¨ç”¨æˆ·æƒ³è¦æŸ¥æ‰¾addressä¸ºâ€åŒ—äº¬â€çš„æ–‡æ¡£ï¼ŒESä¼šè¿›è¡Œä¸¤æ¬¡æœç´¢ï¼Œå…ˆæ˜¯åœ¨ç´¢å¼•åŒºï¼ˆåˆ†è¯åå­˜æ”¾çš„æ•°æ®ï¼‰æ‰¾åˆ°ç›¸åŒ¹é…çš„æ–‡æ¡£çš„â€idâ€ï¼Œå†æ˜¯æŒ‰ç…§â€idâ€å»æ‰¾åˆ°å…ƒæ•°æ®åŒºå¯¹åº”çš„æ–‡æ¡£ï¼Œæœ€åæŒ‰ç…§ï¼šæ¯”å¦‚åœ¨0æ–‡æ¡£å‡ºç°çš„æ¬¡æ•°å¤šï¼Œå°±æŠŠ0æ–‡æ¡£æ’åœ¨å‰é¢ï¼Œå±•ç¤ºç»™ç”¨æˆ·ã€‚</p></li><li><p><strong>æ€»ç»“ï¼š ç´¢å¼•åº“å‚¨å­˜æ•°æ®ï¼Œåˆ†ä¸ºç´¢å¼•åŒºå’Œå…ƒæ•°æ®åŒºï¼Œå…ƒæ•°æ®åŒºå‚¨å­˜å®Œæ•´æ–‡æ¡£ï¼Œç´¢å¼•åŒºå­˜æ”¾åˆ†è¯è¿‡åçš„æ•°æ®</strong></p></li></ul><hr><h2 id="ğŸŒˆKibana"><a href="#ğŸŒˆKibana" class="headerlink" title="ğŸŒˆKibana"></a>ğŸŒˆKibana</h2><p>Kibanaæ˜¯ä¸€ä¸ªé’ˆå¯¹Elasticsearchçš„å¼€æºåˆ†æåŠ<strong>å¯è§†åŒ–å¹³å°</strong>ï¼Œä½¿ç”¨Kibanaå¯ä»¥æŸ¥è¯¢ã€æŸ¥çœ‹å¹¶ä¸å­˜å‚¨åœ¨ESç´¢å¼•çš„æ•°æ®è¿›è¡Œäº¤äº’æ“ä½œï¼Œä½¿ç”¨Kibanaèƒ½æ‰§è¡Œé«˜çº§çš„æ•°æ®åˆ†æï¼Œå¹¶èƒ½ä»¥å›¾è¡¨ã€è¡¨æ ¼å’Œåœ°å›¾çš„å½¢å¼æŸ¥çœ‹æ•°æ®ã€‚</p><blockquote><p>Kibanaç‰ˆæœ¬å’ŒElasticSearchç‰ˆæœ¬å¿…é¡»ä¸€è‡´ï¼</p></blockquote><p><a href="http://localhost:4000/posts/dcb3f659.html#Kibana">Docker å®‰è£… Kibana</a></p><h3 id="KibanaåŸºæœ¬æ“ä½œ"><a href="#KibanaåŸºæœ¬æ“ä½œ" class="headerlink" title="KibanaåŸºæœ¬æ“ä½œ"></a>KibanaåŸºæœ¬æ“ä½œ</h3><h4 id="æ•´ä½“ç•Œé¢"><a href="#æ•´ä½“ç•Œé¢" class="headerlink" title="æ•´ä½“ç•Œé¢"></a>æ•´ä½“ç•Œé¢</h4><p><img src="/Resources/Pasted%20image%2020220721112115.png" alt="Resources/Pasted image 20220721112115.png"></p><p><strong>PUT åˆ›å»ºç´¢å¼•</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /ems<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721112724.png" alt="Resources/Pasted image 20220721112724.png"></p><blockquote><p>å¼ƒç”¨ï¼šåœ¨7.0.0ä¸­ï¼Œé»˜è®¤å¤‡ä»½æ•°å°†ä»[5]æ›´æ”¹ä¸º[1]ï¼›å¦‚æœå¸Œæœ›ç»§ç»­ä½¿ç”¨é»˜è®¤çš„[5]ä¸ªå¤‡ä»½ï¼Œåˆ™å¿…é¡»åœ¨åˆ›å»ºç´¢å¼•è¯·æ±‚æˆ–ä½¿ç”¨ç´¢å¼•æ¨¡æ¿è¿›è¡Œç®¡ç†</p></blockquote><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ™ä¸ä¼šæŠ¥è­¦å‘ŠğŸŸ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /ems<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 1,<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 1<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šç´¢å¼•çš„åå­—å¿…é¡»æ˜¯å°å†™ï¼<br><img src="/Resources/Pasted%20image%2020220721113056.png" alt="Resources/Pasted image 20220721113056.png"></p></blockquote><p><strong>DELETE åˆ é™¤ç´¢å¼•</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ é™¤å•ä¸ªç´¢å¼•</span><br>DELETE /ems<br><br><span class="hljs-comment">#åˆ é™¤æ‰€æœ‰ç´¢å¼•</span><br>DELETE /*<br></code></pre></td></tr></table></figure><p><strong>GET æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</strong> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/indices?v<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721114628.png" alt="Resources/Pasted image 20220721114628.png"></p><blockquote><p>red -&gt; ç´¢å¼•ä¸å¯ç”¨<br>yellow -&gt;ç´¢å¼•ä¸å¥å£®<br>green -&gt;ç´¢å¼•å¥å£®</p></blockquote><hr><h4 id="ç±»å‹Type-å’Œ-æ˜ å°„Mapping"><a href="#ç±»å‹Type-å’Œ-æ˜ å°„Mapping" class="headerlink" title="ç±»å‹Type å’Œ æ˜ å°„Mapping"></a>ç±»å‹Type å’Œ æ˜ å°„Mapping</h4><p><strong>åˆ›å»ºç´¢å¼•æ—¶å¹¶åˆ›å»ºç±»å‹</strong><br>å…¶ä¸­empæ˜¯ç±»å‹ï¼Œidï¼Œnameï¼Œageï¼Œbiræ˜¯empç±»å‹çš„å››ä¸ªå­—æ®µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /ems <br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;emp&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;properties&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;id&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;name&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;age&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;bir&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;date&quot;</span><br>        &#125; <br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721141543.png" alt="Resources/Pasted image 20220721141543.png"></p><blockquote><p>Mapping Typeï¼š<strong>text, keyword, date, integer, long, double, boolean or ip</strong></p></blockquote><p><strong>æŸ¥çœ‹åˆ›å»ºç´¢å¼•ä»¥åŠç´¢å¼•ä¸­çš„æ˜ å°„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721142029.png" alt="Resources/Pasted image 20220721142029.png"></p><p><strong>åªæŸ¥çœ‹ç´¢å¼•ä¸­çš„æ˜ å°„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/_mapping<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721142144.png" alt="Resources/Pasted image 20220721142144.png"></p><hr><h4 id="æ–‡æ¡£Document"><a href="#æ–‡æ¡£Document" class="headerlink" title="æ–‡æ¡£Document"></a>æ–‡æ¡£Document</h4><p><strong>æ’å…¥ä¸€æ¡æ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ–‡æ¡£æ“ä½œï¼š</span><br><span class="hljs-comment"># æ’å…¥ä¸€æ¡æ–‡æ¡£ PUT /ç´¢å¼•/ç±»å‹/1</span><br>PUT /ems/emp/1<br>&#123;<br>  <span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>,<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;zhangsan&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span>:23,<br>  <span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721142647.png" alt="Resources/Pasted image 20220721142647.png"></p><p><strong>æŸ¥è¯¢ä¸€æ¡æ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£ä¸­ä¸€æ¡è®°å½• GET /ç´¢å¼•/ç±»å‹/æ–‡æ¡£id</span><br>GET /ems/emp/1<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721142717.png" alt="Resources/Pasted image 20220721142717.png"></p><p><strong>åˆ é™¤ä¸€æ¡æ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£ä¸­ä¸€æ¡è®°å½• GET /ç´¢å¼•/ç±»å‹/æ–‡æ¡£id</span><br>DELETE /ems/emp/1<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721143532.png" alt="Resources/Pasted image 20220721143532.png"></p><p><strong>æ›´æ–°ä¸€æ¡æ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /ems/emp/1<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;zhangsan2&quot;</span><br>&#125;<br><br>GET /ems/emp/1<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721152834.png" alt="Resources/Pasted image 20220721152834.png"><br><img src="/Resources/Pasted%20image%2020220721152918.png" alt="Resources/Pasted image 20220721152918.png"></p><blockquote><p>å¦‚æœåƒè¿™æ ·æ›´æ–°çš„è¯ï¼Œä¸ä¼šä¿ç•™åŸå§‹æ•°æ®ï¼ˆ<strong>å…ˆåˆ é™¤ï¼Œå†æ’å…¥</strong>ï¼‰<br>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ï¼Œä¿ç•™åŸå§‹æ•°æ®ï¼è€Œä¸”è¿˜å¯ä»¥æ–°æ·»åŠ æ–°çš„å­—æ®µï¼ï¼ˆç¼ºç‚¹æ˜¯ä¼šè‡ªåŠ¨åŒ¹é…å­—æ®µç±»å‹ï¼Œä¸å¤ªå‡†ç¡®ï¼‰ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /ems/emp/1/_update<br>&#123;<br>  <span class="hljs-string">&quot;doc&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;zhangsan2&quot;</span><br>  &#125;<br>&#125;<br><br>GET /ems/emp/1<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721153237.png" alt="Resources/Pasted image 20220721153237.png"><br><img src="/Resources/Pasted%20image%2020220721153251.png" alt="Resources/Pasted image 20220721153251.png"></p><p><strong>ä½¿ç”¨è„šæœ¬æ›´æ–°</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¯æ¬¡ç»™age+5</span><br>POST /ems/emp/1/_update<br>&#123;<br>  <span class="hljs-string">&quot;script&quot;</span>: <span class="hljs-string">&quot;ctx._source.age+=5&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="æ‰¹é‡æ“ä½œ"><a href="#æ‰¹é‡æ“ä½œ" class="headerlink" title="æ‰¹é‡æ“ä½œ"></a>æ‰¹é‡æ“ä½œ</h4><blockquote><p>æ‰¹é‡æ—¶ä¸ä¼šå› ä¸ºä¸€ä¸ªå¤±è´¥è€Œå…¨éƒ¨å¤±è´¥,è€Œæ˜¯ç»§ç»­æ‰§è¡Œåç»­æ“ä½œ,æ‰¹é‡åœ¨è¿”å›æ—¶æŒ‰ç…§æ‰§è¡Œçš„çŠ¶æ€å¼€å§‹è¿”å›</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ–‡æ¡£æ‰¹é‡æ“ä½œ _bulk</span><br><span class="hljs-comment"># æ·»åŠ (index) åˆ é™¤(delete) æ›´æ–°(update)</span><br>PUT /ems/emp/_bulk<br>&#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;4&quot;</span>&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;zhang&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:23,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2011-11-11&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;delete&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;4&quot;</span>&#125;&#125;<br>&#123;<span class="hljs-string">&quot;update&quot;</span>:&#123;<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;doc&quot;</span>:&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;xxx&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:18,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-11-12&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220721154934.png" alt="Resources/Pasted image 20220721154934.png"></p><hr><h2 id="ğŸŒ‹ESé«˜çº§æ£€ç´¢Query"><a href="#ğŸŒ‹ESé«˜çº§æ£€ç´¢Query" class="headerlink" title="ğŸŒ‹ESé«˜çº§æ£€ç´¢Query"></a>ğŸŒ‹ESé«˜çº§æ£€ç´¢Query</h2><p>ESå®˜æ–¹æä¾›äº†ä¸¤ä¸­æ£€ç´¢æ–¹å¼ï¼š</p><ul><li><ol><li>é€šè¿‡ URL å‚æ•°è¿›è¡Œæœç´¢<br><code>GET /ç´¢å¼•/ç±»å‹/_search ?å‚æ•°</code></li></ol></li><li><ol start="2"><li>é€šè¿‡ DSL(Domain Specified Language) è¿›è¡Œæœç´¢<br><code>GET /ç´¢å¼•/ç±»å‹/_search &#123;&#125;</code></li></ol></li></ul><p>å®˜æ–¹æ›´æ¨èä½¿ç”¨<strong>ç¬¬äºŒç§æ–¹å¼</strong>ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯åŸºäºä¼ é€’JSONä½œä¸ºè¯·æ±‚ä½“(request body)æ ¼å¼ä¸ESè¿›è¡Œäº¤äº’ï¼Œè¿™ç§æ–¹å¼æ›´å¼ºå¤§ï¼Œæ›´ç®€æ´ã€‚<br><img src="/Resources/Pasted%20image%2020220725095720.png"></p><p>ä»¥ä¸‹åªå±•ç¤ºå¤§éƒ¨åˆ†çš„å‘½ä»¤ï¼Œæ›´å¤šè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-dsl.html">Query DSL | Elasticsearch Guide [6.8] | Elastic</a></p><h4 id="æ„å»ºæµ‹è¯•æ•°æ®"><a href="#æ„å»ºæµ‹è¯•æ•°æ®" class="headerlink" title="æ„å»ºæµ‹è¯•æ•°æ®"></a>æ„å»ºæµ‹è¯•æ•°æ®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.åˆ é™¤ç´¢å¼•</span><br>DELETE /ems<br><br><span class="hljs-comment"># 2.åˆ›å»ºç´¢å¼•å¹¶æŒ‡å®šç±»å‹</span><br>PUT /ems<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;emp&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;properties&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;age&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;bir&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;date&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;content&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;address&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># 3.æ’å…¥æµ‹è¯•æ•°æ®</span><br>PUT /ems/emp/_bulk<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å°é»‘&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:23,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;ä¸ºå¼€å‘å›¢é˜Ÿé€‰æ‹©ä¸€æ¬¾ä¼˜ç§€çš„MVCæ¡†æ¶æ˜¯ä»¶éš¾äº‹å„¿ï¼Œåœ¨ä¼—å¤šå¯è¡Œçš„æ–¹æ¡ˆä¸­å†³æ‹©éœ€è¦å¾ˆé«˜çš„ç»éªŒå’Œæ°´å¹³&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;åŒ—äº¬&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;ç‹å°é»‘&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:24,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Spring æ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚æ¶æ„ï¼Œç”± 7 ä¸ªå®šä¹‰è‰¯å¥½çš„æ¨¡å—ç»„æˆã€‚Spring æ¨¡å—æ„å»ºåœ¨æ ¸å¿ƒå®¹å™¨ä¹‹ä¸Šï¼Œæ ¸å¿ƒå®¹å™¨å®šä¹‰äº†åˆ›å»ºã€é…ç½®å’Œç®¡ç† bean çš„æ–¹å¼&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å¼ å°äº”&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:8,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Spring Cloud ä½œä¸ºJava è¯­è¨€çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒä¾èµ–äºSpring Bootï¼Œæœ‰å¿«é€Ÿå¼€å‘ã€æŒç»­äº¤ä»˜å’Œå®¹æ˜“éƒ¨ç½²ç­‰ç‰¹ç‚¹ã€‚Spring Cloud çš„ç»„ä»¶éå¸¸å¤šï¼Œæ¶‰åŠå¾®æœåŠ¡çš„æ–¹æ–¹é¢é¢ï¼Œäº•åœ¨å¼€æºç¤¾åŒºSpring å’ŒNetflix ã€Pivotal ä¸¤å¤§å…¬å¸çš„æ¨åŠ¨ä¸‹è¶Šæ¥è¶Šå®Œå–„&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;æ— é”¡&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;win7&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:9,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Springçš„ç›®æ ‡æ˜¯è‡´åŠ›äºå…¨æ–¹ä½çš„ç®€åŒ–Javaå¼€å‘ã€‚ è¿™åŠ¿å¿…å¼•å‡ºæ›´å¤šçš„è§£é‡Šï¼Œ Springæ˜¯å¦‚ä½•ç®€åŒ–Javaå¼€å‘çš„ï¼Ÿ&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;å—äº¬&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;æ¢…è¶…é£&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:43,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„API&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;æ­å·&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å¼ æ— å¿Œ&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:59,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful webæ¥å£&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;åŒ—äº¬&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h4 id="URLæ£€ç´¢"><a href="#URLæ£€ç´¢" class="headerlink" title="URLæ£€ç´¢"></a>URLæ£€ç´¢</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> /ems/emp/_search?<span class="hljs-attribute">q</span>=*&amp;sort=age:desc&amp;size=5&amp;from=0&amp;_source=name,age,bir<br><br>_searchï¼šæœç´¢çš„API<br><br><span class="hljs-attribute">q</span>=* ï¼šåŒ¹é…æ‰€æœ‰æ–‡æ¡£<br><br><span class="hljs-attribute">sort</span>=ageï¼šæŒ‰ç…§æŒ‡å®šå­—æ®µè¿›è¡Œæ’åºï¼Œé»˜è®¤ä¸ºå‡åºï¼Œ:desc é™åºæ’åˆ—<br><br>sizeï¼šå±•ç¤ºå¤šå°‘æ¡æ•°æ®<br><br><span class="hljs-keyword">from</span>ï¼šå±•ç¤ºç¬¬å‡ é¡µ<br><br>_sourceï¼šåªåŒ¹é…å“ªäº›å­—æ®µ<br></code></pre></td></tr></table></figure><h4 id="DSLæ£€ç´¢"><a href="#DSLæ£€ç´¢" class="headerlink" title="DSLæ£€ç´¢"></a>DSLæ£€ç´¢</h4><h5 id="1-æŸ¥è¯¢æ‰€æœ‰-match-all"><a href="#1-æŸ¥è¯¢æ‰€æœ‰-match-all" class="headerlink" title="1. æŸ¥è¯¢æ‰€æœ‰(match_all)"></a>1. æŸ¥è¯¢æ‰€æœ‰(match_all)</h5><p><strong>match_allå…³é”®å­—</strong>ï¼šè¿”å›ç´¢å¼•ä¸­çš„å…¨éƒ¨æ–‡æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº-sort"><a href="#2-å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº-sort" class="headerlink" title="2. å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº(sort)"></a>2. å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº(sort)</h5><blockquote><p>keywordç±»å‹ä¸èƒ½ä½œä¸ºæ’åºä¾æ®</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¦‚æœä»¥keywordç±»å‹çš„è¿›è¡Œæ’åºåˆ™ä¼šå‡ºç°é”™è¯¯</span><br>GET /ems/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>      &#125;<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;bir&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šæ¡æ•°-size"><a href="#3-æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šæ¡æ•°-size" class="headerlink" title="3. æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šæ¡æ•°(size)"></a>3. æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šæ¡æ•°(size)</h5><p><strong>size å…³é”®å­—</strong>ï¼šæŒ‡å®šæŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šæ¡æ•°ã€‚Â <strong>é»˜è®¤è¿”å›å€¼10æ¡</strong><br>æ˜¯å¯¹æŸ¥è¯¢çš„ç»“æœè¿›è¡Œå¤„ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;size&quot;</span>: 5<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="4-åˆ†é¡µæŸ¥è¯¢-from"><a href="#4-åˆ†é¡µæŸ¥è¯¢-from" class="headerlink" title="4. åˆ†é¡µæŸ¥è¯¢(from)"></a>4. åˆ†é¡µæŸ¥è¯¢(from)</h5><p><strong>from å…³é”®å­—</strong>ï¼šç”¨æ¥æŒ‡å®šèµ·å§‹è¿”å›ä½ç½®ï¼Œå’Œsizeå…³é”®å­—è¿ç”¨å¯å®ç°åˆ†é¡µæ•ˆæœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;size&quot;</span>: 5,<br>  <span class="hljs-string">&quot;from&quot;</span>: 0<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="5-æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šå­—æ®µ-source"><a href="#5-æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šå­—æ®µ-source" class="headerlink" title="5. æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šå­—æ®µ(_source)"></a>5. æŸ¥è¯¢ç»“æœä¸­è¿”å›æŒ‡å®šå­—æ®µ(_source)</h5><p><strong>_source å…³é”®å­—</strong>ï¼šæ˜¯ä¸€ä¸ªæ•°ç»„,åœ¨æ•°ç»„ä¸­ç”¨æ¥æŒ‡å®šå±•ç¤ºé‚£äº›å­—æ®µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å±•ç¤ºå•ä¸ªå­—æ®µ</span><br>GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;_source&quot;</span>: <span class="hljs-string">&quot;name&quot;</span><br>&#125;<br><br><span class="hljs-comment"># å±•ç¤ºå¤šä¸ªå­—æ®µ</span><br>GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;_source&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="6-å…³é”®è¯æŸ¥è¯¢-term"><a href="#6-å…³é”®è¯æŸ¥è¯¢-term" class="headerlink" title="6. å…³é”®è¯æŸ¥è¯¢(term)"></a>6. å…³é”®è¯æŸ¥è¯¢(term)</h5><p><strong>term å…³é”®å­—</strong>ï¼šç”¨æ¥ä½¿ç”¨å…³é”®è¯æŸ¥è¯¢</p><blockquote><p> è¿˜æœ‰ä¸€ä¸ªtermsï¼Œå¤šå…³é”®è¯æŸ¥è¯¢</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># name æ˜¯textç±»å‹ï¼Œä¼šè¿›è¡Œåˆ†è¯ï¼Œæ‰€ä»¥nameåŒ…å«â€œå¼ â€çš„æ–‡æ¡£éƒ½è¡Œ</span><br>GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å¼ &quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># bir æ˜¯dateç±»å‹ï¼Œä¸ä¼šè¿›è¡Œåˆ†è¯ï¼Œæ‰€ä»¥åªèƒ½è¾“å…¥å…¨éƒ¨è¿›è¡ŒæŸ¥è¯¢</span><br>GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;bir&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;2012-12&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ€»ç»“ï¼š<br><strong>NOTE1</strong>ï¼šé€šè¿‡ä½¿ç”¨termæŸ¥è¯¢å¾—çŸ¥ESä¸­é»˜è®¤ä½¿ç”¨åˆ†è¯å™¨ä¸ºæ ‡å‡†åˆ†è¯å™¨(Standard Analyzer),æ ‡å‡†åˆ†è¯å™¨å¯¹äº<strong>è‹±æ–‡å•è¯åˆ†è¯</strong>ï¼Œå¯¹äº<strong>ä¸­æ–‡å•å­—åˆ†è¯</strong>ã€‚<br>ï¼ˆæ ‡å‡†åˆ†è¯å™¨ä¸é€‚åˆä¸­æ–‡ï¼‰</p><p><strong>NOTE2</strong>ï¼šé€šè¿‡ä½¿ç”¨termæŸ¥è¯¢å¾—çŸ¥,åœ¨ESçš„Mapping Type ä¸­ keyword , date ,integer, long , double , boolean or ip è¿™äº›ç±»å‹ä¸åˆ†è¯ï¼Œåªæœ‰<strong>textç±»å‹åˆ†è¯</strong>ã€‚<br>ï¼ˆæŸ¥çœ‹åˆ†è¯çš„æ•ˆæœé€»è¾‘ä½¿ç”¨ <code>GET /_analyze &#123;&quot;text&quot;:&quot;redis is open source db&quot;&#125;</code><br><code>GET /_analyze &#123;&quot;text&quot;:&quot;Java æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„äº§å“&quot;&#125;</code>)</p></blockquote><h5 id="7-èŒƒå›´æŸ¥è¯¢-range"><a href="#7-èŒƒå›´æŸ¥è¯¢-range" class="headerlink" title="7. èŒƒå›´æŸ¥è¯¢(range)"></a>7. èŒƒå›´æŸ¥è¯¢(range)</h5><p><strong>range å…³é”®å­—</strong>ï¼šç”¨æ¥æŒ‡å®šæŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„æ–‡æ¡£</p><blockquote><p>åªæ˜¯é’ˆå¯¹ä¸€äº›ç‰¹æ®Šçš„å­—æ®µæ¯”å¦‚ageç­‰</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥è¯¢age&gt;=5,&lt;=10çš„æ–‡æ¡£</span><br><span class="hljs-comment"># gte &gt;=</span><br><span class="hljs-comment"># lte &lt;=</span><br><span class="hljs-comment"># gt &gt;</span><br><span class="hljs-comment"># le &lt;</span><br>GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;gte&quot;</span>: 5,<br>        <span class="hljs-string">&quot;lte&quot;</span>: 10<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="8-å‰ç¼€æŸ¥è¯¢-prefix"><a href="#8-å‰ç¼€æŸ¥è¯¢-prefix" class="headerlink" title="8. å‰ç¼€æŸ¥è¯¢(prefix)"></a>8. å‰ç¼€æŸ¥è¯¢(prefix)</h5><p><strong>prefix å…³é”®å­—</strong>ï¼šç”¨æ¥æ£€ç´¢å«æœ‰æŒ‡å®šå‰ç¼€çš„å…³é”®è¯çš„ç›¸å…³æ–‡æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;prefix&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å¼ &quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š æŒ‡å®šçš„å‰ç¼€å¹¶ä¸æ˜¯è¯´å…ƒæ•°æ®æ–‡æ¡£ä¸­nameå±æ€§ä»¥â€å¼ â€ä¸ºå‰ç¼€çš„ï¼Œè€Œæ˜¯åŒ¹é…çš„ç»è¿‡åˆ†è¯å™¨åˆ†è¯åç´¢å¼•åŒºçš„æ•°æ®ï¼Œè¿™é‡Œâ€å¼ æ— å¿Œâ€ç»è¿‡åˆ†è¯åä¸ºï¼šâ€œå¼ â€,â€œæ— â€,â€œå¿Œâ€ï¼Œæ— è®ºåŒ¹é…åˆ°å“ªä¸ªéƒ½ä¼šæŒ‡å‘é‚£ä»½æ–‡æ¡£</p></blockquote><h5 id="9-é€šé…ç¬¦æŸ¥è¯¢-wildcard"><a href="#9-é€šé…ç¬¦æŸ¥è¯¢-wildcard" class="headerlink" title="9. é€šé…ç¬¦æŸ¥è¯¢(wildcard)"></a>9. é€šé…ç¬¦æŸ¥è¯¢(wildcard)</h5><p><strong>wildcard å…³é”®å­—</strong>ï¼šé€šé…ç¬¦æŸ¥è¯¢ ? ç”¨æ¥åŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ * ç”¨æ¥åŒ¹é…å¤šä¸ªä»»æ„å­—ç¬¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;wildcard&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å¼ *&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œçš„åŒ¹é…ä¹Ÿæ˜¯é’ˆå¯¹ç´¢å¼•åŒºé‡Œé¢çš„æ•°æ®</p></blockquote><h5 id="10-å¤šidæŸ¥è¯¢-ids"><a href="#10-å¤šidæŸ¥è¯¢-ids" class="headerlink" title="10. å¤šidæŸ¥è¯¢(ids)"></a>10. å¤šidæŸ¥è¯¢(ids)</h5><p><strong>ids å…³é”®å­—</strong>ï¼šå€¼ä¸ºæ•°ç»„ç±»å‹,ç”¨æ¥æ ¹æ®ä¸€ç»„idè·å–å¤šä¸ªå¯¹åº”çš„æ–‡æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;ids&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;values&quot;</span>: [<span class="hljs-string">&quot;AlSspHYBh-o7eO8i7bUf&quot;</span>,<span class="hljs-string">&quot;BVSspHYBh-o7eO8i7bUf&quot;</span>]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="11-æ¨¡ç³ŠæŸ¥è¯¢-fuzzy"><a href="#11-æ¨¡ç³ŠæŸ¥è¯¢-fuzzy" class="headerlink" title="11. æ¨¡ç³ŠæŸ¥è¯¢(fuzzy)"></a>11. æ¨¡ç³ŠæŸ¥è¯¢(fuzzy)</h5><p><strong>fuzzy å…³é”®å­—</strong>: ç”¨æ¥æ¨¡ç³ŠæŸ¥è¯¢å«æœ‰æŒ‡å®šå…³é”®å­—çš„æ–‡æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;fuzzy&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;sprin&quot;</span><br>      &#125;<br>  &#125;<br>&#125;<br><span class="hljs-comment"># è¿™é‡Œæœç´¢çš„å…³é”®è¯é•¿åº¦ä¸º5ï¼Œå…è®¸ä¸€æ¬¡æ¨¡ç³Šï¼Œç´¢å¼•åŒºçš„æ•°æ®ä¸ºspringèƒ½ç›¸åº”åŒ¹é…ï¼Œåˆšå¥½å·®1</span><br></code></pre></td></tr></table></figure><blockquote><p>æ¨¡ç³ŠæŸ¥è¯¢çš„è§„åˆ™ï¼š fuzzy æ¨¡ç³ŠæŸ¥è¯¢ <strong>æœ€å¤§æ¨¡ç³Šé”™è¯¯ å¿…é¡»åœ¨0-2ä¹‹é—´</strong><br>æœç´¢å…³é”®è¯é•¿åº¦ <strong>å°äº2</strong> ä¸å…è®¸å­˜åœ¨æ¨¡ç³Šï¼ˆå¿…é¡»ç²¾ç¡®åŒ¹é…ï¼Œä¸å…è®¸é”™è¯¯ï¼‰<br>æœç´¢å…³é”®è¯é•¿åº¦ä¸º<strong>3-5</strong> å…è®¸ä¸€æ¬¡æ¨¡ç³Šï¼ˆæœ€å¤šä¸€æ¬¡é”™è¯¯ï¼‰<br>æœç´¢å…³é”®è¯é•¿åº¦ <strong>å¤§äº5</strong> å…è®¸ä¸¤æ¬¡æ¨¡ç³Šï¼ˆæœ€å¤šä¸¤æ¬¡é”™è¯¯ï¼‰ï¼‰</p></blockquote><h5 id="12-å¸ƒå°”æŸ¥è¯¢-bool"><a href="#12-å¸ƒå°”æŸ¥è¯¢-bool" class="headerlink" title="12. å¸ƒå°”æŸ¥è¯¢(bool)"></a>12. å¸ƒå°”æŸ¥è¯¢(bool)</h5><p><strong>bool å…³é”®å­—</strong>ï¼šç”¨æ¥ç»„åˆå¤šä¸ªæ¡ä»¶å®ç°å¤æ‚æŸ¥è¯¢</p><ul><li><p>must: ç›¸å½“äº&amp;&amp;åŒæ—¶æˆç«‹ï¼ˆandï¼‰</p></li><li><p>should: ç›¸å½“äº|| æˆç«‹ä¸€ä¸ªå°±è¡Œï¼ˆorï¼‰</p></li><li><p>must_not: ç›¸å½“äº! ä¸èƒ½æ»¡è¶³ä»»ä½•ä¸€ä¸ª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;gte&quot;</span>: 5,<br>              <span class="hljs-string">&quot;lte&quot;</span>: 10<br>            &#125;<br>          &#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;must_not&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;address&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å—&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h5 id="13-é«˜äº®æŸ¥è¯¢-highlight"><a href="#13-é«˜äº®æŸ¥è¯¢-highlight" class="headerlink" title="13. é«˜äº®æŸ¥è¯¢(highlight)"></a>13. é«˜äº®æŸ¥è¯¢(highlight)</h5><p><strong>highlight å…³é”®å­—</strong>ï¼šå¯ä»¥è®©ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ä¸­çš„å…³é”®è¯é«˜äº®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;äº”&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;highlight&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;*&quot;</span>:&#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>ç»“æœä¸­ï¼š<br><span class="hljs-string">&quot;hits&quot;</span> : [<br>  &#123;<br><span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;ems&quot;</span>,<br><span class="hljs-string">&quot;_type&quot;</span> : <span class="hljs-string">&quot;emp&quot;</span>,<br><span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;oGsdM4IBp8eFhO_IzLHc&quot;</span>,<br><span class="hljs-string">&quot;_score&quot;</span> : 0.2876821,<br><span class="hljs-string">&quot;_source&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;å¼ å°äº”&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span> : 8,<br>  <span class="hljs-string">&quot;bir&quot;</span> : <span class="hljs-string">&quot;2012-12-12&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span> : <span class="hljs-string">&quot;Spring Cloud ä½œä¸ºJava è¯­è¨€çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒä¾èµ–äºSpring Bootï¼Œæœ‰å¿«é€Ÿå¼€å‘ã€æŒç»­äº¤ä»˜å’Œå®¹æ˜“éƒ¨ç½²ç­‰ç‰¹ç‚¹ã€‚Spring Cloud çš„ç»„ä»¶éå¸¸å¤šï¼Œæ¶‰åŠå¾®æœåŠ¡çš„æ–¹æ–¹é¢é¢ï¼Œäº•åœ¨å¼€æºç¤¾åŒºSpring å’ŒNetflix ã€Pivotal ä¸¤å¤§å…¬å¸çš„æ¨åŠ¨ä¸‹è¶Šæ¥è¶Šå®Œå–„&quot;</span>,<br>  <span class="hljs-string">&quot;address&quot;</span> : <span class="hljs-string">&quot;æ— é”¡&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;highlight&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;name&quot;</span> : [<br><span class="hljs-string">&quot;å¼ å°&lt;em&gt;äº”&lt;/em&gt;&quot;</span><br>  ]<br>&#125;<br>  &#125;<br>]<br><br><span class="hljs-comment"># &quot;*&quot;:&#123;&#125;    ä»£è¡¨æ‰€æœ‰åœ°æ–¹åªè¦åŒ…å«æŸ¥è¯¢çš„è¯éƒ½é«˜äº®</span><br><span class="hljs-comment"># &quot;name&quot;:&#123;&#125; åªæœ‰nameåŒ…å«æŸ¥è¯¢çš„è¯é«˜äº®</span><br></code></pre></td></tr></table></figure><blockquote><p>highlight æ˜¯å¯¹æŸ¥è¯¢åçš„ç»“æœè¿›è¡Œé«˜äº®ï¼Œæ‰€ä»¥è¦æ”¾åœ¨â€queryâ€ä¹‹åè¿›è¡Œï¼ŒåŒæ—¶ï¼Œå¹¶ä¸æ˜¯åœ¨åŸæ•°æ®ä¸Šè¿›è¡Œæ“ä½œï¼Œè€Œæ˜¯æ–°å¢äº†ä¸€æ®µhighlightï¼Œå¹¶ä¸ºéœ€è¦é«˜äº®çš„åœ°æ–¹å¢åŠ æ ‡ç­¾ã€‚ï¼ˆé»˜è®¤æ˜¯<code>&lt;em&gt;æ–œä½“&lt;/em&gt;</code>ï¼‰</p></blockquote><blockquote><p>è‡ªå®šä¹‰é«˜äº®htmlæ ‡ç­¾: å¯ä»¥åœ¨highlightä¸­ä½¿ç”¨pre_tagså’Œpost_tags</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;äº”&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;highlight&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;pre_tags&quot;</span>: [<span class="hljs-string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>], <br>    <span class="hljs-string">&quot;post_tags&quot;</span>: [<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>], <br>    <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>:&#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># ç»“æœ</span><br><span class="hljs-string">&quot;hits&quot;</span> : [<br>  &#123;<br><span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;ems&quot;</span>,<br><span class="hljs-string">&quot;_type&quot;</span> : <span class="hljs-string">&quot;emp&quot;</span>,<br><span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;AlSspHYBh-o7eO8i7bUf&quot;</span>,<br><span class="hljs-string">&quot;_score&quot;</span> : 0.2876821,<br><span class="hljs-string">&quot;_source&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;å¼ å°äº”&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span> : 8,<br>  <span class="hljs-string">&quot;bir&quot;</span> : <span class="hljs-string">&quot;2012-12-12&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span> : <span class="hljs-string">&quot;Spring Cloud ä½œä¸ºJava è¯­è¨€çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒä¾èµ–äºSpring Bootï¼Œæœ‰å¿«é€Ÿå¼€å‘ã€æŒç»­äº¤ä»˜å’Œå®¹æ˜“éƒ¨ç½²ç­‰ç‰¹ç‚¹ã€‚Spring Cloud çš„ç»„ä»¶éå¸¸å¤šï¼Œæ¶‰åŠå¾®æœåŠ¡çš„æ–¹æ–¹é¢é¢ï¼Œäº•åœ¨å¼€æºç¤¾åŒºSpring å’ŒNetflix ã€Pivotal ä¸¤å¤§å…¬å¸çš„æ¨åŠ¨ä¸‹è¶Šæ¥è¶Šå®Œå–„&quot;</span>,<br>  <span class="hljs-string">&quot;address&quot;</span> : <span class="hljs-string">&quot;æ— é”¡&quot;</span><br>&#125;,<br><span class="hljs-string">&quot;highlight&quot;</span> : &#123;<br>  <span class="hljs-string">&quot;name&quot;</span> : [<br><span class="hljs-string">&quot;å¼ å°&lt;span style=&#x27;color:red&#x27;&gt;äº”&lt;/span&gt;&quot;</span><br>  ]<br>&#125;<br>  &#125;<br>]<br></code></pre></td></tr></table></figure><h5 id="14-å¤šå­—æ®µæŸ¥è¯¢-multi-match"><a href="#14-å¤šå­—æ®µæŸ¥è¯¢-multi-match" class="headerlink" title="14. å¤šå­—æ®µæŸ¥è¯¢(multi_match)"></a>14. å¤šå­—æ®µæŸ¥è¯¢(multi_match)</h5><p>æœ‰æ—¶å€™å…‰è¿›è¡Œä¸€é¡¹å­—æ®µåŒ¹é…ä½“éªŒæ•ˆæœå¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥å¯ä»¥åŒæ—¶å¤šå­—æ®µåŒ¹é…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;ä¸­å›½&quot;</span>,              <span class="hljs-comment"># å…³é”®è¯</span><br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>]  <span class="hljs-comment">#è¿™é‡Œå†™è¦æ£€ç´¢çš„æŒ‡å®šå­—æ®µ</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š æ£€ç´¢çš„å…³é”®è¯æ˜¯å¦éœ€è¦æ‹†å¼€æ¥æ£€ç´¢è¿˜éœ€è¦çœ‹æŒ‡å®šçš„å­—æ®µæ˜¯å¦æœ‰åˆ†è¯<br>å³ 1. å¦‚æœæœç´¢çš„å­—æ®µåˆ†è¯ï¼Œä¼šå¯¹queryè¿›è¡Œå…ˆåˆ†è¯åœ¨æœç´¢<br>       2. å¦‚æœæœç´¢çš„å­—æ®µä¸åˆ†è¯ï¼Œä¼šç›´æ¥ä½¿ç”¨queryæ•´ä½“è¿›è¡Œè¯¥å­—æ®µæœç´¢</p></blockquote><h5 id="15-å¤šå­—æ®µåˆ†è¯æŸ¥è¯¢-query-string"><a href="#15-å¤šå­—æ®µåˆ†è¯æŸ¥è¯¢-query-string" class="headerlink" title="15. å¤šå­—æ®µåˆ†è¯æŸ¥è¯¢(query_string)"></a>15. å¤šå­—æ®µåˆ†è¯æŸ¥è¯¢(query_string)</h5><p>è¯¥å…³é”®è¯å¯ä»¥å¢åŠ åˆ†è¯å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /dangdang/book/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;ä¸­å›½å£°éŸ³&quot;</span>,          <span class="hljs-comment"># å…³é”®è¯</span><br>      <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,   <span class="hljs-comment"># åˆ†è¯å™¨</span><br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>] <span class="hljs-comment">#è¿™é‡Œå†™è¦æ£€ç´¢çš„æŒ‡å®šå­—æ®µ</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š æ£€ç´¢çš„å…³é”®è¯æ˜¯å¦éœ€è¦æ‹†å¼€æ¥æ£€ç´¢è¿˜éœ€è¦çœ‹æŒ‡å®šçš„å­—æ®µæ˜¯å¦æœ‰åˆ†è¯<br>å³ 1. å¦‚æœæœç´¢çš„å­—æ®µåˆ†è¯ï¼Œä¼šå¯¹queryè¿›è¡Œå…ˆåˆ†è¯åœ¨æœç´¢<br>       2. å¦‚æœæœç´¢çš„å­—æ®µä¸åˆ†è¯ï¼Œä¼šç›´æ¥ä½¿ç”¨queryæ•´ä½“è¿›è¡Œè¯¥å­—æ®µæœç´¢</p></blockquote><h2 id="ğŸŒ„IKåˆ†è¯å™¨"><a href="#ğŸŒ„IKåˆ†è¯å™¨" class="headerlink" title="ğŸŒ„IKåˆ†è¯å™¨"></a>ğŸŒ„IKåˆ†è¯å™¨</h2><p>é»˜è®¤ESä¸­é‡‡ç”¨æ ‡å‡†åˆ†è¯å™¨è¿›è¡Œåˆ†è¯ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸é€‚ç”¨äºä¸­æ–‡ç½‘ç«™ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹ESå¯¹ä¸­æ–‡å‹å¥½åˆ†è¯,ä»è€Œè¾¾åˆ°æ›´ä½³çš„æœç´¢çš„æ•ˆæœã€‚<br>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik">GitHub - medcl&#x2F;elasticsearch-analysis-ik: The IK Analysis plugin integrates Lucene IK analyzer into elasticsearch, support customized dictionary.</a></p><h3 id="åœ¨çº¿å®‰è£…IK"><a href="#åœ¨çº¿å®‰è£…IK" class="headerlink" title="åœ¨çº¿å®‰è£…IK"></a>åœ¨çº¿å®‰è£…IK</h3><p>v5.5.1ç‰ˆæœ¬åå¼€å§‹æ”¯æŒåœ¨çº¿å®‰è£… </p><h4 id="0ã€è¿›å…¥elasticsearchç›®å½•"><a href="#0ã€è¿›å…¥elasticsearchç›®å½•" class="headerlink" title="0ã€è¿›å…¥elasticsearchç›®å½•"></a>0ã€è¿›å…¥elasticsearchç›®å½•</h4><p><code>docker exec -it elasticsearch bash</code></p><h4 id="1ã€åˆ é™¤ESåŸå§‹æ•°æ®"><a href="#1ã€åˆ é™¤ESåŸå§‹æ•°æ®" class="headerlink" title="1ã€åˆ é™¤ESåŸå§‹æ•°æ®"></a>1ã€åˆ é™¤ESåŸå§‹æ•°æ®</h4><p>å› ä¸ºä¹‹å‰å¯èƒ½ä½¿ç”¨çš„æ ‡å‡†åˆ†è¯å™¨ï¼Œå¦‚æœå­˜åœ¨æ•°æ®ï¼Œç°åœ¨åˆä½¿ç”¨IKåˆ†è¯å™¨ä¼šå‡ºç°å†²çª<br>è¿›å…¥eså®‰è£…ç›®å½•ä¸­å°†dataç›®å½•æ•°æ®åˆ é™¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf data<br></code></pre></td></tr></table></figure><h4 id="2ã€å®‰è£…IK"><a href="#2ã€å®‰è£…IK" class="headerlink" title="2ã€å®‰è£…IK"></a>2ã€å®‰è£…IK</h4><p>åœ¨eså®‰è£…çš„binç›®å½•ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.8.23/elasticsearch-analysis-ik-6.8.23.zip<br><br></code></pre></td></tr></table></figure><blockquote><p>NOTE: è¦æ±‚ç‰ˆæœ¬ä¸¥æ ¼ä¸å½“å‰ä½¿ç”¨ç‰ˆæœ¬ä¸€è‡´,å¦‚éœ€ä½¿ç”¨å…¶ä»–ç‰ˆæœ¬æ›¿æ¢ 6.8.0 ä¸ºä½¿ç”¨çš„ç‰ˆæœ¬å·</p></blockquote><h4 id="3ã€æŸ¥çœ‹IK"><a href="#3ã€æŸ¥çœ‹IK" class="headerlink" title="3ã€æŸ¥çœ‹IK"></a>3ã€æŸ¥çœ‹IK</h4><p>å®‰è£…å®Œæˆåä¼šåœ¨pluginsç›®å½•ä¸‹ï¼Œç”ŸæˆIK</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@linux elasticsearch-6.8.0]$ <span class="hljs-built_in">ls</span> plugins/<br>analysis-ik<br></code></pre></td></tr></table></figure><h4 id="4ã€é‡å¯es"><a href="#4ã€é‡å¯es" class="headerlink" title="4ã€é‡å¯es"></a>4ã€é‡å¯es</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart elasticsearch<br></code></pre></td></tr></table></figure><h4 id="5ã€æµ‹è¯•åˆ†è¯å®‰è£…æˆåŠŸ"><a href="#5ã€æµ‹è¯•åˆ†è¯å®‰è£…æˆåŠŸ" class="headerlink" title="5ã€æµ‹è¯•åˆ†è¯å®‰è£…æˆåŠŸ"></a>5ã€æµ‹è¯•åˆ†è¯å®‰è£…æˆåŠŸ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.153.132:5601/ -&gt; devtools<br><br>GET /_analyze<br>&#123;<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;ä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œ&quot;</span>,<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span><br>&#125;<br><br><span class="hljs-comment"># ç»“æœ</span><br>&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;ä¸­åäººæ°‘å…±å’Œå›½&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 7,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 0<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;å›½æ­Œ&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 7,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 9,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;CN_WORD&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 1<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>IKåˆ†è¯å™¨æä¾›äº†ä¸¤ç§mappingç±»å‹ç”¨æ¥åšæ–‡æ¡£çš„åˆ†è¯åˆ†åˆ«æ˜¯ ik_max_word å’Œ ik_smart<br>ik_max_word: ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œâ€æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½,ä¸­åäººæ°‘,ä¸­å,åäºº,äººæ°‘å…±å’Œå›½,äººæ°‘,äºº,æ°‘,å…±å’Œå›½,å…±å’Œ,å’Œ,å›½å›½,å›½æ­Œâ€ï¼Œä¼šç©·å°½å„ç§å¯èƒ½çš„ç»„åˆï¼›</p><p>ik_smart: ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¸­åäººæ°‘å…±å’Œå›½å›½æ­Œâ€æ‹†åˆ†ä¸ºâ€œä¸­åäººæ°‘å…±å’Œå›½,å›½æ­Œâ€</p></blockquote><h3 id="æœ¬åœ°å®‰è£…IK"><a href="#æœ¬åœ°å®‰è£…IK" class="headerlink" title="æœ¬åœ°å®‰è£…IK"></a>æœ¬åœ°å®‰è£…IK</h3><h4 id="1ã€ä¸‹è½½IKå®‰è£…åŒ…"><a href="#1ã€ä¸‹è½½IKå®‰è£…åŒ…" class="headerlink" title="1ã€ä¸‹è½½IKå®‰è£…åŒ…"></a>1ã€ä¸‹è½½IKå®‰è£…åŒ…</h4><p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases?after=v6.8.2">https://github.com/medcl/elasticsearch-analysis-ik/releases?after=v6.8.2</a></p><h4 id="2ã€å®‰è£…unzip"><a href="#2ã€å®‰è£…unzip" class="headerlink" title="2ã€å®‰è£…unzip"></a>2ã€å®‰è£…unzip</h4><p>ç”±äºå®‰è£…åŒ…æ˜¯zipæ ¼å¼çš„ï¼Œæ‰€ä»¥éœ€è¦unzipæ–¹å¼è§£å‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y unzip<br></code></pre></td></tr></table></figure><h4 id="3ã€åˆ›å»ºIKç›®å½•"><a href="#3ã€åˆ›å»ºIKç›®å½•" class="headerlink" title="3ã€åˆ›å»ºIKç›®å½•"></a>3ã€åˆ›å»ºIKç›®å½•</h4><p>æœ¬åœ°æ–¹å¼ä¸åƒåœ¨çº¿å®‰è£…æ–¹å¼ä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ŒæŠŠikè§£å‹åœ¨é‡Œé¢<br>è¿™é‡Œæˆ‘ä»¬å°±åœ¨pluginsä¸‹æ–°å»ºç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> IK<br></code></pre></td></tr></table></figure><h4 id="4ã€ç§»åŠ¨åˆ°eså®‰è£…ç›®å½•çš„pluginsç›®å½•ä¸­"><a href="#4ã€ç§»åŠ¨åˆ°eså®‰è£…ç›®å½•çš„pluginsç›®å½•ä¸­" class="headerlink" title="4ã€ç§»åŠ¨åˆ°eså®‰è£…ç›®å½•çš„pluginsç›®å½•ä¸­"></a>4ã€ç§»åŠ¨åˆ°eså®‰è£…ç›®å½•çš„pluginsç›®å½•ä¸­</h4><p><code>mv elasticsearch-analysis-ik-6.8.0.zip elasticsearch-6.8.0/plugins/IK</code></p><h4 id="5ã€è§£å‹IK"><a href="#5ã€è§£å‹IK" class="headerlink" title="5ã€è§£å‹IK"></a>5ã€è§£å‹IK</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">unzip elasticsearch-analysis-ik-6.8.0.zip<br></code></pre></td></tr></table></figure><h4 id="6ã€é‡å¯ES"><a href="#6ã€é‡å¯ES" class="headerlink" title="6ã€é‡å¯ES"></a>6ã€é‡å¯ES</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart elasticsearch<br></code></pre></td></tr></table></figure><h3 id="å¸è½½IK"><a href="#å¸è½½IK" class="headerlink" title="å¸è½½IK"></a>å¸è½½IK</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> plugins <br><span class="hljs-built_in">rm</span> -rf analysis-ik/<br></code></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ é™¤åŸæœ‰çš„emsç´¢å¼•æ•°æ®</span><br>DELETE /ems<br><br><span class="hljs-comment"># æ–°å»ºç´¢å¼•/ç±»å‹/çº¦æŸ</span><br><span class="hljs-comment"># åŒæ—¶é’ˆå¯¹å±æ€§å¢åŠ äº†ä½¿ç”¨IKåˆ†è¯å™¨</span><br>PUT /ems<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;emp&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;properties&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span>,<br>           <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>           <span class="hljs-string">&quot;search_analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>     <span class="hljs-comment">#å¯å†™å¯ä¸å†™</span><br>        &#125;,<br>        <span class="hljs-string">&quot;age&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;bir&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;date&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;content&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>          <span class="hljs-string">&quot;search_analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;address&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># æ·»åŠ æ•°æ®</span><br>PUT /ems/emp/_bulk<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å°é»‘&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:23,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;ä¸ºå¼€å‘å›¢é˜Ÿé€‰æ‹©ä¸€æ¬¾ä¼˜ç§€çš„MVCæ¡†æ¶æ˜¯ä»¶éš¾äº‹å„¿ï¼Œåœ¨ä¼—å¤šå¯è¡Œçš„æ–¹æ¡ˆä¸­å†³æ‹©éœ€è¦å¾ˆé«˜çš„ç»éªŒå’Œæ°´å¹³&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;åŒ—äº¬&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;ç‹å°é»‘&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:24,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Spring æ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚æ¶æ„ï¼Œç”± 7 ä¸ªå®šä¹‰è‰¯å¥½çš„æ¨¡å—ç»„æˆã€‚Spring æ¨¡å—æ„å»ºåœ¨æ ¸å¿ƒå®¹å™¨ä¹‹ä¸Šï¼Œæ ¸å¿ƒå®¹å™¨å®šä¹‰äº†åˆ›å»ºã€é…ç½®å’Œç®¡ç† bean çš„æ–¹å¼&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å¼ å°äº”&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:8,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Spring Cloud ä½œä¸ºJava è¯­è¨€çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒä¾èµ–äºSpring Bootï¼Œæœ‰å¿«é€Ÿå¼€å‘ã€æŒç»­äº¤ä»˜å’Œå®¹æ˜“éƒ¨ç½²ç­‰ç‰¹ç‚¹ã€‚Spring Cloud çš„ç»„ä»¶éå¸¸å¤šï¼Œæ¶‰åŠå¾®æœåŠ¡çš„æ–¹æ–¹é¢é¢ï¼Œäº•åœ¨å¼€æºç¤¾åŒºSpring å’ŒNetflix ã€Pivotal ä¸¤å¤§å…¬å¸çš„æ¨åŠ¨ä¸‹è¶Šæ¥è¶Šå®Œå–„&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;æ— é”¡&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;win7&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:9,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Springçš„ç›®æ ‡æ˜¯è‡´åŠ›äºå…¨æ–¹ä½çš„ç®€åŒ–Javaå¼€å‘ã€‚ è¿™åŠ¿å¿…å¼•å‡ºæ›´å¤šçš„è§£é‡Šï¼Œ Springæ˜¯å¦‚ä½•ç®€åŒ–Javaå¼€å‘çš„ï¼Ÿ&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;å—äº¬&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;æ¢…è¶…é£&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:43,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„API&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;æ­å·&quot;</span>&#125;<br>  &#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>  &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;å¼ æ— å¿Œ&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:59,<span class="hljs-string">&quot;bir&quot;</span>:<span class="hljs-string">&quot;2012-12-12&quot;</span>,<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåˆ†å¸ƒå¼å¤šç”¨æˆ·èƒ½åŠ›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼ŒåŸºäºRESTful webæ¥å£&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;åŒ—äº¬&quot;</span>&#125;<br><br><br><span class="hljs-comment"># æµ‹è¯•</span><br>GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;term&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;æ¡†æ¶&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;highlight&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;pre_tags&quot;</span>: [<span class="hljs-string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>],<br>    <span class="hljs-string">&quot;post_tags&quot;</span>: [<span class="hljs-string">&quot;&lt;/span&gt;&quot;</span>],<br>    <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;*&quot;</span>:&#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é…ç½®æ‰©å±•è¯"><a href="#é…ç½®æ‰©å±•è¯" class="headerlink" title="é…ç½®æ‰©å±•è¯"></a>é…ç½®æ‰©å±•è¯</h3><p><strong>æ‰©å±•è¯å…¸ï¼š</strong>Â å°±æ˜¯æœ‰äº›è¯å¹¶ä¸æ˜¯å…³é”®è¯,ä½†æ˜¯ä¹Ÿå¸Œæœ›è¢«ESç”¨æ¥ä½œä¸ºæ£€ç´¢çš„å…³é”®è¯,å¯ä»¥å°†è¿™äº›è¯åŠ å…¥æ‰©å±•è¯å…¸ã€‚</p><p><strong>åœç”¨è¯å…¸ï¼š</strong>Â å°±æ˜¯æœ‰äº›è¯æ˜¯å…³é”®è¯,ä½†æ˜¯å‡ºäºä¸šåŠ¡åœºæ™¯ä¸æƒ³ä½¿ç”¨è¿™äº›å…³é”®è¯è¢«æ£€ç´¢åˆ°ï¼Œå¯ä»¥å°†è¿™äº›è¯æ”¾å…¥åœç”¨è¯å…¸ã€‚</p><h4 id="é…ç½®æœ¬åœ°è¯å…¸"><a href="#é…ç½®æœ¬åœ°è¯å…¸" class="headerlink" title="é…ç½®æœ¬åœ°è¯å…¸"></a>é…ç½®æœ¬åœ°è¯å…¸</h4><p>æŸ¥çœ‹é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼š</p><blockquote><p>åœ¨çº¿å®‰è£…çš„é…ç½®æ–‡ä»¶å’Œæœ¬åœ°å®‰è£…çš„é…ç½®æ–‡ä»¶åœ°å€ä¸åŒåˆ†åˆ«åœ¨ä»¥ä¸‹ç›®å½•ï¼š<br>Â <code>&#123;conf&#125;/analysis-ik/config/IKAnalyzer.cfg.xml</code>Â <code>&#123;plugins&#125;/elasticsearch-analysis-ik-*/config/IKAnalyzer.cfg.xml</code></p></blockquote><p>åœ¨é…ç½®æ–‡ä»¶åŒç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥é…ç½®æ–‡ä»¶åŒç›®å½•ï¼ˆæ­¤æ¬¡é…ç½®æ–‡ä»¶ç›®å½•æ˜¯ç¬¬ä¸€ç§ï¼‰</span><br><span class="hljs-built_in">cd</span> config/analysis-ik/<br><span class="hljs-built_in">cp</span> main.dic ext_dic<br>vim ext_dic<br><span class="hljs-comment"># è¾“å…¥ggdGåˆ é™¤æ‰€æœ‰å†…å®¹</span><br>insert -&gt; ç¢°ç“· -&gt; <span class="hljs-built_in">shift</span> ZZ<br>ä¿å­˜<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> config/analysis-ik/<br>vim IKAnalyzer.cfg.xml<br><span class="hljs-comment"># å¦‚æœæ‰“å¼€ä¸­æ–‡æ˜¯ä¹±ç çš„è¯</span><br>vim ~/.vimrc<br>åŠ å…¥ä»¥ä¸‹é…ç½®å³å¯<br><span class="hljs-built_in">set</span> encoding=utf-8set fileencoding=utf-8<br><br>å†é…ç½®åˆšåˆšé…ç½®å¥½çš„æ‹“å±•è¯å…¸<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220726095647.png"></p><blockquote><p>æœ¬æ¬¡åªæ¼”ç¤ºäº†æ‰©å±•è¯ä¸€æ ·ï¼Œåœç”¨è¯å’Œæ‹“å±•è¯æ“ä½œä¸€è‡´ï¼Œåªæ˜¯æ–‡ä»¶ååœ¨IKAnalyzer.cfg.xmlä¸­å¡«å…¥çš„ä½ç½®ä¸ä¸€æ ·</p></blockquote><p>é…ç½®å®Œæˆåï¼š<br><img src="/Resources/Pasted%20image%2020220726100547.png"></p><blockquote><p>æ–°å¢çš„æ‹“å±•è¯åªèƒ½å¯¹ä¹‹åçš„è¯æ„å»ºç´¢å¼•ï¼Œå¯¹äºä¹‹å‰å·²ç»æ„å»ºè¿‡ç´¢å¼•çš„æ–‡æ¡£ï¼Œåˆ™æ²¡æœ‰æ•ˆæœã€‚å¦‚æœéœ€è¦å¯¹æ‰€æœ‰çš„æ–‡æ¡£é€‚é…æ‰€æœ‰çš„æ‹“å±•è¯ï¼Œå¿…é¡»é‡å»ºæ‰€æœ‰æ–‡æ¡£çš„ç´¢å¼•ã€‚</p></blockquote><h4 id="é…ç½®è¿œç¨‹è¯å…¸"><a href="#é…ç½®è¿œç¨‹è¯å…¸" class="headerlink" title="é…ç½®è¿œç¨‹è¯å…¸"></a>é…ç½®è¿œç¨‹è¯å…¸</h4><p>æœ¬åœ°è¯å…¸å†™å…¥çš„è¯ä¸€æ—¦å†™å…¥ï¼Œåé¢å†æƒ³å»å¡«å…¥æˆ–è€…åœç”¨ï¼Œæ¯”è¾ƒéº»çƒ¦</p><p>æ¯”å¦‚ï¼Œæˆ‘è¿™ä¸ªåšå®¢ç½‘ç«™æˆ‘æƒ³æ ¹æ®ç”¨æˆ·è¾“å…¥çš„è¯çš„æœç´¢è¾¾åˆ°å¤šå°‘åå°†å…¶è®¤å®šä¸ºçƒ­è¯æ·»åŠ åˆ°è¯å…¸ä¸­ï¼Œå¹¶ä¸”ä¸€æ®µæ—¶é—´åè¿›è¡Œä¸€å®šçš„æ›´æ–°ã€‚</p><p><img src="/Resources/Pasted%20image%2020220726110610.png"><br>EMSè¿™ä¸ªåº”ç”¨å°±ç›¸å½“äºæˆ‘ä»¬çš„åšå®¢ï¼Œåœ¨è¿™ä¸ªä¸‹é¢æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶ext.txtï¼Œä¸“é—¨ç”¨äºå­˜æ”¾çƒ­è¯ï¼Œè€Œè¿™ä¸ªçƒ­è¯å…·ä½“æ€ä¹ˆæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆredisï¼Œå½“ç”¨æˆ·æœç´¢è¯çš„æ¬¡æ•°è¾¾åˆ°å¤šå°‘ï¼Œæˆ‘ä»¬é€šè¿‡IOå†™å…¥è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åESé€šè¿‡ç›‘å¬urlè¿™ä¸ªåœ°å€ä¸Šçš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±è¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚</p><h5 id="æ–°å»ºä¸€ä¸ªSpringbootåº”ç”¨"><a href="#æ–°å»ºä¸€ä¸ªSpringbootåº”ç”¨" class="headerlink" title="æ–°å»ºä¸€ä¸ªSpringbootåº”ç”¨"></a>æ–°å»ºä¸€ä¸ªSpringbootåº”ç”¨</h5><p>é¡¹ç›®ç»“æ„åŠç›¸å…³å†…å®¹å¦‚ä¸‹</p><p><img src="/Resources/Pasted%20image%2020220726111721.png"></p><h5 id="é…ç½®è®¿é—®é™æ€èµ„æº"><a href="#é…ç½®è®¿é—®é™æ€èµ„æº" class="headerlink" title="é…ç½®è®¿é—®é™æ€èµ„æº"></a>é…ç½®è®¿é—®é™æ€èµ„æº</h5><p><img src="/Resources/Pasted%20image%2020220726112240.png"></p><h5 id="æµ‹è¯•è®¿é—®é¡¹ç›®"><a href="#æµ‹è¯•è®¿é—®é¡¹ç›®" class="headerlink" title="æµ‹è¯•è®¿é—®é¡¹ç›®"></a>æµ‹è¯•è®¿é—®é¡¹ç›®</h5><p><img src="/Resources/Pasted%20image%2020220726111748.png"></p><blockquote><p>å¦‚æœé‡åˆ°ä¸­æ–‡ä¹±ç ï¼Œå¯ä»¥ä¸‹è½½ä¸€ä¸ªchromeæ‹“å±•Charsetæ›´æ¢ç¼–ç æ ¼å¼å³å¯<br>ä¸æ”¹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªè¦æ–‡æœ¬æ—¶utf-8å³å¯ã€‚</p></blockquote><h5 id="æ”¹ESé…ç½®æ–‡ä»¶"><a href="#æ”¹ESé…ç½®æ–‡ä»¶" class="headerlink" title="æ”¹ESé…ç½®æ–‡ä»¶"></a>æ”¹ESé…ç½®æ–‡ä»¶</h5><p>æŸ¥çœ‹è‡ªå·±çš„ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipconfig<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220726112411.png"></p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim IKAnalyzer.cfg.xml<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220726113032.png"></p><blockquote><p>æœ¬æ¬¡åªæ¼”ç¤ºäº†æ‰©å±•è¯ä¸€æ ·ï¼Œåœç”¨è¯å’Œæ‹“å±•è¯æ“ä½œä¸€è‡´ï¼Œåªæ˜¯æ–‡ä»¶ååœ¨IKAnalyzer.cfg.xmlä¸­å¡«å…¥çš„ä½ç½®ä¸ä¸€æ ·</p></blockquote><h5 id="é‡å¯ES"><a href="#é‡å¯ES" class="headerlink" title="é‡å¯ES"></a>é‡å¯ES</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exit</span><br>docker restart elasticsearch<br></code></pre></td></tr></table></figure><blockquote><p>bugï¼škibanaå´©æ‰äº†ï¼ŒæŠŠè¿œç¨‹è¯å…¸æ³¨é‡Šäº†è¿˜æ˜¯ä¸è¡Œ<br>é‡å¯åæŸ¥çœ‹æ—¥å¿—æ˜¾ç¤º<code>index_closed_exception</code><br><img src="/Resources/Pasted%20image%2020220726143113.png"><br>æ’é”™ing<br>ä½¿ç”¨postman å‘é€postè¯·æ±‚è§£å†³äº†ï¼Œ<del>ä¸çŸ¥é“ä¸ºå•¥</del><code>http://localhost:9200/.kibana/_open</code><br><strong>å› ä¸ºkibanaçš„ç´¢å¼•è¢«å…³é—­äº†ï¼ˆè«åå…¶å¦™è¢«å…³é—­ï¼Ÿä¸çŸ¥é“ä»€ä¹ˆåŸå› è¢«å…³é—­äº†ï¼Œä½†æ˜¯å°±æ˜¯è¿™ä¸ªåŸå› ï¼ï¼‰</strong></p></blockquote><blockquote><p>é”™è¯¯å¤ç°ï¼šä½¿ç”¨postman å‘é€postè¯·æ±‚<code>http://192.168.153.132:9200/.kibana/_close</code><br>å…³é—­ç´¢å¼•å†æ¬¡å‡ºç°é”™è¯¯400ï¼Œç„¶åé‡å¯äº†ä¹‹åå°±å†å¯åŠ¨è‡ªåŠ¨é€€å‡ºæŠ¥exit(1)ã€‚<br><img src="/Resources/Pasted%20image%2020220726154820.png"><br>é‡æ–°å‘é€æ‰“å¼€ç´¢å¼•çš„è¯·æ±‚å³å¯è§£å†³</p></blockquote><p><em>æµ‹è¯•ä½¿ç”¨çš„æ—¶å€™å¦‚æœæ–°åŠ äº†æ‹“å±•è¯ï¼Œé‚£ä¹ˆæµ‹è¯•çš„æ—¶å€™éœ€è¦æ–°å¢æ–‡æ¡£ä»¥æµ‹è¯•ï¼Œä¸ç„¶æ—§æ–‡æ¡£ä¼šä»¥ä¹‹å‰çš„åˆ†è¯æ¨¡å‹æ¥å»ºç«‹ç´¢å¼•ï¼Œå°±ä¼šå‡ºç°æŸ¥ä¸åˆ°çš„æƒ…å†µã€‚</em></p><blockquote><p><strong>å³æ–°åŠ äº†æ‹“å±•è¯åªå¯¹ä¹‹ååŠ å…¥çš„æ–‡æ¡£æœ‰æ•ˆï¼</strong></p></blockquote><hr><h2 id="ğŸ§·ESè¿‡æ»¤-Filter"><a href="#ğŸ§·ESè¿‡æ»¤-Filter" class="headerlink" title="ğŸ§·ESè¿‡æ»¤ Filter"></a>ğŸ§·ESè¿‡æ»¤ Filter</h2><p>ESä¸­çš„æŸ¥è¯¢æ“ä½œåˆ†ä¸º2ç§ï¼š <strong>æŸ¥è¯¢(query)</strong> å’Œ <strong>è¿‡æ»¤(filter)</strong></p><p>æŸ¥è¯¢å³æ˜¯ä¹‹å‰æåˆ°çš„queryæŸ¥è¯¢ï¼Œå®ƒï¼ˆæŸ¥è¯¢ï¼‰é»˜è®¤ä¼šè®¡ç®—æ¯ä¸ªè¿”å›æ–‡æ¡£çš„å¾—åˆ†ï¼Œç„¶åæ ¹æ®å¾—åˆ†æ’åºã€‚è€Œè¿‡æ»¤ï¼ˆfilterï¼‰åªä¼šç­›é€‰å‡ºç¬¦åˆçš„æ–‡æ¡£ï¼Œå¹¶ä¸è®¡ç®—å¾—åˆ†ï¼Œä¸”å®ƒå¯ä»¥ç¼“å­˜æ–‡æ¡£ ã€‚æ‰€ä»¥ï¼Œå•ä»æ€§èƒ½è€ƒè™‘ï¼Œè¿‡æ»¤æ¯”æŸ¥è¯¢æ›´å¿«ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œè¿‡æ»¤é€‚åˆåœ¨å¤§èŒƒå›´ç­›é€‰æ•°æ®ï¼Œè€ŒæŸ¥è¯¢åˆ™é€‚åˆç²¾ç¡®åŒ¹é…æ•°æ®ã€‚ä¸€èˆ¬åº”ç”¨æ—¶ï¼Œ åº”å…ˆä½¿ç”¨è¿‡æ»¤æ“ä½œè¿‡æ»¤æ•°æ®ï¼Œ ç„¶åä½¿ç”¨æŸ¥è¯¢åŒ¹é…æ•°æ®ã€‚<br><img src="/Resources/Pasted%20image%2020220726192122.png"></p><p>å®˜ç½‘è¯´æ˜ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-filter-context.html">Query and filter context</a></p><h3 id="è¿‡æ»¤è¯­æ³•"><a href="#è¿‡æ»¤è¯­æ³•" class="headerlink" title="è¿‡æ»¤è¯­æ³•"></a>è¿‡æ»¤è¯­æ³•</h3><p><strong>NOTE:</strong></p><ul><li>åœ¨æ‰§è¡Œfilterå’Œqueryæ—¶ï¼Œ<strong>å…ˆæ‰§è¡Œfilteråœ¨æ‰§è¡Œquery</strong></li><li>Elasticsearchä¼š<strong>è‡ªåŠ¨ç¼“å­˜ç»å¸¸ä½¿ç”¨çš„è¿‡æ»¤å™¨</strong>ï¼Œä»¥åŠ å¿«æ€§èƒ½</li><li>ä½¿ç”¨è¿‡æ»¤æŸ¥è¯¢<strong>å¿…é¡»ä½¿ç”¨boolæŸ¥è¯¢</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>  <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;must&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;æ¡†æ¶&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    ],<br>    <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;gte&quot;</span>: 0,<br>            <span class="hljs-string">&quot;lte&quot;</span>: 20<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œè¿‡ç¨‹ï¼š å…ˆä»ESä»æ‰§è¡Œè¿‡æ»¤æŸ¥è¯¢ï¼Œæ‰¾åˆ°ç¬¦åˆå¹´é¾„èŒƒå›´åœ¨<code>[0,20]</code>çš„æ–‡æ¡£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä¼šè®¡ç®—å¾—åˆ†ï¼Œç„¶åå†æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä»æ»¡è¶³æ¡ä»¶çš„è¿™äº›æ–‡æ¡£ä¸­åˆå»æŸ¥æ‰¾â€contentâ€å±æ€§çš„å€¼ä¸ºâ€æ¡†æ¶â€çš„æ–‡æ¡£ï¼Œå¹¶å°†å¯èƒ½çš„æ–‡æ¡£è®¡ç®—çš„å¾—åˆ†ã€‚</p><hr><h3 id="å¸¸è§çš„è¿‡æ»¤å™¨ç±»å‹"><a href="#å¸¸è§çš„è¿‡æ»¤å™¨ç±»å‹" class="headerlink" title="å¸¸è§çš„è¿‡æ»¤å™¨ç±»å‹"></a>å¸¸è§çš„è¿‡æ»¤å™¨ç±»å‹</h3><h4 id="term-Filter"><a href="#term-Filter" class="headerlink" title="term Filter"></a>term Filter</h4><p>term ç”¨åœ¨è¿‡æ»¤ä¸­æŸ¥è¯¢ï¼Œè¡¨ç¤ºæŸ¥è¯¢æŒ‡å®šå­—æ®µå«æœ‰è¯¥è¯çš„æ–‡æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å°äº”&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;spring&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="terms-Filter"><a href="#terms-Filter" class="headerlink" title="terms Filter"></a>terms Filter</h4><p>termåªèƒ½åŒ¹é…ä¸€ä¸ªå­—æ®µï¼Œè¦æƒ³è¿‡æ»¤å¤šä¸ªå­—æ®µï¼Œä½¿ç”¨terms</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å°äº”&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;content&quot;</span>: [<span class="hljs-string">&quot;spring&quot;</span>,<span class="hljs-string">&quot;java&quot;</span>]<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="range-Filter"><a href="#range-Filter" class="headerlink" title="range Filter"></a>range Filter</h4><p>é¡¾åæ€ä¹‰ï¼šå°±æ˜¯å…ˆæŸ¥æ‰¾æ»¡è¶³æŸä¸ªæŒ‡å®šèŒƒå›´çš„å­—æ®µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>         <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>           <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>             <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;å°äº”&quot;</span><br>           &#125;<br>         &#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;gte&quot;</span>: 1,<br>            <span class="hljs-string">&quot;lte&quot;</span>: 10<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="exists-Filter"><a href="#exists-Filter" class="headerlink" title="exists Filter"></a>exists Filter</h4><p>å…ˆè¿‡æ»¤æ‰ä¸å­˜åœ¨æŒ‡å®šå­—æ®µçš„æ–‡æ¡£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;exists&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;age&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125; <br><br></code></pre></td></tr></table></figure><h4 id="ids-Filter"><a href="#ids-Filter" class="headerlink" title="ids Filter"></a>ids Filter</h4><p>æŸ¥æ‰¾å«æœ‰æŒ‡å®šå­—æ®µçš„ç´¢å¼•è®°å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /ems/emp/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;ids&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;values&quot;</span>: [<br>              <span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;OY0TqnYB5vZ1Et4zupDf&quot;</span><br>            ]<br>          &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125; <br><br></code></pre></td></tr></table></figure><hr><h2 id="â˜•Java-æ“ä½œElasticSearch"><a href="#â˜•Java-æ“ä½œElasticSearch" class="headerlink" title="â˜•Java æ“ä½œElasticSearch"></a>â˜•Java æ“ä½œElasticSearch</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><h4 id="åˆå§‹åŒ–SpringBooté¡¹ç›®"><a href="#åˆå§‹åŒ–SpringBooté¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–SpringBooté¡¹ç›®"></a>åˆå§‹åŒ–SpringBooté¡¹ç›®</h4><p>é€‰æ‹©ä¾èµ–ï¼šdevtools lombok springweb<br>æ›´æ”¹springbootç‰ˆæœ¬ä¸º2.3.7.RELEASE</p><h4 id="å¼•å…¥Esç›¸å…³ä¾èµ–ï¼š"><a href="#å¼•å…¥Esç›¸å…³ä¾èµ–ï¼š" class="headerlink" title="å¼•å…¥Esç›¸å…³ä¾èµ–ï¼š"></a>å¼•å…¥Esç›¸å…³ä¾èµ–ï¼š</h4><p><strong>ç‰ˆæœ¬å¿…é¡»ä¸esç‰ˆæœ¬ä¸€è‡´</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transport<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.plugin<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transport-netty4-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.70<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ–°å»ºæµ‹è¯•ç±»"><a href="#æ–°å»ºæµ‹è¯•ç±»" class="headerlink" title="æ–°å»ºæµ‹è¯•ç±»"></a>æ–°å»ºæµ‹è¯•ç±»</h3><p>å¿«æ·é”®ï¼šctrl + shift + t</p><h3 id="æµ‹è¯•Javaè¿æ¥Eså®¢æˆ·ç«¯"><a href="#æµ‹è¯•Javaè¿æ¥Eså®¢æˆ·ç«¯" class="headerlink" title="æµ‹è¯•Javaè¿æ¥Eså®¢æˆ·ç«¯"></a>æµ‹è¯•Javaè¿æ¥Eså®¢æˆ·ç«¯</h3><p>#tips å°æŠ€å·§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¾‹å¦‚</span><br><span class="hljs-type">TransportClient</span> <span class="hljs-variable">transportClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">xxx</span>?<br><span class="hljs-comment">// TransportClient ç‚¹è¿›å»çœ‹æºç å‘ç°æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥newï¼Œå¯¹ç€TransportClientæŒ‰ä¸‹crtl+hï¼ŒæŸ¥çœ‹å®ç°ç±»å³å¯</span><br><span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬æŸ¥çœ‹å¯ä»¥å‘ç°ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªPreBuiltTransportClientå®ç°ç±»</span><br><span class="hljs-type">TransportClient</span> <span class="hljs-variable">transportClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PreBuiltTransportClient</span>(Settings.EMPTY);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-meta">@Test</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInit</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> UnknownHostException &#123;<br>      <span class="hljs-comment">// åˆ›å»ºESå®¢æˆ·ç«¯å¯¹è±¡</span><br>      <span class="hljs-type">TransportClient</span> <span class="hljs-variable">transportClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PreBuiltTransportClient</span>(Settings.EMPTY);<br>      <span class="hljs-comment">// è®¾ç½®æ“ä½œESæœåŠ¡ä¸»æœºå’Œç«¯å£</span><br>      transportClient.addTransportAddress(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransportAddress</span>(InetAddress.getByName(<span class="hljs-string">&quot;192.168.153.133&quot;</span>),<span class="hljs-number">9300</span>));<br><span class="hljs-comment">// ä¸ºä»€ä¹ˆæ˜¯9300ï¼Œkibanaæ˜¯9200ï¼Œå› ä¸ºTransportClientåº•å±‚èµ°çš„æ˜¯TCPåè®®ï¼Œè€ŒESå¼€æ”¾çš„TCPåè®®ç«¯å£æ˜¯9300ï¼Œkibanaèµ°çš„æ˜¯RESTFULåè®®ï¼ŒESå¼€æ”¾çš„RESTåè®®ç«¯å£æ˜¯9300ã€‚</span><br><br>      <span class="hljs-comment">// æ“ä½œ</span><br><br>      <span class="hljs-comment">// é‡Šæ”¾èµ„æº</span><br>      transportClient.close();<br>  &#125;<br></code></pre></td></tr></table></figure><hr><h3 id="ç´¢å¼•ç›¸å…³"><a href="#ç´¢å¼•ç›¸å…³" class="headerlink" title="ç´¢å¼•ç›¸å…³"></a>ç´¢å¼•ç›¸å…³</h3><h4 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h4><blockquote><p>ä¸‹é¢çš„ä»£ç æœ‰é—®é¢˜ï¼Œæ²¡é—®é¢˜çš„ä»£ç è§åé¢ï¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestIndexAndTypeMapping</span> &#123;<br>    <span class="hljs-keyword">private</span> TransportClient transportClient;<br><br>    <span class="hljs-comment">//@Before</span><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> UnknownHostException &#123;<br>        System.out.println(<span class="hljs-string">&quot;before&quot;</span>);<br>        <span class="hljs-comment">// åˆ›å»ºESå®¢æˆ·ç«¯å¯¹è±¡</span><br>        <span class="hljs-built_in">this</span>.transportClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PreBuiltTransportClient</span>(Settings.EMPTY);<br>        <span class="hljs-comment">// è®¾ç½®æ“ä½œESæœåŠ¡ä¸»æœºå’Œç«¯å£ http://192.168.153.133/</span><br>        transportClient.addTransportAddress(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransportAddress</span>(InetAddress.getByName(<span class="hljs-string">&quot;192.168.153.133&quot;</span>),<span class="hljs-number">9300</span>));<br><br>        <span class="hljs-comment">// æ“ä½œ</span><br>    &#125;<br>    <span class="hljs-comment">//@After</span><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;after&quot;</span>);<br>        <span class="hljs-comment">// é‡Šæ”¾èµ„æº</span><br>        transportClient.close();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºç´¢å¼•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreateIndex</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç´¢å¼•</span><br>        <span class="hljs-type">CreateIndexResponse</span> <span class="hljs-variable">createIndexResponse</span> <span class="hljs-operator">=</span> transportClient.admin().indices().prepareCreate(<span class="hljs-string">&quot;dangdang5&quot;</span>).get();<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">acknowledged</span> <span class="hljs-operator">=</span> createIndexResponse.isAcknowledged();<br>        System.out.println(acknowledged);<br>        <span class="hljs-comment">//</span><br>    &#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€ä¸ªï¼š<br>é—®é¢˜ï¼šæ‰§è¡Œ@Testæ–¹æ³•æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ‰“æ–­ç‚¹å‘ç°æ˜¯@beforeæ–¹æ³•æ²¡æœ‰æ‰§è¡Œã€‚<br>åŸå› ï¼šjunit4ä¸­æ˜¯@beforeå’Œ@afterï¼Œåœ¨junit5ä¸­ç”¨@BeforeEachå’Œ@AfterEachå–ä»£äº†ã€‚<br>è§£å†³ï¼šç”¨æ–°çš„æ³¨è§£å–ä»£æ—§æ³¨è§£<br>ç¬¬äºŒä¸ªï¼š<br>é—®é¢˜ï¼šæŠ¥é”™&#96;NoNodeAvailableException[None of the configured nodes are available: [</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ElasticSearch&quot;&gt;&lt;a href=&quot;#ElasticSearch&quot; class=&quot;headerlink&quot; title=&quot;ElasticSearch&quot;&gt;&lt;/a&gt;ElasticSearch&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/Resources/elast</summary>
      
    
    
    
    <category term="Database" scheme="http://conquers.github.io/categories/Database/"/>
    
    <category term="ElasticSearch" scheme="http://conquers.github.io/categories/Database/ElasticSearch/"/>
    
    
    <category term="ElasticSearch" scheme="http://conquers.github.io/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>Docker å®‰è£…å®¹å™¨åˆé›†</title>
    <link href="http://conquers.github.io/posts/dcb3f659.html"/>
    <id>http://conquers.github.io/posts/dcb3f659.html</id>
    <published>2022-07-11T13:45:45.000Z</published>
    <updated>2023-11-13T06:21:04.337Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><table><thead><tr><th align="left">åç§°</th><th>ç‰ˆæœ¬å·</th></tr></thead><tbody><tr><td align="left"><a href="#Portainer">Portainer</a></td><td><code>Docker version 24.0.2, build cb74dfc</code></td></tr><tr><td align="left"><code>Aliyun CentOs</code></td><td><code>CentOS 7.8 64ä½</code></td></tr><tr><td align="left"><code>VMware CentOs</code></td><td><code>CentOS 7.8 64ä½</code></td></tr><tr><td align="left"><code>FinalShell</code></td><td><code>3.9.8.2</code></td></tr><tr><td align="left"><code>Redis</code></td><td><code>latest</code> &#x3D; <code>6.2.6</code></td></tr><tr><td align="left"><a href="#MySQL%205.7">MySQL 5.7</a></td><td><code>5.7</code></td></tr><tr><td align="left"><a href="#MySQL%208">MySQL 8</a></td><td><code>8</code></td></tr><tr><td align="left"><code>Docker Hub</code></td><td><a href="https://hub.docker.com/">Docker Hub</a></td></tr><tr><td align="left"><a href="#Elasticsearch">Elasticsearch</a></td><td><code>6.8.23</code></td></tr><tr><td align="left"><a href="#Kibana">Kibana</a></td><td><code>6.8.23</code></td></tr><tr><td align="left"><a href="#Redis">Redis</a></td><td><code>6.X</code></td></tr><tr><td align="left"><a href="#RabbitMQ">RabbitMQ</a></td><td><code>latest</code></td></tr><tr><td align="left"><a href="#nacos">nacos</a></td><td><code>latest</code></td></tr><tr><td align="left"><a href="#XXL-JOB">XXL-JOB</a></td><td><code>2.3.1</code></td></tr><tr><td align="left"><a href="#Nginx">Nginx</a></td><td><code>1.19.10</code></td></tr><tr><td align="left"><code>...</code></td><td><code>...</code></td></tr></tbody></table><blockquote><p>è¯´æ˜ï¼šå¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨ï¼Œåˆ›å»ºå®¹å™¨åï¼Œéœ€è¦åœ¨å®‰å…¨ç­–ç•¥ç»„ä¸­å¼€æ”¾ç«¯å£ã€‚</p></blockquote><h2 id="Portainer"><a href="#Portainer" class="headerlink" title="Portainer"></a>Portainer</h2><h3 id="1ã€æœç´¢é•œåƒ"><a href="#1ã€æœç´¢é•œåƒ" class="headerlink" title="1ã€æœç´¢é•œåƒ"></a>1ã€æœç´¢é•œåƒ</h3><h3 id="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"><a href="#2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬" class="headerlink" title="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull portainer/portainer<br></code></pre></td></tr></table></figure><h3 id="3ã€å¯åŠ¨"><a href="#3ã€å¯åŠ¨" class="headerlink" title="3ã€å¯åŠ¨"></a>3ã€å¯åŠ¨</h3><p>å¦‚æœéœ€è¦ä½¿ç”¨ <code>minio</code>ï¼Œé‚£ä¹ˆå¯ä»¥å°†ç«¯å£æ˜ å°„ä¿®æ”¹ä¸º9002</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -p 9002:9000 \<br>--restart=always \<br>-v /var/run/docker.sock:/var/run/docker.sock \<br>--name prtainer \<br>docker.io/portainer/portainer<br></code></pre></td></tr></table></figure><p>æ‰“å¼€ç½‘å€ï¼š<a href="http://ip:9002/">http://ip:9002/</a></p><p>é¦–æ¬¡ç™»é™†è®¾ç½®è´¦å·å¯†ç ï¼šadmin:admin123</p><p><img src="/Resources/image-20230519142302931.png" alt="image-20230519142302931"></p><p>é€‰æ‹©æœ¬åœ°æ¨¡å¼</p><p><img src="/Resources/image-20230519142344326.png" alt="image-20230519142344326"></p><p><img src="/Resources/image-20230519142426575.png" alt="image-20230519142426575"></p><p><img src="/Resources/image-20230519142741905.png" alt="image-20230519142741905"></p><h2 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><h3 id="1ã€æœç´¢é•œåƒ-1"><a href="#1ã€æœç´¢é•œåƒ-1" class="headerlink" title="1ã€æœç´¢é•œåƒ"></a>1ã€æœç´¢é•œåƒ</h3><h3 id="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-1"><a href="#2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-1" class="headerlink" title="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull elasticsearch:6.8.23<br></code></pre></td></tr></table></figure><h3 id="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ"><a href="#3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ" class="headerlink" title="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ"></a>3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images<br></code></pre></td></tr></table></figure><h3 id="4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"><a href="#4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨" class="headerlink" title="4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"></a>4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name elasticsearch -d -e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms512m -Xmx512m&quot;</span> -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> -p 9200:9200 -p 9300:9300 elasticsearch:6.8.23<br></code></pre></td></tr></table></figure><h3 id="5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡"><a href="#5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡" class="headerlink" title="5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡"></a>5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps<br></code></pre></td></tr></table></figure><h3 id="6ã€æµ‹è¯•ElaticSearch"><a href="#6ã€æµ‹è¯•ElaticSearch" class="headerlink" title="6ã€æµ‹è¯•ElaticSearch"></a>6ã€æµ‹è¯•ElaticSearch</h3><p>æµè§ˆå™¨è®¿é—®ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://localhost:9200<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨curlæ¨¡æ‹Ÿè¯·æ±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://localhost:9200<br></code></pre></td></tr></table></figure><hr><h3 id="elasticsearché›†ç¾¤"><a href="#elasticsearché›†ç¾¤" class="headerlink" title="elasticsearché›†ç¾¤"></a>elasticsearché›†ç¾¤</h3><p>ä»¥ä¸‹ä½¿ç”¨Dockerå®‰è£…ElasticSearché›†ç¾¤</p><blockquote><p>æ³¨æ„è™šæ‹Ÿæœºçš„å†…å­˜ä¸èƒ½å¤ªå°ï¼Œä¸ç„¶èµ·3ä¸ªESæœåŠ¡å°±è¦å´©ï¼ˆä¸€å¼€å§‹ç»™äº†4ä¸ªGï¼Œåé¢ç»™äº†8ä¸ªGï¼‰</p></blockquote><h4 id="åœ¨è™šæ‹Ÿæœºä¸­åˆ›å»ºé…ç½®æ–‡ä»¶æ˜ å°„Eså®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶"><a href="#åœ¨è™šæ‹Ÿæœºä¸­åˆ›å»ºé…ç½®æ–‡ä»¶æ˜ å°„Eså®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶" class="headerlink" title="åœ¨è™šæ‹Ÿæœºä¸­åˆ›å»ºé…ç½®æ–‡ä»¶æ˜ å°„Eså®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶"></a>åœ¨è™šæ‹Ÿæœºä¸­åˆ›å»ºé…ç½®æ–‡ä»¶æ˜ å°„Eså®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p software/elasticsearch/config/data1<br><span class="hljs-built_in">mkdir</span> -p software/elasticsearch/config/data2<br><span class="hljs-built_in">mkdir</span> -p software/elasticsearch/config/data3<br><br><span class="hljs-built_in">mkdir</span> -p software/elasticsearch/config/plugins1<br><span class="hljs-built_in">mkdir</span> -p software/elasticsearch/config/plugins2<br><span class="hljs-built_in">mkdir</span> -p software/elasticsearch/config/plugins3<br><br><br><span class="hljs-built_in">chmod</span> 777 software/elasticsearch/config/data1<br><span class="hljs-built_in">chmod</span> 777 software/elasticsearch/config/data2<br><span class="hljs-built_in">chmod</span> 777 software/elasticsearch/config/data3<br><br>vim software/elasticsearch/config/es1.yml<br>vim software/elasticsearch/config/es2.yml<br>vim software/elasticsearch/config/es3.yml<br><br><br>cluster.name: es                               <span class="hljs-comment">#é›†ç¾¤åç§°(é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´)</span><br>node.name: node1                               <span class="hljs-comment">#èŠ‚ç‚¹åç§°(èŠ‚ç‚¹åç§°ä¸èƒ½ä¸€è‡´)</span><br>network.host: 0.0.0.0                          <span class="hljs-comment">#ç›‘å¬åœ°å€(å¿…é¡»å¼€å¯è¿œç¨‹æƒé™,å¹¶å…³é—­é˜²ç«å¢™)</span><br>http.port: 9201                                <span class="hljs-comment">#ç›‘å¬ç«¯å£(åœ¨ä¸€å°æœºå™¨æ—¶æœåŠ¡ç«¯å£ä¸èƒ½ä¸€è‡´)</span><br>discovery.zen.ping.unicast.hosts: [<span class="hljs-string">&quot;192.168.153.135:9302&quot;</span>, <span class="hljs-string">&quot;192.168.153.135:9303&quot;</span>]                <span class="hljs-comment">#å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹çš„ip</span><br>gateway.recover_after_nodes: 3                 <span class="hljs-comment">#é›†ç¾¤å¯åšmasterçš„æœ€å°èŠ‚ç‚¹æ•°</span><br>transport.tcp.port: 9301                       <span class="hljs-comment">#é›†ç¾¤TCPç«¯å£(åœ¨ä¸€å°æœºå™¨æ­å»ºå¿…é¡»ä¿®æ”¹)</span><br><br>cluster.name: es                               <span class="hljs-comment">#é›†ç¾¤åç§°(é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´)</span><br>node.name: node2                               <span class="hljs-comment">#èŠ‚ç‚¹åç§°(èŠ‚ç‚¹åç§°ä¸èƒ½ä¸€è‡´)</span><br>network.host: 0.0.0.0                          <span class="hljs-comment">#ç›‘å¬åœ°å€(å¿…é¡»å¼€å¯è¿œç¨‹æƒé™,å¹¶å…³é—­é˜²ç«å¢™)</span><br>http.port: 9202                                <span class="hljs-comment">#ç›‘å¬ç«¯å£(åœ¨ä¸€å°æœºå™¨æ—¶æœåŠ¡ç«¯å£ä¸èƒ½ä¸€è‡´)</span><br>discovery.zen.ping.unicast.hosts: [<span class="hljs-string">&quot;192.168.153.135:9301&quot;</span>, <span class="hljs-string">&quot;192.168.153.135:9303&quot;</span>]                <span class="hljs-comment">#å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹çš„ip</span><br>gateway.recover_after_nodes: 3                 <span class="hljs-comment">#é›†ç¾¤å¯åšmasterçš„æœ€å°èŠ‚ç‚¹æ•°</span><br>transport.tcp.port: 9302                       <span class="hljs-comment">#é›†ç¾¤TCPç«¯å£(åœ¨ä¸€å°æœºå™¨æ­å»ºå¿…é¡»ä¿®æ”¹)</span><br><br>cluster.name: es                               <span class="hljs-comment">#é›†ç¾¤åç§°(é›†ç¾¤åç§°å¿…é¡»ä¸€è‡´)</span><br>node.name: node3                               <span class="hljs-comment">#èŠ‚ç‚¹åç§°(èŠ‚ç‚¹åç§°ä¸èƒ½ä¸€è‡´)</span><br>network.host: 0.0.0.0                          <span class="hljs-comment">#ç›‘å¬åœ°å€(å¿…é¡»å¼€å¯è¿œç¨‹æƒé™,å¹¶å…³é—­é˜²ç«å¢™)</span><br>http.port: 9203                                <span class="hljs-comment">#ç›‘å¬ç«¯å£(åœ¨ä¸€å°æœºå™¨æ—¶æœåŠ¡ç«¯å£ä¸èƒ½ä¸€è‡´)</span><br>discovery.zen.ping.unicast.hosts: [<span class="hljs-string">&quot;192.168.153.135:9301&quot;</span>, <span class="hljs-string">&quot;192.168.153.135:9302&quot;</span>]                <span class="hljs-comment">#å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹çš„ip</span><br>gateway.recover_after_nodes: 3                 <span class="hljs-comment">#é›†ç¾¤å¯åšmasterçš„æœ€å°èŠ‚ç‚¹æ•°</span><br>transport.tcp.port: 9303                       <span class="hljs-comment">#é›†ç¾¤TCPç«¯å£(åœ¨ä¸€å°æœºå™¨æ­å»ºå¿…é¡»ä¿®æ”¹)</span><br></code></pre></td></tr></table></figure><h4 id="è°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡"><a href="#è°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡" class="headerlink" title="è°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡"></a>è°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡</h4><p><a href="https://conquers.github.io/posts/dcb3f659.html#elasticsearch">Dockerå®‰è£…ElasticSearch</a> æ²¡æœ‰æŠ¥é”™æ˜¯å› ä¸ºæŒ‡æ˜äº†å•æœºæ¨¡å¼è¿è¡Œï¼Œå› æ­¤ä¸ä¼šæŠ¥é”™ï¼Œåªè¦æ˜¯ä»¥é›†ç¾¤æ–¹æ³•å¯åŠ¨ï¼Œå°±å¿…é¡»è°ƒé«˜ <code>JVM</code> çº¿ç¨‹æ•°é™åˆ¶æ•°é‡ã€‚</p><blockquote><p>å¿…é¡»åšè¿™ä¸ªï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œæ˜¾ç¤º# ERROR: [1] bootstrap checks failed [1]: max virtual memory areas vm.max_map_count [65530] is too low</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/sysctl.conf<br>æ·»åŠ å¦‚ä¸‹é…ç½®<br>-&gt;&gt;<br>vm.max_map_count=262144 <br><br><span class="hljs-comment"># åˆ·æ–°é…ç½®</span><br>sysctl -p<br></code></pre></td></tr></table></figure><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.5/docker.html">å®˜ç½‘è¯´æ˜</a>ï¼š<br><img src="/Resources/Pasted%20image%2020220731202851.png"></p><h4 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms2048m -Xmx2048m&quot;</span> \<br>        -d -p <span class="hljs-number">9201</span>:<span class="hljs-number">9201</span> -p <span class="hljs-number">9301</span>:<span class="hljs-number">9301</span> \<br>        -e ES_MIN_MEM=<span class="hljs-number">128</span>m \<br>        -e ES_MAX_MEM=<span class="hljs-number">4096</span>m \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/es1.yml:/u</span>sr<span class="hljs-regexp">/share/</span>elasticsearch<span class="hljs-regexp">/config/</span>elasticsearch.yml \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/data1/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>data/ \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/plugins1/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>plugins  \<br>        --restart=always \<br>        --name ES01 \<br>        elasticsearch:<span class="hljs-number">6.8</span>.<span class="hljs-number">23</span><br><br><br>docker run -e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms2048m -Xmx2048m&quot;</span> \<br>        -d -p <span class="hljs-number">9202</span>:<span class="hljs-number">9202</span> -p <span class="hljs-number">9302</span>:<span class="hljs-number">9302</span> \<br>        -e ES_MIN_MEM=<span class="hljs-number">128</span>m \<br>        -e ES_MAX_MEM=<span class="hljs-number">4096</span>m \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/es2.yml:/u</span>sr<span class="hljs-regexp">/share/</span>elasticsearch<span class="hljs-regexp">/config/</span>elasticsearch.yml \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/data2/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>data/ \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/plugins2/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>plugins  \<br>        --restart=always \<br>        --name ES02 \<br>        elasticsearch:<span class="hljs-number">6.8</span>.<span class="hljs-number">23</span><br><br><br>docker run -e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms2048m -Xmx2048m&quot;</span> \<br>        -d -p <span class="hljs-number">9203</span>:<span class="hljs-number">9203</span> -p <span class="hljs-number">9303</span>:<span class="hljs-number">9303</span> \<br>        -e ES_MIN_MEM=<span class="hljs-number">128</span>m \<br>        -e ES_MAX_MEM=<span class="hljs-number">4096</span>m \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/es3.yml:/u</span>sr<span class="hljs-regexp">/share/</span>elasticsearch<span class="hljs-regexp">/config/</span>elasticsearch.yml \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/data3/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>data/ \<br>        -v <span class="hljs-regexp">/root/</span>software<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/plugins3/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>plugins  \<br>        --restart=always \<br>        --name ES03 \<br>        elasticsearch:<span class="hljs-number">6.8</span>.<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€"><a href="#æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€"></a>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</h4><p>æµè§ˆå™¨åˆ†åˆ«è®¿é—®ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">153.135</span>:<span class="hljs-number">9201</span>/<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">153.135</span>:<span class="hljs-number">9202</span>/<br>http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">153.135</span>:<span class="hljs-number">9203</span>/<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220729142408.png"><br><code>http://192.168.153.135:9201/_cat/nodes?pretty</code><br><img src="/Resources/Pasted%20image%2020220729143126.png"></p><h4 id="æŸ¥çœ‹é›†ç¾¤å¥åº·"><a href="#æŸ¥çœ‹é›†ç¾¤å¥åº·" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤å¥åº·"></a>æŸ¥çœ‹é›†ç¾¤å¥åº·</h4><p><code>http://192.168.153.135:9201/_cat/health?v</code><br><img src="/Resources/Pasted%20image%2020220729143530.png"><br>ç”±äºç°åœ¨è¿˜æ²¡æœ‰ç”¨kibanaè¿æ¥ESï¼Œä¹Ÿæ²¡æœ‰è‡ªå·±åˆ›å»ºç´¢å¼•ï¼Œå› æ­¤è¿™é‡Œçš„åˆ†ç‰‡æ•°é‡ä¸º0</p><h3 id="è¿æ¥é›†ç¾¤"><a href="#è¿æ¥é›†ç¾¤" class="headerlink" title="è¿æ¥é›†ç¾¤"></a>è¿æ¥é›†ç¾¤</h3><h4 id="Kibana-è¿æ¥-ESé›†ç¾¤"><a href="#Kibana-è¿æ¥-ESé›†ç¾¤" class="headerlink" title="Kibana è¿æ¥ ESé›†ç¾¤"></a>Kibana è¿æ¥ ESé›†ç¾¤</h4><p>å¦‚æœä½ ä¹‹å‰è¿æ¥è¿‡ä¸€å°ESé›†ç¾¤ï¼ˆä¸ºä»€ä¹ˆè¯´ä¸€å°ä¹Ÿæ˜¯é›†ç¾¤å‘¢ï¼Ÿå› ä¸ºESå¯åŠ¨æ–¹å¼å°±æ˜¯é›†ç¾¤å¯åŠ¨ï¼Œåªæ˜¯é›†ç¾¤æ•°é‡ä¸ºä¸€å°ï¼‰ï¼Œå…¶å®éœ€è¦ä¿®æ”¹çš„åœ°æ–¹éƒ½å·®ä¸å¤š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name kibana -e ELASTICSEARCH_HOSTS=http://192.168.153.135:9201 -p 5601:5601 -d kibana:6.8.23<br></code></pre></td></tr></table></figure><p>è¿›å…¥kibanaé…ç½®æ–‡ä»¶ï¼š<br>ä¿®æ”¹è¿æ¥ESçš„åœ°å€ä¸ºé›†ç¾¤ä¸­çš„ä»»æ„ä¸€å°ï¼š<br><a href="https://conquers.github.io/posts/dcb3f659.html#6%E3%80%81%E8%A6%86%E7%9B%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">kibana è¿æ¥ ESé›†ç¾¤-ç¼–å†™é…ç½®</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server.host:</span> <span class="hljs-string">&quot;0&quot;</span><br><span class="hljs-attr">elasticsearch.hosts:</span> [<span class="hljs-string">&quot;http://192.168.153.135:9201&quot;</span>]<br></code></pre></td></tr></table></figure><h4 id="SpringBoot-è¿æ¥ESé›†ç¾¤"><a href="#SpringBoot-è¿æ¥ESé›†ç¾¤" class="headerlink" title="SpringBoot è¿æ¥ESé›†ç¾¤"></a>SpringBoot è¿æ¥ESé›†ç¾¤</h4><p>å¦‚æœä½ ä¹‹å‰æœ‰ç”¨ <code>SpringBoot</code> è¿æ¥ <code>ES</code> ï¼Œè¿™é‡Œçš„é…ç½®å·®ä¸å¤šï¼Œåªæ˜¯éœ€è¦å°†è¿æ¥åœ°å€æ”¹ä¸ºæ‰€æœ‰çš„èŠ‚ç‚¹åœ°å€ï¼ˆé˜²æ­¢å…¶ä¸­æŸä¸€å°æ–­æ‰ä¸å¯ç”¨ï¼‰<br><a href="SpringData%E6%93%8D%E4%BD%9CElasticSearch.md#%E7%BC%96%E5%86%99yml%E9%85%8D%E7%BD%AE">SpringBootè¿æ¥ES-ç¼–å†™é…ç½®</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestClientConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractElasticsearchConfiguration</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æ¥æ›¿æ¢ transportClientå¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title function_">elasticsearchClient</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        å®šä¹‰å®¢æˆ·ç«¯é…ç½®å¯¹è±¡</span><br><span class="hljs-comment">        ç«¯å£ä¸º9200ï¼Œå‰é¢è¯´è¿‡ï¼Œeså¼€æ”¾çš„restç«¯å£ä¸º9200</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">ClientConfiguration</span> <span class="hljs-variable">clientConfiguration</span> <span class="hljs-operator">=</span> ClientConfiguration.builder()<br>                .connectedTo(<span class="hljs-string">&quot;192.168.153.135:9201&quot;</span>, <span class="hljs-string">&quot;192.168.153.135:9202&quot;</span>, <span class="hljs-string">&quot;192.168.153.135:9203&quot;</span>)<br>                .build();<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        é€šè¿‡RestClientså¯¹è±¡åˆ›å»º</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">return</span> RestClients.create(clientConfiguration).rest();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Head-é›†ç¾¤å¯è§†åŒ–"><a href="#Head-é›†ç¾¤å¯è§†åŒ–" class="headerlink" title="Head é›†ç¾¤å¯è§†åŒ–"></a>Head é›†ç¾¤å¯è§†åŒ–</h3><p>ä¸‹è½½é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull mobz/elasticsearch-head:5-alpine<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name=elasticsearch-head \<br>  -p 9100:9100 \<br>  mobz/elasticsearch-head:5-alpine<br></code></pre></td></tr></table></figure><p>è§£å†³è·¨åŸŸ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim software<span class="hljs-regexp">/elasticsearch/</span>config/es1.yml<br>vim software<span class="hljs-regexp">/elasticsearch/</span>config/es2.yml<br>vim software<span class="hljs-regexp">/elasticsearch/</span>config/es3.yml<br><span class="hljs-comment"># åˆ†åˆ«æ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>http.cors.enabled: true<br>http.cors.allow-origin: <span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure><p>é‡å¯esé›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart $(docker ps -a | awk <span class="hljs-string">&#x27;&#123; print $1 &#125;&#x27;</span> | <span class="hljs-built_in">tail</span> -n +2)<br></code></pre></td></tr></table></figure><p>è®¿é—®é¡µé¢<br><code>http://192.168.153.135:9100/</code><br><img src="/Resources/Pasted%20image%2020220729150733.png"></p><p>åˆ›å»ºç´¢å¼•<br><img src="/Resources/Pasted%20image%2020220729150822.png"></p><p><strong>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</strong><br>ElasticSearch6.X é»˜è®¤ä¸ºåˆ†ç‰‡5å’Œ1å¤åˆ¶ï¼š<br><img src="/Resources/Pasted%20image%2020220729151207.png"><br>å¯ä»¥çœ‹åˆ°ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¿è¯ä¸»å‰¯åˆ†ç‰‡ä¸åœ¨åŒä¸€èŠ‚ç‚¹ï¼ˆä¿è¯èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶å¯ç”¨ï¼‰</p><p><strong>ç°åœ¨æˆ‘ä»¬åœæ‰node1èŠ‚ç‚¹ï¼š</strong><br><img src="/Resources/Pasted%20image%2020220729151637.png"><br>å¯ä»¥çœ‹åˆ°é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œè™½ç„¶æœ‰äº›å‰¯æœ¬å¤±æ•ˆäº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿è¯äº†5ä¸ªä¸»åˆ†ç‰‡å¯ç”¨ï¼ˆå³ä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ï¼‰</p><p><strong>ç°åœ¨æˆ‘ä»¬åœæ‰node2èŠ‚ç‚¹ï¼š</strong><br>é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œåªæ˜¯é›†ç¾¤æ•°é‡ç°åœ¨åªæœ‰ä¸€å°ï¼Œä¸»åˆ†ç‰‡ä¾ç„¶å®Œæ•´ã€‚<br><img src="/Resources/Pasted%20image%2020220729151832.png"></p><p><strong>ç°åœ¨æˆ‘ä»¬é‡å¯node2èŠ‚ç‚¹ï¼š</strong><br><img src="/Resources/Pasted%20image%2020220729151859.png"><br>å‘ç°é›†ç¾¤æ…¢æ…¢åŒæ­¥äº†æ•°æ®ï¼Œå»åˆ†æ‹…node1èŠ‚ç‚¹çš„å‹åŠ›ï¼Œæ­¤æ—¶å®Œæ•´çš„ä¸»å‰¯åˆ†ç‰‡éƒ½åˆ†å¸ƒåœ¨è€…&#x3D;è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ‰€ä»¥å¥åº·çŠ¶æ€ä¸ºï¼šgreen</p><p><strong>ç°åœ¨æˆ‘ä»¬é‡å¯node1èŠ‚ç‚¹ï¼š</strong><br>æˆ‘ä»¬å‘ç°åˆ†ç‰‡åˆé‡æ–°åˆ†å¸ƒåœ¨äº†ä¸åŒçš„èŠ‚ç‚¹ï¼Œå¥åº·çŠ¶æ€ä¸ºï¼šgreen<br><img src="/Resources/Pasted%20image%2020220729151929.png"><br><img src="/Resources/Pasted%20image%2020220729151938.png"></p><h2 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h2><h3 id="1ã€æœç´¢é•œåƒ-2"><a href="#1ã€æœç´¢é•œåƒ-2" class="headerlink" title="1ã€æœç´¢é•œåƒ"></a>1ã€æœç´¢é•œåƒ</h3><h3 id="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-2"><a href="#2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-2" class="headerlink" title="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull kibana:6.8.23<br></code></pre></td></tr></table></figure><h3 id="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-1"><a href="#3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-1" class="headerlink" title="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ"></a>3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images<br></code></pre></td></tr></table></figure><h3 id="4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨-1"><a href="#4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨-1" class="headerlink" title="4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"></a>4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#è¿è¡Œkibana æ³¨æ„IPä¸€å®šä¸è¦å†™é”™ï¼Œä¸åé¢é…ç½®æ–‡ä»¶çš„ipä¸€å®šè¦å¯¹åº”</span><br>docker run --name kibana -e ELASTICSEARCH_HOSTS=http://192.168.153.132:9200 -p 5601:5601 -d kibana:6.8.23<br><br>docker run --name kibana -e ELASTICSEARCH_HOSTS=http://192.168.153.132/:9200 -v /mydata/ElasticStackAll/Kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml -p 5601:5601 -d kibana:6.8.23<br></code></pre></td></tr></table></figure><blockquote><p>è™šæ‹Ÿæœºçš„ipä¼šæ›´æ¢ä¼šå¯¼è‡´ElasticSearchIpçš„æ›´æ¢ï¼Œä»è€Œå¯¼è‡´kibanaå¯åŠ¨ä¸äº†ï¼å°±åªèƒ½é‡è£…kabinaå®¹å™¨<br>è§£å†³ï¼šåé¢ç”¨javaå»è¿æ¥esï¼Œä¸éœ€è¦kibanaäº†<br>è§£å†³ï¼š<a href="%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA.md#%E5%9B%BA%E5%AE%9A%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84ip">å›ºå®šè™šæ‹Ÿæœºçš„ip</a></p><p>å¯åŠ¨æ—¶æŠ¥é”™ï¼š<code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code><br>è§£å†³åŠæ³•ï¼š</p><ol><li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</li><li><code>vi /usr/lib/sysctl.d/00-system.conf</code></li><li>æ·»åŠ <code>net.ipv4.ip_forward=1</code></li><li>é‡å¯ç½‘ç»œ<code>systemctl restart network</code></li><li>åœæ­¢å®¹å™¨<code>docker stop kibana</code></li><li>åˆ æ‰å¯åŠ¨å¤±è´¥çš„å®¹å™¨<code>docker rm kibana</code></li><li>é‡å¯docker<code>systemctl restart docker</code></li><li>é‡æ–°å¯åŠ¨kibana</li></ol></blockquote><h3 id="5ã€è¿›å…¥kibanaå®¹å™¨"><a href="#5ã€è¿›å…¥kibanaå®¹å™¨" class="headerlink" title="5ã€è¿›å…¥kibanaå®¹å™¨"></a>5ã€è¿›å…¥kibanaå®¹å™¨</h3><p>ä½¿ç”¨dockerå‘½ä»¤è¿›å…¥åˆ°kibanaå®¹å™¨é‡Œé¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it kibana /bin/sh<br></code></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨ä¸­æ‰¾åˆ°<code>/usr/share/kibana/config/kibana.yml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#ä½¿ç”¨vi ä¿®æ”¹æ–‡ä»¶å†…å®¹</span><br>vi /usr/share/kibana/config/kibana.yml <br></code></pre></td></tr></table></figure><h3 id="6ã€è¦†ç›–é…ç½®æ–‡ä»¶"><a href="#6ã€è¦†ç›–é…ç½®æ–‡ä»¶" class="headerlink" title="6ã€è¦†ç›–é…ç½®æ–‡ä»¶"></a>6ã€è¦†ç›–é…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server.name:</span> <span class="hljs-string">kibana</span><br><span class="hljs-comment"># åªèƒ½å†™0ï¼Œä¸ç„¶ä¼šæŠ¥é”™Error: listen EADDRNOTAVAIL: address not available</span><br><span class="hljs-comment">#server.host: &quot;192.168.153.132&quot;</span><br><span class="hljs-attr">server.host:</span> <span class="hljs-string">&quot;0&quot;</span><br><span class="hljs-comment">#elasticsearch.hosts: [ &quot;http://elasticsearch:9200&quot; ]</span><br><span class="hljs-attr">elasticsearch.hosts:</span> [ <span class="hljs-string">&quot;http://192.168.153.132:9200&quot;</span> ]<br><span class="hljs-attr">xpack.monitoring.ui.container.elasticsearch.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">#è®¾ç½®kibanaä¸­æ–‡æ˜¾ç¤º</span><br><span class="hljs-attr">i18n.locale:</span> <span class="hljs-string">zh-CN</span><br></code></pre></td></tr></table></figure><h3 id="7ã€é‡æ–°å¯åŠ¨kibana"><a href="#7ã€é‡æ–°å¯åŠ¨kibana" class="headerlink" title="7ã€é‡æ–°å¯åŠ¨kibana"></a>7ã€é‡æ–°å¯åŠ¨kibana</h3><p><code>docker restart kibana</code></p><h3 id="8ã€æµ‹è¯•Kibana"><a href="#8ã€æµ‹è¯•Kibana" class="headerlink" title="8ã€æµ‹è¯•Kibana"></a>8ã€æµ‹è¯•Kibana</h3><p><code>http://è‡ªå·±çš„IPåœ°å€:5601</code><br><code>http://192.168.153.132:5601</code><br>æµè§ˆå™¨è®¿é—®ï¼š<br><img src="/Resources/Pasted%20image%2020220721101717.png" alt="Develop/å¼€å‘è™šæ‹Ÿæœº/Resources/Pasted image 20220721101717.png"></p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="Redis-å•æœº"><a href="#Redis-å•æœº" class="headerlink" title="Redis å•æœº"></a>Redis å•æœº</h3><p>ä½¿ç”¨äº‘æœåŠ¡å™¨éœ€è¦å¼€æ”¾ç«¯å£6379-6384åŠ16379-16384ï¼Œå…·ä½“æ ¹æ®éœ€æ±‚ï¼Œä»¥ä¸‹ä½¿ç”¨äº‘æœåŠ¡å™¨è¿›è¡Œæ“ä½œ</p><p><img src="/Resources/image-20230602110426224.png" alt="image-20230602110426224"></p><p><img src="/Resources/image-20230602110742631.png" alt="image-20230602110742631"></p><p>è¯´æ˜ï¼š16379-16384çš„ä½œç”¨ï¼š<a href="https://redis.io/docs/management/scaling/">https://redis.io/docs/management/scaling/</a></p><p><img src="/Resources/image-20230602143938312.png" alt="image-20230602143938312"></p><p>ä½¿ç”¨è™šæ‹Ÿæœºéœ€è¦å…³é—­é˜²ç«å¢™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status firewalld.service //æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€<br>systemctl stop firewalld.service//å…³é—­é˜²ç«å¢™<br>systemctl <span class="hljs-built_in">disable</span> firewalld.service//å¼€æœºåä¹Ÿä¸å¾—ä½¿ç”¨<br></code></pre></td></tr></table></figure><h4 id="ä¸‹è½½é•œåƒ"><a href="#ä¸‹è½½é•œåƒ" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull redis:latest<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"><a href="#åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨" class="headerlink" title="åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"></a>åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</h4><blockquote><p>åˆ›å»ºé…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åœ¨è™šæ‹Ÿæœºä¸­æˆ–è€…äº‘æœåŠ¡å™¨ä¸­</span><br><span class="hljs-built_in">mkdir</span> -p /mydata/redis/conf<br><span class="hljs-built_in">touch</span> /mydata/redis/conf/redis.conf<br></code></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨å®¹å™¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -p 6379:6379 --name redis \<br>-v /mydata/redis/data:/data \<br>-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \<br>-d redis redis-server /etc/redis/redis.conf<br></code></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹å®¹å™¨ç‰ˆæœ¬</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it redis redis-server -v<br><br><span class="hljs-comment"># Redis server v=6.2.6 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=b61f37314a089f19</span><br></code></pre></td></tr></table></figure><blockquote><p>ä¸‹è½½é…ç½®æ–‡ä»¶</p></blockquote><p>æ ¹æ®ä¸Šé¢æŸ¥è¯¢åˆ°çš„ç‰ˆæœ¬ä¸‹è½½é…ç½®æ–‡ä»¶ï¼š<a href="https://redis.io/docs/management/config/%EF%BC%8C%E8%BF%99%E9%87%8C%E7%9A%84%E7%89%88%E6%9C%AC%E6%98%AF6.2%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E4%B8%8B%E8%BD%BD6.2%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6https://raw.githubusercontent.com/redis/redis/6.2/redis.conf">https://redis.io/docs/management/config/ï¼Œè¿™é‡Œçš„ç‰ˆæœ¬æ˜¯6.2ï¼Œé‚£ä¹ˆå°±ä¸‹è½½6.2çš„é…ç½®æ–‡ä»¶https://raw.githubusercontent.com/redis/redis/6.2/redis.conf</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">requirepass</span> redis<br><span class="hljs-comment"># bind 127.0.0.1 -::1</span><br>protected-mode <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><blockquote><p>é‡å¯Rediså®¹å™¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart redis<br></code></pre></td></tr></table></figure><h4 id="è¿›å…¥Rediså®¹å™¨"><a href="#è¿›å…¥Rediså®¹å™¨" class="headerlink" title="è¿›å…¥Rediså®¹å™¨"></a>è¿›å…¥Rediså®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç›´æ¥è¿›å»rediså®¢æˆ·ç«¯ã€‚</span><br>docker <span class="hljs-built_in">exec</span> -it redis redis-cli -a redis<br><br><span class="hljs-comment"># ä¸ç„¶çš„è¯ï¼Œå°±éœ€è¦ä»¥ä¸‹ä¸¤æ¡å‘½ä»¤æ‰èƒ½è¿›å…¥rediså®¢æˆ·ç«¯</span><br>docker <span class="hljs-built_in">exec</span> -it redis /bin/bash<br>redis-cli -a redis<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602142724660.png" alt="image-20230602142724660"></p><h4 id="RedisæŒä¹…åŒ–"><a href="#RedisæŒä¹…åŒ–" class="headerlink" title="RedisæŒä¹…åŒ–"></a>RedisæŒä¹…åŒ–</h4><p>é»˜è®¤æŒä¹…åŒ–æ–¹å¼æ˜¯å¿«ç…§æŒä¹…åŒ–ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒAOFæŒä¹…åŒ–</p><blockquote><p>å‚è€ƒRedisçš„æŒä¹…åŒ–ï¼š<a href="https://conquers.github.io/posts//posts/bae4ff13.html#9%E3%80%81Redis%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6">Redisçš„æŒä¹…åŒ–æœºåˆ¶</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /mydata/redis/conf/redis.conf<br><br><span class="hljs-comment"># ä¿®æ”¹çš„ä¸‹é¢å†…å®¹</span><br>appendonly <span class="hljs-built_in">yes</span><br>ä¿å­˜<br> <br>docker restart redis<br></code></pre></td></tr></table></figure><h3 id="Redisåˆ†ç‰‡é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨-é«˜å¹¶å‘å†™ï¼‰"><a href="#Redisåˆ†ç‰‡é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨-é«˜å¹¶å‘å†™ï¼‰" class="headerlink" title="Redisåˆ†ç‰‡é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨+é«˜å¹¶å‘å†™ï¼‰"></a>Redisåˆ†ç‰‡é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨+é«˜å¹¶å‘å†™ï¼‰</h3><h4 id="ä¸‹è½½é•œåƒ-1"><a href="#ä¸‹è½½é•œåƒ-1" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h4><p>çœç•¥</p><h4 id="åˆ›å»ºæ•°æ®ç›®å½•"><a href="#åˆ›å»ºæ•°æ®ç›®å½•" class="headerlink" title="åˆ›å»ºæ•°æ®ç›®å½•"></a>åˆ›å»ºæ•°æ®ç›®å½•</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /mydata/redis/cluster/node1/data<br><span class="hljs-built_in">mkdir</span> -p /mydata/redis/cluster/node2/data<br><span class="hljs-built_in">mkdir</span> -p /mydata/redis/cluster/node3/data<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹"><a href="#åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹"></a>åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹</h4><p>åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker create --name redis-node1 -v /mydata/redis/cluster/node1/data:/data  \<br>-p 6380:6379 redis --cluster-enabled <span class="hljs-built_in">yes</span>    \<br>--cluster-config-file redis-node1.conf<br></code></pre></td></tr></table></figure><ul><li><p>éƒ¨åˆ†å‚æ•°è§£é‡Šï¼š</p><ul><li><p><code>--cluster-enabled</code>ï¼šæ˜¯å¦å¯åŠ¨é›†ç¾¤ï¼Œé€‰å€¼ï¼šyes ã€no</p></li><li><p><code>--cluster-config-file é…ç½®æ–‡ä»¶.conf </code>ï¼šæŒ‡å®šèŠ‚ç‚¹ä¿¡æ¯ï¼Œè‡ªåŠ¨ç”Ÿæˆ</p></li><li><p><code>--cluster-node-timeout æ¯«ç§’å€¼</code>ï¼š é…ç½®èŠ‚ç‚¹è¿æ¥è¶…æ—¶æ—¶é—´</p></li><li><p><del><code>--appendonly</code>ï¼šæ˜¯å¦å¼€å¯æŒä¹…åŒ–ï¼Œé€‰å€¼ï¼šyesã€no</del></p></li></ul></li></ul><p>å¯åŠ¨é›†ç¾¤ç‚¹1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker start redis-node1<br></code></pre></td></tr></table></figure><p>åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker create --name redis-node2 -v /mydata/redis/cluster/node2/data:/data  \<br>-p 6381:6379 redis --cluster-enabled <span class="hljs-built_in">yes</span>    \<br>--cluster-config-file redis-node2.conf<br></code></pre></td></tr></table></figure><p>å¯åŠ¨é›†ç¾¤èŠ‚ç‚¹2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker start redis-node2<br></code></pre></td></tr></table></figure><p>åˆ›å»ºé›†ç¾¤èŠ‚ç‚¹3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker create --name redis-node3 -v /mydata/redis/cluster/node3/data:/data  \<br>-p 6382:6379 redis --cluster-enabled <span class="hljs-built_in">yes</span>    \<br>--cluster-config-file redis-node3.conf<br></code></pre></td></tr></table></figure><p>å¯åŠ¨é›†ç¾¤èŠ‚ç‚¹3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker start redis-node3<br><br><span class="hljs-comment"># å…¨éƒ¨å¯åŠ¨</span><br>docker start redis-node1 redis-node2 redis-node3<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</p><p><img src="/Resources/image-20230601152728965.png" alt="image-20230601152728965"></p><p>æŸ¥çœ‹ <code>redis-node1 </code>ã€<code>redis-node2</code>ã€<code>redis-node3</code>å®¹å™¨è¢«åˆ†é…çš„IPåœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker inspect redis-node1 // 172.17.0.2<br>docker inspect redis-node2 // 172.17.0.3<br>docker inspect redis-node3 // 172.17.0.4<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230601152829433.png" alt="image-20230601152829433"></p><h4 id="åˆ›å»ºé›†ç¾¤"><a href="#åˆ›å»ºé›†ç¾¤" class="headerlink" title="åˆ›å»ºé›†ç¾¤"></a>åˆ›å»ºé›†ç¾¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä»¥redis-node1ä¸ºä¾‹ï¼Œè¿›å…¥redis-node1çš„å®¹å™¨</span><br>docker <span class="hljs-built_in">exec</span> -it redis-node1 /bin/bash<br><span class="hljs-comment"># åˆ›å»ºé›†ç¾¤</span><br>redis-cli --cluster create 172.17.0.2:6379 172.17.0.3:6379 172.17.0.4:6379 --cluster-replicas 0<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230601154142373.png" alt="image-20230601154142373"></p><ul><li>éƒ¨åˆ†å‚æ•°è§£é‡Šï¼š<ul><li><code>--cluster-replicas</code> ï¼šä¸»ä»æ¯”ä¾‹ï¼Œ 1 ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”å‡ ä¸ªä»èŠ‚ç‚¹ï¼Œè¿™é‡Œæ˜¯0ä¸ª</li></ul></li></ul><h4 id="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯"><a href="#æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯"></a>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥redis-node1çš„å®¹å™¨</span><br>docker <span class="hljs-built_in">exec</span> -it redis-node1 /bin/bash<br><span class="hljs-comment"># è¿›å…¥redis-node2çš„å®¹å™¨</span><br>docker <span class="hljs-built_in">exec</span> -it redis-node2 /bin/bash<br><span class="hljs-comment"># è¿›å…¥redis-node3çš„å®¹å™¨</span><br>docker <span class="hljs-built_in">exec</span> -it redis-node3 /bin/bash<br><br><span class="hljs-comment"># redis</span><br>redis-cli<br><span class="hljs-comment"># æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</span><br>127.0.0.1:6379&gt; cluster nodes<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230601155821525.png" alt="image-20230601155821525"></p><p>æ­¤æ—¶ï¼Œç”±äºä¹‹å‰åˆ›å»ºé›†ç¾¤çš„æ—¶å€™ <code>--cluster-replicas 0</code> ï¼Œå› æ­¤æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸»èŠ‚ç‚¹</p><h4 id="é›†ç¾¤æµ‹è¯•"><a href="#é›†ç¾¤æµ‹è¯•" class="headerlink" title="é›†ç¾¤æµ‹è¯•"></a>é›†ç¾¤æµ‹è¯•</h4><p>å°è¯•å†™å…¥æ•°æ®ï¼Œå‘ç°åªæœ‰ <code>node3</code> å¯ä»¥æŸ¥çœ‹æˆ–è€…å†™å…¥æ•°æ®ï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½ä¼šæŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">(error) MOVED 15495 172.17.0.4:6379`<br>MOVED æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•° 15495 æ˜¯ key å¯¹åº”çš„æ§½ä½ç¼–å·ï¼Œåé¢æ˜¯ç›®æ ‡èŠ‚ç‚¹åœ°å€ã€‚<br><br>æ§½ä½ï¼š<br>Redis é›†ç¾¤æŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹ï¼ˆå‘å¤–æä¾›æœåŠ¡çš„ masterï¼‰æ˜ å°„åˆ° [0 - 16383] slot ä¸Šï¼Œå³æ‰€æœ‰ master å‡åˆ† 16384 å¤§å°çš„ slot ç©ºé—´ï¼Œæ¯ä¸ª master å æœ‰ä¸€å®šçš„ slot ç©ºé—´<br><br>å½“å­˜å‚¨æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šå¯¹ key ä½¿ç”¨ CRC16 ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œå°†å¾—åˆ°çš„å€¼ mod 16384ï¼Œè¿™æ ·ä¸€æ¥ key çš„å€¼å§‹ç»ˆåœ¨ 0-16383 ä¹‹é—´ï¼ŒRedis åˆ™æ ¹æ® key å€¼å°†å…¶æ”¾å…¥å¯¹åº”èŒƒå›´çš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç®—å‡ºæ¥çš„ key å€¼æ˜¯ 3000ï¼ŒèŠ‚ç‚¹1çš„ slot ç©ºé—´æ˜¯ [0 - 5460]ï¼Œé‚£ä¹ˆå°±ä¼šæ”¾åˆ°èŠ‚ç‚¹1ï¼Œå¹³å‡é›†ç¾¤çš„å‹åŠ›<br><br>åŒç†ï¼Œå½“è·å–æ•°æ®æ—¶ï¼Œä¹Ÿä¼šå¯¹ Key è¿›è¡ŒåŒæ ·çš„è®¡ç®—ï¼Œæ ¹æ®å¾—åˆ°çš„å€¼å»å¯¹åº”çš„èŠ‚ç‚¹è·å–æ•°æ®<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230601160012575.png" alt="image-20230601160012575"></p><p>é”™è¯¯åŸå› ï¼šå¯åŠ¨ <code>redis</code> æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨é›†ç¾¤æ¨¡å¼</p><p>è§£å†³åŠæ³•ï¼šä½¿ç”¨ <code>redis-cli</code>æ—¶è¦åŠ ä¸Š <code>-c</code>å‚æ•°</p><p>é›†ç¾¤æ¼”ç¤ºï¼šæ¯ä¸ªå®¹å™¨ä¸­éƒ½ç”¨<code>redis-cli -c</code>å¯åŠ¨ï¼Œè¿™æ ·ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å†™å…¥æˆ–è€…æŸ¥çœ‹äº†</p><p><img src="/Resources/image-20230601164027890.png" alt="image-20230601164027890"></p><p>ç°åœ¨ <code>&#123;key : a, value : b&#125;</code>å­˜æ”¾åœ¨ <code>node3</code> ä¸­ï¼Œæ­¤æ—¶åœæ‰ <code>node3</code> å®¹å™¨ï¼Œå…¶ä»–èŠ‚ç‚¹å°±æ‹¿ä¸åˆ° <code>node3</code> å­˜å‚¨çš„æ•°æ®äº†ï¼Œé‡æ–°å¯åŠ¨ <code>node3</code> å®¹å™¨ï¼Œå³å¯æ‹¿åˆ°å€¼ã€‚</p><p><img src="/Resources/image-20230601164219994.png" alt="image-20230601164219994"></p><h4 id="é›†ç¾¤ä¿®å¤"><a href="#é›†ç¾¤ä¿®å¤" class="headerlink" title="é›†ç¾¤ä¿®å¤"></a>é›†ç¾¤ä¿®å¤</h4><p>åƒä¸Šé¢å¦‚æœé›†ç¾¤ä¸­æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå­˜å‚¨å€¼ä¹Ÿä¸å¯è¡Œäº†ï¼Œå› ä¸ºåˆ†é…çš„slotæ²¡æœ‰å˜ï¼Œä¿®å¤å‘½ä»¤ä¸»è¦æ˜¯ç”¨æ¥æ–°åŠ å…¥çš„é›†ç¾¤æ²¡æœ‰slotï¼Œéœ€è¦é‡æ–°åˆ†é…</p><p><img src="/Resources/image-20230601164631241.png" alt="image-20230601164631241"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥é‡æ–°åˆ†é…slotï¼Œå¹¶è®©è¯¥é›†ç¾¤å‰”é™¤æŒ‚æ‰çš„èŠ‚ç‚¹</span><br>redis-cli --cluster fix 172.17.0.2:6379 --cluster-fix-with-unreachable-masters<br></code></pre></td></tr></table></figure><h3 id="Redisä¸»ä»é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨-é«˜å¹¶å‘å†™-é«˜å¹¶å‘è¯»ï¼‰"><a href="#Redisä¸»ä»é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨-é«˜å¹¶å‘å†™-é«˜å¹¶å‘è¯»ï¼‰" class="headerlink" title="Redisä¸»ä»é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨+é«˜å¹¶å‘å†™+é«˜å¹¶å‘è¯»ï¼‰"></a>Redisä¸»ä»é›†ç¾¤ï¼ˆæµ·é‡å­˜å‚¨+é«˜å¹¶å‘å†™+é«˜å¹¶å‘è¯»ï¼‰</h3><h4 id="ä¸‹è½½é•œåƒ-2"><a href="#ä¸‹è½½é•œåƒ-2" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h4><p>çœç•¥</p><h4 id="åˆ é™¤ä¹‹å‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶"><a href="#åˆ é™¤ä¹‹å‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ é™¤ä¹‹å‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶"></a>åˆ é™¤ä¹‹å‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶</h4><p>åœæ­¢rediså®¹å™¨ï¼Œåˆ é™¤rediså®¹å™¨ï¼Œåˆ é™¤å¯¹åº”çš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ é™¤ä¸‰ä¸ªrediså®¹å™¨</span><br>docker stop redis-node1 redis-node2 redis-node3<br>docker <span class="hljs-built_in">rm</span> redis-node1 redis-node2 redis-node3<br><br><span class="hljs-comment"># åˆ é™¤é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">rm</span> -rf /mydata/redis/cluster/<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºè™šæ‹Ÿç½‘å¡"><a href="#åˆ›å»ºè™šæ‹Ÿç½‘å¡" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿç½‘å¡"></a>åˆ›å»ºè™šæ‹Ÿç½‘å¡</h4><p>ä¸»è¦æ˜¯ç”¨äºredis-clusterèƒ½äºå¤–ç•Œè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œä¸€èˆ¬å¸¸ç”¨æ¡¥æ¥æ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºç½‘å¡</span><br>docker network create myredis<br><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ç½‘å¡</span><br>docker network <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602143457332.png" alt="image-20230602143457332"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹ç½‘å¡è¯¦ç»†ä¿¡æ¯</span><br>docker network inspect myredis<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602143532310.png" alt="image-20230602143532310"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ é™¤ç½‘å¡å‘½ä»¤ å¤šä¸ªä¸­é—´ ç©ºæ ¼éš”å¼€(è¡¥å……)</span><br>docker network <span class="hljs-built_in">rm</span> myredis <br><span class="hljs-comment"># --help </span><br>docker network --<span class="hljs-built_in">help</span> <br></code></pre></td></tr></table></figure><h4 id="æ‰¹é‡åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#æ‰¹é‡åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="æ‰¹é‡åˆ›å»ºé…ç½®æ–‡ä»¶"></a>æ‰¹é‡åˆ›å»ºé…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 6379 6384); <br><span class="hljs-keyword">do</span> <br><span class="hljs-built_in">mkdir</span> -p /mydata/redis/cluster/node-<span class="hljs-variable">$&#123;port&#125;</span>/conf<br><span class="hljs-built_in">touch</span> /mydata/redis/cluster/node-<span class="hljs-variable">$&#123;port&#125;</span>/conf/redis.conf<br><span class="hljs-built_in">cat</span>  &lt;&lt; <span class="hljs-string">EOF &gt; /mydata/redis/cluster/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="hljs-string">port $&#123;port&#125;</span><br><span class="hljs-string">requirepass redis</span><br><span class="hljs-string">bind 0.0.0.0</span><br><span class="hljs-string">protected-mode no</span><br><span class="hljs-string">daemonize no</span><br><span class="hljs-string">appendonly yes</span><br><span class="hljs-string">cluster-enabled yes </span><br><span class="hljs-string">cluster-config-file nodes.conf</span><br><span class="hljs-string">cluster-node-timeout 5000</span><br><span class="hljs-string">cluster-announce-ip  å…¬ç½‘ipæˆ–è€…dockerå®¹å™¨å†…éƒ¨åˆ†é…çš„ip</span><br><span class="hljs-string">cluster-announce-port $&#123;port&#125;</span><br><span class="hljs-string">cluster-announce-bus-port 1$&#123;port&#125;</span><br><span class="hljs-string">masterauth redis</span><br><span class="hljs-string">EOF</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><p><code>port</code>ï¼šèŠ‚ç‚¹ç«¯å£ï¼›</p><p><code>requirepass</code>ï¼šè®¾ç½®å¯†ç ï¼Œè®¿é—®æ—¶éœ€è¦éªŒè¯</p><p><code>protected-mode</code>ï¼šä¿æŠ¤æ¨¡å¼ï¼Œé»˜è®¤å€¼ yesï¼Œå³å¼€å¯ã€‚å¼€å¯ä¿æŠ¤æ¨¡å¼ä»¥åï¼Œéœ€é…ç½® <code>bind ip</code> æˆ–è€…è®¾ç½®è®¿é—®å¯†ç ï¼›å…³é—­ä¿æŠ¤æ¨¡å¼ï¼Œå¤–éƒ¨ç½‘ç»œå¯ä»¥ç›´æ¥è®¿é—®ï¼›</p><p><code>daemonize</code>ï¼šæ˜¯å¦ä»¥å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ï¼ˆåå°å¯åŠ¨ï¼‰ï¼Œé»˜è®¤ noï¼›</p><p><code>appendonly</code>ï¼šæ˜¯å¦å¼€å¯ AOF æŒä¹…åŒ–æ¨¡å¼ï¼Œé»˜è®¤ noï¼›</p><p><code>cluster-enabled</code>ï¼šæ˜¯å¦å¼€å¯é›†ç¾¤æ¨¡å¼ï¼Œé»˜è®¤ noï¼›</p><p><code>cluster-config-file</code>ï¼šé›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯æ–‡ä»¶ï¼›</p><p><code>cluster-node-timeout</code>ï¼šé›†ç¾¤èŠ‚ç‚¹è¿æ¥è¶…æ—¶æ—¶é—´ï¼›</p><p><code>cluster-announce-ip</code>ï¼šé›†ç¾¤èŠ‚ç‚¹ IP</p><ul><li><code>æ³¨æ„ï¼š</code> å¦‚æœä½ æƒ³è¦ä½ çš„redisé›†ç¾¤å¯ä»¥ä¾›å¤–ç½‘è®¿é—®ï¼Œè¿™é‡Œç›´æ¥å¡« æœåŠ¡å™¨çš„IP åœ°å€å³å¯</li><li>å¦‚è‹¥ä¸ºäº†å®‰å…¨ï¼Œåªæ˜¯åœ¨æœåŠ¡å™¨å†…éƒ¨è¿›è¡Œè®¿é—®ï¼Œè¿™é‡Œè¿˜éœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚</li></ul><p><code>cluster-announce-port</code>ï¼šé›†ç¾¤èŠ‚ç‚¹æ˜ å°„ç«¯å£ï¼›</p><p><code>cluster-announce-bus-port</code>ï¼šé›†ç¾¤èŠ‚ç‚¹æ€»çº¿ç«¯å£ã€‚</p><p>ç›®å½•ç»“æ„ï¼šï¼ˆå¦‚æœæ²¡æœ‰ <code>tree</code> å‘½ä»¤å…ˆå®‰è£… <code>yum install -y tree</code>ï¼‰</p><p><img src="/Resources/image-20230602144300924.png" alt="image-20230602144300924"></p><h4 id="æ‰¹é‡å¯åŠ¨å®¹å™¨"><a href="#æ‰¹é‡å¯åŠ¨å®¹å™¨" class="headerlink" title="æ‰¹é‡å¯åŠ¨å®¹å™¨"></a>æ‰¹é‡å¯åŠ¨å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 6379 6384); \<br><span class="hljs-keyword">do</span> \<br>   docker run -it -d -p <span class="hljs-variable">$&#123;port&#125;</span>:<span class="hljs-variable">$&#123;port&#125;</span> -p 1<span class="hljs-variable">$&#123;port&#125;</span>:1<span class="hljs-variable">$&#123;port&#125;</span> \<br>  --privileged=<span class="hljs-literal">true</span> -v /mydata/redis/cluster/node-<span class="hljs-variable">$&#123;port&#125;</span>/conf/redis.conf:/usr/local/etc/redis/redis.conf \<br>  --privileged=<span class="hljs-literal">true</span> -v /mydata/redis/cluster/node-<span class="hljs-variable">$&#123;port&#125;</span>/data:/data \<br>  --restart always --name redis-<span class="hljs-variable">$&#123;port&#125;</span> --net myredis \<br>  --sysctl net.core.somaxconn=1024 redis redis-server /usr/local/etc/redis/redis.conf<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>-it</code>ï¼šäº¤äº’</li><li><code>-d</code>ï¼šåå°è¿è¡Œï¼Œå®¹å™¨å¯åŠ¨å®Œæˆåæ‰“å°å®¹å™¨</li><li><code>--privileged</code>ï¼šæ˜¯å¦è®©docker åº”ç”¨å®¹å™¨ è·å–å®¿ä¸»æœºrootæƒé™ï¼ˆç‰¹æ®Šæƒé™-ï¼‰</li><li><code>-p</code> :ç«¯å£æ˜ å°„</li><li><code>-v</code>ï¼šæ–‡ä»¶æŒ‚è½½</li><li><code>--sysctl</code>ï¼šå‚æ•°æ¥è®¾ç½®ç³»ç»Ÿå‚æ•°ï¼Œé€šè¿‡è¿™äº›å‚æ•°æ¥è°ƒæ•´ç³»ç»Ÿæ€§èƒ½</li><li><code>--restart always</code>ï¼šåœ¨å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯å®¹å™¨</li><li><code>--name</code>ï¼šç»™å®¹å™¨å–å</li><li><code>--net myredis</code>ï¼šä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„è™šæ‹Ÿç½‘å¡ ï¼ˆæƒ³è¯¦ç»†äº†è§£ï¼Œå¯ä»¥å»çœ‹çœ‹Docker ç½‘ç»œæ–¹é¢çŸ¥è¯†ï¼‰</li></ul><h4 id="æŸ¥çœ‹å®¹å™¨"><a href="#æŸ¥çœ‹å®¹å™¨" class="headerlink" title="æŸ¥çœ‹å®¹å™¨"></a>æŸ¥çœ‹å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps <br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602144454028.png" alt="image-20230602144454028"></p><h4 id="åˆ›å»ºRedis-Clusteré›†ç¾¤"><a href="#åˆ›å»ºRedis-Clusteré›†ç¾¤" class="headerlink" title="åˆ›å»ºRedis Clusteré›†ç¾¤"></a>åˆ›å»ºRedis Clusteré›†ç¾¤</h4><p>å¯éšæ„é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹è¿›å…¥ï¼Œåˆ›å»ºRedisé›†ç¾¤</p><p>ä»¥redis-6379å®¹å™¨ä¸ºä¾‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œ</span><br>docker <span class="hljs-built_in">exec</span> -it redis-6379 /bin/bash<br><br><span class="hljs-comment"># åˆ›å»ºé›†ç¾¤</span><br>redis-cli  -a redis --cluster create ip:6379 ip:6380 ip:6381 ip:6382 ip:6383 ip:6384   --cluster-replicas 1<br><br><span class="hljs-comment"># è¾“å…¥yes</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602144851659.png" alt="image-20230602144851659"></p><p><img src="/Resources/image-20230602144912764.png" alt="image-20230602144912764"></p><h4 id="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯-1"><a href="#æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯-1" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯"></a>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥rediså®¢æˆ·ç«¯</span><br>redis-cli -c -a redis<br><br><span class="hljs-comment"># æŸ¥çœ‹ä¿¡æ¯</span><br>cluster info<br><br><span class="hljs-comment"># æŸ¥çœ‹ä¿¡æ¯</span><br>cluster nodes<br><br><span class="hljs-comment"># é€€å‡ºredis å’Œ é€€å‡ºå®¹å™¨</span><br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602145031973.png" alt="image-20230602145031973"></p><p><img src="/Resources/image-20230602145107211.png" alt="image-20230602145107211"></p><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>æ‰“å¼€ä¸¤ä¸ªè¿æ¥ï¼Œåˆ†åˆ«è¿›å…¥6379å’Œ8381å®¹å™¨ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it redis-6379 redis-cli -c -a redis<br><span class="hljs-comment"># é™¤äº†ç«¯å£ä¸º6379çš„å®¹å™¨ï¼Œå…¶ä»–å®¹å™¨éƒ½éœ€è¦åŠ ä¸Š -p xxxxï¼Œå› ä¸ºå®¹å™¨å†…éƒ¨çš„ç«¯å£ä¸æ˜¯6379ï¼Œå¿…é¡»æŒ‡å®šå‚æ•°</span><br>docker <span class="hljs-built_in">exec</span> -it redis-6380 redis-cli -c -a redis -p 6380<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230602145439120.png" alt="image-20230602145439120"></p><h4 id="å¤–ç½‘æµ‹è¯•"><a href="#å¤–ç½‘æµ‹è¯•" class="headerlink" title="å¤–ç½‘æµ‹è¯•"></a>å¤–ç½‘æµ‹è¯•</h4><p>ä½¿ç”¨ <a href="https://github.com/qishibo/AnotherRedisDesktopManager/releases">Another Redis Desktop Manager </a>è¿æ¥redis</p><blockquote><p>å•ä¸ªè¿æ¥</p></blockquote><p><img src="/Resources/image-20230602145709520.png" alt="image-20230602145709520"></p><blockquote><p>è¿æ¥é›†ç¾¤</p></blockquote><p><img src="/Resources/image-20230602145936243.png" alt="image-20230602145936243"></p><p><img src="/Resources/image-20230602150008387.png" alt="image-20230602150008387"></p><h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p>è¿æ¥ARDMè¿æ¥6382ç«¯å£çš„redisï¼Œ6382ä¸­æ²¡æœ‰æ•°æ®ï¼Œä¸”ä½¿ç”¨<code> info replication</code> æ˜¾ç¤ºä»èŠ‚ç‚¹è¿æ¥æ•°ä¸º0</p><p><img src="/Resources/image-20230602152054362.png" alt="image-20230602152054362"></p><p>æŸ¥çœ‹6382çš„ä¿¡æ¯èƒ½çœ‹åˆ°ä¸»èŠ‚ç‚¹çš„ipï¼Œä½†æ˜¯master_link_status:down è¡¨ç¤ºæ²¡æœ‰è¿æ¥ä¸Šä¸»èŠ‚ç‚¹</p><p><img src="/Resources/image-20230602152212215.png" alt="image-20230602152212215"></p><p>è§£å†³ï¼šæ‰€æœ‰çš„é…ç½®æ–‡ä»¶åŠ ä¸Šè¿™ä¸€å¥è¯ï¼Œredisçš„è¿æ¥å¯†ç ï¼Œå·²ä¿®æ”¹ä¹‹å‰çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">masterauth redis<br></code></pre></td></tr></table></figure><p>é‡å¯ä¹‹å6379ä¸­çš„æ•°æ®åœ¨6382ä¸­å‡ºç°äº†</p><p><img src="/Resources/image-20230602153239637.png" alt="image-20230602153239637"></p><p>ä¸»èŠ‚ç‚¹ä¸­ï¼Œä»èŠ‚ç‚¹çš„è¿æ¥æ•°ä¹Ÿå˜æˆ1</p><p><img src="/Resources/image-20230602153749398.png" alt="image-20230602153749398"></p><p>ä»èŠ‚ç‚¹ä¸­master_link_status:up</p><p><img src="/Resources/image-20230602153736068.png" alt="image-20230602153736068"></p><p>å¹¶ä¸”master_replidä¹Ÿä¸€è‡´äº†</p><h4 id="æ‰¹é‡åœæ­¢å®¹å™¨ï¼ˆè¡¥å……ï¼‰"><a href="#æ‰¹é‡åœæ­¢å®¹å™¨ï¼ˆè¡¥å……ï¼‰" class="headerlink" title="æ‰¹é‡åœæ­¢å®¹å™¨ï¼ˆè¡¥å……ï¼‰"></a>æ‰¹é‡åœæ­¢å®¹å™¨ï¼ˆè¡¥å……ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 6379 6384); <br><span class="hljs-keyword">do</span> <br>docker stop redis-<span class="hljs-variable">$&#123;port&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h4 id="æ‰¹é‡åˆ é™¤å®¹å™¨ï¼ˆè¡¥å……ï¼‰"><a href="#æ‰¹é‡åˆ é™¤å®¹å™¨ï¼ˆè¡¥å……ï¼‰" class="headerlink" title="æ‰¹é‡åˆ é™¤å®¹å™¨ï¼ˆè¡¥å……ï¼‰"></a>æ‰¹é‡åˆ é™¤å®¹å™¨ï¼ˆè¡¥å……ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 6379 6384); <br><span class="hljs-keyword">do</span> <br>docker <span class="hljs-built_in">rm</span> redis-<span class="hljs-variable">$&#123;port&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h4 id="æ‰¹é‡é‡å¯å®¹å™¨ï¼ˆè¡¥å……ï¼‰"><a href="#æ‰¹é‡é‡å¯å®¹å™¨ï¼ˆè¡¥å……ï¼‰" class="headerlink" title="æ‰¹é‡é‡å¯å®¹å™¨ï¼ˆè¡¥å……ï¼‰"></a>æ‰¹é‡é‡å¯å®¹å™¨ï¼ˆè¡¥å……ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 6379 6384); <br><span class="hljs-keyword">do</span> <br>docker restart redis-<span class="hljs-variable">$&#123;port&#125;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h3 id="Redisä¸»ä»é›†ç¾¤-å“¨å…µï¼ˆæµ·é‡å­˜å‚¨-é«˜å¹¶å‘å†™-é«˜å¹¶å‘è¯»-é«˜å¯ç”¨ï¼‰"><a href="#Redisä¸»ä»é›†ç¾¤-å“¨å…µï¼ˆæµ·é‡å­˜å‚¨-é«˜å¹¶å‘å†™-é«˜å¹¶å‘è¯»-é«˜å¯ç”¨ï¼‰" class="headerlink" title="Redisä¸»ä»é›†ç¾¤+å“¨å…µï¼ˆæµ·é‡å­˜å‚¨+é«˜å¹¶å‘å†™+é«˜å¹¶å‘è¯»+é«˜å¯ç”¨ï¼‰"></a>Redisä¸»ä»é›†ç¾¤+å“¨å…µï¼ˆæµ·é‡å­˜å‚¨+é«˜å¹¶å‘å†™+é«˜å¹¶å‘è¯»+é«˜å¯ç”¨ï¼‰</h3><p>åŸºäºç¬¬äºŒæ­¥çš„ä¸»ä»é›†ç¾¤ï¼Œç»§ç»­æ­å»ºä¸»ä»é›†ç¾¤+å“¨å…µï¼šè¿™é‡Œæ­å»ºçš„æ˜¯3ä¸»3ä»3å“¨å…µ</p><p>å¾…å®Œæˆï¼šäº‘æœåŠ¡å™¨+Dockerå®ç°</p><h3 id="Redisä¸»ä»é›†ç¾¤-å“¨å…µï¼ˆè™šæ‹Ÿæœº-Docker-composeå®ç°ï¼‰"><a href="#Redisä¸»ä»é›†ç¾¤-å“¨å…µï¼ˆè™šæ‹Ÿæœº-Docker-composeå®ç°ï¼‰" class="headerlink" title="Redisä¸»ä»é›†ç¾¤+å“¨å…µï¼ˆè™šæ‹Ÿæœº+Docker-composeå®ç°ï¼‰"></a>Redisä¸»ä»é›†ç¾¤+å“¨å…µï¼ˆè™šæ‹Ÿæœº+Docker-composeå®ç°ï¼‰</h3><h4 id="Docker-composeæ­å»ºRedis-Sentinel"><a href="#Docker-composeæ­å»ºRedis-Sentinel" class="headerlink" title="Docker-composeæ­å»ºRedis Sentinel"></a>Docker-composeæ­å»ºRedis Sentinel</h4><p>æ–‡ä»¶ç»„ç»‡æ ¼å¼ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">redis-cluster<br><span class="hljs-code">â”œâ”€â”€ docker-compose.yml</span><br><span class="hljs-code">redis-sentinel</span><br><span class="hljs-code">â”œâ”€â”€ docker-compose.yml</span><br><span class="hljs-code">â”œâ”€â”€ sentinel1.conf</span><br><span class="hljs-code">â”œâ”€â”€ sentinel2.conf</span><br><span class="hljs-code">â”œâ”€â”€ sentinel3.conf</span><br></code></pre></td></tr></table></figure><h5 id="1-Master-x2F-Slave"><a href="#1-Master-x2F-Slave" class="headerlink" title="1. Master&#x2F;Slave"></a>1. Master&#x2F;Slave</h5><p>è¿›å…¥<code>redis-cluster</code>æ–‡ä»¶å¤¹ï¼Œåˆ›å»º<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œ<br>ä¸‹é¢çš„Composeæ–‡ä»¶è®¾ç½®äº†1Master 2Slave</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.6&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">master:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-master</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--requirepass</span> <span class="hljs-string">redispwd</span>  <span class="hljs-string">--masterauth</span> <span class="hljs-string">redispwd</span> <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">6379</span><span class="hljs-string">:6379</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/master:/data</span><br><br>  <span class="hljs-attr">slave1:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-slave-1</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--slaveof</span> <span class="hljs-string">redis-master</span> <span class="hljs-number">6379</span>  <span class="hljs-string">--requirepass</span> <span class="hljs-string">redispwd</span> <span class="hljs-string">--masterauth</span> <span class="hljs-string">redispwd</span>  <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">6380</span><span class="hljs-string">:6379</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/slave1:/data</span><br><br><br>  <span class="hljs-attr">slave2:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-slave-2</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--slaveof</span> <span class="hljs-string">redis-master</span> <span class="hljs-number">6379</span>  <span class="hljs-string">--requirepass</span> <span class="hljs-string">redispwd</span> <span class="hljs-string">--masterauth</span> <span class="hljs-string">redispwd</span>  <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">6381</span><span class="hljs-string">:6379</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/slave2:/data</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--slaveof</code>å¯ä»¥æ¢æˆ<code>-replicaof</code><br>æ³¨æ„ï¼Œå¦‚æœè®¾ç½®äº†Rediså®¢æˆ·ç«¯è®¿é—®å¯†ç requirepassï¼Œ é‚£ä¹ˆä¹Ÿè¦è®¾ç½®ç›¸åŒçš„å‰¯æœ¬é›†åŒæ­¥å¯†ç masterauthã€‚</p></blockquote><p>å¦å¤–æˆ‘ä»¬åé¢ä½¿ç”¨å“¨å…µæ¨¡å¼èƒ½å¤Ÿå®Œæˆæ•…éšœè½¬ç§»ï¼Œç°æœ‰çš„Masterå¯èƒ½ä¼šå˜æˆSlaveï¼Œæ•…åœ¨å½“å‰Masterå®¹å™¨ä¸­ä¹Ÿè¦æºå¸¦masterauthå‚æ•°ã€‚</p><h6 id="å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨"><a href="#å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨" class="headerlink" title="å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨"></a>å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨</h6><p>æ‰§è¡Œ<code>docker-compose up -d</code>ä¼šäº§ç”Ÿ3ä¸ªRediså®¹å™¨ï¼Œåˆ†åˆ«æ˜ å°„åˆ°å®¿ä¸»æœº6379ã€6380ã€6381ç«¯å£ï¼Œ é»˜è®¤è¿æ¥åœ¨ <strong><code>redis-cluster-default</code>ç½‘æ¡¥</strong>ï¼ˆè¿™ä¸ªåé¢ä¼šç”¨åˆ°ï¼Œç½‘æ¡¥çš„åå­—å¯ä»¥åœ¨æ‰§è¡Œ<code>docker-compose up -d</code>ä¸­çœ‹åˆ°ï¼Œè§ä¸‹å›¾ï¼‰ã€‚<br><img src="/Resources/Pasted%20image%2020220922163825.png"><br><img src="/Resources/Pasted%20image%2020220922163938.png"></p><blockquote><p>ä½¿ç”¨å·¥å…·è¿æ¥Redisæ—¶éœ€è¦ä½¿ç”¨å¯†ç redispwd</p></blockquote><h5 id="2-Redis-Sentinel"><a href="#2-Redis-Sentinel" class="headerlink" title="2. Redis Sentinel"></a>2. Redis Sentinel</h5><p>å¾ˆæ˜æ˜¾æˆ‘ä»¬å³å°†æ­å»ºçš„Sentinelå®¹å™¨éœ€è¦èƒ½è®¿é—®åˆ°ä»¥ä¸Š3ä¸ªå®¹å™¨ï¼Œæ•…éœ€è¦åœ¨å½¢æˆSentinelå®¹å™¨æ—¶ä½¿ç”¨å¤–ç½®çš„ <strong><code>redis-cluster-default</code>ç½‘æ¡¥</strong></p><h6 id="è¿›å…¥redis-sentinelæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºdocker-compose-ymlæ–‡ä»¶ï¼Œ"><a href="#è¿›å…¥redis-sentinelæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºdocker-compose-ymlæ–‡ä»¶ï¼Œ" class="headerlink" title="è¿›å…¥redis-sentinelæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œ"></a>è¿›å…¥redis-sentinelæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œ</h6><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.6&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">sentinel1:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-sentinel-1</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">26379</span><span class="hljs-string">:26379</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-sentinel</span> <span class="hljs-string">/usr/local/etc/redis/sentinel.conf</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./sentinel1.conf:/usr/local/etc/redis/sentinel.conf</span><br>  <span class="hljs-attr">sentinel2:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-sentinel-2</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">26380</span><span class="hljs-string">:26379</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-sentinel</span> <span class="hljs-string">/usr/local/etc/redis/sentinel.conf</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./sentinel2.conf:/usr/local/etc/redis/sentinel.conf</span><br>  <span class="hljs-attr">sentinel3:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-sentinel-3</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">26381</span><span class="hljs-string">:26379</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-sentinel</span> <span class="hljs-string">/usr/local/etc/redis/sentinel.conf</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./sentinel3.conf:/usr/local/etc/redis/sentinel.conf</span><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">default:</span><br>    <span class="hljs-attr">external:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">redis-cluster_default</span><br></code></pre></td></tr></table></figure><h6 id="åˆ›å»ºå“¨å…µæ–‡ä»¶ï¼Œå°†å¦‚ä¸‹å†…å®¹æ‹·è´è¿›å»"><a href="#åˆ›å»ºå“¨å…µæ–‡ä»¶ï¼Œå°†å¦‚ä¸‹å†…å®¹æ‹·è´è¿›å»" class="headerlink" title="åˆ›å»ºå“¨å…µæ–‡ä»¶ï¼Œå°†å¦‚ä¸‹å†…å®¹æ‹·è´è¿›å»"></a>åˆ›å»ºå“¨å…µæ–‡ä»¶ï¼Œå°†å¦‚ä¸‹å†…å®¹æ‹·è´è¿›å»</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs conf">port 26379  <br>dir /tmp  <br>sentinel monitor mymaster 192.168.153.135 6379 2  <br>sentinel down-after-milliseconds mymaster 30000  <br>sentinel parallel-syncs mymaster 1  <br>sentinel auth-pass mymaster redispwd  <br>sentinel failover-timeout mymaster 180000  <br>sentinel deny-scripts-reconfig yes<br></code></pre></td></tr></table></figure><p>å¸¦æ³¨é‡Šç‰ˆ</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># è‡ªå®šä¹‰é›†ç¾¤åï¼Œå…¶ä¸­192.168.153.135ä¸º redis-master çš„ ipï¼Œ6379 ä¸º redis-master çš„ç«¯å£ï¼Œ2 ä¸ºæœ€å°æŠ•ç¥¨æ•°ï¼ˆå› ä¸ºæœ‰ 3 å° Sentinel æ‰€ä»¥å¯ä»¥è®¾ç½®æˆ 2ï¼‰  </span><br><span class="hljs-section"># sentinelé€šè®¯ç«¯å£  </span><br>port 26379  <br>dir /tmp  <br><span class="hljs-section"># sentineléœ€è¦ç›‘æ§çš„master/slaverä¿¡æ¯ï¼Œæ ¼å¼ä¸ºsentinel monitor <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mastername</span>&gt;</span></span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">masterIP</span>&gt;</span></span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">masterPort</span>&gt;</span></span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">quorum</span>&gt;</span></span>  </span><br><span class="hljs-section"># å…¶ä¸­<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">quorum</span>&gt;</span></span>åº”è¯¥å°äºé›†ç¾¤ä¸­slaveçš„ä¸ªæ•°ï¼Œå½“å¤±æ•ˆçš„èŠ‚ç‚¹æ•°è¶…è¿‡äº†<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">quorum</span>&gt;</span></span>,åˆ™è®¤ä¸ºæ•´ä¸ªä½“ç³»ç»“æ„å¤±æ•ˆ  </span><br>sentinel monitor mymaster 192.168.153.135 6379 2  <br><span class="hljs-section"># masterè¢«å½“å‰sentinelå®ä¾‹è®¤å®šä¸ºå¤±æ•ˆçš„é—´éš”æ—¶é—´ï¼Œæ ¼å¼ä¸ºsentinel down-after-milliseconds <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">mastername</span>&gt;</span></span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">milliseconds</span>&gt;</span></span>  </span><br>sentinel down-after-milliseconds mymaster 30000  <br><span class="hljs-section"># å½“æ–°masteräº§æ—¶ï¼ŒåŒæ—¶è¿›è¡Œâ€œslaveofâ€åˆ°æ–°masterå¹¶è¿›è¡ŒåŒæ­¥å¤åˆ¶çš„slaveä¸ªæ•°  </span><br><span class="hljs-section"># åœ¨salveæ‰§è¡ŒsalveofåŒæ­¥æ—¶ï¼Œå°†ä¼šç»ˆæ­¢å®¢æˆ·ç«¯è¯·æ±‚ã€‚  </span><br><span class="hljs-section"># æ­¤å€¼è¾ƒå¤§,æ„å‘³ç€â€œé›†ç¾¤â€ç»ˆæ­¢å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶é—´æ€»å’Œå’Œè¾ƒå¤§ã€‚  </span><br><span class="hljs-section"># æ­¤å€¼è¾ƒå°,æ„å‘³ç€â€œé›†ç¾¤â€åœ¨æ•…éšœè½¬ç§»æœŸé—´ï¼Œå¤šä¸ªsalveå‘å®¢æˆ·ç«¯æä¾›æœåŠ¡æ—¶ä»ç„¶ä½¿ç”¨æ—§æ•°æ®ã€‚  </span><br>sentinel parallel-syncs mymaster 1  <br>sentinel auth-pass mymaster redispwd  <br><span class="hljs-section"># failoverè¿‡æœŸæ—¶é—´ã€‚å½“failoverå¼€å§‹åï¼Œåœ¨æ­¤æ—¶é—´å†…ä»ç„¶æ²¡æœ‰è§¦å‘ä»»ä½•failoveræ“ä½œï¼Œå½“å‰sentinelå°†ä¼šè®¤ä¸ºæ­¤æ¬¡failoerå¤±è´¥ã€‚  </span><br>sentinel failover-timeout mymaster 180000  <br>sentinel deny-scripts-reconfig yes<br></code></pre></td></tr></table></figure><h6 id="å°†å“¨å…µæ–‡ä»¶å¤åˆ¶ä¸‰ä»½åˆ°docker-composeåŒä¸€ç›®å½•ä¸‹"><a href="#å°†å“¨å…µæ–‡ä»¶å¤åˆ¶ä¸‰ä»½åˆ°docker-composeåŒä¸€ç›®å½•ä¸‹" class="headerlink" title="å°†å“¨å…µæ–‡ä»¶å¤åˆ¶ä¸‰ä»½åˆ°docker-composeåŒä¸€ç›®å½•ä¸‹"></a>å°†å“¨å…µæ–‡ä»¶å¤åˆ¶ä¸‰ä»½åˆ°docker-composeåŒä¸€ç›®å½•ä¸‹</h6><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">redis-sentinel<br><span class="hljs-code">â”œâ”€â”€ docker-compose.yml</span><br><span class="hljs-code">â”œâ”€â”€ sentinel1.conf</span><br><span class="hljs-code">â”œâ”€â”€ sentinel2.conf</span><br><span class="hljs-code">â”œâ”€â”€ sentinel3.conf</span><br></code></pre></td></tr></table></figure><h6 id="å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨-1"><a href="#å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨-1" class="headerlink" title="å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨"></a>å¯åŠ¨å¹¶æŸ¥çœ‹å®¹å™¨</h6><p>æ‰§è¡Œ<code>docker-compose up -d</code>ç”Ÿæˆ3ä¸ªSentinelå®¹å™¨ã€‚<br><img src="/Resources/Pasted%20image%2020220922163916.png"></p><h5 id="3-è¿è¡Œæµ‹è¯•"><a href="#3-è¿è¡Œæµ‹è¯•" class="headerlink" title="3. è¿è¡Œæµ‹è¯•"></a>3. è¿è¡Œæµ‹è¯•</h5><h6 id="æµ‹è¯•Master-x2F-Slave"><a href="#æµ‹è¯•Master-x2F-Slave" class="headerlink" title="æµ‹è¯•Master&#x2F;Slave"></a>æµ‹è¯•Master&#x2F;Slave</h6><p>ä½¿ç”¨å¯è§†åŒ–å·¥å…·å¯¹6379ï¼ˆmasterèŠ‚ç‚¹ï¼‰æ·»åŠ æ•°æ®åï¼Œå…¶ä»–èŠ‚ç‚¹åŒæ­¥æ•°æ®å¦‚å›¾ï¼š<br><img src="/Resources/Pasted%20image%2020220921161453.png"></p><p>ä½¿ç”¨springbootåº”ç”¨æ·»åŠ æ•°æ®åï¼ˆæ·»åŠ çš„æ•°æ®æ˜¯<code>com.cqupt.dao.UserDao</code>ï¼‰ï¼Œå…¶ä»–èŠ‚ç‚¹åŒæ­¥æ•°æ®å¦‚å›¾ï¼šï¼ˆéœ€è¦åœ¨<code>application.yml</code>ä¸­é…ç½®å¯†ç ï¼‰<br><img src="/Resources/Pasted%20image%2020220921162153.png"></p><h6 id="æµ‹è¯•Sentinel"><a href="#æµ‹è¯•Sentinel" class="headerlink" title="æµ‹è¯•Sentinel"></a>æµ‹è¯•Sentinel</h6><p>æŸ¥çœ‹å“¨å…µçš„æ—¥å¿—ï¼š<br><img src="/Resources/Pasted%20image%2020220922164106.png"></p><blockquote><p>ä¸Šè¿°æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºï¼Œå“¨å…µç›‘å¬masterå’ŒslaveèŠ‚ç‚¹</p></blockquote><p>ç­‰å¾…30såï¼ˆé˜²æ­¢å…¶ä»–é”™è¯¯å‘ç”Ÿï¼Œä¾‹å¦‚é—®é¢˜1ç­‰ï¼‰åœæ­¢redis-masteræœåŠ¡å™¨ï¼š<br><img src="/Resources/Pasted%20image%2020220922164132.png"></p><p>é€šè¿‡rediså¯è§†åŒ–å·¥å…·æŸ¥çœ‹redisé›†ç¾¤ä¿¡æ¯<br><img src="/Resources/Pasted%20image%2020220922142732.png"></p><blockquote><p>6380å†™å…¥æ•°æ®ï¼ŒåŒæ ·å¯ä»¥åœ¨6381æŸ¥çœ‹æ•°æ®ï¼Œå¦å¤–6381ä¸èƒ½å†™å…¥æ•°æ®ï¼Œç¬¦åˆä»èŠ‚ç‚¹çš„å±æ€§ï¼Œå› æ­¤åœ¨6379ä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œ6380æˆä¸ºäº†æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œ6381ä¾ç„¶æ˜¯ä»èŠ‚ç‚¹ã€‚</p></blockquote><p>æ‰“å¼€redis-masteræœåŠ¡å™¨ï¼š<br><img src="/Resources/Pasted%20image%2020220922164250.png"></p><blockquote><p>ä¸Šè¿°æ—¥å¿—è¡¨æ˜å“¨å…µæ£€æµ‹åˆ°åŸmasteré‡æ–°å¯åŠ¨ï¼Œå°†åŸmasterèŠ‚ç‚¹å˜æˆæ–°masterçš„ä»èŠ‚ç‚¹<br>æ­¤æ—¶ï¼Œ6380å†™å…¥æ•°æ®ï¼ŒåŒæ ·å¯ä»¥åœ¨6381ï¼Œ6379æŸ¥çœ‹æ•°æ®ã€‚<br>æµ‹è¯•çœç•¥ï¼</p></blockquote><h6 id="éªŒè¯Sentinel"><a href="#éªŒè¯Sentinel" class="headerlink" title="éªŒè¯Sentinel"></a>éªŒè¯Sentinel</h6><p>è¿›å…¥redis-slave-1å‘ç°å·²ç»å˜æˆäº†ä¸»èŠ‚ç‚¹<br><img src="/Resources/Pasted%20image%2020220922164945.png"></p><p>è¿›å…¥redis-masterå‘ç°å·²ç»å˜æˆäº†ä»èŠ‚ç‚¹<br><img src="/Resources/Pasted%20image%2020220922165048.png"></p><h4 id="å¯èƒ½é‡åˆ°çš„é”™è¯¯ä¿¡æ¯"><a href="#å¯èƒ½é‡åˆ°çš„é”™è¯¯ä¿¡æ¯" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é”™è¯¯ä¿¡æ¯"></a>å¯èƒ½é‡åˆ°çš„é”™è¯¯ä¿¡æ¯</h4><h5 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a>é—®é¢˜1</h5><p>åœ¨å¯åŠ¨ä¹‹åæŸ¥çœ‹å“¨å…µçš„æ—¥å¿—å¯èƒ½å‡ºç°å¦‚å›¾æ‰€ç¤ºï¼ˆæ²¡æœ‰å…³é—­masterï¼Œä½†æ˜¯æ£€æµ‹åˆ°äº†masterå…³é—­ï¼‰<br><img src="/Resources/Pasted%20image%2020220922143955.png"><br><strong>è¿™å°±éœ€è¦å¼€æ”¾ç«¯å£è®¿é—®ï¼Œè§è™šæ‹Ÿæœºå…³é—­é˜²ç«å¢™</strong></p><h5 id="é—®é¢˜2"><a href="#é—®é¢˜2" class="headerlink" title="é—®é¢˜2"></a>é—®é¢˜2</h5><p>ä½†æ˜¯ç»è¿‡æµ‹è¯•åå‘ç°6380å’Œ6381å¯ä»¥åŒæ­¥æ•°æ®ï¼Œ79è·å–ä¸åˆ°åœ¨80æ–°æ·»åŠ çš„æ•°æ®ï¼ŒæŸ¥çœ‹6379çš„æ—¥å¿—å‘ç°è¿æ¥ä¸ä¸Šmaster<br><img src="/Resources/Pasted%20image%2020220922144318.png"></p><p><strong>æ£€æŸ¥<code>docker-compose.yml</code>æ–‡ä»¶ä¸­æ˜¯å¦æ¯ä¸ªèŠ‚ç‚¹éƒ½æ·»åŠ äº†<code>masterauth redispwd</code> é€‰é¡¹ï¼Œå½“æ—¶åœ¨ä¸»èŠ‚ç‚¹ä¸­æ·»åŠ å¯¼è‡´é”™è¯¯</strong><br><img src="/Resources/Pasted%20image%2020220922153640.png"></p><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="MySQL-5-7"><a href="#MySQL-5-7" class="headerlink" title="MySQL 5.7"></a>MySQL 5.7</h3><h4 id="1ã€æœç´¢é•œåƒ-3"><a href="#1ã€æœç´¢é•œåƒ-3" class="headerlink" title="1ã€æœç´¢é•œåƒ"></a>1ã€æœç´¢é•œåƒ</h4><p><img src="/Resources/Pasted%20image%2020220711214516.png" alt="Pasted image 20220711214516.png"></p><h4 id="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-3"><a href="#2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-3" class="headerlink" title="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬</h4><p><img src="/Resources/Pasted%20image%2020220711214709.png" alt="Pasted image 20220711214709.png"><br><img src="/Resources/Pasted%20image%2020220711214718.png" alt="Pasted image 20220711214718.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull mysql:5.7<br></code></pre></td></tr></table></figure><h4 id="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-2"><a href="#3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-2" class="headerlink" title="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ"></a>3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ</h4><p><img src="/Resources/Pasted%20image%2020220711214829.png" alt="Pasted image 20220711214829.png"></p><h4 id="4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶"><a href="#4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶" class="headerlink" title="4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶"></a>4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /mydata/mysql/data<br><span class="hljs-built_in">mkdir</span> -p /mydata/mysql/log<br><span class="hljs-built_in">mkdir</span> -p /mydata/mysql/conf<br><br><span class="hljs-comment"># æˆ–è€…</span><br><span class="hljs-built_in">mkdir</span> -p /mydata/mysql/&#123;data,conf,init&#125;<br></code></pre></td></tr></table></figure><h4 id="5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"><a href="#5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨" class="headerlink" title="5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"></a>5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -p 3307:3306 --name mysql -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7<br><br><span class="hljs-comment"># æ³¨ï¼šå¦‚æœæ˜¯æœåŠ¡å™¨ä¸è¦ä½¿ç”¨rootè¿™ç§ç®€å•å¯†ç ï¼Œä¸ç„¶å®¹æ˜“å‡ºé—®é¢˜ï¼ŒQWEIOP1234</span><br><br>éƒ¨åˆ†å‚æ•°è¯´æ˜<br>-p 3306:3306:å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£<br><br>: å†’å·å‰æ˜¯å®¿ä¸»æœºçš„è·¯å¾„ï¼Œå†’å·åæ˜¯å®¹å™¨çš„è·¯å¾„<br>-v /mydata/mysql/conf:/etc/mysql:å°†é…ç½®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº<br>-v /mydata/mysql/log:/var/log/mysql:å°†æ—¥å¿—æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº<br>-v /mydata/mysql/data:/var/lib/mysql/:å°†é…ç½®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº<br>-e MYSQL_ROOT_PASSWORD=root:åˆå§‹åŒ–rootç”¨æˆ·çš„å¯†ç <br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220711215847.png" alt="Pasted image 20220711215847.png"></p><p>æŸ¥çœ‹è¿›ç¨‹<code>docker ps</code><br><img src="/Resources/Pasted%20image%2020220712093152.png" alt="Pasted image 20220712093152.png"></p><p><code>docker exec -it mysql /bin/bash</code> è¿›å…¥è£…è½½mysqlçš„å®¹å™¨<br><img src="/Resources/Pasted%20image%2020220712093710.png" alt="Pasted image 20220712093710.png"><br><code>exit</code>é€€å‡ºè£…è½½mysqlçš„å®¹å™¨</p><h4 id="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><h5 id="è¿›å…¥ç›®å½•"><a href="#è¿›å…¥ç›®å½•" class="headerlink" title="è¿›å…¥ç›®å½•"></a>è¿›å…¥ç›®å½•</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /mydata/mysql/conf<br></code></pre></td></tr></table></figure><h5 id="ä¿®æ”¹æ–‡ä»¶"><a href="#ä¿®æ”¹æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶"></a>ä¿®æ”¹æ–‡ä»¶</h5><blockquote><p>æŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ŒæŒ‰escé€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œè¾“å…¥:wqä¿å­˜é€€å‡º</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi my.cnf<br></code></pre></td></tr></table></figure><p><code>my.cnf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cnf">[client]<br>default-character-set=utf8<br>[mysql]<br>default-character-set=utf8<br>[mysqld]<br>init_connect=&#x27;SET collation_connection = utf8_unicode_ci&#x27;<br>init_connect=&#x27;SET NAMES utf8&#x27;<br>character-set-server=utf8<br>collation-server=utf8_unicode_ci<br>skip-character-set-client-handshake<br>skip-name-resolve<br></code></pre></td></tr></table></figure><h5 id="é‡å¯"><a href="#é‡å¯" class="headerlink" title="é‡å¯"></a>é‡å¯</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart mysql<br></code></pre></td></tr></table></figure><h5 id="è¿›å…¥äº¤äº’æ¨¡å¼"><a href="#è¿›å…¥äº¤äº’æ¨¡å¼" class="headerlink" title="è¿›å…¥äº¤äº’æ¨¡å¼"></a>è¿›å…¥äº¤äº’æ¨¡å¼</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it mysql /bin/bash<br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹å®¹å™¨çš„é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹å®¹å™¨çš„é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å®¹å™¨çš„é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹å®¹å™¨çš„é…ç½®æ–‡ä»¶</h5><p><img src="/Resources/Pasted%20image%2020220712102635.png" alt="Pasted image 20220712102635.png"></p><h5 id="é€€å‡ºäº¤äº’æ¨¡å¼"><a href="#é€€å‡ºäº¤äº’æ¨¡å¼" class="headerlink" title="é€€å‡ºäº¤äº’æ¨¡å¼"></a>é€€å‡ºäº¤äº’æ¨¡å¼</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><h4 id="7ã€ä½¿ç”¨å¯è§†åŒ–æ•°æ®åº“è¿æ¥MySQL"><a href="#7ã€ä½¿ç”¨å¯è§†åŒ–æ•°æ®åº“è¿æ¥MySQL" class="headerlink" title="7ã€ä½¿ç”¨å¯è§†åŒ–æ•°æ®åº“è¿æ¥MySQL"></a>7ã€ä½¿ç”¨å¯è§†åŒ–æ•°æ®åº“è¿æ¥MySQL</h4><blockquote><p>æ³¨æ„ï¼Œipå¯èƒ½ä¼šæ”¹å˜ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨<code>ip a</code>æŸ¥çœ‹</p></blockquote><p><img src="/Resources/Pasted%20image%2020220711220215.png" alt="Pasted image 20220711220215.png"></p><blockquote><p>å¦‚æœç”¨çš„æœåŠ¡å™¨çš„æ•°æ®åº“ï¼Œæœ‰å¯èƒ½è¢«æ‹’ç»é“¾æ¥</p></blockquote><p>è§£å†³åŠæ³•ï¼š<a href="https://blog.csdn.net/iiiiiilikangshuai/article/details/100905996">is not allowed to connect to this mysql server_å¯è¡Œçš„codeçš„åšå®¢-CSDNåšå®¢</a></p><blockquote><p>å¦‚æœç”¨çš„è™šæ‹Ÿæœºï¼Œæœ‰å¯èƒ½timed out: connect</p></blockquote><p>è§£å†³åŠæ³•ï¼šå…³é—­è™šæ‹Ÿæœºçš„é˜²ç«å¢™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">disable</span> firewalld.service<br>systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="MySQL-8"><a href="#MySQL-8" class="headerlink" title="MySQL 8"></a>MySQL 8</h3><h4 id="1ã€æœç´¢é•œåƒ-4"><a href="#1ã€æœç´¢é•œåƒ-4" class="headerlink" title="1ã€æœç´¢é•œåƒ"></a>1ã€æœç´¢é•œåƒ</h4><h4 id="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-4"><a href="#2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-4" class="headerlink" title="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull mysql:latest<br><span class="hljs-comment"># æ­¤æ—¶çš„latest ä¸º8.0.27</span><br></code></pre></td></tr></table></figure><h4 id="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-3"><a href="#3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-3" class="headerlink" title="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ"></a>3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ</h4><h4 id="4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶-1"><a href="#4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶-1" class="headerlink" title="4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶"></a>4ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bask">mkdir -p /mydata/mysql8/data<br>mkdir -p /mydata/mysql8/log<br>mkdir -p /mydata/mysql8/conf<br>mkdir -p /mydata/mysql8/mysql-files<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">[mysqld]<br><span class="hljs-comment"># è®¾ç½®3306ç«¯å£</span><br>port=3306<br><span class="hljs-comment"># å…è®¸æœ€å¤§è¿æ¥æ•°</span><br>max_connections=1000<br><span class="hljs-comment"># å…è®¸è¿æ¥å¤±è´¥çš„æ¬¡æ•°ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢æœ‰äººä»è¯¥ä¸»æœºè¯•å›¾æ”»å‡»æ•°æ®åº“ç³»ç»Ÿ</span><br>max_connect_errors=100<br><span class="hljs-comment"># æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸ºUTF8</span><br>character-set-server=utf8mb4<br><span class="hljs-comment"># åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“</span><br>default-storage-engine=INNODB<br><span class="hljs-comment"># é»˜è®¤ä½¿ç”¨â€œmysql_native_passwordâ€æ’ä»¶è®¤è¯</span><br>default_authentication_plugin=mysql_native_password<br><span class="hljs-comment">#æ˜¯å¦å¯¹sqlè¯­å¥å¤§å°å†™æ•æ„Ÿï¼Œ1è¡¨ç¤ºä¸æ•æ„Ÿ</span><br>lower_case_table_names = 1<br><span class="hljs-comment">#MySQLè¿æ¥é—²ç½®è¶…è¿‡ä¸€å®šæ—¶é—´å(å•ä½ï¼šç§’)å°†ä¼šè¢«å¼ºè¡Œå…³é—­</span><br><span class="hljs-comment">#MySQLé»˜è®¤çš„wait_timeout  å€¼ä¸º8ä¸ªå°æ—¶, interactive_timeoutå‚æ•°éœ€è¦åŒæ—¶é…ç½®æ‰èƒ½ç”Ÿæ•ˆ</span><br>interactive_timeout = 1800<br>wait_timeout = 1800<br><span class="hljs-comment">#Metadata Lockæœ€å¤§æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œ ä¸€èˆ¬ç”¨äºæ§åˆ¶ alteræ“ä½œçš„æœ€å¤§æ—¶é•¿sine mysql5.6</span><br><span class="hljs-comment">#æ‰§è¡Œ DMLæ“ä½œæ—¶é™¤äº†å¢åŠ innodbäº‹åŠ¡é”å¤–è¿˜å¢åŠ Metadata Lockï¼Œå…¶ä»–alterï¼ˆDDLï¼‰sessionå°†é˜»å¡</span><br>lock_wait_timeout = 3600<br><span class="hljs-comment">#å†…éƒ¨å†…å­˜ä¸´æ—¶è¡¨çš„æœ€å¤§å€¼ã€‚</span><br><span class="hljs-comment">#æ¯”å¦‚å¤§æ•°æ®é‡çš„group by ,order byæ—¶å¯èƒ½ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œ</span><br><span class="hljs-comment">#è¶…è¿‡äº†è¿™ä¸ªå€¼å°†å†™å…¥ç£ç›˜ï¼Œç³»ç»ŸIOå‹åŠ›å¢å¤§</span><br>tmp_table_size = 64M<br>max_heap_table_size = 64M<br>[mysql]<br><span class="hljs-comment"># è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†</span><br>default-character-set=utf8mb4<br>[client]<br><span class="hljs-comment"># è®¾ç½®mysqlå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶é»˜è®¤ä½¿ç”¨çš„ç«¯å£</span><br>port=3306<br>default-character-set=utf8mb4<br></code></pre></td></tr></table></figure><h4 id="5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨-1"><a href="#5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨-1" class="headerlink" title="5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"></a>5ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  --restart=always --privileged=<span class="hljs-literal">true</span> --name mysql8 \<br>-v /mydata/mysql8/conf:/etc/mysql/conf.d \<br>-v /mydata/mysql8/data:/var/lib/mysql \<br>-v /mydata/mysql8/log:/var/log \<br>-v /mydata/mysql8/mysql-files:/var/lib/mysql-files \<br>-p 3307:3306 -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&#x27;root&#x27;</span> -d mysql:latest<br><br><span class="hljs-comment"># æ³¨ï¼šå¦‚æœæ˜¯æœåŠ¡å™¨ä¸è¦ä½¿ç”¨rootè¿™ç§ç®€å•å¯†ç ï¼Œä¸ç„¶å®¹æ˜“å‡ºé—®é¢˜</span><br><br><span class="hljs-comment"># å¦‚æœå¯åŠ¨æŠ¥é”™ï¼Œç¡®ä¿dataç›®å½•ä¸ºç©ºï¼Œå†æ’æŸ¥å…¶ä»–é”™è¯¯</span><br><br>docker run  --restart=always --privileged=<span class="hljs-literal">true</span> --name mysql8 \<br>-v /DockerData/mysql/mysql8.0/conf:/etc/mysql/conf.d \<br>-v /DockerData/mysql/mysql8.0/data:/var/lib/mysql \<br>-v /DockerData/mysql/mysql8.0/log:/var/log \<br>-v /DockerData/mysql/mysql8.0/mysql-files:/var/lib/mysql-files \<br>-p 3306:3306 -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&#x27;root&#x27;</span> -d mysql:8.0<br><br>docker run  --name mysql8 -p 3306:3306  -v /d/DockerSpace/mysql/data:/var/lib/mysql  -v /d/DockerSpace/mysql/log:/var/log/mysql  -v /d/DockerSpace/mysql/conf/my.cnf:/etc/mysql/my.cnf -e MYSQL_ROOT_PASSWORD=root --restart=always  -d mysql:8.0<br><span class="hljs-comment"># --restart=always åˆ›å»ºå®¹å™¨æ—¶æ²¡æœ‰æ·»åŠ å‚æ•°  --restart=always ï¼Œå¯¼è‡´çš„åæœæ˜¯ï¼šå½“ Docker é‡å¯æ—¶ï¼Œå®¹å™¨æœªèƒ½è‡ªåŠ¨å¯åŠ¨ã€‚</span><br><br></code></pre></td></tr></table></figure><h3 id="MySQL-ä¸»ä»å¤åˆ¶"><a href="#MySQL-ä¸»ä»å¤åˆ¶" class="headerlink" title="MySQL ä¸»ä»å¤åˆ¶"></a>MySQL ä¸»ä»å¤åˆ¶</h3><p>ä»¥ <code>MySQL 8</code> ä¸ºä¾‹</p><p>å®‰è£…å¥½ä¸€å°åï¼Œå†ä»¥ç›¸åŒæ–¹å¼å®‰è£…å¦ä¸€å°å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /mydata/mysql8_slave/data<br><span class="hljs-built_in">mkdir</span> -p /mydata/mysql8_slave/log<br><span class="hljs-built_in">mkdir</span> -p /mydata/mysql8_slave/conf<br><span class="hljs-built_in">mkdir</span> -p /mydata/mysql8_slave/mysql-files<br><br><span class="hljs-comment"># é…ç½®æ–‡ä»¶å¤åˆ¶ mysql8 çš„</span><br><br>docker run  --restart=always --privileged=<span class="hljs-literal">true</span> --name mysql8_slave \<br>-v /mydata/mysql8_slave/conf:/etc/mysql/conf.d \<br>-v /mydata/mysql8_slave/data:/var/lib/mysql \<br>-v /mydata/mysql8_slave/log:/var/log \<br>-v /mydata/mysql8_slave/mysql-files:/var/lib/mysql-files \<br>-p 3308:3306 -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&#x27;root&#x27;</span> -d mysql:latest<br></code></pre></td></tr></table></figure><p>ä¸¤å° <code>MySQL</code> æœåŠ¡å™¨å¦‚ä¸‹ï¼š</p><p><img src="/Resources/image-20230629094614377.png" alt="image-20230629094614377"></p><p>ä¿®æ”¹ <code>mysql8</code> çš„é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">[mysqld]</span><br><span class="hljs-comment">#[å¿…é¡»]ä¸»æœåŠ¡å™¨å”¯ä¸€ID</span><br><span class="hljs-attr">server-id</span>=<span class="hljs-string">1</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—,æŒ‡åè·¯å¾„ã€‚</span><br><span class="hljs-attr">log-bin</span>=<span class="hljs-string">/var/log/mysql/binlog/atguigu-bin</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>mysql8_slave</code> çš„é…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">[mysqld]</span><br><span class="hljs-comment">#[å¿…é¡»]ä»æœåŠ¡å™¨å”¯ä¸€ID</span><br><span class="hljs-attr">server-id</span>=<span class="hljs-string">2</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># è¿™é‡Œåº”è¯¥è¦å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ï¼Œä½†ä»…ä½œæ¼”ç¤ºï¼Œæ‰€ä»¥å°±çœç•¥äº†</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>binlog</code> æ–‡ä»¶å¤¹æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exit</span> -it mysql8 /bin/bash<br><span class="hljs-built_in">cd</span> /var/log<br><span class="hljs-built_in">mkdir</span> -p mysql/binlog<br><span class="hljs-built_in">chown</span> -R -v mysql:mysql binlog<br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><p>é‡å¯å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker restart mysql8 mysql8_slave<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å¯è§†åŒ–è½¯ä»¶è¿æ¥ä¸¤ä¸ªå®¹å™¨æˆ–è€…åˆ†åˆ«è¿›å…¥å®¹å™¨ä¸­çš„ <code>MySQL</code> </p><p>åœ¨ ä¸»æœºï¼š<code>mysql8</code> ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; CREATE USER &#x27;slave&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;ä¸»æœºå¯†ç &#x27;;<br><br>mysql&gt; GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;slave&#x27;@&#x27;%&#x27;;<br><br>mysql&gt; show master status;<br># ä¿å­˜Fileå’ŒPositionï¼Œä¸‹ä¸€æ­¥ä¼šç”¨åˆ°<br></code></pre></td></tr></table></figure><p><img src="/Resources/image-20230629100530400.png" alt="image-20230629100530400"></p><p>åœ¨ä»æœºï¼š<code>mysql8_slave</code> ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; change master to master_host=&#x27;ä¸»æœºip&#x27;, master_user=&#x27;slave&#x27;, master_password=&#x27;ä¸»æœºå¯†ç &#x27;, master_port=ä¸»æœºç«¯å£, master_log_file=&#x27;atguigu-bin.000001&#x27;, master_log_pos=1531, master_connect_retry=30;<br># master_log_file æ˜¯ä¸Šé¢çš„File<br># master_log_pos  æ˜¯ä¸Šé¢çš„Position<br><br><br>mysql&gt; show slave status;<br>+----------------+-----------------+<br>|Slave_IO_Running|Slave_SQL_Running|<br>+----------------+-----------------+<br>|NO              |NO               |<br>+----------------+-----------------+<br><br>mysql&gt; start slave;<br>+----------------+-----------------+<br>|Slave_IO_Running|Slave_SQL_Running|<br>+----------------+-----------------+<br>|Yes             |Yes              |<br>+----------------+-----------------+<br># Yes è¯´æ˜å¯åŠ¨æ•°æ®åŒæ­¥æˆåŠŸ<br></code></pre></td></tr></table></figure><p>éªŒè¯æµ‹è¯•ï¼š</p><p>ä¸»æœºåˆ›å»ºæ•°æ®åº“ <code>test_bck</code></p><p>åˆ›å»ºæ•°æ®è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE account(<br>id INT PRIMARY KEY AUTO_INCREMENT,<br>NAME VARCHAR(15),<br>balance DECIMAL(10,2)<br>);<br></code></pre></td></tr></table></figure><p>æ’å…¥æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; INSERT INTO test_bck.account (id, NAME, balance) VALUES (1, &#x27;wtt&#x27;, 100.00)<br></code></pre></td></tr></table></figure><p>åˆ·æ–°ä»æ•°æ®åº“çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥å‘ç°æ•°æ®å·²ç»åŒæ­¥äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from test_bck.account;<br>+--+----+-------+<br>|id|NAME|balance|<br>+--+----+-------+<br>|1 |wtt |100.00 |<br>+--+----+-------+<br></code></pre></td></tr></table></figure><p>è¡¥å……ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ä»æœºæ‰§è¡Œ<br># åœæ­¢åŒæ­¥<br>mysql&gt; stop slave;<br># å¦‚æœå†æ¬¡ä½¿ç”¨æ•°æ®åŒæ­¥ï¼Œéœ€è¦é‡æ–°é…ç½®ä¸»ä»<br>mysql&gt; reset master; #åˆ é™¤Masterä¸­æ‰€æœ‰çš„binglogæ–‡ä»¶ï¼Œå¹¶å°†æ—¥å¿—ç´¢å¼•æ–‡ä»¶æ¸…ç©ºï¼Œé‡æ–°å¼€å§‹æ‰€æœ‰æ–°çš„æ—¥å¿—æ–‡ä»¶(æ…ç”¨)<br></code></pre></td></tr></table></figure><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><h3 id="1ã€æœç´¢é•œåƒ-5"><a href="#1ã€æœç´¢é•œåƒ-5" class="headerlink" title="1ã€æœç´¢é•œåƒ"></a>1ã€æœç´¢é•œåƒ</h3><h3 id="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-5"><a href="#2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬-5" class="headerlink" title="2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬"></a>2ã€å®‰è£…æŒ‡å®šç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull nginx:1.19.10<br></code></pre></td></tr></table></figure><blockquote><p><img src="/./Resources/image-20230718113454570.png" alt="image-20230718113454570"><br>é—®é¢˜ï¼šæŠ¥é”™<br>åŸå› ï¼šæ²¡æœ‰é…ç½®DNS<br>è§£å†³ï¼šé…ç½®DNSè§£ææœåŠ¡å™¨<a href="%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA.md#%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E5%8D%A1">é…ç½®è™šæ‹Ÿæœºç½‘å¡</a><br>æ·»åŠ DNS1&#x3D;114.114.114.114, DNS2&#x3D;8.8.8.8</p></blockquote><h3 id="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-4"><a href="#3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ-4" class="headerlink" title="3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ"></a>3ã€æŸ¥çœ‹å·²å®‰è£…çš„é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker images<br></code></pre></td></tr></table></figure><h3 id="3-5ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶"><a href="#3-5ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶" class="headerlink" title="3.5ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶"></a>3.5ã€åˆ›å»ºæŒ‚è½½çš„é…ç½®æ–‡ä»¶</h3><blockquote><p>æ˜ å°„æ–‡ä»¶å‰ï¼Œé¦–å…ˆè¦<strong>å…ˆåˆ›å»ºå¥½</strong>æ‰å¯ä»¥æ˜ å°„ï¼<br>å¦‚æœæ²¡æœ‰åˆ›å»ºå°±æ‰§è¡Œçš„è¯ï¼Œdockerä¼šé»˜è®¤æ˜ å°„æ–‡ä»¶å¤¹çš„ç±»å‹ğŸ“‚ï¼ˆå¹¶ä¸”ä¼šè‡ªåŠ¨åˆ›å»ºç›¸åº”çš„æ–‡ä»¶å¤¹ï¼‰ï¼Œè¿™é‡Œå°±ä¼šè‡ªåŠ¨åˆ›å»ºsoftwareä¸‹çš„nginxæ–‡ä»¶å¤¹ğŸ“‚å’Œnginx.confæ–‡ä»¶å¤¹ğŸ“‚<br> <img src="/./Resources/image-20230718113501876.png" alt="image-20230718113501876"></p></blockquote><p>é…ç½®<code>nginx.conf</code>æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>ç¬¬ä¸€ç§ï¼šç½‘ä¸Šæ‰¾<br><strong>ç¬¬äºŒç§ï¼šå¤åˆ¶å®¹å™¨å†…çš„<code>nginx.conf</code></strong></p><ul><li>åˆ é™¤åˆšåˆš<code>docker</code>è‡ªåŠ¨åˆ›å»ºçš„<code>nginx.conf</code>ğŸ“‚  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf nginx.conf<br></code></pre></td></tr></table></figure></li><li>å¤åˆ¶  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">cp</span> nginx:/etc/nginx/nginx.conf /root/software/nginx/nginx.conf<br></code></pre></td></tr></table></figure></li></ul><h3 id="4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨-2"><a href="#4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨-2" class="headerlink" title="4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨"></a>4ã€åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -p 80:80 --name nginx -d -v /root/software/nginx/nginx.conf:/etc/nginx/nginx.conf nginx:1.19.10 <br><br>docker run -p 80:80 --name nginx -d -v /root/html:/usr/share/nginx/html nginx:1.19.10 <br></code></pre></td></tr></table></figure><blockquote><p>å½“æŒ‚è½½é…ç½®æ–‡ä»¶æ—¶ï¼šä½¿ç”¨nginxçš„ä»£ç†æœåŠ¡å™¨åŠŸèƒ½ï¼Œå®ç°åå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡åŠŸèƒ½<br>å½“æŒ‚è½½nginxå®¶ç›®å½•æ—¶ï¼ˆå®¶ç›®å½•çš„ä½ç½®åœ¨ç¬¬8éƒ¨åˆ†ï¼‰ï¼šä½¿ç”¨nginxçš„æœåŠ¡å™¨åŠŸèƒ½<br><strong>ä¹Ÿå¯ä»¥éƒ½æŒ‚è½½ï¼Œä¸¤ä¸ª-v</strong></p></blockquote><blockquote><p>è¿™é‡Œæ²¡æœ‰æ˜ å°„æ•´ä¸ªç›®å½•ï¼Œè€Œä»…ä»…æ˜¯å•ä¸ªæ–‡ä»¶ï¼Œè¯´æ˜è¯¥ç›®å½•è¿˜æœ‰å…¶ä»–æ–‡ä»¶ä¸èƒ½è¢«è¦†ç›–ï¼<br><img src="/./Resources/image-20230718113520721.png" alt="image-20230718113520721"></p></blockquote><h3 id="5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡-1"><a href="#5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡-1" class="headerlink" title="5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡"></a>5ã€æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps<br></code></pre></td></tr></table></figure><h3 id="6ã€æµ‹è¯•Nginx"><a href="#6ã€æµ‹è¯•Nginx" class="headerlink" title="6ã€æµ‹è¯•Nginx"></a>6ã€æµ‹è¯•Nginx</h3><p><img src="/./Resources/image-20230718113526938.png" alt="image-20230718113526938"></p><h3 id="7ã€è¿›å…¥å®¹å™¨"><a href="#7ã€è¿›å…¥å®¹å™¨" class="headerlink" title="7ã€è¿›å…¥å®¹å™¨"></a>7ã€è¿›å…¥å®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it nginx bash<br></code></pre></td></tr></table></figure><h3 id="8ã€ä¿®æ”¹é¡µé¢"><a href="#8ã€ä¿®æ”¹é¡µé¢" class="headerlink" title="8ã€ä¿®æ”¹é¡µé¢"></a>8ã€ä¿®æ”¹é¡µé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -name index.html<br></code></pre></td></tr></table></figure><p><img src="/./Resources/image-20230718113533242.png" alt="image-20230718113533242"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/share/nginx/html<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;i love docker&quot;</span> &gt; index.html<br></code></pre></td></tr></table></figure><p><img src="/./Resources/image-20230718113539596.png" alt="image-20230718113539596"></p><h3 id="9ã€æŒ‚è½½é…ç½®æ–‡ä»¶"><a href="#9ã€æŒ‚è½½é…ç½®æ–‡ä»¶" class="headerlink" title="9ã€æŒ‚è½½é…ç½®æ–‡ä»¶"></a>9ã€æŒ‚è½½é…ç½®æ–‡ä»¶</h3><p>é¦–å…ˆæŸ¥æ‰¾nginxæ˜¯å¦æœ‰é…ç½®æ–‡ä»¶<br><img src="/./Resources/image-20230718113547625.png" alt="image-20230718113547625"><br>æ‰€ä»¥åº”è¯¥åœ¨å®¿ä¸»æœºä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ä»¥æ˜ å°„åˆ°è¿™ä¸ªæ–‡ä»¶</p><p>å®˜ç½‘ç¡®è®¤ï¼š</p><blockquote><p><code>:ro</code> ï¼šåªè¯»<br><img src="/./Resources/image-20230718113552193.png" alt="image-20230718113552193"></p></blockquote><p><strong>ç®€æ˜“ç‰ˆ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull nginx<br><br>docker run --name nginx-test -p 80:80 -d nginx<br><br><span class="hljs-built_in">mkdir</span> -p /mydata/nginx/&#123;conf,html,logs&#125;<br><br>docker <span class="hljs-built_in">cp</span> nginx-test:/etc/nginx/nginx.conf /mydata/nginx/conf/nginx.conf<br>docker <span class="hljs-built_in">cp</span> nginx-test:/etc/nginx/conf.d /mydata/nginx/conf/conf.d<br>docker <span class="hljs-built_in">cp</span> nginx-test:/usr/share/nginx/html/ /mydata/nginx/<br><br>docker stop nginx-test<br>docker <span class="hljs-built_in">rm</span> nginx-test<br><br><br><br>docker run \<br>-p 80:80 \<br>--name nginx \<br>-v /mydata/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \<br>-v /mydata/nginx/conf/conf.d:/etc/nginx/conf.d \<br>-v /mydata/nginx/log:/var/log/nginx \<br>-v /mydata/nginx/html:/usr/share/nginx/html \<br>-d nginx<br></code></pre></td></tr></table></figure><h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><h3 id="1ã€ä¸‹è½½-RabbitMQ-é•œåƒ"><a href="#1ã€ä¸‹è½½-RabbitMQ-é•œåƒ" class="headerlink" title="1ã€ä¸‹è½½ RabbitMQ é•œåƒ"></a>1ã€ä¸‹è½½ RabbitMQ é•œåƒ</h3><p>ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull rabbitmq:management<br></code></pre></td></tr></table></figure><p>æ›´å¤šç‰ˆæœ¬çš„é•œåƒå¯ä»¥è®¿é—® Docker å®˜ç½‘ï¼š<code>https://hub.docker.com/_/rabbitmq?tab=tags</code></p><h3 id="2ã€åˆ›å»ºå¹¶è¿è¡Œ-RabbitMQ-å®¹å™¨"><a href="#2ã€åˆ›å»ºå¹¶è¿è¡Œ-RabbitMQ-å®¹å™¨" class="headerlink" title="2ã€åˆ›å»ºå¹¶è¿è¡Œ RabbitMQ å®¹å™¨"></a>2ã€åˆ›å»ºå¹¶è¿è¡Œ RabbitMQ å®¹å™¨</h3><p>å¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -p 15672:15672 -p 5672:5672 \<br>-e RABBITMQ_DEFAULT_USER=admin \<br>-e RABBITMQ_DEFAULT_PASS=admin \<br>--hostname myRabbit \<br>--name rabbitmq \<br>rabbitmq:management<br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>-dï¼šè¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨ï¼›</li><li>-pï¼šå°†å®¹å™¨çš„ç«¯å£ 5672ï¼ˆåº”ç”¨è®¿é—®ç«¯å£ï¼‰å’Œ 15672 ï¼ˆæ§åˆ¶å°Webç«¯å£å·ï¼‰æ˜ å°„åˆ°ä¸»æœºä¸­ï¼›</li><li>-eï¼šæŒ‡å®šç¯å¢ƒå˜é‡ï¼š<ul><li>RABBITMQ_DEFAULT_VHOSTï¼šé»˜è®¤è™šæ‹Ÿæœºåï¼›</li><li>RABBITMQ_DEFAULT_USERï¼šé»˜è®¤çš„ç”¨æˆ·åï¼›</li><li>RABBITMQ_DEFAULT_PASSï¼šé»˜è®¤çš„ç”¨æˆ·å¯†ç ï¼›</li></ul></li><li>â€“hostnameï¼šæŒ‡å®šä¸»æœºåï¼ˆRabbitMQ çš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„ èŠ‚ç‚¹åç§° å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåï¼‰ï¼›</li><li>â€“name rabbitmqï¼šè®¾ç½®å®¹å™¨åç§°ï¼›</li><li>rabbitmqï¼šå®¹å™¨ä½¿ç”¨çš„é•œåƒåç§°ï¼›</li></ul><h4 id="æŸ¥çœ‹å¯åŠ¨æƒ…å†µï¼š"><a href="#æŸ¥çœ‹å¯åŠ¨æƒ…å†µï¼š" class="headerlink" title="æŸ¥çœ‹å¯åŠ¨æƒ…å†µï¼š"></a>æŸ¥çœ‹å¯åŠ¨æƒ…å†µï¼š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps -l<br>------------<br>CONTAINER ID   IMAGE                 COMMAND                  CREATED              STATUS              PORTS                                                                                                                                                 NAMES<br>5df031b58d0f   rabbitmq:management   <span class="hljs-string">&quot;docker-entrypoint.sâ€¦&quot;</span>   About a minute ago   Up About a minute   4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, :::5672-&gt;5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp, :::15672-&gt;15672/tcp   rabbitmq<br></code></pre></td></tr></table></figure><p>è®¾ç½® docker å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨å¯åŠ¨ï¼ˆå¯é€‰ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update rabbitmq --restart=always<br></code></pre></td></tr></table></figure><h3 id="3ã€è®¿é—®-RabbitMQ-åå°ç®¡ç†"><a href="#3ã€è®¿é—®-RabbitMQ-åå°ç®¡ç†" class="headerlink" title="3ã€è®¿é—® RabbitMQ åå°ç®¡ç†"></a>3ã€è®¿é—® RabbitMQ åå°ç®¡ç†</h3><p>æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š<a href="http://ip:15672/">http://ip:15672</a> å³å¯è®¿é—®åå°ç®¡ç†é¡µé¢ï¼Œè¿™é‡Œçš„ ip ä¸ºè¿è¡Œ RabbitMQ æ‰€åœ¨çš„æœåŠ¡å™¨çš„ IP åœ°å€ï¼›<br>é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ guestï¼ˆå¦‚æœæ²¡æœ‰åœ¨å®¹å™¨åˆ›å»ºçš„æ—¶å€™æŒ‡å®šç”¨æˆ·åå¯†ç ï¼‰ï¼›<br>ä½†ç”±äºæˆ‘ä»¬å¯åŠ¨çš„æ—¶å€™è®¾ç½®äº†é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¾ç½®çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚(admin.admin)<br><img src="/Resources/Pasted%20image%2020220713154424.png" alt="Pasted image 20220713154424.png"><br><img src="/Resources/Pasted%20image%2020220713154355.png" alt="Pasted image 20220713154355.png"></p><p>æç¤ºï¼š å¦‚æœæ— æ³•è®¿é—®å¯ä»¥å°è¯•å¼€å¯é˜²ç«å¢™ 15672 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --zone=public --add-port=15672/tcp --permanentã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<br>firewall-cmd --reload<br></code></pre></td></tr></table></figure><h2 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å®‰è£…ä¹‹å‰ä½ éœ€è¦å‡†å¤‡ä¸€ä¸ªmysqlï¼Œå½“å‰å®‰è£…æ–¹å¼æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­çš„ï¼Œè¿™é‡Œçš„éƒ¨ç½²æ˜¯å•æœºæ¨¡å¼</p><h3 id="1ã€Docker-æ‹‰å–é•œåƒ"><a href="#1ã€Docker-æ‹‰å–é•œåƒ" class="headerlink" title="1ã€Docker æ‹‰å–é•œåƒ"></a>1ã€Docker æ‹‰å–é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull nacos/nacos-server<br></code></pre></td></tr></table></figure><h3 id="2ã€æŒ‚è½½ç›®å½•"><a href="#2ã€æŒ‚è½½ç›®å½•" class="headerlink" title="2ã€æŒ‚è½½ç›®å½•"></a>2ã€æŒ‚è½½ç›®å½•</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#æ–°å»ºnacosç›®å½•</span><br>mkdir -p <span class="hljs-regexp">/mydata/</span>nacos<br></code></pre></td></tr></table></figure><h3 id="3ã€å¯åŠ¨nacoså¹¶å¤åˆ¶æ–‡ä»¶åˆ°å®¿ä¸»æœºï¼Œå…³é—­å®¹å™¨"><a href="#3ã€å¯åŠ¨nacoså¹¶å¤åˆ¶æ–‡ä»¶åˆ°å®¿ä¸»æœºï¼Œå…³é—­å®¹å™¨" class="headerlink" title="3ã€å¯åŠ¨nacoså¹¶å¤åˆ¶æ–‡ä»¶åˆ°å®¿ä¸»æœºï¼Œå…³é—­å®¹å™¨"></a>3ã€å¯åŠ¨nacoså¹¶å¤åˆ¶æ–‡ä»¶åˆ°å®¿ä¸»æœºï¼Œå…³é—­å®¹å™¨</h3><p>è¿™ä¸€æ­¥å¯åŠ¨nacosæ˜¯ä¸ºäº†å°†nacosé‡Œé¢çš„æ–‡ä»¶æ‹·è´å‡ºåˆ°æŒ‚è½½ç›®å½•ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä¿®æ”¹æŒ‚è½½ç›®å½•ä¸­æ–‡ä»¶æ¥æ˜ å°„åˆ°å®¹å™¨é‡Œé¢å»äº†</p><h4 id="å¯åŠ¨å®¹å™¨-1"><a href="#å¯åŠ¨å®¹å™¨-1" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -p 8848:8848 --name nacos -d nacos/nacos-server<br></code></pre></td></tr></table></figure><h4 id="å¤åˆ¶æ–‡ä»¶"><a href="#å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å¤åˆ¶æ–‡ä»¶"></a>å¤åˆ¶æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">cp</span> nacos:/home/nacos/logs/ /mydata/nacos/logs/<br>docker <span class="hljs-built_in">cp</span> nacos:/home/nacos/conf/ /mydata/nacos/conf/<br></code></pre></td></tr></table></figure><h4 id="å…³é—­å®¹å™¨"><a href="#å…³é—­å®¹å™¨" class="headerlink" title="å…³é—­å®¹å™¨"></a>å…³é—­å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">rm</span> -f nacos<br></code></pre></td></tr></table></figure><h3 id="4ã€mysqlä¸­åˆ›å»ºnacosæ‰€éœ€çš„è¡¨"><a href="#4ã€mysqlä¸­åˆ›å»ºnacosæ‰€éœ€çš„è¡¨" class="headerlink" title="4ã€mysqlä¸­åˆ›å»ºnacosæ‰€éœ€çš„è¡¨"></a>4ã€mysqlä¸­åˆ›å»ºnacosæ‰€éœ€çš„è¡¨</h3><ul><li>mysqlä¸­æ–°å»ºä¸€ä¸ªåº“ï¼Œåå­—å¯è‡ªå®šä¹‰ï¼Œè¿™é‡Œå°±ç”¨ nacos-config</li><li>å§‹åŒ–mysqlæ•°æ®åº“ï¼Œæ•°æ®åº“åˆå§‹åŒ–æ–‡ä»¶ï¼šmysql-schema.sql ï¼ˆåœ¨ conf é‡Œé¢ï¼‰</li><li>ä½¿ç”¨ä¸ä¹‹å¯¹åº”çš„ mysql-schema.sqlï¼Œä¸ç„¶ä¼šå‡ºé—®é¢˜ï¼</li></ul><h3 id="5ã€å†æ¬¡å¯åŠ¨nacos"><a href="#5ã€å†æ¬¡å¯åŠ¨nacos" class="headerlink" title="5ã€å†æ¬¡å¯åŠ¨nacos"></a>5ã€å†æ¬¡å¯åŠ¨nacos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name nacos -p 8848:8848  -p 9848:9848 -p 9849:9849 --privileged=<span class="hljs-literal">true</span> -e JVM_XMS=256m -e JVM_XMX=256m -e MODE=standalone -v /mydata/nacos/logs/:/home/nacos/logs -v /mydata/nacos/conf/:/home/nacos/conf/ --restart=always nacos/nacos-server<br></code></pre></td></tr></table></figure><ul><li>docker run -d ï¼š å¯åŠ¨å®¹å™¨ -dæ˜¯åå°å¯åŠ¨å¹¶è¿”å›å®¹å™¨idçš„æ„æ€</li><li>-name nacos ï¼šä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°</li><li>-p 8848:8848 -p 9848:9848 -p 9849:9849 ï¼š æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ³¨æ„è¿™é‡Œçš„pä¸èƒ½å¤§å†™ï¼Œå¤§å†™æ˜¯éšæœºç«¯å£æ˜ å°„</li><li>â€“privileged&#x3D;true ï¼š æ‰©å¤§å®¹å™¨å†…çš„æƒé™ï¼Œå°†å®¹å™¨å†…çš„æƒé™å˜ä¸ºrootæƒé™ï¼Œä¸åŠ çš„è¯å°±æ˜¯æ™®é€šç”¨æˆ·æƒé™ï¼Œå¯èƒ½ä¼šå‡ºç°cannot open directory</li><li>-e JVM_XMS&#x3D;256m ï¼š ä¸ºjvmå¯åŠ¨æ—¶åˆ†é…çš„å†…å­˜</li><li>-e JVM_XMX&#x3D;256m ï¼š ä¸ºjvmè¿è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„æœ€å¤§å†…å­˜</li><li>-e MODE&#x3D;standalone ï¼š ä½¿ç”¨ standaloneæ¨¡å¼ï¼ˆå•æœºæ¨¡å¼ï¼‰,MODEå€¼æœ‰clusterï¼ˆé›†ç¾¤ï¼‰æ¨¡å¼&#x2F;standaloneæ¨¡å¼ä¸¤ç§ï¼ŒMODEå¿…é¡»å¤§å†™</li><li>-v &#x2F;mydata&#x2F;nacos&#x2F;logs&#x2F;:&#x2F;home&#x2F;nacos&#x2F;logs : å°†å®¹å™¨çš„&#x2F;home&#x2F;nacos&#x2F;logsç›®å½•æŒ‚è½½åˆ° &#x2F;mydata&#x2F;nacos&#x2F;logs</li><li>-v &#x2F;mydata&#x2F;nacos&#x2F;conf&#x2F;:&#x2F;home&#x2F;nacos&#x2F;conf&#x2F;ï¼š å°†å®¹å™¨çš„&#x2F;home&#x2F;nacos&#x2F;confç›®å½•æŒ‚è½½åˆ° &#x2F;mydata&#x2F;nacos&#x2F;conf</li><li>â€“restart&#x3D;always ï¼šé‡å¯dockeræ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨ç›¸å…³å®¹å™¨</li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>éœ€è¦åœ¨é˜²ç«å¢™å¼€æ”¾ç›¸å…³ç«¯å£ï¼Œå¦‚æœä½ æ˜¯äº‘æœåŠ¡å™¨ï¼Œå¼€æ”¾å®‰å…¨ç»„ï¼Œä¸‹é¢æä¾›ç›¸å…³è¯­å¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å¼€æ”¾ç«¯å£8848 9848 9849</span><br>firewall-cmd --zone=public --add-port=8848/tcp --permanent<br>firewall-cmd --zone=public --add-port=9848/tcp --permanent<br>firewall-cmd --zone=public --add-port=9849/tcp --permanent<br><br><span class="hljs-comment">## é‡å¯é˜²ç«å¢™</span><br>firewall-cmd --reload<br><br><span class="hljs-comment">## æŸ¥çœ‹æ‰€æœ‰å¼€å¯çš„ç«¯å£</span><br>firewall-cmd --zone=public --list-ports<br><br><span class="hljs-comment">## é‡å¯docker</span><br>systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1"><a href="#6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶-1" class="headerlink" title="6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åœ¨å®¿ä¸»æœºä¸­ä¿®æ”¹application.propertiesæ–‡ä»¶</span><br>vim /mydata/nacos/conf/application.properties<br><br>spring.datasource.platform=mysql<br>db.num=1<br>db.url.0=jdbc:mysql://192.168.153.135:3306/nacos-config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=30000&amp;autoReconnect=<span class="hljs-literal">true</span>&amp;useUnicode=<span class="hljs-literal">true</span>&amp;useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC<br>db.user=root<br>db.password=root<br><br><span class="hljs-comment"># ä¸Šé¢çš„ 192.168.153.135 å†™ä½ çš„ MySQL æ•°æ®åº“çš„ IP</span><br></code></pre></td></tr></table></figure><h3 id="7ã€éªŒè¯ï¼ˆå¯é€‰ï¼‰"><a href="#7ã€éªŒè¯ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="7ã€éªŒè¯ï¼ˆå¯é€‰ï¼‰"></a>7ã€éªŒè¯ï¼ˆå¯é€‰ï¼‰</h3><p>éªŒè¯é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## å› ä¸ºæˆ‘ä»¬åœ¨ç¬¬ä¸‰æ­¥å·²ç»å¤åˆ¶äº†logså’Œconfåˆ°äº†æˆ‘ä»¬çš„å®¿ä¸»æœºé‡Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹application.propertiesæ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨é‡Œï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„è¯­å¥æ¥æŸ¥çœ‹</span><br><br><span class="hljs-comment">## è¿›å…¥åˆ°nacoså®¹å™¨é‡Œ</span><br>docker <span class="hljs-built_in">exec</span> -it nacos /bin/bash<br><br><span class="hljs-comment">## æŸ¥çœ‹application.propertiesæ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> /home/nacos/conf/application.properties<br><br><span class="hljs-comment">## é€€å‡ºå®¹å™¨</span><br><span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure><p>éªŒè¯æ•°æ®åº“æ˜¯å¦è¿æ¥æˆåŠŸï¼š</p><p>è¿›å…¥ nacosï¼Œæ–°å»ºå‘½åç©ºé—´ï¼ŒæŸ¥çœ‹è¡¨tenant_infoæ˜¯å¦æœ‰å¯¹åº”çš„ä¿¡æ¯</p><h3 id="8ã€é—®é¢˜"><a href="#8ã€é—®é¢˜" class="headerlink" title="8ã€é—®é¢˜"></a>8ã€é—®é¢˜</h3><p>ç¬¬å…­æ­¥ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæœ€åˆçš„ç‰ˆæœ¬ä¸ºï¼šæ•°æ®åº“ipä¸ºlocalhost</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">## åœ¨å®¿ä¸»æœºä¸­ä¿®æ”¹application.propertiesæ–‡ä»¶</span><br>vim /mydata/nacos/conf/application.properties<br><br>spring.datasource.platform=mysql<br>db.num=1<br>db.url.0=jdbc:mysql://localhost:3306/nacos-config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=30000&amp;autoReconnect=<span class="hljs-literal">true</span>&amp;useUnicode=<span class="hljs-literal">true</span>&amp;useSSL=<span class="hljs-literal">false</span>&amp;serverTimezone=UTC<br>db.user=root<br>db.password=root<br><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯å½“è™šæ‹Ÿæœºé‡å¯æ—¶ï¼Œå°±è¿ä¸ä¸Š console äº†ï¼Œç»è¿‡ä¸€é¡¿ç™¾åº¦ï¼Œé…ç½®æ–‡ä»¶æ²¡æœ‰é…ç½®æˆåŠŸï¼Œå¯¼è‡´ nacos è‡ªåŠ¨ä½¿ç”¨äº†å†…ç½®çš„æ•°æ®æºï¼Œå†…ç½®æ•°æ®æºæ˜¯åŸºäºå†…å­˜çš„ï¼Œæ–­ç”µæ¶ˆå¤±ï¼Œå› æ­¤é‡å¯ä¹‹åï¼Œæ•°æ®ä¹Ÿæ²¡æœ‰äº†ï¼Œå¯¼è‡´è¿›ä¸å»äº†</p><h2 id="MINIO"><a href="#MINIO" class="headerlink" title="MINIO"></a>MINIO</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull minio/minio<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /mydata/minio/config<br><span class="hljs-built_in">mkdir</span> -p /mydata/minio/data<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run \<br>--name minio \<br>-p 9000:9000 \<br>-p 9001:9001 \<br>-e <span class="hljs-string">&quot;MINIO_PROMETHEUS_AUTH_TYPE=public&quot;</span> \<br>-e <span class="hljs-string">&quot;MINIO_ROOT_USER=minioadmin&quot;</span> \<br>-e <span class="hljs-string">&quot;MINIO_ROOT_PASSWORD=minioadmin&quot;</span> \<br>-v /mydata/minio/data:/data \<br>-v /mydata/minio/config:/root/.minio \<br>-d minio/minio server /data --console-address <span class="hljs-string">&quot;:9001&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[MinIO Console](http://192.168.153.135:9001/login)<br></code></pre></td></tr></table></figure><h2 id="XXL-JOB"><a href="#XXL-JOB" class="headerlink" title="XXL-JOB"></a>XXL-JOB</h2><p>ä¸€ã€åˆ›å»ºæ˜ å°„å®¹å™¨çš„æ–‡ä»¶ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull xuxueli/xxl-job-admin:2.3.1<br></code></pre></td></tr></table></figure><p>äºŒã€åˆ›å»ºæ˜ å°„å®¹å™¨çš„æ–‡ä»¶ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p -m 777 /mydata/xxl-job/data/applogs<br></code></pre></td></tr></table></figure><p>ä¸‰ã€åˆ›å»ºapplication.propertiesæ–‡ä»¶ï¼Œ<strong>ä¿®æ”¹æ•°æ®åº“ç›¸å…³ä¿¡æ¯</strong>ç„¶åæ”¾å…¥åˆ°&#x2F;mydata&#x2F;xxl-jobç›®å½•ä¸‹</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">### web</span><br><span class="hljs-attr">server.port</span>=<span class="hljs-string">8080</span><br><span class="hljs-attr">server.servlet.context-path</span>=<span class="hljs-string">/xxl-job-admin</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### actuator</span><br><span class="hljs-attr">management.server.servlet.context-path</span>=<span class="hljs-string">/actuator</span><br><span class="hljs-attr">management.health.mail.enabled</span>=<span class="hljs-string">false</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### resources</span><br><span class="hljs-attr">spring.mvc.servlet.load-on-startup</span>=<span class="hljs-string">0</span><br><span class="hljs-attr">spring.mvc.static-path-pattern</span>=<span class="hljs-string">/static/**</span><br><span class="hljs-attr">spring.resources.static-locations</span>=<span class="hljs-string">classpath:/static/</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### freemarker</span><br><span class="hljs-attr">spring.freemarker.templateLoaderPath</span>=<span class="hljs-string">classpath:/templates/</span><br><span class="hljs-attr">spring.freemarker.suffix</span>=<span class="hljs-string">.ftl</span><br><span class="hljs-attr">spring.freemarker.charset</span>=<span class="hljs-string">UTF-8</span><br><span class="hljs-attr">spring.freemarker.request-context-attribute</span>=<span class="hljs-string">request</span><br><span class="hljs-attr">spring.freemarker.settings.number_format</span>=<span class="hljs-string">0.##########</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### mybatis</span><br><span class="hljs-attr">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:/mybatis-mapper/*Mapper.xml</span><br><span class="hljs-comment">#mybatis.type-aliases-package=com.xxl.job.admin.core.model</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### xxl-job, datasource</span><br><span class="hljs-attr">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://192.168.153.135:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span><br><span class="hljs-attr">spring.datasource.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.password</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">spring.datasource.driver-class-name</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### datasource-pool</span><br><span class="hljs-attr">spring.datasource.type</span>=<span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span><br><span class="hljs-attr">spring.datasource.hikari.minimum-idle</span>=<span class="hljs-string">10</span><br><span class="hljs-attr">spring.datasource.hikari.maximum-pool-size</span>=<span class="hljs-string">30</span><br><span class="hljs-attr">spring.datasource.hikari.auto-commit</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.datasource.hikari.idle-timeout</span>=<span class="hljs-string">30000</span><br><span class="hljs-attr">spring.datasource.hikari.pool-name</span>=<span class="hljs-string">HikariCP</span><br><span class="hljs-attr">spring.datasource.hikari.max-lifetime</span>=<span class="hljs-string">900000</span><br><span class="hljs-attr">spring.datasource.hikari.connection-timeout</span>=<span class="hljs-string">10000</span><br><span class="hljs-attr">spring.datasource.hikari.connection-test-query</span>=<span class="hljs-string">SELECT 1</span><br><span class="hljs-attr">spring.datasource.hikari.validation-timeout</span>=<span class="hljs-string">1000</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### xxl-job, email</span><br><span class="hljs-attr">spring.mail.host</span>=<span class="hljs-string">smtp.qq.com</span><br><span class="hljs-attr">spring.mail.port</span>=<span class="hljs-string">25</span><br><span class="hljs-attr">spring.mail.username</span>=<span class="hljs-string">xxx@qq.com</span><br><span class="hljs-attr">spring.mail.from</span>=<span class="hljs-string">xxx@qq.com</span><br><span class="hljs-attr">spring.mail.password</span>=<span class="hljs-string">xxx</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.auth</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.starttls.enable</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.starttls.required</span>=<span class="hljs-string">true</span><br><span class="hljs-attr">spring.mail.properties.mail.smtp.socketFactory.class</span>=<span class="hljs-string">javax.net.ssl.SSLSocketFactory</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### xxl-job, access token</span><br><span class="hljs-attr">xxl.job.accessToken</span>=<span class="hljs-string">default_token</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### xxl-job, i18n (default is zh_CN, and you can choose &quot;zh_CN&quot;, &quot;zh_TC&quot; and &quot;en&quot;)</span><br><span class="hljs-attr">xxl.job.i18n</span>=<span class="hljs-string">zh_CN</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">## xxl-job, triggerpool max size</span><br><span class="hljs-attr">xxl.job.triggerpool.fast.max</span>=<span class="hljs-string">200</span><br><span class="hljs-attr">xxl.job.triggerpool.slow.max</span>=<span class="hljs-string">100</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment">### xxl-job, log retention days</span><br><span class="hljs-attr">xxl.job.logretentiondays</span>=<span class="hljs-string">30</span><br></code></pre></td></tr></table></figure><p>å››ã€å¯¼å…¥mysqlæ•°æ®åº“ï¼Œæ‰§è¡Œtables_xxl_job.sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs sql">#<br># XXL<span class="hljs-operator">-</span>JOB v2<span class="hljs-number">.3</span><span class="hljs-number">.1</span><br># Copyright (c) <span class="hljs-number">2015</span><span class="hljs-operator">-</span>present, xuxueli.<br> <br><span class="hljs-keyword">CREATE</span> database if <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> `xxl_job` <span class="hljs-keyword">default</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8mb4 <span class="hljs-keyword">collate</span> utf8mb4_unicode_ci;<br>use `xxl_job`;<br> <br><span class="hljs-keyword">SET</span> NAMES utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_info` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `job_group` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä¸»é”®ID&#x27;</span>,<br>  `job_desc` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `add_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `author` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ä½œè€…&#x27;</span>,<br>  `alarm_email` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æŠ¥è­¦é‚®ä»¶&#x27;</span>,<br>  `schedule_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;NONE&#x27;</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦ç±»å‹&#x27;</span>,<br>  `schedule_conf` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦é…ç½®ï¼Œå€¼å«ä¹‰å–å†³äºè°ƒåº¦ç±»å‹&#x27;</span>,<br>  `misfire_strategy` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;DO_NOTHING&#x27;</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦è¿‡æœŸç­–ç•¥&#x27;</span>,<br>  `executor_route_strategy` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨è·¯ç”±ç­–ç•¥&#x27;</span>,<br>  `executor_handler` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä»»åŠ¡handler&#x27;</span>,<br>  `executor_param` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä»»åŠ¡å‚æ•°&#x27;</span>,<br>  `executor_block_strategy` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;é˜»å¡å¤„ç†ç­–ç•¥&#x27;</span>,<br>  `executor_timeout` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;ä»»åŠ¡æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’&#x27;</span>,<br>  `executor_fail_retry_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å¤±è´¥é‡è¯•æ¬¡æ•°&#x27;</span>,<br>  `glue_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;GLUEç±»å‹&#x27;</span>,<br>  `glue_source` mediumtext COMMENT <span class="hljs-string">&#x27;GLUEæºä»£ç &#x27;</span>,<br>  `glue_remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;GLUEå¤‡æ³¨&#x27;</span>,<br>  `glue_updatetime` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;GLUEæ›´æ–°æ—¶é—´&#x27;</span>,<br>  `child_jobid` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å­ä»»åŠ¡IDï¼Œå¤šä¸ªé€—å·åˆ†éš”&#x27;</span>,<br>  `trigger_status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦çŠ¶æ€ï¼š0-åœæ­¢ï¼Œ1-è¿è¡Œ&#x27;</span>,<br>  `trigger_last_time` <span class="hljs-type">bigint</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;ä¸Šæ¬¡è°ƒåº¦æ—¶é—´&#x27;</span>,<br>  `trigger_next_time` <span class="hljs-type">bigint</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;ä¸‹æ¬¡è°ƒåº¦æ—¶é—´&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_log` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `job_group` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä¸»é”®ID&#x27;</span>,<br>  `job_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ä»»åŠ¡ï¼Œä¸»é”®ID&#x27;</span>,<br>  `executor_address` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨åœ°å€ï¼Œæœ¬æ¬¡æ‰§è¡Œçš„åœ°å€&#x27;</span>,<br>  `executor_handler` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä»»åŠ¡handler&#x27;</span>,<br>  `executor_param` <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä»»åŠ¡å‚æ•°&#x27;</span>,<br>  `executor_sharding_param` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨ä»»åŠ¡åˆ†ç‰‡å‚æ•°ï¼Œæ ¼å¼å¦‚ 1/2&#x27;</span>,<br>  `executor_fail_retry_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å¤±è´¥é‡è¯•æ¬¡æ•°&#x27;</span>,<br>  `trigger_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦-æ—¶é—´&#x27;</span>,<br>  `trigger_code` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦-ç»“æœ&#x27;</span>,<br>  `trigger_msg` text COMMENT <span class="hljs-string">&#x27;è°ƒåº¦-æ—¥å¿—&#x27;</span>,<br>  `handle_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œ-æ—¶é—´&#x27;</span>,<br>  `handle_code` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œ-çŠ¶æ€&#x27;</span>,<br>  `handle_msg` text COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œ-æ—¥å¿—&#x27;</span>,<br>  `alarm_status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;å‘Šè­¦çŠ¶æ€ï¼š0-é»˜è®¤ã€1-æ— éœ€å‘Šè­¦ã€2-å‘Šè­¦æˆåŠŸã€3-å‘Šè­¦å¤±è´¥&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  KEY `I_trigger_time` (`trigger_time`),<br>  KEY `I_handle_code` (`handle_code`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_log_report` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `trigger_day` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è°ƒåº¦-æ—¶é—´&#x27;</span>,<br>  `running_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;è¿è¡Œä¸­-æ—¥å¿—æ•°é‡&#x27;</span>,<br>  `suc_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡ŒæˆåŠŸ-æ—¥å¿—æ•°é‡&#x27;</span>,<br>  `fail_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå¤±è´¥-æ—¥å¿—æ•°é‡&#x27;</span>,<br>  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `i_trigger_day` (`trigger_day`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_logglue` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `job_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ä»»åŠ¡ï¼Œä¸»é”®ID&#x27;</span>,<br>  `glue_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;GLUEç±»å‹&#x27;</span>,<br>  `glue_source` mediumtext COMMENT <span class="hljs-string">&#x27;GLUEæºä»£ç &#x27;</span>,<br>  `glue_remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;GLUEå¤‡æ³¨&#x27;</span>,<br>  `add_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_registry` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `registry_group` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `registry_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `registry_value` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  KEY `i_g_k_v` (`registry_group`,`registry_key`,`registry_value`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_group` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `app_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨AppName&#x27;</span>,<br>  `title` <span class="hljs-type">varchar</span>(<span class="hljs-number">12</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨åç§°&#x27;</span>,<br>  `address_type` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨åœ°å€ç±»å‹ï¼š0=è‡ªåŠ¨æ³¨å†Œã€1=æ‰‹åŠ¨å½•å…¥&#x27;</span>,<br>  `address_list` text COMMENT <span class="hljs-string">&#x27;æ‰§è¡Œå™¨åœ°å€åˆ—è¡¨ï¼Œå¤šåœ°å€é€—å·åˆ†éš”&#x27;</span>,<br>  `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_user` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è´¦å·&#x27;</span>,<br>  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å¯†ç &#x27;</span>,<br>  `role` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è§’è‰²ï¼š0-æ™®é€šç”¨æˆ·ã€1-ç®¡ç†å‘˜&#x27;</span>,<br>  `permission` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æƒé™ï¼šæ‰§è¡Œå™¨IDåˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†å‰²&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `i_username` (`username`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `xxl_job_lock` (<br>  `lock_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;é”åç§°&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`lock_name`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br> <br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `xxl_job_group`(`id`, `app_name`, `title`, `address_type`, `address_list`, `update_time`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;xxl-job-executor-sample&#x27;</span>, <span class="hljs-string">&#x27;ç¤ºä¾‹æ‰§è¡Œå™¨&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;2018-11-03 22:21:31&#x27;</span> );<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `xxl_job_info`(`id`, `job_group`, `job_desc`, `add_time`, `update_time`, `author`, `alarm_email`, `schedule_type`, `schedule_conf`, `misfire_strategy`, `executor_route_strategy`, `executor_handler`, `executor_param`, `executor_block_strategy`, `executor_timeout`, `executor_fail_retry_count`, `glue_type`, `glue_source`, `glue_remark`, `glue_updatetime`, `child_jobid`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;æµ‹è¯•ä»»åŠ¡1&#x27;</span>, <span class="hljs-string">&#x27;2018-11-03 22:21:31&#x27;</span>, <span class="hljs-string">&#x27;2018-11-03 22:21:31&#x27;</span>, <span class="hljs-string">&#x27;XXL&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;CRON&#x27;</span>, <span class="hljs-string">&#x27;0 0 0 * * ? *&#x27;</span>, <span class="hljs-string">&#x27;DO_NOTHING&#x27;</span>, <span class="hljs-string">&#x27;FIRST&#x27;</span>, <span class="hljs-string">&#x27;demoJobHandler&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;SERIAL_EXECUTION&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;BEAN&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;GLUEä»£ç åˆå§‹åŒ–&#x27;</span>, <span class="hljs-string">&#x27;2018-11-03 22:21:31&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `xxl_job_user`(`id`, `username`, `password`, `role`, `permission`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;e10adc3949ba59abbe56e057f20f883e&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `xxl_job_lock` ( `lock_name`) <span class="hljs-keyword">VALUES</span> ( <span class="hljs-string">&#x27;schedule_lock&#x27;</span>);<br> <br><span class="hljs-keyword">commit</span>;<br></code></pre></td></tr></table></figure><p>äº”ã€æ‰§è¡Œdockerå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run  -p 18080:8080 -d --name=xxl-job-admin --restart=always -v /mydata/xxl-job/application.properties:/application.properties  -e PARAMS=<span class="hljs-string">&#x27;--spring.config.location=/application.properties&#x27;</span> xuxueli/xxl-job-admin:2.3.1<br></code></pre></td></tr></table></figure><h1 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h1><p>0ã€æ¯æ¬¡æŒ‚èµ·å†å¯åŠ¨ï¼Œsshå¯ä»¥æ­£å¸¸è¿æ¥ï¼Œmysqlè¿™äº›å°±è¿ä¸ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">service NetworkManager stop<br>systemctl restart network.service<br></code></pre></td></tr></table></figure><p>1ã€è™šæ‹Ÿæœºæ²¡æœ‰ç½‘ç»œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ping www.baidu.com<br><span class="hljs-comment"># æ˜¾ç¤ºæœªçŸ¥çš„åç§°æˆ–æœåŠ¡</span><br></code></pre></td></tr></table></figure><p>è§£å†³ï¼šé…ç½®dns(åœ¨ç½‘å¡çš„é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">DNS1=8.8.8.8                <span class="hljs-comment">#æ‰‹åŠ¨æ·»åŠ DNS1</span><br>DNS2=114.114.114.114        <span class="hljs-comment">#æ‰‹åŠ¨æ·»åŠ DNS2</span><br><br>systemctl restart network.service<br></code></pre></td></tr></table></figure><p>2ã€å¦‚æœå®‰è£…é•œåƒæŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Error response from daemon: Get <span class="hljs-string">&quot;https://registry-1.docker.io/v2/&quot;</span>: dial tcp: lookup registry-1.dock<br></code></pre></td></tr></table></figure><p>è§£å†³ï¼šå¯èƒ½æ˜¯æ²¡ç½‘ç»œï¼Œå‚è€ƒ1ï¼Œå¦‚æœæ²¡é—®é¢˜ï¼Œæ£€æŸ¥é•œåƒåŠ é€Ÿæ˜¯å¦é…ç½®æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker info<br></code></pre></td></tr></table></figure><p>è§£å†³ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br>systemctl restart docker.service<br></code></pre></td></tr></table></figure><p>3ã€è¿æ¥ä¸ä¸Šè™šæ‹Ÿæœº</p><p>shellè¿ä¸ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">service NetworkManager stop<br>service network restart<br>systemctl restart network.service<br></code></pre></td></tr></table></figure><p>mysqlç­‰å®¹å™¨è¿ä¸ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status firewalld.service //æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€<br>systemctl stop firewalld.service//å…³é—­é˜²ç«å¢™<br>systemctl <span class="hljs-built_in">disable</span> firewalld.service//å¼€æœºåä¹Ÿä¸å¾—ä½¿ç”¨<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;åç§°&lt;/th&gt;
&lt;th&gt;ç‰ˆæœ¬å·&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;</summary>
      
    
    
    
    <category term="Docker" scheme="http://conquers.github.io/categories/Docker/"/>
    
    
    <category term="Portainer" scheme="http://conquers.github.io/tags/Portainer/"/>
    
    <category term="Elasitc" scheme="http://conquers.github.io/tags/Elasitc/"/>
    
    <category term="Mysql" scheme="http://conquers.github.io/tags/Mysql/"/>
    
    <category term="Redis" scheme="http://conquers.github.io/tags/Redis/"/>
    
    <category term="Nginx" scheme="http://conquers.github.io/tags/Nginx/"/>
    
    <category term="RabbitMQ" scheme="http://conquers.github.io/tags/RabbitMQ/"/>
    
  </entry>
  
  <entry>
    <title>Shiroå®æˆ˜æ•™ç¨‹</title>
    <link href="http://conquers.github.io/posts/9cde3973.html"/>
    <id>http://conquers.github.io/posts/9cde3973.html</id>
    <published>2022-06-19T06:07:08.000Z</published>
    <updated>2023-11-17T02:43:49.897Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://shiro.apache.org/">Apache Shiro | Simple. Java. Security.</a></p><h2 id="ä¸€-æƒé™çš„ç®¡ç†"><a href="#ä¸€-æƒé™çš„ç®¡ç†" class="headerlink" title="ä¸€. æƒé™çš„ç®¡ç†"></a>ä¸€. æƒé™çš„ç®¡ç†</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æƒé™ç®¡ç†"><a href="#1-1-ä»€ä¹ˆæ˜¯æƒé™ç®¡ç†" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æƒé™ç®¡ç†"></a>1.1 ä»€ä¹ˆæ˜¯æƒé™ç®¡ç†</h3><p>åŸºæœ¬ä¸Šæ¶‰åŠåˆ°ç”¨æˆ·å‚ä¸çš„ç³»ç»Ÿéƒ½è¦è¿›è¡Œæƒé™ç®¡ç†ï¼Œæƒé™ç®¡ç†å±äºç³»ç»Ÿå®‰å…¨çš„èŒƒç•´ï¼Œæƒé™ç®¡ç†å®ç° <mark>å¯¹ç”¨æˆ·è®¿é—®ç³»ç»Ÿçš„æ§åˆ¶</mark> ï¼ŒæŒ‰ç…§å®‰å…¨è§„åˆ™æˆ–è€…å®‰å…¨ç­–ç•¥æ§åˆ¶ç”¨æˆ·å¯ä»¥è®¿é—®è€Œä¸”åªèƒ½è®¿é—®è‡ªå·±è¢«æˆæƒçš„èµ„æºã€‚</p><p>æƒé™ç®¡ç†åŒ…æ‹¬ç”¨æˆ· <mark>èº«ä»½è®¤è¯</mark> å’Œ<mark>æˆæƒ</mark> ä¸¤éƒ¨åˆ†ï¼Œç®€ç§°<code>è®¤è¯æˆæƒ</code>ã€‚å¯¹äºéœ€è¦è®¿é—®æ§åˆ¶çš„èµ„æºç”¨æˆ·é¦–å…ˆç»è¿‡èº«ä»½è®¤è¯ï¼Œè®¤è¯é€šè¿‡åç”¨æˆ·å…·æœ‰è¯¥èµ„æºçš„è®¿é—®æƒé™æ–¹å¯è®¿é—®ã€‚</p><h3 id="1-2-ä»€ä¹ˆæ˜¯èº«ä»½è®¤è¯"><a href="#1-2-ä»€ä¹ˆæ˜¯èº«ä»½è®¤è¯" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯èº«ä»½è®¤è¯"></a>1.2 ä»€ä¹ˆæ˜¯èº«ä»½è®¤è¯</h3><p><mark>èº«ä»½è®¤è¯</mark>ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·çš„å¤„ç†è¿‡ç¨‹ã€‚æœ€å¸¸ç”¨çš„ç®€å•èº«ä»½è®¤è¯æ–¹å¼æ˜¯ç³»ç»Ÿé€šè¿‡æ ¸å¯¹ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå£ä»¤ï¼Œçœ‹å…¶æ˜¯å¦ä¸ç³»ç»Ÿä¸­å­˜å‚¨çš„è¯¥ç”¨æˆ·çš„ç”¨æˆ·åå’Œå£ä»¤ä¸€è‡´ï¼Œæ¥åˆ¤æ–­ç”¨æˆ·èº«ä»½æ˜¯å¦æ­£ç¡®ã€‚å¯¹äºé‡‡ç”¨æŒ‡çº¹ç­‰ç³»ç»Ÿï¼Œåˆ™å‡ºç¤ºæŒ‡çº¹ï¼›å¯¹äºç¡¬ä»¶Keyç­‰åˆ·å¡ç³»ç»Ÿï¼Œåˆ™éœ€è¦åˆ·å¡ã€‚</p><h3 id="1-3-ä»€ä¹ˆæ˜¯æˆæƒ"><a href="#1-3-ä»€ä¹ˆæ˜¯æˆæƒ" class="headerlink" title="1.3 ä»€ä¹ˆæ˜¯æˆæƒ"></a>1.3 ä»€ä¹ˆæ˜¯æˆæƒ</h3><p><mark>æˆæƒï¼Œå³è®¿é—®æ§åˆ¶</mark> ï¼Œæ§åˆ¶è°èƒ½è®¿é—®å“ªäº›èµ„æºã€‚ä¸»ä½“è¿›è¡Œèº«ä»½è®¤è¯åéœ€è¦åˆ†é…æƒé™æ–¹å¯è®¿é—®ç³»ç»Ÿçš„èµ„æºï¼Œå¯¹äºæŸäº›èµ„æºæ²¡æœ‰æƒé™æ˜¯æ— æ³•è®¿é—®çš„</p><h2 id="äºŒã€ä»€ä¹ˆæ˜¯shiro"><a href="#äºŒã€ä»€ä¹ˆæ˜¯shiro" class="headerlink" title="äºŒã€ä»€ä¹ˆæ˜¯shiro"></a>äºŒã€ä»€ä¹ˆæ˜¯shiro</h2><p><img src="/Resources/Pasted%20image%2020220619141355.png" alt="Pasted image 20220619141355"></p><blockquote><p>Apache Shiroâ„¢ is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management. With Shiroâ€™s easy-to-understand API, you can quickly and easily secure any application â€“ from the smallest mobile applications to the largest web and enterprise applications.</p><p>Shiro æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œå®ƒæ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚ä½¿ç”¨Shiroæ˜“äºç†è§£çš„APIï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè½»æ¾åœ°ä¿æŠ¤ä»»ä½•åº”ç”¨ç¨‹åºâ€”ä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„webå’Œä¼ä¸šåº”ç”¨ç¨‹åºã€‚</p></blockquote><p><mark>Shiroæ˜¯apacheæ——ä¸‹ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œå®ƒå°†è½¯ä»¶ç³»ç»Ÿçš„å®‰å…¨è®¤è¯ç›¸å…³çš„åŠŸèƒ½æŠ½å–å‡ºæ¥ï¼Œå®ç°ç”¨æˆ·èº«ä»½è®¤è¯ï¼Œæƒé™æˆæƒã€åŠ å¯†ã€ä¼šè¯ç®¡ç†ç­‰åŠŸèƒ½ï¼Œç»„æˆäº†ä¸€ä¸ªé€šç”¨çš„å®‰å…¨è®¤è¯æ¡†æ¶ã€‚</mark></p><h2 id="ä¸‰ã€shiroçš„æ ¸å¿ƒæ¶æ„"><a href="#ä¸‰ã€shiroçš„æ ¸å¿ƒæ¶æ„" class="headerlink" title="ä¸‰ã€shiroçš„æ ¸å¿ƒæ¶æ„"></a>ä¸‰ã€shiroçš„æ ¸å¿ƒæ¶æ„</h2><p><a href="https://shiro.apache.org/architecture.html">Apache Shiro Architecture | Apache Shiro</a></p><p><img src="/Resources/Pasted%20image%2020220619142030.png" alt="Pasted image 20220619142030"></p><h3 id="3-1-Subject-org-apache-shiro-subject-Subject"><a href="#3-1-Subject-org-apache-shiro-subject-Subject" class="headerlink" title="3.1 SubjectÂ (org.apache.shiro.subject.Subject)"></a>3.1 <strong>Subject</strong>Â (<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/subject/Subject.html"><code>org.apache.shiro.subject.Subject</code></a>)</h3><p><mark>Subject</mark>å³ä¸»ä½“ï¼Œå¤–éƒ¨åº”ç”¨ä¸subjectè¿›è¡Œäº¤äº’ï¼Œsubjectè®°å½•äº†å½“å‰æ“ä½œç”¨æˆ·ï¼Œå°†ç”¨æˆ·çš„æ¦‚å¿µç†è§£ä¸ºå½“å‰æ“ä½œçš„ä¸»ä½“ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªé€šè¿‡æµè§ˆå™¨è¯·æ±‚çš„ç”¨æˆ·ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºã€‚</p><p>Subjectåœ¨shiroä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­å®šä¹‰äº†å¾ˆå¤šè®¤è¯æˆç›¸å…³çš„æ–¹æ³•ï¼Œå¤–éƒ¨ç¨‹åºé€šè¿‡subjectè¿›è¡Œè®¤è¯æˆï¼Œè€Œsubjectæ˜¯é€šè¿‡SecurityManagerå®‰å…¨ç®¡ç†å™¨è¿›è¡Œè®¤è¯æˆæƒ</p><h3 id="3-2-SecurityManager-org-apache-shiro-mgt-SecurityManager"><a href="#3-2-SecurityManager-org-apache-shiro-mgt-SecurityManager" class="headerlink" title="3.2 SecurityManagerÂ (org.apache.shiro.mgt.SecurityManager)"></a>3.2 <strong>SecurityManager</strong>Â (<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/mgt/SecurityManager.html"><code>org.apache.shiro.mgt.SecurityManager</code></a>)</h3><p><mark>SecurityManager</mark>å³å®‰å…¨ç®¡ç†å™¨ï¼Œå¯¹å…¨éƒ¨çš„subjectè¿›è¡Œå®‰å…¨ç®¡ç†ï¼Œå®ƒæ˜¯shiroçš„æ ¸å¿ƒï¼Œè´Ÿè´£å¯¹æ‰€æœ‰çš„subjectè¿›è¡Œå®‰å…¨ç®¡ç†ã€‚é€šè¿‡SecurityManagerå¯ä»¥å®Œæˆsubjectçš„è®¤è¯ã€æˆæƒç­‰ï¼Œå®è´¨ä¸ŠSecurityManageræ˜¯é€šè¿‡Authenticatorè¿›è¡Œè®¤è¯ï¼Œé€šè¿‡Authorizerè¿›è¡Œæˆæƒï¼Œé€šè¿‡SessionManagerè¿›è¡Œä¼šè¯ç®¡ç†ç­‰ã€‚</p><p>SecurityManageræ˜¯ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿äº†Authenticator, Authorizer, SessionManagerè¿™ä¸‰ä¸ªæ¥å£ã€‚</p><h3 id="3-3-Authenticator-org-apache-shiro-authc-Authenticator"><a href="#3-3-Authenticator-org-apache-shiro-authc-Authenticator" class="headerlink" title="3.3 Authenticator(org.apache.shiro.authc.Authenticator)"></a>3.3 Authenticator(<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/Authenticator.html"><code>org.apache.shiro.authc.Authenticator</code></a>)</h3><p><mark>uthenticatorå³è®¤è¯å™¨</mark>ï¼Œå¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œè®¤è¯ï¼ŒAuthenticatoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œshiroæä¾›ModularRealmAuthenticatorå®ç°ç±»ï¼Œé€šè¿‡ModularRealmAuthenticatoråŸºæœ¬ä¸Šå¯ä»¥æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è®¤è¯å™¨ã€‚</p><h3 id="3-4-Authorizer-org-apache-shiro-authz-Authorizer"><a href="#3-4-Authorizer-org-apache-shiro-authz-Authorizer" class="headerlink" title="3.4 AuthorizerÂ (org.apache.shiro.authz.Authorizer)"></a>3.4 AuthorizerÂ (<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/authz/Authorizer.html"><code>org.apache.shiro.authz.Authorizer</code></a>)</h3><p><mark>Authorizerå³æˆæƒå™¨</mark>ï¼Œç”¨æˆ·é€šè¿‡è®¤è¯å™¨è®¤è¯é€šè¿‡ï¼Œåœ¨è®¿é—®åŠŸèƒ½æ—¶éœ€è¦é€šè¿‡æˆæƒå™¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æ­¤åŠŸèƒ½çš„æ“ä½œæƒé™ã€‚</p><h3 id="3-5-Realm-org-apache-shiro-realm-Realm"><a href="#3-5-Realm-org-apache-shiro-realm-Realm" class="headerlink" title="3.5 RealmÂ (org.apache.shiro.realm.Realm)"></a>3.5 RealmÂ (<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/Realm.html"><code>org.apache.shiro.realm.Realm</code></a>)</h3><p>Realmå³é¢†åŸŸï¼Œç›¸å½“äºdatasourceæ•°æ®æºï¼ŒsecurityManagerè¿›è¡Œå®‰å…¨è®¤è¯éœ€è¦é€šè¿‡Realmè·å–ç”¨æˆ·æƒé™æ•°æ®ï¼Œæ¯”å¦‚ï¼šå¦‚æœç”¨æˆ·èº«ä»½æ•°æ®åœ¨æ•°æ®åº“é‚£ä¹ˆrealmå°±éœ€è¦ä»æ•°æ®åº“è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</p><p><mark>æ³¨æ„ï¼šä¸è¦æŠŠrealmç†è§£æˆåªæ˜¯ä»æ•°æ®æºå–æ•°æ®ï¼Œåœ¨realmä¸­è¿˜æœ‰è®¤è¯æˆæƒæ ¡éªŒçš„ç›¸å…³çš„ä»£ç ã€‚</mark></p><h3 id="3-6-SessionManager-org-apache-shiro-session-mgt-SessionManager"><a href="#3-6-SessionManager-org-apache-shiro-session-mgt-SessionManager" class="headerlink" title="3.6 SessionManager(org.apache.shiro.session.mgt.SessionManager)"></a>3.6 SessionManager(<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/SessionManager.html"><code>org.apache.shiro.session.mgt.SessionManager</code></a>)</h3><p><mark>SessionManagerå³ä¼šè¯ç®¡ç†</mark>ï¼Œshiroæ¡†æ¶å®šä¹‰äº†ä¸€å¥—ä¼šè¯ç®¡ç†ï¼Œå®ƒä¸ä¾èµ–webå®¹å™¨çš„sessionï¼Œæ‰€ä»¥shiroå¯ä»¥ä½¿ç”¨åœ¨éwebåº”ç”¨ä¸Šï¼Œä¹Ÿå¯ä»¥å°†åˆ†å¸ƒå¼åº”ç”¨çš„ä¼šè¯é›†ä¸­åœ¨ä¸€ç‚¹ç®¡ç†ï¼Œæ­¤ç‰¹æ€§å¯ä½¿å®ƒå®ç°å•ç‚¹ç™»å½•ã€‚</p><h3 id="3-7-SessionDAO-org-apache-shiro-session-mgt-eis-SessionDAO"><a href="#3-7-SessionDAO-org-apache-shiro-session-mgt-eis-SessionDAO" class="headerlink" title="3.7 SessionDAOÂ (org.apache.shiro.session.mgt.eis.SessionDAO)"></a>3.7 SessionDAOÂ (<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/eis/SessionDAO.html"><code>org.apache.shiro.session.mgt.eis.SessionDAO</code></a>)</h3><p><mark>SessionDAOå³ä¼šè¯dao</mark>ï¼Œæ˜¯å¯¹sessionä¼šè¯æ“ä½œçš„ä¸€å¥—æ¥å£ï¼Œæ¯”å¦‚è¦å°†sessionå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œå¯ä»¥é€šè¿‡jdbcå°†ä¼šè¯å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</p><h3 id="3-8-CacheManager-org-apache-shiro-cache-CacheManager"><a href="#3-8-CacheManager-org-apache-shiro-cache-CacheManager" class="headerlink" title="3.8 CacheManagerÂ (org.apache.shiro.cache.CacheManager)"></a>3.8 CacheManagerÂ (<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/cache/CacheManager.html"><code>org.apache.shiro.cache.CacheManager</code></a>)</h3><p><mark>CacheManagerå³ç¼“å­˜ç®¡ç†</mark>ï¼Œå°†ç”¨æˆ·æƒé™æ•°æ®å­˜å‚¨åœ¨ç¼“å­˜ï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ã€‚</p><h3 id="3-9-Cryptography-org-apache-shiro-crypto"><a href="#3-9-Cryptography-org-apache-shiro-crypto" class="headerlink" title="3.9 Cryptography(org.apache.shiro.crypto.*)"></a>3.9 Cryptography(<a href="https://shiro.apache.org/static/current/apidocs/org/apache/shiro/crypto/package-summary.html"><code>org.apache.shiro.crypto.*</code></a>)</h3><p><mark>Cryptographyå³å¯†ç ç®¡ç†</mark>ï¼Œshiroæä¾›äº†ä¸€å¥—åŠ å¯†&#x2F;è§£å¯†çš„ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘ã€‚æ¯”å¦‚æä¾›å¸¸ç”¨çš„æ•£åˆ—ã€åŠ &#x2F;è§£å¯†ç­‰åŠŸèƒ½ã€‚</p><h2 id="å››ã€shiroä¸­çš„è®¤è¯"><a href="#å››ã€shiroä¸­çš„è®¤è¯" class="headerlink" title="å››ã€shiroä¸­çš„è®¤è¯"></a>å››ã€shiroä¸­çš„è®¤è¯</h2><h3 id="4-1-è®¤è¯"><a href="#4-1-è®¤è¯" class="headerlink" title="4.1 è®¤è¯"></a>4.1 è®¤è¯</h3><p>èº«ä»½è®¤è¯ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·çš„å¤„ç†è¿‡ç¨‹ã€‚æœ€å¸¸ç”¨çš„ç®€å•èº«ä»½è®¤è¯æ–¹å¼æ˜¯ç³»ç»Ÿé€šè¿‡æ ¸å¯¹ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå£ä»¤ï¼Œçœ‹å…¶æ˜¯å¦ä¸ç³»ç»Ÿä¸­å­˜å‚¨çš„è¯¥ç”¨æˆ·çš„ç”¨æˆ·åå’Œå£ä»¤ä¸€è‡´ï¼Œæ¥åˆ¤æ–­ç”¨æˆ·èº«ä»½æ˜¯å¦æ­£ç¡®ã€‚</p><h3 id="4-2-shiroä¸­è®¤è¯çš„å…³é”®å¯¹è±¡"><a href="#4-2-shiroä¸­è®¤è¯çš„å…³é”®å¯¹è±¡" class="headerlink" title="4.2 shiroä¸­è®¤è¯çš„å…³é”®å¯¹è±¡"></a>4.2 shiroä¸­è®¤è¯çš„å…³é”®å¯¹è±¡</h3><ul><li><p>Subjectï¼šä¸»ä½“<br>è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œä¸»ä½“å¯ä»¥æ˜¯ç”¨æˆ·ã€ç¨‹åºç­‰ï¼Œè¿›è¡Œè®¤è¯çš„éƒ½ç§°ä¸ºä¸»ä½“ï¼›</p></li><li><p>Principalï¼šèº«ä»½ä¿¡æ¯<br>æ˜¯ä¸»ä½“ï¼ˆsubjectï¼‰è¿›è¡Œèº«ä»½è®¤è¯çš„æ ‡è¯†ï¼Œæ ‡è¯†å¿…é¡»å…·æœ‰ <mark>å”¯ä¸€æ€§</mark>ï¼Œå¦‚ç”¨æˆ·åã€æ‰‹æœºå·ã€é‚®ç®±åœ°å€ç­‰ï¼Œä¸€ä¸ªä¸»ä½“å¯ä»¥æœ‰å¤šä¸ªèº«ä»½ï¼Œä½†æ˜¯å¿…é¡»æœ‰ä¸€ä¸ªä¸»èº«ä»½ï¼ˆPrimary Principalï¼‰ã€‚</p></li><li><p>Credentialï¼šå‡­è¯ä¿¡æ¯<br>æ˜¯åªæœ‰ä¸»ä½“è‡ªå·±çŸ¥é“çš„å®‰å…¨ä¿¡æ¯ï¼Œå¦‚å¯†ç ã€è¯ä¹¦ç­‰ã€‚</p></li></ul><h3 id="4-3-è®¤è¯æµç¨‹"><a href="#4-3-è®¤è¯æµç¨‹" class="headerlink" title="4.3 è®¤è¯æµç¨‹"></a>4.3 è®¤è¯æµç¨‹</h3><p><img src="/Resources/Pasted%20image%2020220619144311.png" alt="Pasted image 20220619144311"></p><h3 id="4-4-è®¤è¯çš„å¼€å‘"><a href="#4-4-è®¤è¯çš„å¼€å‘" class="headerlink" title="4.4 è®¤è¯çš„å¼€å‘"></a>4.4 è®¤è¯çš„å¼€å‘</h3><h4 id="1-åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–"><a href="#1-åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–" class="headerlink" title="1. åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–"></a>1. åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2-å¼•å…¥shiroé…ç½®æ–‡ä»¶"><a href="#2-å¼•å…¥shiroé…ç½®æ–‡ä»¶" class="headerlink" title="2. å¼•å…¥shiroé…ç½®æ–‡ä»¶"></a>2. å¼•å…¥shiroé…ç½®æ–‡ä»¶</h4><p>é…ç½®æ–‡ä»¶ï¼šåç§°éšæ„ï¼Œä»¥ .ini ç»“å°¾ï¼Œæ”¾åœ¨ resources ç›®å½•ä¸‹</p><blockquote><p>æ³¨æ„ï¼šåœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­å¹¶ä¸ä¼šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥ç”¨æ¥åˆå­¦æ—¶ç»ƒæ‰‹</p></blockquote><p><code>shiro.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[users]</span><br><span class="hljs-attr">wtt</span>=<span class="hljs-number">123</span><br><span class="hljs-attr">ttw</span>=<span class="hljs-number">456</span><br></code></pre></td></tr></table></figure><h4 id="3-å¼€å‘è®¤è¯ä»£ç "><a href="#3-å¼€å‘è®¤è¯ä»£ç " class="headerlink" title="3.å¼€å‘è®¤è¯ä»£ç "></a>3.å¼€å‘è®¤è¯ä»£ç </h4><p><code>TestAuthenticator</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UnknownAccountException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;<br><span class="hljs-keyword">import</span> org.apache.shiro.realm.text.IniRealm;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: TestAuthenticator &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: &lt;br/&gt;</span><br><span class="hljs-comment"> * date: 2022/6/19 14:53&lt;br/&gt;</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAuthenticator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//1. åˆ›å»ºå®‰å…¨ç®¡ç†å™¨å¯¹è±¡</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        <span class="hljs-comment">//2. ç»™å®‰å…¨ç®¡ç†å™¨è®¾ç½®realm</span><br>        securityManager.setRealm(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IniRealm</span>(<span class="hljs-string">&quot;classpath:shiro.ini&quot;</span>));<br>        <span class="hljs-comment">//3. securityUtils ç»™å…¨å±€å®‰å…¨å·¥å…·ç±»è®¾ç½®å®‰å…¨ç®¡ç†å™¨</span><br>        SecurityUtils.setSecurityManager(securityManager);<br>        <span class="hljs-comment">//4. å…³é”®å¯¹è±¡ subject ä¸»ä½“</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-comment">//5. åˆ›å»ºä»¤ç‰Œ</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">usernamePasswordToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;wt&quot;</span>, <span class="hljs-string">&quot;13&quot;</span>);<br>        <span class="hljs-comment">// ç”¨æˆ·è®¤è¯</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å‰:&quot;</span> + subject.isAuthenticated());<br>            subject.login(usernamePasswordToken);<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å:&quot;</span> + subject.isAuthenticated());<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>output:<br>è®¤è¯ä¹‹å‰:<span class="hljs-literal">false</span><br>è®¤è¯ä¹‹å:<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h4 id="4-å¸¸è§çš„å¼‚å¸¸ç±»å‹"><a href="#4-å¸¸è§çš„å¼‚å¸¸ç±»å‹" class="headerlink" title="4.å¸¸è§çš„å¼‚å¸¸ç±»å‹"></a>4.å¸¸è§çš„å¼‚å¸¸ç±»å‹</h4><h5 id="IncorrectCredentialsExceptionï¼ˆå¯†ç é”™è¯¯ï¼‰"><a href="#IncorrectCredentialsExceptionï¼ˆå¯†ç é”™è¯¯ï¼‰" class="headerlink" title="IncorrectCredentialsExceptionï¼ˆå¯†ç é”™è¯¯ï¼‰"></a>IncorrectCredentialsExceptionï¼ˆå¯†ç é”™è¯¯ï¼‰</h5><p>![[Pasted image 20220619151535.png|400]]</p><h5 id="UnknownAccountExceptionï¼ˆç”¨æˆ·ä¸å­˜åœ¨ï¼‰"><a href="#UnknownAccountExceptionï¼ˆç”¨æˆ·ä¸å­˜åœ¨ï¼‰" class="headerlink" title="UnknownAccountExceptionï¼ˆç”¨æˆ·ä¸å­˜åœ¨ï¼‰"></a>UnknownAccountExceptionï¼ˆç”¨æˆ·ä¸å­˜åœ¨ï¼‰</h5><p>![[Pasted image 20220619151629.png|400]]</p><h5 id="DisabledAccountExceptionï¼ˆå¸å·è¢«ç¦ç”¨ï¼‰"><a href="#DisabledAccountExceptionï¼ˆå¸å·è¢«ç¦ç”¨ï¼‰" class="headerlink" title="DisabledAccountExceptionï¼ˆå¸å·è¢«ç¦ç”¨ï¼‰"></a>DisabledAccountExceptionï¼ˆå¸å·è¢«ç¦ç”¨ï¼‰</h5><h5 id="LockedAccountExceptionï¼ˆå¸å·è¢«é”å®šï¼‰"><a href="#LockedAccountExceptionï¼ˆå¸å·è¢«é”å®šï¼‰" class="headerlink" title="LockedAccountExceptionï¼ˆå¸å·è¢«é”å®šï¼‰"></a>LockedAccountExceptionï¼ˆå¸å·è¢«é”å®šï¼‰</h5><h5 id="ExcessiveAttemptsExceptionï¼ˆç™»å½•å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼‰"><a href="#ExcessiveAttemptsExceptionï¼ˆç™»å½•å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼‰" class="headerlink" title="ExcessiveAttemptsExceptionï¼ˆç™»å½•å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼‰"></a>ExcessiveAttemptsExceptionï¼ˆç™»å½•å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼‰</h5><h5 id="ExpiredCredentialsExceptionï¼ˆå‡­è¯è¿‡æœŸï¼‰"><a href="#ExpiredCredentialsExceptionï¼ˆå‡­è¯è¿‡æœŸï¼‰" class="headerlink" title="ExpiredCredentialsExceptionï¼ˆå‡­è¯è¿‡æœŸï¼‰"></a>ExpiredCredentialsExceptionï¼ˆå‡­è¯è¿‡æœŸï¼‰</h5><h5 id="ç­‰"><a href="#ç­‰" class="headerlink" title="ç­‰"></a>ç­‰</h5><h4 id="5-è‡ªå®šä¹‰Realm"><a href="#5-è‡ªå®šä¹‰Realm" class="headerlink" title="5.  è‡ªå®šä¹‰Realm"></a>5.  è‡ªå®šä¹‰Realm</h4><blockquote><p>é€šè¿‡åˆ†ææºç å¯å¾—ï¼š<br>è®¤è¯ï¼š<br>1.æœ€ç»ˆæ‰§è¡Œç”¨æˆ·åæ¯”è¾ƒ æ˜¯åœ¨<code>SimpleAccountRealm</code>ç±»çš„<code>doGetAuthenticationInfo</code> æ–¹æ³•ä¸­å®Œæˆç”¨æˆ·åæ ¡éªŒ<br>2.æœ€ç»ˆå¯†ç æ ¡éªŒæ˜¯åœ¨ <code>AuthenticatingRealm</code>ç±» çš„ <code>assertCredentialsMatch</code>æ–¹æ³• ä¸­<br>æ€»ç»“ï¼š<br><code>AuthenticatingRealm</code> ï¼ˆè®¤è¯realmï¼‰ <code>doGetAuthenticationInfo</code><br><code>AuthorizingRealm</code> ï¼ˆæˆæƒrealmï¼‰ <code>doGetAuthorizationInfo</code></p></blockquote><p>è‡ªå®šä¹‰Realmçš„ä½œç”¨ï¼šæ”¾å¼ƒä½¿ç”¨.iniæ–‡ä»¶ï¼Œä½¿ç”¨æ•°æ®åº“æŸ¥è¯¢</p><p>ä¸Šè¾¹çš„ç¨‹åºä½¿ç”¨çš„æ˜¯Shiroè‡ªå¸¦çš„IniRealmï¼ŒIniRealmä»inié…ç½®æ–‡ä»¶ä¸­è¯»å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éœ€è¦ä»ç³»ç»Ÿçš„æ•°æ®åº“ä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰realmã€‚</p><h5 id="5-1-shiroæä¾›çš„Realm"><a href="#5-1-shiroæä¾›çš„Realm" class="headerlink" title="5.1 shiroæä¾›çš„Realm"></a>5.1 shiroæä¾›çš„Realm</h5><p><img src="/Resources/Pasted%20image%2020220619154953.png" alt="Pasted image 20220619154953"><br>å³é”®<br><img src="/Resources/Pasted%20image%2020220619155013.png" alt="Pasted image 20220619155013"><br><img src="/Resources/Pasted%20image%2020220619160248.png" alt="Pasted image 20220619160248"></p><h5 id="5-2-æ ¹æ®è®¤è¯æºç è®¤è¯ä½¿ç”¨çš„æ˜¯SimpleAccountRealm"><a href="#5-2-æ ¹æ®è®¤è¯æºç è®¤è¯ä½¿ç”¨çš„æ˜¯SimpleAccountRealm" class="headerlink" title="5.2 æ ¹æ®è®¤è¯æºç è®¤è¯ä½¿ç”¨çš„æ˜¯SimpleAccountRealm"></a>5.2 æ ¹æ®è®¤è¯æºç è®¤è¯ä½¿ç”¨çš„æ˜¯SimpleAccountRealm</h5><p><img src="/Resources/Pasted%20image%2020220619160233.png" alt="Pasted image 20220619160233"></p><blockquote><p>SimpleAccountRealmçš„éƒ¨åˆ†æºç ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ä¸€ä¸ªæ˜¯ è®¤è¯ ä¸€ä¸ªæ˜¯ æˆæƒ,</p></blockquote><p>æºç éƒ¨åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleAccountRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br><span class="hljs-comment">//.......çœç•¥</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">upToken</span> <span class="hljs-operator">=</span> (UsernamePasswordToken) token;<br>        <span class="hljs-type">SimpleAccount</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> getUser(upToken.getUsername());<br><br>        <span class="hljs-keyword">if</span> (account != <span class="hljs-literal">null</span>) &#123;<br><br>            <span class="hljs-keyword">if</span> (account.isLocked()) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LockedAccountException</span>(<span class="hljs-string">&quot;Account [&quot;</span> + account + <span class="hljs-string">&quot;] is locked.&quot;</span>);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (account.isCredentialsExpired()) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;The credentials for account [&quot;</span> + account + <span class="hljs-string">&quot;] are expired&quot;</span>;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExpiredCredentialsException</span>(msg);<br>            &#125;<br><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> account;<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> getUsername(principals);<br>        USERS_LOCK.readLock().lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.users.get(username);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            USERS_LOCK.readLock().unlock();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="5-3-è‡ªå®šä¹‰realm"><a href="#5-3-è‡ªå®šä¹‰realm" class="headerlink" title="5.3 è‡ªå®šä¹‰realm"></a>5.3 è‡ªå®šä¹‰realm</h5><p>![[Pasted image 20220619161700.png|400]]<br>é€šè¿‡ä¸Šä¸€éƒ¨åˆ†å¯çŸ¥ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°æŠ½è±¡ç±»<code>AuthorizingRealm</code>çš„<code>doGetAuthorizationInfo</code>å’Œ<code>AuthenticatingRealm</code>ä¸­çš„<code>doGetAuthenticationInf</code><br>ä½†æ˜¯é€šè¿‡ä¸Šå›¾å¯çŸ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ªç±»ç»§æ‰¿<code>AuthorizingRealm</code>å³å¯ï¼ˆå› ä¸º<code>AuthorizingRealm</code>ç»§æ‰¿äº†<code>AuthenticatingRealm</code>ï¼‰</p><hr><p>åœ¨ç¼–å†™è‡ªå®šä¹‰realmçš„ç±»ä¸­çš„doGetAuthenticationInfoæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›çš„å¯¹è±¡æ˜¯AuthenticationInfoï¼Œé€šè¿‡æŸ¥çœ‹ä¸‹å›¾ï¼Œå¯ä»¥å‘ç°å¯ä»¥ç”¨ä¸¤ä¸ªå®ç°ç±»è¿”å›ã€‚<br><img src="/Resources/Pasted%20image%2020220619162838.png" alt="Pasted image 20220619162838"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.realm;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.PrincipalCollection;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: CustomerRealm &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: è‡ªå®šä¹‰realmå®ç°,å°†è®¤è¯/æˆæƒæ•°æ®çš„æ¥æºè½¬ä¸ºæ•°æ®åº“çš„å®ç°</span><br><span class="hljs-comment"> * date: 2022/6/19 16:12&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-comment">//æˆæƒ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//è®¤è¯</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-comment">// å¯†ç æ˜¯åœ¨çˆ¶ç±»æ ¡éªŒçš„</span><br>        <span class="hljs-comment">// åœ¨tokenä¸­è·å–ç”¨æˆ·å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> (String) token.getPrincipal();<br>        System.out.println(principal);<br>        <span class="hljs-comment">// å®é™…å¼€å‘ä¸­åº”å½“ æ ¹æ®èº«ä»½ä¿¡æ¯ä½¿ç”¨jdbc mybatisæŸ¥è¯¢ç›¸å…³æ•°æ®åº“</span><br>        <span class="hljs-comment">// åœ¨è¿™é‡Œåªåšç®€å•çš„æ¼”ç¤º</span><br>        <span class="hljs-comment">// å‡è®¾username,passwordæ˜¯ä»æ•°æ®åº“è·å¾—çš„ä¿¡æ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;wtt&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123&quot;</span>;<br>        <span class="hljs-keyword">if</span> (username.equals(principal)) &#123;<br>            <span class="hljs-comment">// å‚æ•°1:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®çš„ç”¨æˆ·å</span><br>            <span class="hljs-comment">// å‚æ•°2:è¿”å›æ•°æ®åº“ä¸­æ­£ç¡®å¯†ç </span><br>            <span class="hljs-comment">// å‚æ•°3:æä¾›å½“å‰realmçš„åå­— this.getName();</span><br>            <span class="hljs-type">SimpleAuthenticationInfo</span> <span class="hljs-variable">simpleAuthenticationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(principal, password, <span class="hljs-built_in">this</span>.getName());<br>            <span class="hljs-keyword">return</span> simpleAuthenticationInfo;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h5 id="5-4-ä½¿ç”¨è‡ªå®šä¹‰Realmè®¤è¯"><a href="#5-4-ä½¿ç”¨è‡ªå®šä¹‰Realmè®¤è¯" class="headerlink" title="5.4 ä½¿ç”¨è‡ªå®šä¹‰Realmè®¤è¯"></a>5.4 ä½¿ç”¨è‡ªå®šä¹‰Realmè®¤è¯</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UnknownAccountException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;<br><span class="hljs-keyword">import</span> org.apache.shiro.realm.text.IniRealm;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;<br><span class="hljs-keyword">import</span> org.example.realm.CustomerRealm;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: TestCustomerAuthenticator &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: ä½¿ç”¨è‡ªå®šä¹‰Realm</span><br><span class="hljs-comment"> * date: 2022/6/19 16:19&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCustomerAuthenticator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//1. åˆ›å»ºå®‰å…¨ç®¡ç†å™¨å¯¹è±¡</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        <span class="hljs-comment">//2. ç»™å®‰å…¨ç®¡ç†å™¨è®¾ç½®realm</span><br>        securityManager.setRealm(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerRealm</span>());<br>        <span class="hljs-comment">//3. securityUtils ç»™å…¨å±€å®‰å…¨å·¥å…·ç±»è®¾ç½®å®‰å…¨ç®¡ç†å™¨</span><br>        SecurityUtils.setSecurityManager(securityManager);<br>        <span class="hljs-comment">//4. å…³é”®å¯¹è±¡ subject ä¸»ä½“</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-comment">//5. åˆ›å»ºä»¤ç‰Œ</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">usernamePasswordToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;wtt&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å‰:&quot;</span> + subject.isAuthenticated());<br>            subject.login(usernamePasswordToken);<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å:&quot;</span> + subject.isAuthenticated());<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="6-ä½¿ç”¨MD5-Salt-Hash"><a href="#6-ä½¿ç”¨MD5-Salt-Hash" class="headerlink" title="6. ä½¿ç”¨MD5+Salt+Hash"></a>6. ä½¿ç”¨MD5+Salt+Hash</h4><p>å®é™…åº”ç”¨æ˜¯å°†ç›å’Œæ•£åˆ—åçš„å€¼å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè‡ªåŠ¨realmä»æ•°æ®åº“å–å‡ºç›å’ŒåŠ å¯†åçš„å€¼ç”±shiroå®Œæˆå¯†ç æ ¡éªŒã€‚</p><blockquote><p>è¡¥å……ï¼šMD5ç®—æ³•</p><p>ä½œç”¨ï¼šä¸€èˆ¬ç”¨æ¥åŠ å¯†æˆ–è€…ç­¾åï¼ˆæ ¡éªŒå’Œï¼‰ã€‚<br>ç”Ÿæˆç»“æœï¼šå§‹ç»ˆæ˜¯ä¸€ä¸ª16è¿›åˆ¶32ä½é•¿åº¦å­—ç¬¦ä¸²ã€‚</p><h2 id="ç‰¹ç‚¹ï¼š1-MD5ç®—æ³•ä¸å¯é€†ã€‚2-å¦‚æœå†…å®¹ç›¸åŒæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡md5ç”Ÿæˆç»“æœå§‹ç»ˆæ˜¯ä¸€è‡´ã€‚"><a href="#ç‰¹ç‚¹ï¼š1-MD5ç®—æ³•ä¸å¯é€†ã€‚2-å¦‚æœå†…å®¹ç›¸åŒæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡md5ç”Ÿæˆç»“æœå§‹ç»ˆæ˜¯ä¸€è‡´ã€‚" class="headerlink" title="ç‰¹ç‚¹ï¼š1. MD5ç®—æ³•ä¸å¯é€†ã€‚2. å¦‚æœå†…å®¹ç›¸åŒæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡md5ç”Ÿæˆç»“æœå§‹ç»ˆæ˜¯ä¸€è‡´ã€‚"></a>ç‰¹ç‚¹ï¼š<br>1. MD5ç®—æ³•ä¸å¯é€†ã€‚<br>2. å¦‚æœå†…å®¹ç›¸åŒæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡md5ç”Ÿæˆç»“æœå§‹ç»ˆæ˜¯ä¸€è‡´ã€‚</h2><p>ç½‘ç»œä¸Šæä¾›çš„MD5åœ¨çº¿è§£å¯†ä¸€èˆ¬æ˜¯ç”¨ç©·ä¸¾çš„æ–¹æ³•ã€‚<br>ç›ï¼ˆSaltï¼‰ï¼šå¦‚å¯†ç æ˜¯123456ï¼ŒåŠ ç›ä¹‹åï¼Œå˜æˆäº†123456a*qzã€‚</p></blockquote><h6 id="Shiroä¸­çš„MD5-Salt-Hash"><a href="#Shiroä¸­çš„MD5-Salt-Hash" class="headerlink" title="Shiroä¸­çš„MD5,Salt,Hash"></a>Shiroä¸­çš„MD5,Salt,Hash</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.crypto.hash.Md5Hash;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: TestShiroMD5 &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: &lt;br/&gt;</span><br><span class="hljs-comment"> * date: 2022/6/19 17:18&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestShiroMD5</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªmd5ç®—æ³•</span><br><span class="hljs-comment">//        Md5Hash md5Hash = new Md5Hash();</span><br><span class="hljs-comment">//        md5Hash.setBytes(&quot;1234&quot;.getBytes());</span><br><span class="hljs-comment">//        System.out.println(md5Hash.toHex());</span><br><br>        <span class="hljs-comment">//ä½¿ç”¨md5ï¼Œæ„é€ å‡½æ•°</span><br>        <span class="hljs-type">Md5Hash</span> <span class="hljs-variable">md5Hash</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Md5Hash</span>(<span class="hljs-string">&quot;X0*7ps123&quot;</span>);<br>        System.out.println(md5Hash.toHex());<br><br>        <span class="hljs-comment">//ä½¿ç”¨MD5 + saltå¤„ç†</span><br>        <span class="hljs-type">Md5Hash</span> <span class="hljs-variable">md5Hash1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Md5Hash</span>(<span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-string">&quot;X0*7ps&quot;</span>);<br>        System.out.println(md5Hash1.toHex());<br><br>        <span class="hljs-comment">// ç”±ç¬¬ä¸€ç§å’Œç¬¬ä¸€ç§çš„ç»“æœå¯çŸ¥ï¼ŒSalté»˜è®¤åŠ åœ¨å‰é¢çš„</span><br><br>        <span class="hljs-comment">//ä½¿ç”¨md5 + salt + hashæ•£åˆ—ï¼ˆå‚æ•°ä»£è¡¨è¦æ•£åˆ—å¤šå°‘æ¬¡ï¼Œä¸€èˆ¬æ˜¯ 1024æˆ–2048ï¼‰</span><br>        <span class="hljs-type">Md5Hash</span> <span class="hljs-variable">md5Hash2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Md5Hash</span>(<span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-string">&quot;X0*7ps&quot;</span>, <span class="hljs-number">1024</span>);<br>        System.out.println(md5Hash2.toHex());<br>    &#125;<br>&#125;<br><br><br>output:<br>8a83592a02263bfe6752b2b5b03a4799<br>8a83592a02263bfe6752b2b5b03a4799<br>e4f9bf3e0c58f045e62c23c533fcf633<br></code></pre></td></tr></table></figure><h6 id="è‡ªå®šä¹‰md5-saltçš„realm"><a href="#è‡ªå®šä¹‰md5-saltçš„realm" class="headerlink" title="è‡ªå®šä¹‰md5+saltçš„realm"></a>è‡ªå®šä¹‰md5+saltçš„realm</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.realm;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.PrincipalCollection;<br><span class="hljs-keyword">import</span> org.apache.shiro.util.ByteSource;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: CustomerMd5Realm &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: ä½¿ç”¨è‡ªå®šä¹‰realm åŠ å…¥ md5 å salt + hash</span><br><span class="hljs-comment"> * date: 2022/6/19 18:00&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerMd5Realm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-comment">//è·å– tokenä¸­çš„ ç”¨æˆ·å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> (String) token.getPrincipal();<br><br>        <span class="hljs-comment">//å‡è®¾è¿™æ˜¯ä»æ•°æ®åº“æŸ¥è¯¢åˆ°çš„ä¿¡æ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;wtt&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;e4f9bf3e0c58f045e62c23c533fcf633&quot;</span>;<span class="hljs-comment">//åŠ å¯†å</span><br><br>        <span class="hljs-comment">//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“</span><br>        <span class="hljs-keyword">if</span> (username.equals(principal)) &#123;<br>            <span class="hljs-comment">//å‚æ•°1:æ•°æ®åº“ç”¨æˆ·å</span><br>            <span class="hljs-comment">//å‚æ•°2:æ•°æ®åº“md5+saltä¹‹åçš„å¯†ç </span><br>            <span class="hljs-comment">//å‚æ•°3:æ³¨å†Œæ—¶çš„éšæœºç›</span><br>            <span class="hljs-comment">//å‚æ•°4:realmçš„åå­—</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(principal,<br>                    password,<br>                    ByteSource.Util.bytes(<span class="hljs-string">&quot;X0*7ps&quot;</span>),<br>                    <span class="hljs-built_in">this</span>.getName());<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h6 id="ä½¿ç”¨md5-saltè®¤è¯"><a href="#ä½¿ç”¨md5-saltè®¤è¯" class="headerlink" title="ä½¿ç”¨md5+saltè®¤è¯"></a>ä½¿ç”¨md5+saltè®¤è¯</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UnknownAccountException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher;<br><span class="hljs-keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;<br><span class="hljs-keyword">import</span> org.example.realm.CustomerMd5Realm;<br><span class="hljs-keyword">import</span> org.example.realm.CustomerRealm;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: TestCustomerMd5Authenticator &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: &lt;br/&gt;</span><br><span class="hljs-comment"> * date: 2022/6/19 18:01&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCustomerMd5Authenticator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//1. åˆ›å»ºå®‰å…¨ç®¡ç†å™¨å¯¹è±¡</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        <span class="hljs-comment">//2. åˆ›å»ºmd5Realmå¯¹è±¡</span><br>        <span class="hljs-type">CustomerMd5Realm</span> <span class="hljs-variable">md5Realm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerMd5Realm</span>();<br><br>        <span class="hljs-comment">//------------------------------------------------------</span><br>        <span class="hljs-comment">//æ–°å¢æ­¥éª¤</span><br>        <span class="hljs-comment">//3. åˆ›å»ºhashå‡­è¯åŒ¹é…å™¨</span><br>        <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">credentialsMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>();<br>        <span class="hljs-comment">//4. è®¾ç½®hashç®—æ³•çš„åå­—</span><br>        credentialsMatcher.setHashAlgorithmName(<span class="hljs-string">&quot;md5&quot;</span>);<br>        <span class="hljs-comment">//5. ç»™å½“å‰çš„realmè®¾å®šæ–°çš„å‡­è¯åŒ¹é…å™¨</span><br>        md5Realm.setCredentialsMatcher(credentialsMatcher);<br>        <span class="hljs-comment">//------------------------------------------------------</span><br><br>        <span class="hljs-comment">//6. ç»™å®‰å…¨ç®¡ç†å™¨è®¾ç½®realm</span><br>        securityManager.setRealm(md5Realm);<br>        <span class="hljs-comment">//7. securityUtils ç»™å…¨å±€å®‰å…¨å·¥å…·ç±»è®¾ç½®å®‰å…¨ç®¡ç†å™¨</span><br>        SecurityUtils.setSecurityManager(securityManager);<br>        <span class="hljs-comment">//8. å…³é”®å¯¹è±¡ subject ä¸»ä½“</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-comment">//9. åˆ›å»ºä»¤ç‰Œ</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">usernamePasswordToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;wtt&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å‰:&quot;</span> + subject.isAuthenticated());<br>            subject.login(usernamePasswordToken);<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å:&quot;</span> + subject.isAuthenticated());<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h6 id="å¦‚æœæœ‰æ•£åˆ—ï¼Œåˆ™éœ€è¦åœ¨ä¸Šè¿°ä»£ç ä¸­ç»™å‡­è¯åŒ¹é…å™¨setHashIterations"><a href="#å¦‚æœæœ‰æ•£åˆ—ï¼Œåˆ™éœ€è¦åœ¨ä¸Šè¿°ä»£ç ä¸­ç»™å‡­è¯åŒ¹é…å™¨setHashIterations" class="headerlink" title="å¦‚æœæœ‰æ•£åˆ—ï¼Œåˆ™éœ€è¦åœ¨ä¸Šè¿°ä»£ç ä¸­ç»™å‡­è¯åŒ¹é…å™¨setHashIterations"></a>å¦‚æœæœ‰æ•£åˆ—ï¼Œåˆ™éœ€è¦åœ¨ä¸Šè¿°ä»£ç ä¸­ç»™å‡­è¯åŒ¹é…å™¨<code>setHashIterations</code></h6><p><code>credentialsMatcher.setHashIterations(&#39;æ•£åˆ—çš„æ¬¡æ•°&#39;);</code></p><blockquote><p>åŠ å¯†ç®—æ³•å’Œæ•£åˆ—æ¬¡æ•°å‡æ˜¯ä½¿ç”¨<code>credentialsMatcher</code>çš„<code>setxxxxx</code>æ–¹æ³•</p></blockquote><p>è®¤è¯é€»è¾‘ï¼š<br>![[Pasted image 20220619183827.png]]</p><h2 id="äº”ã€shiroä¸­çš„æˆæƒ"><a href="#äº”ã€shiroä¸­çš„æˆæƒ" class="headerlink" title="äº”ã€shiroä¸­çš„æˆæƒ"></a>äº”ã€shiroä¸­çš„æˆæƒ</h2><h3 id="5-1-æˆæƒ"><a href="#5-1-æˆæƒ" class="headerlink" title="5.1 æˆæƒ"></a>5.1 æˆæƒ</h3><p>æˆæƒï¼Œå³è®¿é—®æ§åˆ¶ï¼Œæ§åˆ¶è°èƒ½è®¿é—®å“ªäº›èµ„æºã€‚ä¸»ä½“è¿›è¡Œèº«ä»½è®¤è¯åéœ€è¦åˆ†é…æƒé™æ–¹å¯è®¿é—®ç³»ç»Ÿçš„èµ„æºï¼Œå¯¹äºæŸäº›èµ„æºæ²¡æœ‰æƒé™æ˜¯æ— æ³•è®¿é—®çš„ã€‚</p><h3 id="5-2-å…³é”®å¯¹è±¡"><a href="#5-2-å…³é”®å¯¹è±¡" class="headerlink" title="5.2 å…³é”®å¯¹è±¡"></a>5.2 å…³é”®å¯¹è±¡</h3><p><mark>æˆæƒå¯ç®€å•ç†è§£ä¸ºwhoå¯¹what(which)è¿›è¡ŒHowæ“ä½œï¼š</mark></p><p><mark>Whoï¼Œå³ä¸»ä½“ï¼ˆSubjectï¼‰</mark>ï¼Œä¸»ä½“éœ€è¦è®¿é—®ç³»ç»Ÿä¸­çš„èµ„æºã€‚</p><p><mark>Whatï¼Œå³èµ„æºï¼ˆResource)</mark>ï¼Œå¦‚ç³»ç»Ÿèœå•ã€é¡µé¢ã€æŒ‰é’®ã€ç±»æ–¹æ³•ã€ç³»ç»Ÿå•†å“ä¿¡æ¯ç­‰ã€‚èµ„æºåŒ…æ‹¬<mark>èµ„æºç±»å‹</mark>å’Œ<mark>èµ„æºå®ä¾‹</mark>ï¼Œæ¯”å¦‚å•†å“ä¿¡æ¯ä¸ºèµ„æºç±»å‹ï¼Œç±»å‹ä¸ºt01çš„å•†å“ä¸ºèµ„æºå®ä¾‹ï¼Œç¼–å·ä¸º001çš„å•†å“ä¿¡æ¯ä¹Ÿå±äºèµ„æºå®ä¾‹ã€‚</p><p><mark>Howï¼Œæƒé™&#x2F;è®¸å¯ï¼ˆPermission)</mark>ï¼Œè§„å®šäº†ä¸»ä½“å¯¹èµ„æºçš„æ“ä½œè®¸å¯ï¼Œ<mark>æƒé™ç¦»å¼€èµ„æºæ²¡æœ‰æ„ä¹‰</mark>ï¼Œå¦‚ç”¨æˆ·æŸ¥è¯¢æƒé™ã€ç”¨æˆ·æ·»åŠ æƒé™ã€æŸä¸ªç±»æ–¹æ³•çš„è°ƒç”¨æƒé™ã€ç¼–å·ä¸º001ç”¨æˆ·çš„ä¿®æ”¹æƒé™ç­‰ï¼Œé€šè¿‡æƒé™å¯çŸ¥ä¸»ä½“å¯¹å“ªäº›èµ„æºéƒ½æœ‰å“ªäº›æ“ä½œè®¸å¯ã€‚</p><h3 id="5-3-æˆæƒæµç¨‹"><a href="#5-3-æˆæƒæµç¨‹" class="headerlink" title="5.3 æˆæƒæµç¨‹"></a>5.3 æˆæƒæµç¨‹</h3><p><img src="/Resources/Pasted%20image%2020220619185305.png" alt="Pasted image 20220619185305"></p><h3 id="5-4-æˆæƒæ–¹å¼"><a href="#5-4-æˆæƒæ–¹å¼" class="headerlink" title="5.4 æˆæƒæ–¹å¼"></a>5.4 æˆæƒæ–¹å¼</h3><ul><li><p><mark>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</mark><br>RBACåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰æ˜¯ä»¥è§’è‰²ä¸ºä¸­å¿ƒè¿›è¡Œè®¿é—®æ§åˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(subject.hasRole(<span class="hljs-string">&quot;admin&quot;</span>))&#123;<br> <span class="hljs-comment">//æ“ä½œä»€ä¹ˆèµ„æº</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><mark>åŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶</mark><br>RBACåŸºäºèµ„æºçš„è®¿é—®æ§åˆ¶ï¼ˆResource-Based Access Controlï¼‰æ˜¯ä»¥èµ„æºä¸ºä¸­å¿ƒè¿›è¡Œè®¿é—®æ§åˆ¶  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(subject.isPermission(<span class="hljs-string">&quot;user:update:01&quot;</span>))&#123;<br><span class="hljs-comment">//ä¸»ä½“ å¯¹ èµ„æºï¼ˆ01ï¼‰å…·æœ‰ä¿®æ”¹çš„æƒé™</span><br>&#125;<br><span class="hljs-keyword">if</span>(subject.isPermission(<span class="hljs-string">&quot;user:update:*&quot;</span>))&#123;<br><span class="hljs-comment">//ä¸»ä½“ å¯¹ æ‰€æœ‰çš„èµ„æº å…·æœ‰æ›´æ–°çš„æƒé™</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="5-5-æƒé™å­—ç¬¦ä¸²"><a href="#5-5-æƒé™å­—ç¬¦ä¸²" class="headerlink" title="5.5 æƒé™å­—ç¬¦ä¸²"></a>5.5 æƒé™å­—ç¬¦ä¸²</h3><p>æƒé™å­—ç¬¦ä¸²çš„è§„åˆ™æ˜¯ï¼šèµ„æºæ ‡è¯†ç¬¦ : æ“ä½œ : èµ„æºå®ä¾‹æ ‡è¯†ç¬¦ï¼Œæ„æ€æ˜¯å¯¹å“ªä¸ªèµ„æºçš„å“ªä¸ªå®ä¾‹å…·æœ‰ä»€ä¹ˆæ“ä½œï¼Œâ€:â€æ˜¯èµ„æº&#x2F;æ“ä½œ&#x2F;å®ä¾‹çš„åˆ†å‰²ç¬¦ï¼Œæƒé™å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ä½¿<code>*</code>é€šé…ç¬¦ã€‚</p><p>ä¾‹å­ï¼š</p><ul><li>ç”¨æˆ·åˆ›å»ºæƒé™ï¼šuser:createï¼Œæˆ–user:create:*</li><li>ç”¨æˆ·ä¿®æ”¹å®ä¾‹001çš„æƒé™ï¼šuser:update:001</li><li>ç”¨æˆ·å®ä¾‹001çš„æ‰€æœ‰æƒé™ï¼šuser : * : 001</li></ul><h3 id="5-6-shiroä¸­æˆæƒç¼–ç¨‹å®ç°æ–¹å¼"><a href="#5-6-shiroä¸­æˆæƒç¼–ç¨‹å®ç°æ–¹å¼" class="headerlink" title="5.6 shiroä¸­æˆæƒç¼–ç¨‹å®ç°æ–¹å¼"></a>5.6 shiroä¸­æˆæƒç¼–ç¨‹å®ç°æ–¹å¼</h3><p>ç¼–ç¨‹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br><span class="hljs-keyword">if</span>(subject.hasRole(â€œadminâ€)) &#123;<br><span class="hljs-comment">//æœ‰æƒé™</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//æ— æƒé™</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ³¨è§£å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequiresRoles(&quot;admin&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">//æœ‰æƒé™</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ ‡ç­¾å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">JSP/GSP æ ‡ç­¾ï¼šåœ¨JSP/GSP é¡µé¢é€šè¿‡ç›¸åº”çš„æ ‡ç­¾å®Œæˆï¼š<br>&lt;shiro:hasRole name=<span class="hljs-string">&quot;admin&quot;</span>&gt;<br>&lt;!â€” æœ‰æƒé™â€”&gt;<br>&lt;/shiro:hasRole&gt;<br>æ³¨æ„: Thymeleaf ä¸­ä½¿ç”¨shiroéœ€è¦é¢å¤–é›†æˆ!<br><br></code></pre></td></tr></table></figure><h3 id="5-7-å¼€å‘æˆæƒ"><a href="#5-7-å¼€å‘æˆæƒ" class="headerlink" title="5.7 å¼€å‘æˆæƒ"></a>5.7 å¼€å‘æˆæƒ</h3><h4 id="1-realmçš„å®ç°"><a href="#1-realmçš„å®ç°" class="headerlink" title="1.realmçš„å®ç°"></a>1.realmçš„å®ç°</h4><p>ä¸»è¦æ˜¯çœ‹ä¸Šé¢çš„<code>doGetAuthorizationInfo</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.realm;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.AuthenticationToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;<br><span class="hljs-keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.PrincipalCollection;<br><span class="hljs-keyword">import</span> org.apache.shiro.util.ByteSource;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: CustomerMd5Realm &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: ä½¿ç”¨è‡ªå®šä¹‰realm åŠ å…¥ md5 å salt + hash</span><br><span class="hljs-comment"> * date: 2022/6/19 18:00&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerMd5Realm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principals)</span> &#123;<br>        <span class="hljs-comment">//System.out.println(&quot;----&quot;);</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">primaryPrincipal</span> <span class="hljs-operator">=</span> (String) principals.getPrimaryPrincipal();<br>        System.out.println(<span class="hljs-string">&quot;èº«ä»½ä¿¡æ¯:&quot;</span> + primaryPrincipal);<br>        <span class="hljs-comment">//æ ¹æ®èº«ä»½ä¿¡æ¯ ç”¨æˆ·åï¼Œè·å–å½“å‰ç”¨æˆ·çš„è§’è‰²ä¿¡æ¯å’Œæƒé™ä¿¡æ¯</span><br>        <span class="hljs-comment">//å‡è®¾ç°åœ¨åªæœ‰adminå’Œuser</span><br>        <span class="hljs-type">SimpleAuthorizationInfo</span> <span class="hljs-variable">simpleAuthorizationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthorizationInfo</span>();<br>        <span class="hljs-comment">//å°†æ•°æ®åº“ä¸­çš„è§’è‰²ä¿¡æ¯èµ‹å€¼ç»™æƒé™å¯¹è±¡</span><br>        simpleAuthorizationInfo.addRole(<span class="hljs-string">&quot;admin&quot;</span>);<br>        simpleAuthorizationInfo.addRole(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-comment">//å°†æ•°æ®åº“ä¸­çš„æƒé™ä¿¡æ¯èµ‹å€¼ç»™æƒé™å¯¹è±¡</span><br>        simpleAuthorizationInfo.addStringPermission(<span class="hljs-string">&quot;user:*:*&quot;</span>);<br>        simpleAuthorizationInfo.addStringPermission(<span class="hljs-string">&quot;product:create&quot;</span>);<br>        <span class="hljs-keyword">return</span> simpleAuthorizationInfo;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException &#123;<br>        <span class="hljs-comment">//è·å– tokenä¸­çš„ ç”¨æˆ·å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> (String) token.getPrincipal();<br><br>        <span class="hljs-comment">//å‡è®¾è¿™æ˜¯ä»æ•°æ®åº“æŸ¥è¯¢åˆ°çš„ä¿¡æ¯</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;wtt&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;e4f9bf3e0c58f045e62c23c533fcf633&quot;</span>;<span class="hljs-comment">//åŠ å¯†å</span><br><br>        <span class="hljs-comment">//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“</span><br>        <span class="hljs-keyword">if</span> (username.equals(principal)) &#123;<br>            <span class="hljs-comment">//å‚æ•°1:æ•°æ®åº“ç”¨æˆ·å</span><br>            <span class="hljs-comment">//å‚æ•°2:æ•°æ®åº“md5+saltä¹‹åçš„å¯†ç </span><br>            <span class="hljs-comment">//å‚æ•°3:æ³¨å†Œæ—¶çš„éšæœºç›</span><br>            <span class="hljs-comment">//å‚æ•°4:realmçš„åå­—</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(principal,<br>                    password,<br>                    ByteSource.Util.bytes(<span class="hljs-string">&quot;X0*7ps&quot;</span>),<br>                    <span class="hljs-built_in">this</span>.getName());<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="2-æˆæƒ"><a href="#2-æˆæƒ" class="headerlink" title="2.æˆæƒ"></a>2.æˆæƒ</h4><p>ä¸»è¦æ˜¯çœ‹<code>-------------------------------------------</code>ä¸‹é¢çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.apache.shiro.SecurityUtils;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.IncorrectCredentialsException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UnknownAccountException;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.UsernamePasswordToken;<br><span class="hljs-keyword">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher;<br><span class="hljs-keyword">import</span> org.apache.shiro.mgt.DefaultSecurityManager;<br><span class="hljs-keyword">import</span> org.apache.shiro.subject.Subject;<br><span class="hljs-keyword">import</span> org.example.realm.CustomerMd5Realm;<br><br><span class="hljs-keyword">import</span> javax.sound.midi.Soundbank;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ClassName: TestCustomerMd5Authenticator &lt;br/&gt;</span><br><span class="hljs-comment"> * Description: &lt;br/&gt;</span><br><span class="hljs-comment"> * date: 2022/6/19 18:01&lt;br/&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> wangtaotao &lt;br/&gt;</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> JDK 1.8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCustomerMd5Authenticator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//1. åˆ›å»ºå®‰å…¨ç®¡ç†å™¨å¯¹è±¡</span><br>        <span class="hljs-type">DefaultSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultSecurityManager</span>();<br>        <span class="hljs-comment">//2. åˆ›å»ºmd5Realmå¯¹è±¡</span><br>        <span class="hljs-type">CustomerMd5Realm</span> <span class="hljs-variable">md5Realm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerMd5Realm</span>();<br><br>        <span class="hljs-comment">//------------------------------------------------------</span><br>        <span class="hljs-comment">//æ–°å¢æ­¥éª¤</span><br>        <span class="hljs-comment">//3. åˆ›å»ºhashå‡­è¯åŒ¹é…å™¨</span><br>        <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">credentialsMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>();<br>        <span class="hljs-comment">//4. è®¾ç½®hashç®—æ³•çš„åå­—</span><br>        credentialsMatcher.setHashAlgorithmName(<span class="hljs-string">&quot;md5&quot;</span>);<br>        <span class="hljs-comment">//5. ç»™å½“å‰çš„realmè®¾å®šæ–°çš„å‡­è¯åŒ¹é…å™¨</span><br>        md5Realm.setCredentialsMatcher(credentialsMatcher);<br>        <span class="hljs-comment">// æ•£åˆ—:</span><br>        credentialsMatcher.setHashIterations(<span class="hljs-number">1024</span>);<br>        <span class="hljs-comment">//------------------------------------------------------</span><br><br>        <span class="hljs-comment">//6. ç»™å®‰å…¨ç®¡ç†å™¨è®¾ç½®realm</span><br>        securityManager.setRealm(md5Realm);<br>        <span class="hljs-comment">//7. securityUtils ç»™å…¨å±€å®‰å…¨å·¥å…·ç±»è®¾ç½®å®‰å…¨ç®¡ç†å™¨</span><br>        SecurityUtils.setSecurityManager(securityManager);<br>        <span class="hljs-comment">//8. å…³é”®å¯¹è±¡ subject ä¸»ä½“</span><br>        <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();<br>        <span class="hljs-comment">//9. åˆ›å»ºä»¤ç‰Œ</span><br>        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">usernamePasswordToken</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernamePasswordToken</span>(<span class="hljs-string">&quot;wtt&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å‰:&quot;</span> + subject.isAuthenticated());<br>            subject.login(usernamePasswordToken);<br>            System.out.println(<span class="hljs-string">&quot;è®¤è¯ä¹‹å:&quot;</span> + subject.isAuthenticated());<br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;å¯†ç é”™è¯¯&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//-------------------------------------------</span><br>        <span class="hljs-comment">//å¯¹è®¤è¯çš„ç”¨æˆ·è¿›è¡Œæˆæƒ</span><br>        <span class="hljs-keyword">if</span> (subject.isAuthenticated()) &#123;<br>            <span class="hljs-comment">//1.åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ è°ƒç”¨doGetAuthorizationInfoæ–¹æ³•</span><br>            System.out.println(subject.hasRole(<span class="hljs-string">&quot;admin&quot;</span>));<br>            <span class="hljs-comment">//2.åŸºäºå¤šè§’è‰²çš„æƒé™æ§åˆ¶ æœ‰å‡ ä¸ªè§’è‰²ï¼Œè°ƒç”¨å‡ æ¬¡doGetAuthorizationInfoæ–¹æ³•</span><br>            System.out.println(subject.hasAllRoles(Arrays.asList(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;super&quot;</span>)));<br>            System.out.println(<span class="hljs-string">&quot;-----&quot;</span>);<br>            <span class="hljs-comment">//3.æ˜¯å¦å…·æœ‰å…¶ä¸­ä¸€ä¸ªè§’è‰²</span><br>            <span class="hljs-type">boolean</span>[] hasRoles = subject.hasRoles(Arrays.asList(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;super&quot;</span>));<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">boolean</span> is : hasRoles) &#123;<br>                System.out.println(is);<br>            &#125;<br>            System.out.println(<span class="hljs-string">&quot;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&lt;mark&gt;&quot;</span>);<br>            <span class="hljs-comment">//4.åŸºäºå•ä¸ªæƒé™å­—ç¬¦ä¸²çš„è®¿é—®æ§åˆ¶    èµ„æºæ ‡è¯†ç¬¦ï¼šæ“ä½œï¼šèµ„æºç±»å‹</span><br>            System.out.println(subject.isPermitted(<span class="hljs-string">&quot;user:update:*&quot;</span>));<br>            System.out.println(subject.isPermitted(<span class="hljs-string">&quot;product:create:02&quot;</span>));<br>            <span class="hljs-comment">//5.åŸºäºå¤šä¸ªæƒé™å­—ç¬¦ä¸²çš„è®¿é—®æ§åˆ¶    èµ„æºæ ‡è¯†ç¬¦ï¼šæ“ä½œï¼šèµ„æºç±»å‹</span><br>            <span class="hljs-type">boolean</span>[] permitted = subject.isPermitted(<span class="hljs-string">&quot;user:*:01&quot;</span>, <span class="hljs-string">&quot;order:*:10&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">boolean</span> b : permitted) &#123;<br>                System.out.println(b);<br>            &#125;<br>            <span class="hljs-comment">//6.åŒæ—¶å…·æœ‰å“ªäº›æƒé™</span><br>            System.out.println(subject.isPermittedAll(<span class="hljs-string">&quot;user:*:01&quot;</span>,<span class="hljs-string">&quot;product:create:02&quot;</span>));<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ•´åˆSpringBooté¡¹ç›®å®æˆ˜"><a href="#å…­ã€æ•´åˆSpringBooté¡¹ç›®å®æˆ˜" class="headerlink" title="å…­ã€æ•´åˆSpringBooté¡¹ç›®å®æˆ˜"></a>å…­ã€æ•´åˆSpringBooté¡¹ç›®å®æˆ˜</h2><h3 id="6-1-æ•´åˆæ€è·¯"><a href="#6-1-æ•´åˆæ€è·¯" class="headerlink" title="6.1 æ•´åˆæ€è·¯"></a>6.1 æ•´åˆæ€è·¯</h3><p><img src="/Resources/Pasted%20image%2020220620085152.png" alt="Pasted image 20220620085152"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://shiro.apache.org/&quot;&gt;Apache Shiro | Simple. Java. Security.&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¸€-æƒé™çš„ç®¡ç†&quot;&gt;&lt;a href=&quot;#ä¸€-æƒé™çš„ç®¡ç†&quot; class=&quot;headerlink&quot;</summary>
      
    
    
    
    
    <category term="Shiro" scheme="http://conquers.github.io/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>Redis</title>
    <link href="http://conquers.github.io/posts/bae4ff13.html"/>
    <id>http://conquers.github.io/posts/bae4ff13.html</id>
    <published>2022-06-18T08:30:15.000Z</published>
    <updated>2023-06-06T00:30:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p><a href="https://redis.io/">Redis - è‹±æ–‡å®˜ç½‘</a><br><a href="http://www.redis.cn/">Redis - ä¸­æ–‡ç½‘</a><br><a href="https://github.com/redis/redis">GitHub - redis&#x2F;redis</a></p><blockquote><p>å‚è€ƒèµ„æ–™<br>è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1jD4y1Q7tU">ã€ç¼–ç¨‹ä¸è‰¯äººã€‘é€‚åˆåç«¯ç¼–ç¨‹äººå‘˜çš„Rediså®æˆ˜æ•™ç¨‹ã€redisåº”ç”¨åœºæ™¯ã€åˆ†å¸ƒå¼ç¼“å­˜ã€Sessionç®¡ç†ã€é¢è¯•ç›¸å…³ç­‰å·²å®Œç»“!å“”å“©å“”å“©_bilibili</a><br>è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1cr4y1671t">é»‘é©¬ç¨‹åºå‘˜Rediså…¥é—¨åˆ°å®æˆ˜æ•™ç¨‹ï¼Œæ·±åº¦é€æredisåº•å±‚åŸç†+redisåˆ†å¸ƒå¼é”+ä¼ä¸šè§£å†³æ–¹æ¡ˆ+é»‘é©¬ç‚¹è¯„å®æˆ˜é¡¹ç›®_å“”å“©å“”å“©_bilibili</a><br>å‚è€ƒç¬”è®°ï¼š<a href="https://blog.csdn.net/unique_perfect/article/details/105515137">ä»å‰æ…¢-Redis_unique_perfectçš„åšå®¢-CSDNåšå®¢</a></p><p>ä»£ç å‚è€ƒï¼šredis-study</p></blockquote><h2 id="1ã€Nosqlçš„å¼•è¨€"><a href="#1ã€Nosqlçš„å¼•è¨€" class="headerlink" title="1ã€Nosqlçš„å¼•è¨€"></a>1ã€Nosqlçš„å¼•è¨€</h2><p>NoSQLï¼ˆNot Only SQLï¼‰ï¼Œæ„å³ä¸ä»…ä»…æ˜¯SQLï¼Œæ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚Nosqlè¿™ä¸ªæŠ€æœ¯é—¨ç±»ï¼Œæ—©æœŸå°±æœ‰äººæå‡ºï¼Œå‘å±•è‡³2009å¹´è¶‹åŠ¿è¶Šå‘é«˜æ¶¨ã€‚</p><blockquote><p>RDBMSï¼šå…³ç³»å‹æ•°æ®åº“<br>NOSQLï¼šï¼ˆæ³›æŒ‡ï¼‰éå…³ç³»å‹æ•°æ®åº“<br>RDBMSå’ŒNOSQLç›¸è¾…ç›¸æˆ</p></blockquote><h2 id="2ã€ä¸ºä»€ä¹ˆæ˜¯NoSQL"><a href="#2ã€ä¸ºä»€ä¹ˆæ˜¯NoSQL" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆæ˜¯NoSQL"></a>2ã€ä¸ºä»€ä¹ˆæ˜¯NoSQL</h2><p>éšç€äº’è”ç½‘ç½‘ç«™çš„å…´èµ·ï¼Œä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“åœ¨åº”ä»˜åŠ¨æ€ç½‘ç«™ï¼Œç‰¹åˆ«æ˜¯è¶…å¤§è§„æ¨¡å’Œé«˜å¹¶å‘çš„çº¯åŠ¨æ€ç½‘ç«™å·²ç»æ˜¾å¾—åŠ›ä¸ä»æš´éœ²äº†å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ã€‚å¦‚<strong>å•†åŸç½‘ç«™ä¸­å¯¹å•†å“æ•°æ®é¢‘ç¹æŸ¥è¯¢</strong>ã€<strong>å¯¹çƒ­æœå•†å“çš„æ’è¡Œç»Ÿè®¡</strong>ã€<strong>è®¢å•è¶…æ—¶é—®é¢˜</strong>ã€ä»¥åŠ<strong>å¾®ä¿¡æœ‹å‹åœˆï¼ˆéŸ³é¢‘ï¼Œè§†é¢‘ã€‰å­˜å‚¨</strong>ç­‰ç›¸å…³ä½¿ç”¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“å®ç°å°±æ˜¾å¾—éå¸¸å¤æ‚ï¼Œè™½ç„¶èƒ½å®ç°ç›¸åº”åŠŸèƒ½ä½†æ˜¯åœ¨æ€§èƒ½ä¸Šå´ä¸æ˜¯é‚£ä¹ˆä¹è§‚ã€‚nosqlè¿™ä¸ªæŠ€æœ¯é—¨ç±»çš„å‡ºç°ï¼Œæ›´å¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå®ƒå‘Šè¯‰äº†ä¸–ç•Œä¸ä»…ä»…æ˜¯sqlã€‚</p><h2 id="3ã€NoSQLçš„å››å¤§åˆ†ç±»"><a href="#3ã€NoSQLçš„å››å¤§åˆ†ç±»" class="headerlink" title="3ã€NoSQLçš„å››å¤§åˆ†ç±»"></a>3ã€NoSQLçš„å››å¤§åˆ†ç±»</h2><h4 id="3-1-é”®å€¼-Key-Value-å­˜å‚¨æ•°æ®åº“"><a href="#3-1-é”®å€¼-Key-Value-å­˜å‚¨æ•°æ®åº“" class="headerlink" title="3.1 é”®å€¼(Key-Value)å­˜å‚¨æ•°æ®åº“"></a>3.1 é”®å€¼(Key-Value)å­˜å‚¨æ•°æ®åº“</h4><ul><li><p>è¯´æ˜:<br>è¿™ä¸€ç±»æ•°æ®åº“ä¸»è¦ä¼šä½¿ç”¨åˆ°ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¡¨ä¸­æœ‰ä¸€ä¸ªç‰¹å®šçš„é”®å’Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç‰¹å®šçš„æ•°æ®ã€‚<br><code>Map&lt;key,value&gt;</code></p></li><li><p>ç‰¹ç‚¹<br>ä¼˜ç‚¹ï¼šKey&#x2F;valueæ¨¡å‹å¯¹äºITç³»ç»Ÿæ¥è¯´çš„ä¼˜åŠ¿åœ¨äºç®€å•ã€æ˜“éƒ¨ç½²ã€‚<br>ç¼ºç‚¹ï¼šå¦‚æœDBAï¼ˆæ•°æ®åº“ç®¡ç†å‘˜ï¼‰åªå¯¹éƒ¨åˆ†å€¼è¿›è¡ŒæŸ¥è¯¢æˆ–æ›´æ–°çš„æ—¶å€™ï¼ŒKey&#x2F;valueå°±æ˜¾å¾—æ•ˆç‡ä½ä¸‹äº†ã€‚</p></li><li><p>ç›¸å…³äº§å“</p><ul><li>Tokyo Cabinet&#x2F;Tyrant</li><li><strong>Redis</strong>  å†…å­˜</li><li><strong>SSDB</strong>  ç¡¬ç›˜</li><li>Voldemort </li><li>Oracle BDB</li></ul></li></ul><h4 id="3-2-åˆ—å­˜å‚¨æ•°æ®åº“"><a href="#3-2-åˆ—å­˜å‚¨æ•°æ®åº“" class="headerlink" title="3.2 åˆ—å­˜å‚¨æ•°æ®åº“"></a>3.2 åˆ—å­˜å‚¨æ•°æ®åº“</h4><ul><li><p>è¯´æ˜<br>è¿™éƒ¨åˆ†æ•°æ®åº“é€šå¸¸æ˜¯ç”¨æ¥åº”å¯¹åˆ†å¸ƒå¼å­˜å‚¨çš„<strong>æµ·é‡æ•°æ®</strong>ã€‚</p></li><li><p>ç‰¹ç‚¹<br>é”®ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯æŒ‡å‘äº†å¤šä¸ªåˆ—ã€‚è¿™äº›åˆ—æ˜¯ç”±åˆ—å®¶æ—æ¥å®‰æ’çš„ã€‚</p></li><li><p>ç›¸å…³äº§å“<br>Cassandraã€<strong>HBase</strong>ã€Riakã€‚</p></li></ul><h4 id="3-3-æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆDocumentï¼‰"><a href="#3-3-æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆDocumentï¼‰" class="headerlink" title="3.3 æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆDocumentï¼‰"></a>3.3 æ–‡æ¡£å‹æ•°æ®åº“ï¼ˆDocumentï¼‰</h4><ul><li><p>è¯´æ˜<br>æ–‡æ¡£å‹æ•°æ®åº“çš„çµæ„Ÿæ˜¯æ¥è‡ªäºLotus NotesåŠå…¬è½¯ä»¶çš„ï¼Œè€Œä¸”å®ƒåŒç¬¬ä¸€ç§é”®å€¼å­˜å‚¨ç›¸ç±»ä¼¼ï¼Œè¯¥ç±»å‹çš„æ•°æ®æ¨¡å‹æ˜¯ç‰ˆæœ¬åŒ–çš„æ–‡æ¡£ï¼ŒåŠç»“æ„åŒ–çš„æ–‡æ¡£ä»¥ç‰¹å®šçš„æ ¼å¼å­˜å‚¨ï¼Œæ¯”å¦‚<strong>JSON</strong>ã€‚æ–‡æ¡£å‹æ•°æ®åº“å¯ä»¥çœ‹ä½œæ˜¯é”®å€¼æ•°æ®åº“çš„å‡çº§ç‰ˆï¼Œå…è®¸ä¹‹é—´åµŒå¥—é”®å€¼ã€‚è€Œä¸”æ–‡æ¡£å‹æ•°æ®åº“æ¯”é”®å€¼æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜<br><code>&#123;&quot;name&quot;:&quot;wtt&quot;,&quot;age&quot;:&quot;23&quot;&#125; -----&gt; document</code></p></li><li><p>ç‰¹ç‚¹<br>ä»¥æ–‡æ¡£ï¼ˆjsonï¼‰å½¢å¼å­˜å‚¨</p></li><li><p>ç›¸å…³äº§å“<br><strong>MongoDBï¼ˆæœ€æ–°ç‰ˆä¸º6.xï¼Œæˆªè‡³2022.9.14ï¼‰</strong>ã€CouchDBï¼Œå›½å†…ä¹Ÿæœ‰æ–‡æ¡£å‹æ•°æ®åº“SequoiaDBï¼Œå·²ç»å¼€æºã€‚</p></li></ul><h4 id="3-4-å›¾å½¢-Graph-æ•°æ®åº“"><a href="#3-4-å›¾å½¢-Graph-æ•°æ®åº“" class="headerlink" title="3.4 å›¾å½¢(Graph)æ•°æ®åº“"></a>3.4 å›¾å½¢(Graph)æ•°æ®åº“</h4><ul><li><p>è¯´æ˜<br>å›¾å½¢ç»“æ„çš„æ•°æ®åº“åŒå…¶ä»–è¡Œåˆ—ä»¥åŠåˆšæ€§ç»“æ„çš„SQLæ•°æ®åº“ä¸åŒï¼Œå®ƒæ˜¯ä½¿ç”¨çµæ´»çš„å›¾å½¢æ¨¡å‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰©å±•åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚</p></li><li><p>ç‰¹ç‚¹<br>NoSQLæ•°æ®åº“æ²¡æœ‰æ ‡å‡†çš„æŸ¥è¯¢è¯­è¨€(SQL)ï¼Œå› æ­¤è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢éœ€è¦åˆ¶å®šæ•°æ®æ¨¡å‹ã€‚è®¸å¤šNoSQLæ•°æ®åº“éƒ½æœ‰RESTå¼çš„æ•°æ®æ¥å£æˆ–è€…æŸ¥è¯¢APIã€‚</p></li><li><p>ç›¸å…³äº§å“<br>Neo4Jã€InfoGridã€ Infinite Graphã€</p></li></ul><h2 id="4ã€NoSQLåº”ç”¨åœºæ™¯"><a href="#4ã€NoSQLåº”ç”¨åœºæ™¯" class="headerlink" title="4ã€NoSQLåº”ç”¨åœºæ™¯"></a>4ã€NoSQLåº”ç”¨åœºæ™¯</h2><ul><li><p><strong>æ•°æ®æ¨¡å‹æ¯”è¾ƒç®€å•</strong></p></li><li><p><strong>éœ€è¦çµæ´»æ€§æ›´å¼ºçš„ITç³»ç»Ÿï¼ˆç³»ç»Ÿè®¾è®¡çµæ´»ï¼Œæ€§èƒ½è¦æ±‚é«˜ï¼‰</strong></p></li><li><p><strong>å¯¹æ•°æ®åº“æ€§èƒ½è¦æ±‚è¾ƒé«˜</strong></p></li><li><p><strong>ä¸éœ€è¦é«˜åº¦çš„æ•°æ®ä¸€è‡´æ€§ (NoSQLäº§å“å¯¹äºäº‹åŠ¡æ”¯æŒä¸æ˜¯å¾ˆå¥½)</strong></p></li></ul><h2 id="5ã€ä»€ä¹ˆæ˜¯Redis"><a href="#5ã€ä»€ä¹ˆæ˜¯Redis" class="headerlink" title="5ã€ä»€ä¹ˆæ˜¯Redis"></a>5ã€ä»€ä¹ˆæ˜¯Redis</h2><p><img src="/Resources/Pasted%20image%2020220914160123.png"></p><p>Redis ï¼ˆ<strong>Re</strong>mote <strong>Di</strong>ctionary <strong>S</strong>erverï¼‰ï¼Œè¿œç¨‹å­—å…¸æœåŠ¡</p><blockquote><p>The open source, in-memory data store used by millions of developers as a database, cache, streaming engine, and message broker.<br>æ•°ç™¾ä¸‡å¼€å‘äººå‘˜ä½¿ç”¨çš„å¼€æºå†…å­˜æ•°æ®å­˜å‚¨ä½œä¸º<strong>æ•°æ®åº“ã€ç¼“å­˜ã€æµå¼•æ“å’Œæ¶ˆæ¯ä¸­é—´ä»¶</strong>ã€‚</p></blockquote><p>Qï¼š<u>Redisä½¿ç”¨å†…å­˜ä½œä¸ºæ•°æ®åº“ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæ–­ç”µæ•°æ®ä¸ä¼šæ¶ˆå¤±å‘¢ï¼Ÿ</u><br>Aï¼š<u>æŒä¹…åŒ–æœºåˆ¶ï¼Œå®šæœŸå°†å†…å­˜æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­ã€‚</u></p><h2 id="6ã€Redisç‰¹ç‚¹"><a href="#6ã€Redisç‰¹ç‚¹" class="headerlink" title="6ã€Redisç‰¹ç‚¹"></a>6ã€Redisç‰¹ç‚¹</h2><ul><li><strong>Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½key&#x2F;valueå†…å­˜å‹æ•°æ®åº“</strong></li><li><strong>Redisæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹</strong></li><li><strong>Redisæ”¯æŒæŒä¹…åŒ–</strong></li><li><strong>Rediså•çº¿ç¨‹ï¼Œå•è¿›ç¨‹</strong>ï¼š6.0ä¹‹å‰ï¼šå‘½ä»¤å•çº¿ç¨‹ï¼Œç½‘ç»œå•çº¿ç¨‹ï¼Œ6.0ä¹‹åå‘½ä»¤å•çº¿ç¨‹ï¼Œç½‘ç»œå¤šçº¿ç¨‹ï¼Œ<a href="https://blog.csdn.net/CSDN2497242041/article/details/122659705">Redis 6.0å¤šçº¿ç¨‹æ¨¡å‹æ€»ç»“</a><ul><li>å‘½ä»¤åŸºäºå†…å­˜æ“ä½œï¼Œå·²ç»å¾ˆå¿«äº†ï¼Œä¸éœ€è¦å¤šçº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨å¤šçº¿ç¨‹ï¼Œåè€Œä¼šå¼•èµ·ä¸€äº›é—®é¢˜ã€‚</li><li>ç½‘ç»œå¤šçº¿ç¨‹ï¼šå› ä¸ºè¯»å†™ç½‘ç»œçš„read&#x2F;writeç³»ç»Ÿè°ƒç”¨å ç”¨äº†Redisæ‰§è¡ŒæœŸé—´å¤§éƒ¨åˆ†CPUæ—¶é—´ï¼Œç“¶é¢ˆä¸»è¦åœ¨äºç½‘ç»œçš„ IO æ¶ˆè€—</li><li>ç½‘ç»œå¤šçº¿ç¨‹çš„å®ç°æ–¹å¼ï¼šIOå¤šè·¯å¤ç”¨+å¤šä¸ªäº‹ä»¶å¤„ç†å™¨</li><li><img src="/Resources/Pasted%20image%2020230606160933.png"></li></ul></li></ul><h2 id="7ã€å®‰è£…Redis"><a href="#7ã€å®‰è£…Redis" class="headerlink" title="7ã€å®‰è£…Redis"></a>7ã€å®‰è£…Redis</h2><blockquote><p>å‚è€ƒåœ°å€ï¼š<a href="https://redis.io/docs/getting-started/installation/">Installing Redis | Redis</a><br>åœ¨CentOsä¸­ä½¿ç”¨Dockerå®‰è£…Rediså‚è€ƒï¼š<a href="../../../Develop/%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA/Docker%20%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E5%90%88%E9%9B%86.md#Redis">CentOsä¸­ä½¿ç”¨Dockerå®‰è£…Redis</a><br>ä»¥ä¸‹ä»…æ¼”ç¤ºåœ¨MacOSä¸­å®‰è£…Redis</p></blockquote><h2 id="8ã€Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤"><a href="#8ã€Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤" class="headerlink" title="8ã€Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤"></a>8ã€Redisæ•°æ®åº“ç›¸å…³æŒ‡ä»¤</h2><blockquote><p>Rediså…¨éƒ¨å‘½ä»¤å‚è€ƒ<br>è‹±æ–‡å®˜ç½‘ï¼š<a href="https://redis.io/commands/">Commands | Redis</a><br>ä¸­æ–‡ç½‘ï¼š<a href="http://www.redis.cn/commands.html">Rediså‘½ä»¤ä¸­å¿ƒï¼ˆRedis commandsï¼‰</a></p></blockquote><h3 id="æ•°æ®åº“ç›¸å…³æŒ‡ä»¤"><a href="#æ•°æ®åº“ç›¸å…³æŒ‡ä»¤" class="headerlink" title="æ•°æ®åº“ç›¸å…³æŒ‡ä»¤"></a>æ•°æ®åº“ç›¸å…³æŒ‡ä»¤</h3><h4 id="Select-åˆ‡æ¢æ•°æ®åº“"><a href="#Select-åˆ‡æ¢æ•°æ®åº“" class="headerlink" title="Select åˆ‡æ¢æ•°æ®åº“"></a>Select åˆ‡æ¢æ•°æ®åº“</h4><p>Redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ç¬¬0ä¸ªæ•°æ®åº“ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[3]&gt; <span class="hljs-keyword">select</span> 0<br>OK<br>127.0.0.1:6379&gt; <span class="hljs-comment">#é»˜è®¤æ•°æ®åº“åé¢æ²¡æœ‰&#x27;[ç¼–å·]&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; <span class="hljs-keyword">select</span> 3 <span class="hljs-comment">#åˆ‡æ¢æ•°æ®åº“</span><br>OK<br></code></pre></td></tr></table></figure><h4 id="Flushdb-è¯·ç©ºå½“å‰åº“"><a href="#Flushdb-è¯·ç©ºå½“å‰åº“" class="headerlink" title="Flushdb è¯·ç©ºå½“å‰åº“"></a>Flushdb è¯·ç©ºå½“å‰åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[3]&gt; flushdb<br>OK<br>127.0.0.1:6379[3]&gt; keys *<br>(empty array)<br></code></pre></td></tr></table></figure><h4 id="Flushall-è¯·ç©ºæ‰€æœ‰åº“"><a href="#Flushall-è¯·ç©ºæ‰€æœ‰åº“" class="headerlink" title="Flushall è¯·ç©ºæ‰€æœ‰åº“"></a>Flushall è¯·ç©ºæ‰€æœ‰åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[3]&gt; <span class="hljs-built_in">set</span> name <span class="hljs-string">&quot;wtt&quot;</span> <span class="hljs-comment">#åœ¨æ•°æ®åº“3ä¸­æ–°å¢æ•°æ®</span><br>OK<br>127.0.0.1:6379[3]&gt; get name<br><span class="hljs-string">&quot;wtt&quot;</span><br>127.0.0.1:6379[3]&gt; <span class="hljs-keyword">select</span> 7 <span class="hljs-comment">#åˆ‡æ¢åˆ°æ•°æ®åº“7</span><br>OK<br>127.0.0.1:6379[7]&gt; flushall <span class="hljs-comment">#åœ¨æ•°æ®åº“7æ¸…ç©ºæ‰€æœ‰åº“</span><br>OK<br>127.0.0.1:6379[7]&gt; <span class="hljs-keyword">select</span> 3<br>OK<br>127.0.0.1:6379[3]&gt; get name<br>(nil)<br></code></pre></td></tr></table></figure><h3 id="keyç›¸å…³æŒ‡ä»¤"><a href="#keyç›¸å…³æŒ‡ä»¤" class="headerlink" title="keyç›¸å…³æŒ‡ä»¤"></a>keyç›¸å…³æŒ‡ä»¤</h3><h4 id="Del-åˆ é™¤key"><a href="#Del-åˆ é™¤key" class="headerlink" title="Del åˆ é™¤key"></a>Del åˆ é™¤key</h4><blockquote><p>åŒæ—¶åˆ é™¤å¤šä¸ªkeyï¼šDEL key1 key2</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; get a<br><span class="hljs-string">&quot;v&quot;</span><br>127.0.0.1:6379&gt; del a<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; get a<br>(nil)<br></code></pre></td></tr></table></figure><h4 id="Exists-åˆ¤æ–­é”®å€¼æ˜¯å¦å­˜åœ¨"><a href="#Exists-åˆ¤æ–­é”®å€¼æ˜¯å¦å­˜åœ¨" class="headerlink" title="Exists åˆ¤æ–­é”®å€¼æ˜¯å¦å­˜åœ¨"></a>Exists åˆ¤æ–­é”®å€¼æ˜¯å¦å­˜åœ¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; exists name<br>(<span class="hljs-built_in">integer</span>) 1 <span class="hljs-comment"># 1 = å­˜åœ¨ ï¼Œ0 = ä¸å­˜åœ¨</span><br></code></pre></td></tr></table></figure><h4 id="Ttl-è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºç§’"><a href="#Ttl-è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºç§’" class="headerlink" title="Ttl è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´ è¿‡æœŸæ—¶é—´ä¸ºç§’"></a>Ttl è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´ <em>è¿‡æœŸæ—¶é—´ä¸ºç§’</em></h4><blockquote><p>å½“keyä¸å­˜åœ¨æ—¶ï¼Œè¿”å›-2ã€‚<br>å½“keyå­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å›-1ã€‚<br>å¦åˆ™ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›keyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[1]&gt; expire name 10<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379[1]&gt; ttl name <span class="hljs-comment">#ttl æŸ¥çœ‹å‰©ä½™æ—¶é—´</span><br>(<span class="hljs-built_in">integer</span>) 0<br>127.0.0.1:6379[1]&gt; get name<br>(nil)<br></code></pre></td></tr></table></figure><h4 id="Pttl-è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’"><a href="#Pttl-è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’" class="headerlink" title="Pttl è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´ è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’"></a>Pttl è¿”å›å½“å‰keyçš„è¿‡æœŸæ—¶é—´ <em>è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’</em></h4><h4 id="Expire-è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºç§’"><a href="#Expire-è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºç§’" class="headerlink" title="Expire è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´ è¿‡æœŸæ—¶é—´ä¸ºç§’"></a>Expire è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´ <em>è¿‡æœŸæ—¶é—´ä¸ºç§’</em></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[1]&gt; expire name 10<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379[1]&gt; ttl name <span class="hljs-comment">#ttl æŸ¥çœ‹å‰©ä½™æ—¶é—´</span><br>(<span class="hljs-built_in">integer</span>) 0<br>127.0.0.1:6379[1]&gt; get name<br>(nil)<br></code></pre></td></tr></table></figure><h4 id="Pexpire-è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’"><a href="#Pexpire-è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´-è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’" class="headerlink" title="Pexpire è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´ è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’"></a>Pexpire è®¾ç½®å½“å‰keyçš„è¿‡æœŸæ—¶é—´ <em>è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’</em></h4><h4 id="Keys-æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼çš„key"><a href="#Keys-æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼çš„key" class="headerlink" title="Keys æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼çš„key"></a>Keys æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼çš„key</h4><blockquote><p>*å¤šä¸ªï¼Œ?å•ä¸ªï¼Œ[abc]å…¶ä¸€ï¼Œç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼</p></blockquote><ul><li>keys* æŸ¥æ‰¾æ‰€æœ‰key</li><li>keys h?llo æŸ¥æ‰¾hello,hallo,hxlloç­‰</li><li>keys h*llo æŸ¥æ‰¾hllo,heeeelloç­‰</li><li>Keys h[ae]lloåŒ¹é…helloå’Œhallo ,ä½†ä¸åŒ¹é…hilloã€‚ç‰¹æ®Šç¬¦å·ç”¨â€\â€œéš”å¼€<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">6379</span>[<span class="hljs-number">3</span>]&gt; keys *<br><span class="hljs-attribute">1</span>) <span class="hljs-string">&quot;name&quot;</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="Move-ç§»åŠ¨é”®å€¼åˆ°å¦å¤–ä¸€ä¸ªæ•°æ®åº“"><a href="#Move-ç§»åŠ¨é”®å€¼åˆ°å¦å¤–ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="Move ç§»åŠ¨é”®å€¼åˆ°å¦å¤–ä¸€ä¸ªæ•°æ®åº“"></a>Move ç§»åŠ¨é”®å€¼åˆ°å¦å¤–ä¸€ä¸ªæ•°æ®åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; get name<br><span class="hljs-string">&quot;xr&quot;</span><br>127.0.0.1:6379&gt; move name 1<br>(<span class="hljs-built_in">integer</span>) 1<br>127.0.0.1:6379&gt; <span class="hljs-keyword">select</span> 1<br>OK<br>127.0.0.1:6379[1]&gt; get name<br><span class="hljs-string">&quot;xr&quot;</span><br></code></pre></td></tr></table></figure><h4 id="Rename-ä¿®æ”¹å½“å‰keyçš„åå­—"><a href="#Rename-ä¿®æ”¹å½“å‰keyçš„åå­—" class="headerlink" title="Rename ä¿®æ”¹å½“å‰keyçš„åå­—"></a>Rename ä¿®æ”¹å½“å‰keyçš„åå­—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379&gt; <span class="hljs-built_in">set</span> a b<br>OK<br>127.0.0.1:6379&gt; rename a aa<br>OK<br>127.0.0.1:6379&gt; get aa<br><span class="hljs-string">&quot;b&quot;</span><br></code></pre></td></tr></table></figure><h4 id="Type-æŸ¥çœ‹å½“å‰keyçš„ç±»å‹"><a href="#Type-æŸ¥çœ‹å½“å‰keyçš„ç±»å‹" class="headerlink" title="Type æŸ¥çœ‹å½“å‰keyçš„ç±»å‹"></a>Type æŸ¥çœ‹å½“å‰keyçš„ç±»å‹</h4><ul><li>none (keyä¸å­˜åœ¨)</li><li>string (å­—ç¬¦ä¸²)</li><li>list (åˆ—è¡¨)</li><li>set (é›†åˆ)</li><li>Zset (æœ‰åºé›†)</li><li>hash (å“ˆå¸Œè¡¨)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[1]&gt; <span class="hljs-built_in">type</span> name<br>string<br></code></pre></td></tr></table></figure><h4 id="Dbsize-æŸ¥çœ‹é”®æ€»æ•°"><a href="#Dbsize-æŸ¥çœ‹é”®æ€»æ•°" class="headerlink" title="Dbsize æŸ¥çœ‹é”®æ€»æ•°"></a>Dbsize æŸ¥çœ‹é”®æ€»æ•°</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1:6379[3]&gt; dbsize <span class="hljs-comment">#æŸ¥çœ‹æ•°æ®åº“å¤§å°</span><br>(<span class="hljs-built_in">integer</span>) 0<br></code></pre></td></tr></table></figure><h3 id="äº”å¤§æ•°æ®ç±»å‹"><a href="#äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="äº”å¤§æ•°æ®ç±»å‹"></a>äº”å¤§æ•°æ®ç±»å‹</h3><p><strong>æ•°æ®ç±»å‹</strong>ï¼šæŒ‡çš„æ˜¯å­˜å‚¨çš„æ•°æ®çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ value éƒ¨åˆ†çš„ç±»å‹ï¼Œ key éƒ¨åˆ†æ°¸è¿œéƒ½æ˜¯å­—ç¬¦ä¸²ã€‚</p><p><strong>Redis æ•°æ®å­˜å‚¨æ ¼å¼</strong>ï¼šRedisè‡ªèº«æ˜¯ä¸€ä¸ª Mapï¼Œå…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨ key : valueçš„å½¢å¼å­˜å‚¨ã€‚</p><h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><p><code>Map&lt;String,String&gt; map</code><br><img src="/Resources/Pasted%20image%2020220915104123.png"></p><p><strong>å¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>èŒƒä¾‹</th></tr></thead><tbody><tr><td>set</td><td>è®¾ç½®ä¸€ä¸ªkey&#x2F;value</td><td><code>set k1 v1</code></td></tr><tr><td>get</td><td>æ ¹æ®keyè·å¾—å¯¹åº”çš„value</td><td><code>get k1</code></td></tr><tr><td>mset</td><td>ä¸€æ¬¡è®¾ç½®å¤šä¸ªkey&#x2F;value</td><td><code>mset k1 v1 k2 v2</code></td></tr><tr><td>mget</td><td>ä¸€æ¬¡è·å–å¤šä¸ªkey&#x2F;value</td><td><code>mget k1 k2</code></td></tr><tr><td>strlen</td><td>è·å–å¯¹åº”keyçš„valueçš„é•¿åº¦</td><td><code>strlen k1</code></td></tr><tr><td>append</td><td>ä¸ºå¯¹åº”çš„keyçš„valueè¿½åŠ å†…å®¹ï¼ˆå¦‚æœä¸å­˜åœ¨keyï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨åˆ›å»ºkeyï¼‰</td><td><code>append key1 &quot;this is append value&quot;</code></td></tr><tr><td>getrangeï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰</td><td>æˆªå–valueçš„å†…å®¹ï¼ˆ0åˆ°-1ä»£è¡¨æ‰€æœ‰å†…å®¹ï¼‰</td><td><code>getrange key1 0 -1</code></td></tr><tr><td>setex</td><td>è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸ <strong>ç§’</strong></td><td><code>setex key1 30 &quot;hello&quot;</code></td></tr><tr><td>psetex</td><td>è®¾ç½®ä¸€ä¸ªkeyå­˜æ´»çš„æœ‰æ•ˆæœŸ <strong>æ¯«ç§’</strong></td><td><code>psetex key1 30 &quot;hello&quot;</code></td></tr><tr><td>setnx</td><td>å­˜åœ¨ä¸åšä»»ä½•æ“ä½œï¼Œä¸å­˜åœ¨åˆ™æ·»åŠ </td><td><code> setnx key1 wtt</code></td></tr><tr><td>msetnxåŸå­æ“ä½œï¼ˆåªè¦æœ‰ä¸€ä¸ªå­˜åœ¨å°±ä¸åšä»»ä½•æ“ä½œï¼‰</td><td>åŒæ—¶è®¾ç½®å¤šä¸ªkeyï¼Œåªæœ‰éƒ½ä¸å­˜åœ¨æ—¶æ‰ä¿å­˜</td><td></td></tr><tr><td>decr</td><td>è¿›è¡Œæ•°å€¼ç±»å‹çš„-1æ“ä½œ</td><td><code>decr key1</code></td></tr><tr><td>decrby</td><td>æ ¹æ®æä¾›çš„æ•°æ®è¿›è¡Œå‡æ³•æ“ä½œ</td><td><code>decrby key1 5</code></td></tr><tr><td>incr</td><td>è¿›è¡Œæ•°å€¼ç±»å‹çš„+1æ“ä½œ</td><td><code>incr key1</code></td></tr><tr><td>incrby</td><td>æ ¹æ®æä¾›çš„æ•°æ®è¿›è¡ŒåŠ æ³•æ“ä½œ</td><td><code>incrby key1 5</code></td></tr><tr><td>incrbyfloat</td><td>æ ¹æ®æä¾›çš„æ•°æ®åŠ æµ®ç‚¹æ•°</td><td><code>incrbyfloat key1 1.5</code></td></tr></tbody></table><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p><code>Map&lt;String,List&gt; map</code></p><blockquote><p>åŒºåˆ«äºJavaä¸­çš„Listï¼ŒRedisä¸­çš„Listå¯ä»¥é€šè¿‡lpushä»å·¦å‘åˆ—è¡¨æ”¾å…¥å…ƒç´ ï¼Œä¹Ÿå¯ä»¥é€šè¿‡rpushä»å³å‘åˆ—è¡¨æ”¾å…¥å…ƒç´ ï¼ˆæœ¬è´¨æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼‰ï¼</p></blockquote><p><img src="/Resources/Pasted%20image%2020220915104344.png"></p><p><strong>å¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>èŒƒä¾‹</th></tr></thead><tbody><tr><td>lpush</td><td>å°†æŸä¸ªå€¼æˆ–å¤šä¸ªå€¼åŠ å…¥åˆ°ä¸€ä¸ªkeyåˆ—è¡¨å¤´éƒ¨</td><td><code>lpush list value1 value2</code></td></tr><tr><td>lpushx</td><td>åŒlpush,ä½†æ˜¯å¿…é¡»è¦ä¿è¯è¿™ä¸ªkeyå­˜åœ¨</td><td><code>xpushx list value3 value4</code></td></tr><tr><td>rpush</td><td>å°†æŸä¸ªå€¼æˆ–å¤šä¸ªå€¼åŠ å…¥åˆ°ä¸€ä¸ªkeyåˆ—è¡¨æœ«å°¾</td><td><code>rpush list value5</code></td></tr><tr><td>rpushx</td><td>åŒrpush,ä½†æ˜¯å¿…é¡»è¦ä¿è¯è¿™ä¸ªkeyå­˜åœ¨</td><td><code>rpush list value5</code></td></tr><tr><td>lpop</td><td>è¿”å›å’Œç§»é™¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td><td><code>lpop list</code> (ç§»é™¤å¤šä¸ªå…ƒç´ ä½¿ç”¨<code>lpop list n</code> nä»£è¡¨ç§»é™¤å‡ ä¸ª)</td></tr><tr><td>rpop</td><td>è¿”å›å’Œç§»é™¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td><td><code>lpop list</code> (ç§»é™¤å¤šä¸ªå…ƒç´ ä½¿ç”¨<code>lpop list n</code> nä»£è¡¨ç§»é™¤å‡ ä¸ª</td></tr><tr><td>lrange 0 -1</td><td>è·å–æŸä¸€ä¸ªä¸‹æ ‡åŒºé—´å†…çš„å…ƒç´ </td><td><code>lrange list 0 -1</code></td></tr><tr><td>llen</td><td>è·å–åˆ—è¡¨å…ƒç´ ä¸ªæ•°</td><td><code>llen list</code></td></tr><tr><td>lset</td><td>è®¾ç½®æŸä¸€ä¸ªæŒ‡å®šç´¢å¼•çš„å€¼(ç´¢å¼•å¿…é¡»å­˜åœ¨)</td><td><code>lset list 0 value</code></td></tr><tr><td>lindex</td><td>è·å–æŸä¸€ä¸ªæŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ </td><td><code>lindex list 0</code></td></tr><tr><td>lrem</td><td>åˆ é™¤é‡å¤å…ƒç´ </td><td><code>lrem list 2 value</code> (æ•°å­—ä»£è¡¨ç§»é™¤å‡ ä¸ªé‡å¤çš„å€¼)</td></tr><tr><td>ltrim</td><td>ä¿ç•™åˆ—è¡¨ä¸­ç‰¹å®šåŒºé—´å†…çš„å…ƒç´ </td><td><code>ltrim list 1 2</code></td></tr><tr><td>linsert</td><td>åœ¨æŸä¸€ä¸ªå…ƒç´ ä¹‹å‰(before)æˆ–è€…ä¹‹å(after)æ’å…¥æ–°å…ƒç´ </td><td><code>linsert list before value3 value</code></td></tr></tbody></table><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><p><code>Map&lt;String,Set&gt; map</code><br><img src="/Resources/Pasted%20image%2020220915150230.png"></p><p><strong>å¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>èŒƒä¾‹</th></tr></thead><tbody><tr><td>sadd</td><td>ä¸ºé›†åˆæ·»åŠ å…ƒç´ </td><td></td></tr><tr><td>smembers</td><td>æ˜¾ç¤ºé›†åˆä¸­æ‰€æœ‰å…ƒç´ æ— åº</td><td></td></tr><tr><td>scard</td><td>è¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°</td><td></td></tr><tr><td>spop</td><td>éšæœºè¿”å›ä¸€ä¸ªå…ƒç´ å¹¶å°†å…ƒç´ åœ¨é›†åˆä¸­åˆ é™¤</td><td></td></tr><tr><td>smove</td><td>ä»ä¸€ä¸ªé›†åˆä¸­å‘å¦ä¸€ä¸ªé›†åˆç§»åŠ¨å…ƒç´ </td><td></td></tr><tr><td>srem</td><td>ä»é›†åˆä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ </td><td></td></tr><tr><td>sismember</td><td>åˆ¤æ–­ä¸€ä¸ªé›†åˆä¸­æ˜¯å¦å«æœ‰è¿™ä¸ªå…ƒç´ </td><td></td></tr><tr><td>srandmember</td><td>éšæœºè¿”å›å…ƒç´ </td><td></td></tr><tr><td>sdiff</td><td>å»æ‰ç¬¬ä¸€ä¸ªé›†åˆä¸­å…¶å®ƒé›†åˆå«æœ‰çš„ç›¸åŒå…ƒç´ </td><td></td></tr><tr><td>sinter</td><td>æ±‚äº¤é›†</td><td></td></tr><tr><td>sunion</td><td>æ±‚å’Œé›†</td><td></td></tr></tbody></table><h4 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h4><p><code>Map&lt;String,ZSet&gt; map</code></p><blockquote><p>åŒºåˆ«äºSetï¼ŒZsetæ˜¯æœ‰åºçš„ã€‚</p></blockquote><p><img src="/Resources/Pasted%20image%2020220915150705.png"></p><p><strong>å¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>èŒƒä¾‹</th></tr></thead><tbody><tr><td>zadd</td><td>æ·»åŠ ä¸€ä¸ªæœ‰åºé›†åˆå…ƒç´ </td><td></td></tr><tr><td>zcard</td><td>è¿”å›é›†åˆçš„å…ƒç´ ä¸ªæ•°</td><td></td></tr><tr><td>zrangeå‡åº zrevrangeé™åº</td><td>è¿”å›ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td><td></td></tr><tr><td>zrangebyscore</td><td>æŒ‰ç…§åˆ†æ•°æŸ¥æ‰¾ä¸€ä¸ªèŒƒå›´å†…çš„å…ƒç´ </td><td></td></tr><tr><td>zrank</td><td>è¿”å›æ’å</td><td></td></tr><tr><td>zrevrank</td><td>å€’åºæ’å</td><td></td></tr><tr><td>zscore</td><td>æ˜¾ç¤ºæŸä¸€ä¸ªå…ƒç´ çš„åˆ†æ•°</td><td></td></tr><tr><td>zrem</td><td>ç§»é™¤æŸä¸€ä¸ªå…ƒç´ </td><td></td></tr><tr><td>zincrby*</td><td>ç»™æŸä¸ªç‰¹å®šå…ƒç´ åŠ åˆ†</td><td></td></tr></tbody></table><h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><p><code>Map&lt;String,Map&lt;String,value&gt;&gt; map</code><br><img src="/Resources/Pasted%20image%2020220915151206.png"></p><p><strong>å¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th><th>èŒƒä¾‹</th></tr></thead><tbody><tr><td>hset</td><td>è®¾ç½®ä¸€ä¸ªkey&#x2F;valueå¯¹</td><td></td></tr><tr><td>hget</td><td>è·å¾—ä¸€ä¸ªkeyå¯¹åº”çš„value</td><td></td></tr><tr><td>hgetall</td><td>è·å¾—æ‰€æœ‰çš„key&#x2F;valueå¯¹</td><td></td></tr><tr><td>hdel</td><td>åˆ é™¤æŸä¸€ä¸ªkey&#x2F;valueå¯¹</td><td></td></tr><tr><td>hexists</td><td>åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨</td><td></td></tr><tr><td>hkeys</td><td>è·å¾—æ‰€æœ‰çš„key</td><td></td></tr><tr><td>hvals</td><td>è·å¾—æ‰€æœ‰çš„value</td><td></td></tr><tr><td>hmsetè®¾ç½®å¤šä¸ªkey&#x2F;value</td><td></td><td></td></tr><tr><td>hmget</td><td>è·å¾—å¤šä¸ªkeyçš„value</td><td></td></tr><tr><td>hsetnxè®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„keyçš„å€¼</td><td></td><td></td></tr><tr><td>hincrbyä¸ºvalueè¿›è¡ŒåŠ æ³•è¿ç®—</td><td></td><td></td></tr><tr><td>hincrbyfloat</td><td>ä¸ºvalueåŠ å…¥æµ®ç‚¹å€¼</td><td></td></tr></tbody></table><h2 id="9ã€Redisçš„æŒä¹…åŒ–æœºåˆ¶"><a href="#9ã€Redisçš„æŒä¹…åŒ–æœºåˆ¶" class="headerlink" title="9ã€Redisçš„æŒä¹…åŒ–æœºåˆ¶"></a>9ã€Redisçš„æŒä¹…åŒ–æœºåˆ¶</h2><blockquote><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://redis.io/docs/manual/persistence/">Redis persistence | Redis</a></p></blockquote><p>Rediså®˜æ–¹æä¾›äº†ä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹æ³•æ¥å°†æ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜ï¼Œæ—¢å¯ä»¥åŒæ—¶ä½¿ç”¨(aof)ï¼Œåˆå¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œåœ¨æŸç§æƒ…å†µä¸‹ä¹Ÿå¯ä»¥éƒ½ä¸ä½¿ç”¨ï¼Œå…·ä½“ä½¿ç”¨é‚£ç§æŒä¹…åŒ–æ–¹æ¡ˆå–å†³äºç”¨æˆ·çš„æ•°æ®å’Œåº”ç”¨å†³å®šã€‚</p><blockquote><p>æ— è®ºä½¿ç”¨AOFè¿˜æ˜¯å¿«ç…§æœºåˆ¶æŒä¹…åŒ–ï¼Œå°†æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜éƒ½æ˜¯æœ‰å¿…è¦çš„ï¼Œé™¤äº†æŒä¹…åŒ–å¤–ï¼Œç”¨æˆ·è¿˜åº”è¯¥å¯¹æŒä¹…åŒ–çš„æ–‡ä»¶è¿›è¡Œå¤‡ä»½(æœ€å¥½å¤‡ä»½åœ¨å¤šä¸ªä¸åŒåœ°æ–¹)ã€‚</p></blockquote><ul><li>ROB(Redis Database Backup file)ï¼šä¿å­˜è¿™ä¸€æ—¶åˆ»çš„æ•°æ®çŠ¶æ€ï¼Œä¹Ÿè¢«å«åšRedisæ•°æ®å¤‡ä»½æ–‡ä»¶</li><li>AOF(<strong>Append Only File</strong>)ï¼šå°†æ‰€æœ‰rediså†™å‘½ä»¤è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</li><li><img src="/Resources/Pasted%20image%2020230531170507.png"></li></ul><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>è¿™ç§æ–¹å¼å¯ä»¥å°†æŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®éƒ½å†™å…¥ç¡¬ç›˜ä¸­ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯redisçš„<strong>é»˜è®¤æŒä¹…åŒ–æ–¹å¼</strong>ï¼Œä¿å­˜çš„æ–‡ä»¶æ˜¯ä»¥.rdbå½¢å¼ç»“å°¾çš„æ–‡ä»¶ï¼Œå› æ­¤è¿™ç§æ–¹å¼ä¹Ÿç§°ä¹‹ä¸ºRDBæ–¹å¼ã€‚<br><img src="/Resources/Pasted%20image%2020220915155813.png"><br><img src="/Resources/Pasted%20image%2020220915160528.png"></p><h4 id="å¿«ç…§ç”Ÿæˆæ–¹å¼"><a href="#å¿«ç…§ç”Ÿæˆæ–¹å¼" class="headerlink" title="å¿«ç…§ç”Ÿæˆæ–¹å¼"></a>å¿«ç…§ç”Ÿæˆæ–¹å¼</h4><ul><li>å®¢æˆ·ç«¯æ–¹å¼ï¼šBGSAVEå’ŒSAVEæŒ‡ä»¤</li><li>æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘</li></ul><h5 id="å®¢æˆ·ç«¯æ–¹å¼"><a href="#å®¢æˆ·ç«¯æ–¹å¼" class="headerlink" title="å®¢æˆ·ç«¯æ–¹å¼"></a>å®¢æˆ·ç«¯æ–¹å¼</h5><p><strong>BGSAVE</strong><br>å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨BGSAVEå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå½“æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„BGSAVEå‘½ä»¤æ—¶ï¼Œredisä¼šè°ƒç”¨forkæ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åå­è¿›ç¨‹è´Ÿè´£å°†å¿«ç…§å†™å…¥ç£ç›˜ä¸­ï¼Œè€Œçˆ¶è¿›ç¨‹åˆ™ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚<br>ç–‘é—®ï¼šå½“æ‰§è¡Œforkæ“ä½œæ—¶ï¼Œè¿›è¡Œäº†rediså†™æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®æ‹·è´äº†ä¸€ä»½ï¼Œå¯¹æ•°æ®å‰¯æœ¬Bè¿›è¡Œäº†å†™æ“ä½œï¼Œé‚£ä¹ˆä¹‹åæ˜¯æ€ä¹ˆå¤„ç†çš„<br><img src="/Resources/Pasted%20image%2020230531164423.png"></p><p><strong>SAVE</strong><br>å®¢æˆ·ç«¯è¿˜å¯ä»¥ä½¿ç”¨SAVEå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œæ¥æ”¶åˆ°SAVEå‘½ä»¤çš„redisæœåŠ¡å™¨åœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰å°†ä¸å†å“åº”ä»»ä½•å…¶ä»–çš„å‘½ä»¤<br><img src="/Resources/Pasted%20image%2020220915162455.png"></p><p>ğŸ””<strong>æ³¨æ„ï¼šSAVEå‘½ä»¤å¹¶ä¸å¸¸ç”¨ï¼Œä½¿ç”¨SAVEå‘½ä»¤åœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰ï¼Œrediså¤„äºé˜»å¡çŠ¶æ€,æ— æ³•å¯¹å¤–æœåŠ¡ã€‚</strong></p><h5 id="æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘"><a href="#æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘" class="headerlink" title="æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘"></a>æœåŠ¡å™¨é…ç½®è‡ªåŠ¨è§¦å‘</h5><p>å¦‚æœç”¨æˆ·åœ¨redis.confä¸­è®¾ç½®äº†saveé…ç½®é€‰é¡¹ï¼Œredisä¼šåœ¨saveé€‰é¡¹æ¡ä»¶æ»¡è¶³ä¹‹åè‡ªåŠ¨è§¦å‘ä¸€æ¬¡BGSAVEå‘½ä»¤ï¼Œå¦‚æœè®¾ç½®å¤šä¸ªsaveé…ç½®é€‰é¡¹ï¼Œå½“ä»»æ„ä¸€ä¸ªsaveé…ç½®é€‰é¡¹æ¡ä»¶æ»¡è¶³ï¼Œredisä¹Ÿä¼šè§¦å‘ä¸€æ¬¡BGSAVEå‘½ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs conf"># æ³¨è¯¥é…ç½®æ–‡ä»¶æ˜¯redis7çš„<br>################################ SNAPSHOTTING  ################################<br><br># Save the DB to disk. å°†æ•°æ®åº“ä¿å­˜åˆ°ç£ç›˜.<br>#<br># save &lt;seconds&gt; &lt;changes&gt; [&lt;seconds&gt; &lt;changes&gt; ...]<br>#<br># Redis will save the DB if the given number of seconds elapsed and it<br># surpassed the given number of write operations against the DB.<br># å¦‚æœç»è¿‡äº†ç»™å®šçš„ç§’æ•°ï¼Œå¹¶ä¸”è¶…è¿‡äº†é’ˆå¯¹DBçš„ç»™å®šå†™å…¥æ“ä½œæ•°ï¼ŒRediså°†æ•°æ®åº“ä¿å­˜åˆ°ç£ç›˜.<br>#<br># Snapshotting can be completely disabled with a single empty string argument<br># as in following example:<br># ä½¿ç”¨ save &quot;&quot; å³å¯ç¦ç”¨redisä¸­çš„Snapshotting<br>#<br># save &quot;&quot;<br>#<br># Unless specified otherwise, by default Redis will save the DB:<br>#   * After 3600 seconds (an hour) if at least 1 change was performed<br>#   * After 300 seconds (5 minutes) if at least 100 changes were performed<br>#   * After 60 seconds if at least 10000 changes were performed<br># é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™é»˜è®¤æƒ…å†µä¸‹Redisä¼šä¿å­˜æ•°æ®åº“ï¼š<br>#   è¿™é‡Œçš„ç¿»è¯‘ä¸»è¦å‡ºè‡ªäº https://redis.io/docs/management/persistence/#snapshotting ä¸­å…³äºrdbçš„è§£é‡Š<br>#   You can configure Redis to have it save the dataset <br>#   every N seconds if there are at least M changes in the dataset  å¦‚æœæ¯nç§’å‘ç”Ÿäº†mæ¬¡<br>#   , or you can manually call the SAVE or BGSAVE commands.<br>#   æ¯3600ç§’ï¼Œ1æ¬¡æ›´æ”¹<br>#   æ¯300ç§’ï¼Œ100æ¬¡æ›´æ”¹<br>#   æ¯60ç§’åï¼Œ10000æ¬¡æ›´æ”¹<br># <br># You can set these explicitly by uncommenting the following line.<br># æ‚¨å¯ä»¥é€šè¿‡å–æ¶ˆå¯¹ä»¥ä¸‹è¡Œçš„æ³¨é‡Šæ¥æ˜¾å¼è®¾ç½®è¿™äº›å€¼ã€‚<br>#<br># save 3600 1 300 100 60 10000<br><br><br># æ³¨è¯¥é…ç½®æ–‡ä»¶æ˜¯redis6.2çš„ï¼ŒåŸºæœ¬ä¸Šè·Ÿ7å·®ä¸å¤šï¼Œå°±ä¸å†ç¿»è¯‘äº†<br>################################ SNAPSHOTTING  ################################<br><br># Save the DB to disk.<br>#<br># save &lt;seconds&gt; &lt;changes&gt;<br>#<br># Redis will save the DB if both the given number of seconds and the given<br># number of write operations against the DB occurred.<br>#<br># Snapshotting can be completely disabled with a single empty string argument<br># as in following example:<br>#<br># save &quot;&quot;<br>#<br># Unless specified otherwise, by default Redis will save the DB:<br>#   * After 3600 seconds (an hour) if at least 1 key changed<br>#   * After 300 seconds (5 minutes) if at least 100 keys changed<br>#   * After 60 seconds if at least 10000 keys changed<br>#<br># You can set these explicitly by uncommenting the three following lines.<br>#<br># save 3600 1<br># save 300 100<br># save 60 10000<br></code></pre></td></tr></table></figure><h5 id="æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯shutdownæŒ‡ä»¤"><a href="#æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯shutdownæŒ‡ä»¤" class="headerlink" title="æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯shutdownæŒ‡ä»¤"></a>æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯shutdownæŒ‡ä»¤</h5><p>å½“redisé€šè¿‡shutdownæŒ‡ä»¤æ¥æ”¶åˆ°å…³é—­æœåŠ¡å™¨çš„è¯·æ±‚æ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªsaveå‘½ä»¤ï¼Œé˜»å¡æ‰€æœ‰çš„å®¢æˆ·ç«¯ï¼Œä¸å†æ‰§è¡Œå®¢æˆ·ç«¯æ‰§è¡Œå‘é€çš„ä»»ä½•å‘½ä»¤ï¼Œå¹¶ä¸”åœ¨saveå‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹åå…³é—­æœåŠ¡å™¨ã€‚</p><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>è¿™ç§æ–¹å¼å¯ä»¥å°†æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œçš„å†™å‘½ä»¤è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼ŒAOFæŒä¹…åŒ–ä¼šå°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤å†™åˆ°AOFçš„æ–‡ä»¶æœ«å°¾ï¼Œä»¥æ­¤æ¥è®°å½•æ•°æ®å‘ç”Ÿçš„å˜ï¼Œå› æ­¤åªè¦redisä»å¤´åˆ°å°¾æ‰§è¡Œä¸€æ¬¡AOFæ–‡ä»¶æ‰€åŒ…å«çš„æ‰€æœ‰å†™å‘½ä»¤ï¼Œå°±å¯ä»¥æ¢å¤AOFæ–‡ä»¶çš„è®°å½•çš„æ•°æ®é›†ã€‚</p><blockquote><p>å¼€å¯AOFæŒä¹…åŒ–å‚è€ƒï¼š<a href="../../../Develop/%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA/Docker%20%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E5%90%88%E9%9B%86.md#Redis%E6%8C%81%E4%B9%85%E5%8C%96">RedisæŒä¹…åŒ–</a><br>å¼€å¯åï¼Œå¤šäº†ä¸€ä¸ª<code>appendonly.aof</code>æ–‡ä»¶<br><img src="/Resources/Pasted%20image%2020220916164124.png"></p></blockquote><h4 id="æ—¥å¿—è¿½åŠ é¢‘ç‡"><a href="#æ—¥å¿—è¿½åŠ é¢‘ç‡" class="headerlink" title="æ—¥å¿—è¿½åŠ é¢‘ç‡"></a>æ—¥å¿—è¿½åŠ é¢‘ç‡</h4><p><strong>alwaysã€è°¨æ…ä½¿ç”¨ã€‘</strong></p><ul><li>è¯´æ˜ï¼šæ¯ä¸ªrediså†™å‘½ä»¤éƒ½è¦åŒæ­¥å†™å…¥ç¡¬ç›˜ï¼Œä¸¥é‡é™ä½redisé€Ÿåº¦</li><li>è§£é‡Šï¼šå¦‚æœç”¨æˆ·ä½¿ç”¨äº†alwaysé€‰é¡¹ï¼Œé‚£ä¹ˆæ¯ä¸ªrediså†™å‘½ä»¤éƒ½ä¼šè¢«å†™å…¥ç¡¬ç›˜ï¼Œä»è€Œå°†å‘ç”Ÿç³»ç»Ÿå´©æºƒæ—¶å‡ºç°çš„æ•°æ®ä¸¢å¤±å‡åˆ°æœ€å°‘ï¼›é—æ†¾çš„æ˜¯ï¼Œå› ä¸ºè¿™ç§åŒæ­¥ç­–ç•¥éœ€è¦å¯¹ç¡¬ç›˜è¿›è¡Œå¤§é‡çš„å†™å…¥æ“ä½œï¼Œæ‰€ä»¥rediså¤„ç†å‘½ä»¤çš„é€Ÿåº¦ä¼šå—åˆ°ç¡¬ç›˜æ€§èƒ½çš„é™åˆ¶ï¼›</li><li>æ³¨æ„ï¼šè½¬ç›˜å¼ç¡¬ç›˜åœ¨è¿™ç§é¢‘ç‡ä¸‹200å·¦å³ä¸ªå‘½ä»¤&#x2F;sï¼›å›ºæ€ç¡¬ç›˜(SSD)å‡ ç™¾ä¸‡ä¸ªå‘½ä»¤&#x2F;sï¼›</li><li>è­¦å‘Šï¼šä½¿ç”¨SSDç”¨æˆ·è¯·è°¨æ…ä½¿ç”¨alwaysé€‰é¡¹ï¼Œè¿™ç§æ¨¡å¼ä¸æ–­å†™å…¥å°‘é‡æ•°æ®çš„åšæ³•æœ‰å¯èƒ½ä¼šå¼•å‘ä¸¥é‡çš„<strong>å†™å…¥æ”¾å¤§</strong>ï¼ˆä¸æ–­å¾€ç£ç›˜å†™å…¥å°æ–‡ä»¶ï¼‰é—®é¢˜ï¼Œå¯¼è‡´å°†å›ºæ€ç¡¬ç›˜çš„å¯¿å‘½ä»åŸæ¥çš„å‡ å¹´é™ä½ä¸ºå‡ ä¸ªæœˆã€‚</li></ul><p><strong>everysecã€æ¨èã€‘ï¼ˆé»˜è®¤ï¼‰</strong></p><ul><li>è¯´æ˜ï¼šæ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥æ˜¾å¼çš„å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç£ç›˜</li><li>è§£é‡Šï¼šä¸ºäº†å…¼é¡¾æ•°æ®å®‰å…¨å’Œå†™å…¥æ€§èƒ½ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ä½¿ç”¨everysecé€‰é¡¹ï¼Œè®©redisæ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡å¯¹AOFæ–‡ä»¶è¿›è¡ŒåŒæ­¥ï¼›redisæ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶æ—¶æ€§èƒ½å’Œä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–ç‰¹æ€§æ—¶çš„æ€§èƒ½ç›¸å·®æ— å‡ ï¼Œè€Œé€šè¿‡æ¯ç§’åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶ï¼Œrediså¯ä»¥ä¿è¯ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æœ€å¤šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚</li></ul><p><strong>noã€ä¸æ¨èã€‘</strong></p><ul><li>è¯´æ˜ï¼šç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥</li><li>è§£é‡Šï¼šæœ€åä½¿ç”¨noé€‰é¡¹ï¼Œå°†å®Œå…¨ç”±æ“ä½œç³»ç»Ÿå†³å®šä»€ä¹ˆæ—¶å€™åŒæ­¥AOFæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸ªé€‰é¡¹ä¸ä¼šå¯¹redisæ€§èƒ½å¸¦æ¥å½±å“ã€‚ä½†æ˜¯ç³»ç»Ÿå´©æºƒæ—¶ï¼Œä¼šä¸¢å¤±ä¸å®šæ•°é‡çš„æ•°æ®ï¼Œå¦å¤–å¦‚æœç”¨æˆ·ç¡¬ç›˜å¤„ç†å†™å…¥æ“ä½œä¸å¤Ÿå¿«çš„è¯ï¼Œå½“ç¼“å†²åŒºè¢«ç­‰å¾…å†™å…¥ç¡¬ç›˜æ•°æ®å¡«æ»¡æ—¶ï¼Œredisä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œå¹¶å¯¼è‡´redisçš„å¤„ç†å‘½ä»¤è¯·æ±‚çš„é€Ÿåº¦å˜æ…¢ã€‚</li></ul><h4 id="AOFæ–‡ä»¶çš„é‡å†™"><a href="#AOFæ–‡ä»¶çš„é‡å†™" class="headerlink" title="AOFæ–‡ä»¶çš„é‡å†™"></a>AOFæ–‡ä»¶çš„é‡å†™</h4><h5 id="AOFå¸¦æ¥çš„é—®é¢˜"><a href="#AOFå¸¦æ¥çš„é—®é¢˜" class="headerlink" title="AOFå¸¦æ¥çš„é—®é¢˜"></a>AOFå¸¦æ¥çš„é—®é¢˜</h5><p>AOFçš„æ–¹å¼ä¹ŸåŒæ—¶å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚æŒä¹…åŒ–æ–‡ä»¶ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ã€‚ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨incr testå‘½ä»¤100æ¬¡ï¼Œæ–‡ä»¶ä¸­å¿…é¡»ä¿å­˜å…¨éƒ¨çš„100æ¡å‘½ä»¤ï¼Œå…¶å®æœ‰99æ¡éƒ½æ˜¯å¤šä½™çš„ã€‚å› ä¸ºè¦æ¢å¤æ•°æ®åº“çš„çŠ¶æ€å…¶å®æ–‡ä»¶ä¸­ä¿å­˜ä¸€æ¡set test 100å°±å¤Ÿäº†ã€‚ä¸ºäº†å‹ç¼©aofçš„æŒä¹…åŒ–æ–‡ä»¶ï¼ŒRedisæä¾›äº†<strong>AOFé‡å†™ï¼ˆReWriterï¼‰æœºåˆ¶</strong>ã€‚</p><h5 id="AOFé‡å†™æœºåˆ¶"><a href="#AOFé‡å†™æœºåˆ¶" class="headerlink" title="AOFé‡å†™æœºåˆ¶"></a>AOFé‡å†™æœºåˆ¶</h5><p><strong>å®¢æˆ·ç«¯æ–¹å¼è§¦å‘é‡å†™</strong></p><ul><li>æ‰§è¡Œ <code>BGREWRITEAOF</code> å‘½ä»¤ï¼ˆè¯¥å‘½ä»¤ä¸ä¼šé˜»å¡redisçš„æœåŠ¡ï¼‰</li></ul><p><strong>æœåŠ¡å™¨é…ç½®æ–¹å¼è‡ªåŠ¨è§¦å‘</strong></p><ul><li>é…ç½®<code>redis.conf</code>ä¸­çš„<code>auto-aof-rewrite-percentage</code>å’Œ<code>auto-aof-rewrite-min-size</code>é€‰é¡¹</li><li>å¦‚æœè®¾ç½®<code>auto-aof-rewrite-percentage 100</code>å’Œ<code>auto-aof-rewrite-min-size 64mb</code>ï¼Œå¹¶ä¸”å¯ç”¨çš„AOFæŒä¹…åŒ–æ—¶ï¼Œé‚£ä¹ˆå½“AOFæ–‡ä»¶ä½“ç§¯å¤§äº64Mï¼Œå¹¶ä¸”AOFæ–‡ä»¶çš„ä½“ç§¯æ¯”ä¸Šä¸€æ¬¡é‡å†™ä¹‹åä½“ç§¯å¤§äº†è‡³å°‘ä¸€å€(100%)æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ã€‚å¦‚æœé‡å†™è¿‡äºé¢‘ç¹ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘å°†<code>auto-aof-rewrite-percentage</code>è®¾ç½®ä¸ºæ›´å¤§ã€‚</li></ul><blockquote><p><code>auto-aof-rewrite-percentage</code>å’Œ<code>auto-aof-rewrite-min-size</code>å¯èƒ½è§£é‡Šä¸å¤ªå¯¹ï¼Œç¿»çœ‹å®˜æ–¹æ–‡æ¡£åéœ€è¦æŸ¥çœ‹é…ç½®æ–‡ä»¶è¯´æ˜<br><img src="/Resources/Pasted%20image%2020220919094207.png"></p><p>æŸ¥çœ‹é…ç½®æ–‡ä»¶è¯´æ˜<br><img src="/Resources/Pasted%20image%2020220919094655.png"></p></blockquote><h5 id="é‡å†™åŸç†"><a href="#é‡å†™åŸç†" class="headerlink" title="é‡å†™åŸç†"></a>é‡å†™åŸç†</h5><p>æ³¨æ„ï¼šé‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶ï¼Œè€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶ï¼Œæ›¿æ¢åŸæœ‰çš„æ–‡ä»¶ã€‚è¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚</p><p><strong>é‡å†™æµç¨‹</strong>ï¼š</p><ul><li><ol><li>redisè°ƒç”¨fork ï¼Œç°åœ¨æœ‰çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ï¼Œå­è¿›ç¨‹æ ¹æ®å†…å­˜ä¸­çš„æ•°æ®åº“å¿«ç…§ï¼Œå¾€ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥é‡å»ºæ•°æ®åº“çŠ¶æ€çš„å‘½ä»¤ã€‚</li></ol></li><li><ol start="2"><li>çˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†clientè¯·æ±‚ï¼Œé™¤äº†æŠŠå†™å‘½ä»¤å†™å…¥åˆ°åŸæ¥çš„aofæ–‡ä»¶ä¸­ã€‚åŒæ—¶æŠŠæ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯å¦‚æœå­è¿›ç¨‹é‡å†™å¤±è´¥çš„è¯å¹¶ä¸ä¼šå‡ºé—®é¢˜ã€‚</li></ol></li><li><ol start="3"><li>å½“å­è¿›ç¨‹æŠŠå¿«ç…§å†…å®¹å†™å…¥å·²å‘½ä»¤æ–¹å¼å†™åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­åï¼Œå­è¿›ç¨‹å‘ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹ã€‚ç„¶åçˆ¶è¿›ç¨‹æŠŠç¼“å­˜çš„å†™å‘½ä»¤ä¹Ÿå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚</li></ol></li><li><ol start="4"><li>ç°åœ¨çˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è€çš„aofæ–‡ä»¶ï¼Œå¹¶é‡å‘½åï¼Œåé¢æ”¶åˆ°çš„å†™å‘½ä»¤ä¹Ÿå¼€å§‹å¾€æ–°çš„aofæ–‡ä»¶ä¸­è¿½åŠ ã€‚</li></ol></li></ul><p><img src="/Resources/Pasted%20image%2020220919101504.png"></p><h2 id="10ã€Javaæ“ä½œRedis"><a href="#10ã€Javaæ“ä½œRedis" class="headerlink" title="10ã€Javaæ“ä½œRedis"></a>10ã€Javaæ“ä½œRedis</h2><h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><h3 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><p><a href="https://mvnrepository.com/">Maven Repository: Search&#x2F;Browse&#x2F;Explore</a><br>æœç´¢<code>jedis</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.76<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–ç æµ‹è¯•"><a href="#ç¼–ç æµ‹è¯•" class="headerlink" title="ç¼–ç æµ‹è¯•"></a>ç¼–ç æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPing</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        <span class="hljs-comment">// 1. new Jedis å¯¹è±¡å³å¯  </span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">6379</span>);  <br>        <span class="hljs-comment">// jedis æ‰€æœ‰çš„å‘½ä»Šå°±æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„æ‰€æœ‰æŒ‡ä»¤!  </span><br>        System.out.println(jedis.ping());  <br>    &#125;<br>&#125; <br>output:<br>PONG<br></code></pre></td></tr></table></figure><h3 id="å¸¸ç”¨çš„API"><a href="#å¸¸ç”¨çš„API" class="headerlink" title="å¸¸ç”¨çš„API"></a>å¸¸ç”¨çš„API</h3><h2 id="11-Springbootæ•´åˆRedis"><a href="#11-Springbootæ•´åˆRedis" class="headerlink" title="11. Springbootæ•´åˆRedis"></a>11. Springbootæ•´åˆRedis</h2><p>Spring Boot Data Redis ä¸­æä¾›äº† RedisTemplateå’ŒStringRedisTemplateã€‚<br>å…¶ä¸­StringRedisTemplateæ˜¯RedisTemplateçš„å­ç±»</p><ul><li><strong>RedisTemplate</strong><br>ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯Objectï¼Œæ„å‘³ç€å­˜å‚¨çš„keyå’Œvalue éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡</li><li><strong>StringRedisTemplate</strong><br>ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯String,æ„å‘³ç€StringRedisTemplateçš„keyå’Œvalueéƒ½åªèƒ½æ˜¯å­—ç¬¦ä¸²</li></ul><blockquote><p>æ³¨æ„ï¼šä½¿ç”¨RedisTemplateé»˜è®¤æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–åˆ°Redisä¸­ï¼Œæ‰€ä»¥æ”¾å…¥çš„å¯¹è±¡å¿…é¡»å®ç°å¯¹è±¡åºåˆ—åŒ–æ¥å£</p></blockquote><h3 id="1-å¼•å…¥ä¾èµ–"><a href="#1-å¼•å…¥ä¾èµ–" class="headerlink" title="1. å¼•å…¥ä¾èµ–"></a>1. å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--        Spring date redis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="1-é…ç½®applicaiton-yml"><a href="#1-é…ç½®applicaiton-yml" class="headerlink" title="1. é…ç½®applicaiton.yml"></a>1. é…ç½®applicaiton.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># redis  </span><br><span class="hljs-attr">redis:</span>  <br>  <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>  <br>  <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="2-æµ‹è¯•ä½¿ç”¨StringRedisTemplate"><a href="#2-æµ‹è¯•ä½¿ç”¨StringRedisTemplate" class="headerlink" title="2. æµ‹è¯•ä½¿ç”¨StringRedisTemplate"></a>2. æµ‹è¯•ä½¿ç”¨StringRedisTemplate</h3><p><code>opsForValue()</code>å°±æ˜¯<code>redis</code>ä¸­çš„<code>String</code><br><code>opsForList()</code>å°±æ˜¯<code>redis</code>ä¸­çš„<code>list</code><br><code>....</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestStringRedisTemplate</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ³¨å…¥SpringRedisTemplate</span><br><span class="hljs-comment">     * SpringRedisTemplateçš„keyå’Œvalueéƒ½æ˜¯Stringç±»å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ“ä½œredisä¸­keyç›¸å…³çš„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testKey</span><span class="hljs-params">()</span> &#123;<br><br>        <span class="hljs-comment">// åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">hasKey</span> <span class="hljs-operator">=</span> stringRedisTemplate.hasKey(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(hasKey);<br><br>        <span class="hljs-comment">// åˆ é™¤ä¸€ä¸ªkey</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">aBoolean</span> <span class="hljs-operator">=</span> stringRedisTemplate.delete(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(aBoolean);<br><br>        <span class="hljs-comment">// åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">hasKeys</span> <span class="hljs-operator">=</span> stringRedisTemplate.hasKey(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(hasKeys);<br><br>        <span class="hljs-comment">// åˆ¤æ–­keyå¯¹åº”å€¼çš„ç±»å‹</span><br>        <span class="hljs-type">DataType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> stringRedisTemplate.type(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(type);<br><br>        <span class="hljs-comment">// åˆ¤æ–­redisä¸­æ‰€æœ‰çš„key</span><br>        Set&lt;String&gt; keys = stringRedisTemplate.keys(<span class="hljs-string">&quot;*&quot;</span>);<br>        System.out.println(keys);<br><br>        <span class="hljs-comment">// è·å–keyå€¼çš„è¿‡æœŸäº‹ä»¶</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">expire</span> <span class="hljs-operator">=</span> stringRedisTemplate.getExpire(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(expire);<br><br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testList</span><span class="hljs-params">()</span> &#123;<br>        stringRedisTemplate.opsForList().leftPush(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;wtt&quot;</span>);<br>        stringRedisTemplate.opsForList().leftPushAll(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;wtt&quot;</span>, <span class="hljs-string">&quot;wttt&quot;</span>, <span class="hljs-string">&quot;wtttt&quot;</span>);<br>        <span class="hljs-comment">// åœ¨redis-cliä¸­æŸ¥çœ‹list ä½¿ç”¨LRANGE name 0 -1</span><br>        List&lt;String&gt; list = stringRedisTemplate.opsForList().range(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">assert</span> list != <span class="hljs-literal">null</span>;<br>        list.forEach(value -&gt; System.out.println(value));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSet</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºSet</span><br>        stringRedisTemplate.opsForSet().add(<span class="hljs-string">&quot;nameSet&quot;</span>, <span class="hljs-string">&quot;wt&quot;</span>,<span class="hljs-string">&quot;wtt&quot;</span>,<span class="hljs-string">&quot;wt&quot;</span>);<br>        <span class="hljs-comment">// æŸ¥çœ‹Set</span><br>        Set&lt;String&gt; set = stringRedisTemplate.opsForSet().members(<span class="hljs-string">&quot;nameSet&quot;</span>);<br>        <span class="hljs-keyword">assert</span> set != <span class="hljs-literal">null</span>;<br>        set.forEach(string-&gt; System.out.println(string));<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testZSet</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºZSet</span><br>        stringRedisTemplate.opsForZSet().add(<span class="hljs-string">&quot;zsets&quot;</span>, <span class="hljs-string">&quot;wt&quot;</span>,<span class="hljs-number">13</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testHash</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªhashç±»å‹å¹¶æ”¾å…¥key value</span><br>        stringRedisTemplate.opsForHash().put(<span class="hljs-string">&quot;maps&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;wtt&quot;</span>);<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ“ä½œredisä¸­å­—ç¬¦ä¸² opsForValueå®é™…æ“ä½œå°±æ˜¯redisä¸­çš„Stringç±» å‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// è®¾ç½®ä¸€ä¸ª key value</span><br>        stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;wtt&quot;</span>);<br>        <span class="hljs-comment">// è·å–key å¯¹åº”çš„value</span><br>        stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>);<br>        <span class="hljs-comment">// è®¾ç½®ä¸€ä¸ª key value expireTime</span><br>        stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;wtt&quot;</span>, <span class="hljs-number">120</span>, TimeUnit.SECONDS);<br>        <span class="hljs-comment">// è¿½åŠ value</span><br>        stringRedisTemplate.opsForValue().append(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;lihai&quot;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="3-æµ‹è¯•ä½¿ç”¨RedisTemplate"><a href="#3-æµ‹è¯•ä½¿ç”¨RedisTemplate" class="headerlink" title="3. æµ‹è¯•ä½¿ç”¨RedisTemplate"></a>3. æµ‹è¯•ä½¿ç”¨RedisTemplate</h3><p>![[redistemplate 2.png]]<br><code>RedisTemplate</code>å­˜è¿›<code>redis</code>ä¸­çš„æ•°æ®éƒ½æ˜¯ç»è¿‡åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥æ”¾å…¥çš„å¯¹è±¡å¿…é¡»å®ç°å¯¹è±¡åºåˆ—åŒ–æ¥å£ã€‚å› æ­¤ä½¿ç”¨<code>RedisTemplate</code>æ‹¿ä¸åˆ°é€šè¿‡<code>StringRedisTemplate</code>å­˜è¿›å»çš„æ•°æ®</p><hr><p>ä½†æ˜¯æˆ‘ä»¬å¸¸å¸¸ç”¨<code>String</code>è¡¨ç¤º<code>key</code>ï¼Œå¯¹è±¡è¡¨ç¤º<code>value</code>ï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹åºåˆ—åŒ–çš„æ–¹å¼ã€‚<br>é»˜è®¤çš„åºåˆ—åŒ–æ–¹å¼æ˜¯<code>JdkSerializationRedisSerializer</code><br>![[Pasted image 20220705194854.png]]</p><hr><p>ä¿®æ”¹é»˜è®¤åºåˆ—åŒ–æ–¹æ¡ˆ<br><code>redisTemplate.setKeySerializer(new StringRedisSerializer());</code></p><blockquote><p>ä½†æ˜¯å¯¹äºhashmapæ¥è¯´ï¼Œ![[Pasted image 20220705201037.png]]æœ‰ä¸¤ä¸ªkeyå€¼ï¼Œä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œåªä¼šä¿®æ”¹ç¬¬ä¸€ä¸ªkeyçš„é»˜è®¤åºåˆ—åŒ–æ–¹æ¡ˆï¼Œå› æ­¤å¦‚æœæƒ³ä¿®æ”¹ç¬¬äºŒä¸ªçš„é»˜è®¤åºåˆ—åŒ–æ–¹æ¡ˆï¼Œè¿˜éœ€è¦ä¿®æ”¹hashkeyçš„åºåˆ—åŒ–<code>redisTemplate.setHashKeySerializer(new StringRedisSerializer());</code></p></blockquote><h3 id="4-RedisTemplateå’ŒStringRedisTemplateçš„bound-api"><a href="#4-RedisTemplateå’ŒStringRedisTemplateçš„bound-api" class="headerlink" title="4. RedisTemplateå’ŒStringRedisTemplateçš„bound api"></a>4. RedisTemplateå’ŒStringRedisTemplateçš„bound api</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBound</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//spring data ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¯¹redisè¿›è¡Œæ›´å‹å¥½çš„æ“ä½œ å› æ­¤æä¾›äº†bound api ç®€åŒ–æ“ä½œ</span><br>    redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>    redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>    stringredisTemplate.opsForValue().set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;wtt&quot;</span>);<br>    stringredisTemplate.opsForValue().append(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;lihai!&quot;</span>);<br>    stringredisTemplate.opsForValue().get(<span class="hljs-string">&quot;name&quot;</span>);<br><br>    <span class="hljs-comment">//å¯¹å­—ç¬¦ä¸²ç±»å‹keyè¿›è¡Œç»‘å®šåç»­æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ªkeyçš„æ“ä½œ</span><br>    BoundValueOperations&lt;String, String&gt; name = stringredisTemplate.boundValueOps(<span class="hljs-string">&quot;name&quot;</span>);<br>    name.set(<span class="hljs-string">&quot;wtt&quot;</span>);<br>    name.append(<span class="hljs-string">&quot;lihailiahi!&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol><li>é’ˆå¯¹äºæ—¥åå¤„ç†çš„key value éƒ½æ˜¯ String ä½¿ç”¨ StringRedisTemplate </li><li>é’ˆå¯¹äºæ—¥åå¤„ç†çš„key value éƒ½æ˜¯å¯¹è±¡ä½¿ç”¨ RedisTemplate </li><li>é’ˆå¯¹äºåŒä¸€ä¸ªkeyå¤šæ¬¡æ“ä½œå¯ä»¥ä½¿ç”¨boundxxxOps () Value List Set Iset Hashçš„api ç®€åŒ–ä¹¦å†™</li></ol></blockquote><h2 id="12ã€Redisåº”ç”¨åœºæ™¯"><a href="#12ã€Redisåº”ç”¨åœºæ™¯" class="headerlink" title="12ã€Redisåº”ç”¨åœºæ™¯"></a>12ã€Redisåº”ç”¨åœºæ™¯</h2><ol><li>åˆ©ç”¨redisä¸­å­—ç¬¦ä¸²ç±»å‹å®Œæˆé¡¹ç›®ä¸­æ‰‹æœº<strong>éªŒè¯ç å­˜å‚¨</strong>çš„å®ç°</li><li>åˆ©ç”¨redisä¸­å­—ç¬¦ä¸²ç±»å‹å®Œæˆå…·æœ‰<strong>æ—¶æ•ˆæ€§ä¸šåŠ¡</strong>åŠŸèƒ½ï¼Œå¦‚è®¢å•è¶…æ—¶ï¼Œç”¨æˆ·ä¿¡æ¯token<ul><li>12306</li><li>æ·˜å®</li></ul></li><li>åˆ©ç”¨redisä¸­åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿ<strong>sessionå…±äº«</strong></li><li>åˆ©ç”¨redisä¸­çš„zsetç±»å‹ï¼Œå®ç°å¦‚<strong>æ’è¡Œæ¦œ</strong>ä¹‹ç±»åŠŸèƒ½ <ul><li>dangdangé”€é‡æ’è¡Œsales(zset)[å•†å“id,å•†å“é”€é‡]</li></ul></li><li>åˆ©ç”¨rediså®ç°<strong>åˆ†å¸ƒå¼ç¼“å­˜</strong></li><li>åˆ©ç”¨redisè§£å†³åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿä¸­<strong>åˆ†å¸ƒå¼é”é—®é¢˜</strong></li></ol><h3 id="åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸€ï¼‰"><a href="#åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸€ï¼‰" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸€ï¼‰"></a>åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸€ï¼‰</h3><ul><li><ol><li>ç¼“å­˜ï¼ˆCacheï¼‰ï¼šè®¡ç®—æœºå†…å­˜ä¸­çš„ä¸€æ®µæ•°æ®</li></ol></li><li><ol start="2"><li>ç‰¹ç‚¹</li></ol><ul><li>è¯»å†™å¿«</li><li>æ–­ç”µç«‹å³ä¸¢å¤±</li></ul></li><li><ol start="3"><li>è§£å†³é—®é¢˜</li></ol><ul><li>æé«˜ç½‘ç«™ååé‡æé«˜ç½‘ç«™è¿è¡Œæ•ˆç‡</li><li><strong>æ ¸å¿ƒè§£å†³é—®é¢˜</strong>ï¼šç¼“å­˜çš„å­˜åœ¨æ˜¯ç”¨æ¥å‡è½»æ•°æ®åº“è®¿é—®å‹åŠ›</li><li>æ³¨æ„ï¼šä½¿ç”¨ç¼“å­˜æ—¶ä¸€å®šæ˜¯æ•°æ®åº“ä¸­æ•°æ®<strong>æå°‘å‘ç”Ÿä¿®æ”¹</strong>ï¼Œæ›´å¤šç”¨äºæŸ¥è¯¢è¿™ç§æƒ…å†µï¼ˆæœ‰ç‚¹ç±»ä¼¼mysqlä¸­çš„ç´¢å¼•ï¼‰</li></ul></li><li><ol start="4"><li>æœ¬åœ°ç¼“å­˜ä¸åˆ†å¸ƒå¼ç¼“å­˜</li></ol><ul><li>æœ¬åœ°ç¼“å­˜ï¼ˆlocal cacheï¼‰<ul><li>å­˜åœ¨åº”ç”¨æœåŠ¡å™¨å†…å­˜ä¸­æ•°æ®ç§°ä¹‹ä¸ºæœ¬åœ°ç¼“å­˜</li><li>æœ¬åœ°ç¼“å­˜ä¼šéšç€åº”ç”¨çš„å…³é—­ä¸¢å¤±</li></ul></li><li>åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆdistribute cacheï¼‰<ul><li>å­˜å‚¨åœ¨å½“å‰åº”ç”¨æœåŠ¡å™¨å†…å­˜ä¹‹å¤–æ•°æ®ç§°ä¹‹ä¸ºåˆ†å¸ƒå¼ç¼“å­˜</li></ul></li><li>é›†ç¾¤<ul><li>å°†<strong>åŒä¸€ç§æœåŠ¡çš„å¤šä¸ªèŠ‚ç‚¹</strong>æ”¾åœ¨ä¸€èµ·å…±åŒå¯¹ç³»ç»Ÿæä¾›æœåŠ¡è¿‡ç¨‹ï¼Œç§°ä¹‹ä¸ºé›†ç¾¤</li></ul></li><li>åˆ†å¸ƒå¼<ul><li><strong>æœ‰å¤šä¸ªä¸åŒæœåŠ¡é›†ç¾¤</strong>åŠŸèƒ½å¯¹ç³»ç»Ÿæä¾›æœåŠ¡ï¼Œè¿™ä¸ªç³»ç»Ÿç§°ä¹‹ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿ</li></ul></li></ul></li><li><ol start="5"><li>åˆ©ç”¨mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜ç»“åˆrediså®ç°åˆ†å¸ƒå¼ç¼“å­˜</li></ol><ul><li>mybatisä¸­åº”ç”¨çº§ç¼“å­˜ï¼ˆäºŒçº§ç¼“å­˜ï¼‰  <ul><li>sqlsessionFactoryçº§åˆ«ç¼“å­˜  æ‰€æœ‰ä¼šè¯å…±äº«</li></ul></li><li>å¦‚ä½•å¼€å¯åº”ç”¨çº§ç¼“å­˜ï¼ˆäºŒçº§ç¼“å­˜ï¼‰<ul><li>åœ¨mapper.xmlä¸­åŠ å…¥æ ‡ç­¾<code>&lt;cache/&gt;</code></li></ul></li></ul></li></ul><h4 id="æ­å»ºMybatisæœ¬åœ°ç¼“å­˜ç¯å¢ƒ"><a href="#æ­å»ºMybatisæœ¬åœ°ç¼“å­˜ç¯å¢ƒ" class="headerlink" title="æ­å»ºMybatisæœ¬åœ°ç¼“å­˜ç¯å¢ƒ"></a>æ­å»ºMybatisæœ¬åœ°ç¼“å­˜ç¯å¢ƒ</h4><blockquote><p>åŸºæœ¬ç¯å¢ƒæ­å»ºå‚è€ƒï¼š<a href="../../Spring/SpringBoot/SpringBoot.md#%E5%9C%A8SpringBoot%E4%B8%AD%E9%9B%86%E6%88%90Mybatis">åœ¨SpringBootä¸­é›†æˆMybatis</a><br>æ³¨æ„ï¼šå¦‚æœè¦ä½¿ç”¨mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜ï¼Œentityå¯¹è±¡å¿…é¡»å®ç°å¯¹è±¡åºåˆ—åŒ–<code>implements Serializable</code>ï¼›</p></blockquote><ul><li><p>å¼€å¯mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜å‰<br><img src="/Resources/Pasted%20image%2020220919161137.png"></p></li><li><p>å¼€å¯mybatisè‡ªèº«æœ¬åœ°ç¼“å­˜åï¼ˆå¼€å¯æ–¹å¼å¦‚ä¸‹ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¼€å¯mybatisäºŒçº§ç¼“å­˜--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">cache</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;org.apache.ibatis.cache.impl.PerpetualCache&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!--ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æ•ˆæœç›¸åŒ--&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020220919161033.png"></p></li></ul><h4 id="æ­å»ºRedisåˆ†å¸ƒå¼ç¼“å­˜ç¯å¢ƒ"><a href="#æ­å»ºRedisåˆ†å¸ƒå¼ç¼“å­˜ç¯å¢ƒ" class="headerlink" title="æ­å»ºRedisåˆ†å¸ƒå¼ç¼“å­˜ç¯å¢ƒ"></a>æ­å»ºRedisåˆ†å¸ƒå¼ç¼“å­˜ç¯å¢ƒ</h4><p><img src="/Resources/Pasted%20image%2020220919164355.png"><br>é€šè¿‡æŸ¥çœ‹æºç å‘ç°ï¼Œmybatisä¸­çš„<code>PerpetualCache</code>ï¼Œå°†ç¼“å­˜putåˆ°å†…å­˜ä¸­ï¼Œä¸‹æ¬¡å–å¾—æ—¶å€™å†getï¼Œåº•å±‚ä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯<code>HashMap</code>ï¼Œå› æ­¤<strong>ä½¿ç”¨Redisåˆ†å¸ƒå¼ç¼“å­˜åªéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªCacheç±»å®ç°Cacheæ¥å£ï¼Œå¹¶å¯¹å…¶ä¸­çš„æ–¹æ³•æ¢æˆredisä¸­çš„æ–¹å¼å®ç°å³å¯</strong>ã€‚</p><p>æœ€åå†æŠŠtypeä¸­çš„ç±»åæ¢æˆè‡ªå®šä¹‰çš„Cacheç±»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xxxx&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h5 id="å®ç°get-put"><a href="#å®ç°get-put" class="headerlink" title="å®ç°get put"></a>å®ç°get put</h5><p>æ–°å»ºä¸€ä¸ª<code>RedisCache</code>å®ç°<code>Cache</code>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object o, Object o1)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">removeObject</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†typeä¸­çš„ç±»åæ¢æˆè‡ªå®šä¹‰çš„Cacheç±»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.cqupt.cache.RedisCache&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>è¿è¡ŒæŠ¥é”™<br><img src="/Resources/Pasted%20image%2020220919170356.png"></p><p>æŠ¥é”™ä¿¡æ¯ï¼šéœ€è¦å®šä¹‰ä¸€ä¸ªIDå’Œæ„é€ å™¨ï¼ˆä»¿ç…§mybatisçš„PerpetualCacheçš„ä»£ç æ·»åŠ idå’Œæ„é€ å™¨åå¹¶è¿è¡Œï¼‰<br><img src="/Resources/Pasted%20image%2020220919171051.png"></p><blockquote><p>é€šè¿‡æ§åˆ¶å°çš„ä¿¡æ¯å¯ä»¥å‘ç°ï¼šidæ˜¯mapperä¸­çš„namespace</p></blockquote><p>è¿è¡ŒæŠ¥é”™<br><img src="/Resources/Pasted%20image%2020220919170356.png"></p><p>æŠ¥é”™ä¿¡æ¯ï¼šnameå€¼ä¸èƒ½ä¸ºç©ºï¼Œé‚£ä¹ˆå€¼å°±æ˜¯idå°±æ˜¯mapperä¸­çš„namespaceï¼Œæ‰€ä»¥åªéœ€è¦å°†<code>return null</code>æ”¹ä¸º<code>return this.id</code>å³å¯ã€‚<br><img src="/Resources/Pasted%20image%2020220919172257.png"></p><p>ä»¥ä¸‹ä¸å†ä¸€ä¸€ä¸¾ä¾‹ï¼Œè§ä»£ç ä¸­æ³¨é‡Šè¯´æ˜ï¼›<br><img src="/Resources/Pasted%20image%2020220919173357.png"></p><p><code>RedisCache</code> è‡ªå®šä¹‰Cacheç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“å‰æ”¾å…¥ç¼“å­˜çš„mapperçš„namespace</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¿…é¡»å­˜åœ¨æ„é€ æ–¹æ³•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id å½“å‰æ”¾å…¥ç¼“å­˜çš„mapperçš„namespace</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisCache</span><span class="hljs-params">(String id)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;id======================&gt;&quot;</span> + id);<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›cacheå”¯ä¸€æ ‡è¯†</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.id;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡RedisTemplateæˆ–è€…StringRedisTemplateæŠŠå€¼æ”¾å…¥redis</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key key</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value value</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span><br><span class="hljs-comment">         * è¿™é‡Œä¸èƒ½ç›´æ¥ä½¿ç”¨</span><br><span class="hljs-comment">         * @autowired</span><br><span class="hljs-comment">         * private RedisTemplate redisTemplate</span><br><span class="hljs-comment">         * æ˜¯å› ä¸ºRedisCacheè¿™ä¸ªç±»æ˜¯ç”±mybatiså®ä¾‹åŒ–çš„ï¼Œè€Œä¸æ˜¯springå·¥å‚ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨æ³¨å…¥æ–¹å¼</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">RedisTemplate</span> <span class="hljs-variable">redisTemplate</span> <span class="hljs-operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);<br>        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * ä½¿ç”¨redis hashç±»å‹ä½œä¸ºç¼“å­˜å­˜å‚¨æ¨¡å‹&lt;key, &lt;hashKey,value&gt;&gt;</span><br><span class="hljs-comment">         * å…¶ä¸­keyæ˜¯mapperçš„namespace</span><br><span class="hljs-comment">         * hashKeyæ˜¯å…·ä½“çš„mapperä¸­çš„æŸä¸ªæ–¹æ³•</span><br><span class="hljs-comment">         * valueåˆ™æ˜¯æŸä¸ªæ–¹æ³•çš„è¿”å›å€¼</span><br><span class="hljs-comment">         */</span><br><br>        redisTemplate.opsForHash().put(id.toString(),key.toString(),value);<br><br>        System.out.println(<span class="hljs-string">&quot;key======================&gt;&quot;</span>+key.toString());<br>        System.out.println(<span class="hljs-string">&quot;value======================&gt;&quot;</span>+value);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> &#123;<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">RedisTemplate</span> <span class="hljs-variable">redisTemplate</span> <span class="hljs-operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);<br>        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         * æ ¹æ®keyä»redisè·å–æ•°æ®</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> redisTemplate.opsForHash().get(id.toString(), key.toString());<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">removeObject</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ApplicationContextUtils</code></p><blockquote><p>å¯¹ApplicationContextAwareä¸å¤Ÿäº†è§£ï¼ä¸”<code>å› ä¸ºRedisCacheè¿™ä¸ªç±»æ˜¯ç”±mybatiså®ä¾‹åŒ–çš„ï¼Œè€Œä¸æ˜¯springå·¥å‚ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨æ³¨å…¥æ–¹å¼</code>è¿™å¥è¯ä¹Ÿä¸å¤ªç†è§£ï¼Rediså­¦å®Œåï¼Œå¤ä¹ Spring5!</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·å–Springbootåˆ›å»ºå¥½çš„å·¥å‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationContextUtils</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextAware</span> &#123;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * ä¿ç•™ä¸‹æ¥çš„å·¥å‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ApplicationContext applicationContext;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†åˆ›å»ºå¥½çš„å·¥å‚ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ç»™è¿™ä¸ªç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> applicationContext å·¥å‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> BeansException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>        <span class="hljs-built_in">this</span>.applicationContext = applicationContext;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æä¾›å†å·¥å‚ä¸­è·å–å¯¹è±¡çš„æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String beanName)</span>&#123;<br>        <span class="hljs-keyword">return</span> applicationContext.getBean(beanName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>UserServiceTest</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        userService.findAll().forEach(System.out::println);<br><br>        userService.findAll().forEach(System.out::println);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°ç»“æœ<br><img src="/Resources/Pasted%20image%2020220919193626.png"></p><h5 id="å®ç°remove-clear"><a href="#å®ç°remove-clear" class="headerlink" title="å®ç°remove clear"></a>å®ç°remove clear</h5><p>Qï¼š<u>å¦‚æœåœ¨æŸ¥è¯¢çš„æ—¶å€™Redisä¸­æ­£å¥½æœ‰æ•°æ®ï¼Œä½†æ˜¯å‰ä¸€ç§’è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆä»Redisæ‹¿å‡ºæ¥çš„æ•°æ®å°±æ˜¯æ—§æ•°æ®ã€‚ç±»ä¼¼äºä»¥ä¸‹</u></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">find<br>modify<br>find<br></code></pre></td></tr></table></figure><p>Aï¼š<u>æ¯å½“è¿›è¡Œä¿®æ”¹çš„æ—¶å€™ï¼Œå°±æŠŠç¼“å­˜æ¸…é™¤ï¼Œå³è§¦å‘ä¸‹é¢çš„clearæ–¹æ³•(ä¸æ˜¯removeObjectï¼Œmybatisç‰ˆæœ¬ä¸º2.1.3)</u><br><strong>ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šclearæ¸…é™¤çš„æ˜¯keyä¸ºidï¼ˆnamespaceï¼‰çš„hashï¼Œå³æ¸…é™¤è¿™ä¸€ä¸ªmapperçš„æ‰€æœ‰ç¼“å­˜</strong></p><p>å®Œå–„ä¹‹å‰æ²¡æœ‰å†™å®Œçš„<code>removeObject</code>å’Œ<code>clear</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤ç¼“å­˜ï¼ˆmybatisç°åœ¨è¿˜æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œä»¥åå¯èƒ½ä¼šå®ç°ï¼‰</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> key key</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">removeObject</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¸…ç©ºç¼“å­˜</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">RedisTemplate</span> <span class="hljs-variable">redisTemplate</span> <span class="hljs-operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);<br>    redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>    redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * æ¸…ç©ºnamespace</span><br><span class="hljs-comment">     */</span><br>    redisTemplate.delete(id.toString());<br>&#125;<br></code></pre></td></tr></table></figure><p>Qï¼š<u>ä¸ºä»€ä¹ˆä½¿ç”¨clearï¼Œä¸æ ¹æ®æŒ‡å®šçš„keyåˆ é™¤å¯¹åº”çš„value</u><br>Aï¼š<img src="/Resources/Pasted%20image%2020220919204625.png"><br><u>ç»è¿‡æµ‹è¯•ï¼Œä¸åŒå‚æ•°å¯¹åº”çš„Keyæ˜¯ä¸åŒçš„ï¼Œå› æ­¤åº”è¯¥æ˜¯å¯ä»¥é€šè¿‡åªåˆ é™¤å¯¹åº”çš„valueçš„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨removeObjectæ–¹æ³•ï¼Œä½†æ˜¯mybatisé»˜è®¤å´æ²¡æœ‰å®ç°</u></p><h5 id="å®ç°getSize"><a href="#å®ç°getSize" class="headerlink" title="å®ç°getSize"></a>å®ç°getSize</h5><p>è¯¥æ–¹æ³•ç”¨äºè®¡ç®—ç¼“å­˜æ•°é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * é€šè¿‡applicationå·¥å…·ç±»è·å–redisTemplate</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">RedisTemplate</span> <span class="hljs-variable">redisTemplate</span> <span class="hljs-operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);<br>    redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>    redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br><br>    <span class="hljs-keyword">return</span> redisTemplate.opsForHash().size(id.toString()).intValue();<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æœ€åä¸€ç‚¹ï¼šä¼˜åŒ–è·å–redisTemplate"><a href="#æœ€åä¸€ç‚¹ï¼šä¼˜åŒ–è·å–redisTemplate" class="headerlink" title="æœ€åä¸€ç‚¹ï¼šä¼˜åŒ–è·å–redisTemplate"></a>æœ€åä¸€ç‚¹ï¼šä¼˜åŒ–è·å–redisTemplate</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> RedisTemplate <span class="hljs-title function_">getRedisTemplate</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">RedisTemplate</span> <span class="hljs-variable">redisTemplate</span> <span class="hljs-operator">=</span> (RedisTemplate) ApplicationContextUtils.getBean(<span class="hljs-string">&quot;redisTemplate&quot;</span>);<br>    redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>    redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>());<br>    <span class="hljs-keyword">return</span> redisTemplate;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆäºŒï¼‰"><a href="#åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆäºŒï¼‰" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆäºŒï¼‰"></a>åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆäºŒï¼‰</h3><p>å¦‚æœé¡¹ç›®ä¸­è¡¨æŸ¥è¯¢ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³è”æŸ¥è¯¢ï¼Œä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸€ï¼‰ä¸­çš„ç¼“å­˜æ–¹å¼æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><p><strong>ä½†æ˜¯å¦‚æœåœ¨è¡¨è¿æ¥æŸ¥è¯¢è¿‡ç¨‹ä¸­å°±ä¼šå­˜åœ¨ä¸€å®šçš„é—®é¢˜ï¼</strong></p><p>è§£å†³æ–¹å¼ï¼šå°†<code>&lt;cache&gt;</code>æ ‡ç­¾æ¢æˆ&#96;<cache-ref namespace="xxxx"/><br>æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š<strong>UserDaoå’ŒEmpDaoå…±äº«UserDaoçš„ç¼“å­˜</strong>ï¼Œå³EmpDaoä½¿ç”¨äº†UserDaoçš„idï¼ˆnamespaceï¼‰è¿›è¡Œå­˜å‚¨ã€‚<br><img src="/Resources/Pasted%20image%2020220920200751.png"></p><p>æµ‹è¯•<br><img src="/Resources/Pasted%20image%2020220920203940.png"></p><h3 id="åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸‰ï¼‰"><a href="#åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸‰ï¼‰" class="headerlink" title="åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸‰ï¼‰"></a>åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆä¸‰ï¼‰</h3><ol><li>ç¼“å­˜ä¼˜åŒ–ç­–ç•¥<br>å¯¹æ”¾å…¥redisä¸­çš„keyï¼ˆè¿™é‡Œçš„keyæŒ‡çš„æ˜¯hashkeyï¼ŒçœŸæ­£çš„keyæ˜¯namespaceï¼‰çš„é•¿åº¦è¿›è¡Œä¼˜åŒ–ï¼šå°½å¯èƒ½çš„å°†keyè®¾è®¡ç®€æ´<br><img src="/Resources/Pasted%20image%2020220920202718.png"><br><strong>ä½¿ç”¨MD5å¯¹keyè¿›è¡Œå¤„ç†</strong><br>MD5ç›¸å…³å‚è€ƒï¼š<a href="../../Shiro/Shiro%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B.md#6%20%E4%BD%BF%E7%94%A8MD5%20Salt%20Hash">ä½¿ç”¨MD5 Salt Hash</a></li></ol><p>ä¿®æ”¹<code>RedisCache</code>ä¸­çš„ä»£ç <br><img src="/Resources/Pasted%20image%2020220920205128.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†å†—é•¿çš„keyè½¬ä¸ºmd5</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> key key</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> md5</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getKeyToMd5</span><span class="hljs-params">(String key)</span>&#123;<br>    <span class="hljs-keyword">return</span> DigestUtils.md5DigestAsHex(key.getBytes());<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¹‹åå¦‚ä¸‹æ‰€ç¤º</p><ul><li>æ”¾<br><img src="/Resources/Pasted%20image%2020220920205226.png"></li><li>å–<br><img src="/Resources/Pasted%20image%2020220920205506.png"></li></ul><h3 id="ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿</h3><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/qq_45637260/article/details/125866738">è¯¦è§£ç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿</a></p></blockquote><h4 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h4><p>å¤§å¤šæ•°æƒ…å†µï¼Œç¼“å­˜å¯ä»¥å‡å°‘æ•°æ®åº“çš„æŸ¥è¯¢ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>é€šå¸¸æµç¨‹æ˜¯ï¼šä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œå…ˆæŸ¥è¯¢æ˜¯å¦åœ¨ç¼“å­˜å½“ä¸­ï¼Œå¦‚æœç¼“å­˜ä¸­å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨å¯¹åº”çš„æ•°æ®ï¼Œåˆ™æ£€ç´¢æ•°æ®åº“ï¼Œå¦‚æœæ•°æ®åº“ä¸­å­˜åœ¨å¯¹åº”çš„æ•°æ®ï¼Œåˆ™æ›´æ–°ç¼“å­˜å¹¶è¿”å›ç»“æœã€‚å¦‚æœæ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨å¯¹åº”çš„æ•°æ®ï¼Œåˆ™è¿”å›ç©ºæˆ–é”™è¯¯ã€‚</p><p>ç¼“å­˜ç©¿é€ï¼ˆcache penetrationï¼‰æ˜¯ç”¨æˆ·è®¿é—®çš„<strong>æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜å½“ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­</strong>ã€‚å‡ºäºå®¹é”™çš„è€ƒè™‘ï¼Œå¦‚æœä»åº•å±‚æ•°æ®åº“æŸ¥è¯¢ä¸åˆ°æ•°æ®ï¼Œåˆ™ä¸å†™å…¥ç¼“å­˜ã€‚è¿™å°±å¯¼è‡´<strong>æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ°åº•å±‚æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œç¼“å­˜ä¹Ÿå¤±å»äº†æ„ä¹‰</strong>ã€‚å½“é«˜å¹¶å‘æˆ–æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„Keyé¢‘ç¹æ”»å‡»æ—¶ï¼Œ<strong>æ•°æ®åº“çš„å‹åŠ›éª¤å¢</strong>ï¼Œç”šè‡³å´©æºƒï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜ç©¿é€</strong>é—®é¢˜ã€‚<br><img src="/Resources/Pasted%20image%2020230531111802.png"></p><ul><li><p>è§£å†³æ–¹æ¡ˆ1ï¼šç¼“å­˜ç©ºæ•°æ®ï¼ŒæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œä»æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œæ­¤æ—¶å¦‚æœå¾€æ•°æ®åº“æ’å…¥äº†æ•°æ®ï¼Œéœ€è¦æŠŠredisä¸­çš„æ•°æ®è¿›è¡Œæ›´æ–°</p><ul><li>è¿”å›å€¼ï¼š<code>&#123;key : 1, value : null&#125;</code></li><li>æ›´æ–°å€¼ï¼š<code>&#123;key : 1, value : 1&#125;</code></li><li>ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œæ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œå¯¼è‡´æ•°æ®åº“å·²ç»æœ‰ç»“æœäº†ï¼Œä½†æ˜¯redisä¸­è¿˜æ˜¯null</li></ul></li><li><p>è§£å†³æ–¹æ¡ˆ2ï¼š<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong></p><ul><li><img src="/Resources/Pasted%20image%2020230531111852.png"></li><li>å®ç°æ–¹æ¡ˆ<ul><li>Redissonï¼šå®ƒçš„åº•å±‚ä¸»è¦æ˜¯å…ˆå»åˆå§‹åŒ–ä¸€ä¸ªæ¯”è¾ƒå¤§æ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾çš„äºŒè¿›åˆ¶0æˆ–1ã€‚åœ¨ä¸€å¼€å§‹éƒ½æ˜¯0ï¼Œå½“ä¸€ä¸ªkeyæ¥äº†ä¹‹åç»è¿‡3æ¬¡hashè®¡ç®—ï¼Œæ¨¡äºæ•°ç»„é•¿åº¦æ‰¾åˆ°æ•°æ®çš„ä¸‹æ ‡ç„¶åæŠŠæ•°ç»„ä¸­åŸæ¥çš„0æ”¹ä¸º1ï¼Œè¿™æ ·çš„è¯ï¼Œä¸‰ä¸ªæ•°ç»„çš„ä½ç½®å°±èƒ½æ ‡æ˜ä¸€ä¸ªkeyçš„å­˜åœ¨ã€‚æŸ¥æ‰¾çš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</li><li><a href="https://github.com/redisson/redisson#quick-start">Javaå®ç°æ–¹æ³•å¦‚ä¸‹</a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>config.useSingleServer().setAddress(<span class="hljs-string">&quot;redis://127.0.0.1:6379&quot;</span>);<br>config.useSingleServer().setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br><span class="hljs-comment">//æ„é€ Redisson</span><br><span class="hljs-type">RedissonClient</span> <span class="hljs-variable">redisson</span> <span class="hljs-operator">=</span> Redisson.create(config);<br> <br>RBloomFilter&lt;String&gt; bloomFilter = redisson.getBloomFilter(<span class="hljs-string">&quot;phoneList&quot;</span>);<br><span class="hljs-comment">//åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„è®¡å…ƒç´ ä¸º100000000L,è¯¯å·®ç‡ä¸º3%</span><br>bloomFilter.tryInit(<span class="hljs-number">100000000L</span>,<span class="hljs-number">0.03</span>);<br><span class="hljs-comment">//å°†å·ç 10086æ’å…¥åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­</span><br>bloomFilter.add(<span class="hljs-string">&quot;10086&quot;</span>);<br> <br><span class="hljs-comment">//åˆ¤æ–­ä¸‹é¢å·ç æ˜¯å¦åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­</span><br>System.out.println(bloomFilter.contains(<span class="hljs-string">&quot;123456&quot;</span>));<span class="hljs-comment">//false</span><br>System.out.println(bloomFilter.contains(<span class="hljs-string">&quot;10086&quot;</span>));<span class="hljs-comment">//true</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li>Guava</li></ul></li><li>ç¼ºç‚¹ï¼šå¸ƒéš†è¿‡æ»¤å™¨æ˜¯é€šè¿‡æŸ¥è¯¢hashåçš„å€¼æ˜¯å¦ä¸º1ï¼Œå½“id1å’Œid2å°†1ã€3ã€7ã€9ã€12ã€14çš„å€¼æ›´æ”¹ä¸º1åï¼Œid3å¯¹åº”çš„3ã€9ã€12æ°å¥½ä¹Ÿä¸º1ï¼Œä½†å®é™…ä¸Šid3æ˜¯ä¸å­˜åœ¨çš„<ul><li><img src="/Resources/Pasted%20image%2020230531113240.png"></li><li>å­˜åœ¨è¯¯åˆ¤</li></ul></li></ul></li></ul><h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h4><p>åœ¨ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œé€šå¸¸ä¼šå¯¹ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸€æ–¹é¢ç›®çš„æ˜¯ä¿æŒç¼“å­˜ä¸æ•°æ®åº“æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦ä¸€æ–¹é¢æ˜¯å‡å°‘å†·ç¼“å­˜å ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ã€‚</p><p>ä½†å½“ç¼“å­˜ä¸­å¤§é‡çƒ­ç‚¹ç¼“å­˜é‡‡ç”¨äº†ç›¸åŒçš„å®æ•ˆæ—¶é—´ï¼Œå°±ä¼šå¯¼è‡´<strong>å¤§é‡ç¼“å­˜åœ¨æŸä¸€ä¸ªæ—¶åˆ»åŒæ—¶å®æ•ˆ</strong>ï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´<strong>æ•°æ®åº“å‹åŠ›éª¤å¢</strong>ï¼Œç”šè‡³å®•æœºã€‚ä»è€Œå½¢æˆä¸€ç³»åˆ—çš„è¿é”ååº”ï¼Œé€ æˆç³»ç»Ÿå´©æºƒç­‰æƒ…å†µï¼Œè¿™å°±æ˜¯<strong>ç¼“å­˜é›ªå´©</strong>ï¼ˆCache Avalancheï¼‰ã€‚</p><p><img src="/Resources/Pasted%20image%2020230531145859.png"></p><ul><li>è§£å†³æ–¹æ¡ˆï¼š<ul><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼šå“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥<ul><li>ngxinã€spring cloud gateway</li><li>é™çº§å¯åšä¸ºç³»ç»Ÿçš„ä¿åº•ç­–ç•¥ï¼Œé€‚ç”¨äºç©¿é€ã€å‡»ç©¿ã€é›ªå´©</li></ul></li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ï¼šGuavaã€Caffeine</li></ul></li></ul><h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡å¤§é‡çƒ­ç‚¹keyåŒæ—¶å¤±æ•ˆçš„æƒ…å†µï¼Œå¦‚æœæ˜¯<strong>å•ä¸ªçƒ­ç‚¹key</strong>ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œåœ¨è¿™ä¸ªkeyå¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘è¯·æ±‚å°±ä¼šå‡»ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚åˆ°æ•°æ®åº“ï¼Œå¥½åƒè›®åŠ›å‡»ç©¿ä¸€æ ·ã€‚è¿™ç§æƒ…å†µå°±æ˜¯<strong>ç¼“å­˜å‡»ç©¿</strong>ï¼ˆCache Breakdownï¼‰ã€‚</p><p><img src="/Resources/Pasted%20image%2020230531143625.png"></p><ul><li>è§£å†³æ–¹æ¡ˆ1ï¼šäº’æ–¥é”(<strong>å¼ºä¸€è‡´</strong>)</li><li>è§£å†³æ–¹æ¡ˆ2ï¼šé€»è¾‘è¿‡æœŸ(<strong>é«˜å¯ç”¨</strong>)</li><li><img src="/Resources/Pasted%20image%2020230531144701.png"></li></ul><p>ä»å®šä¹‰ä¸Šå¯ä»¥çœ‹å‡ºï¼Œç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©å¾ˆç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯ç¼“å­˜å‡»ç©¿æ˜¯ä¸€ä¸ªçƒ­ç‚¹keyå¤±æ•ˆï¼Œè€Œç¼“å­˜é›ªå´©æ˜¯å¤§é‡çƒ­ç‚¹keyå¤±æ•ˆã€‚å› æ­¤ï¼Œå¯ä»¥å°†ç¼“å­˜å‡»ç©¿çœ‹ä½œæ˜¯ç¼“å­˜é›ªå´©çš„ä¸€ä¸ªå­é›†ã€‚</p><h2 id="13ã€Redisä¸»ä»"><a href="#13ã€Redisä¸»ä»" class="headerlink" title="13ã€Redisä¸»ä»"></a>13ã€Redisä¸»ä»</h2><h3 id="ä¸»ä»æ¶æ„"><a href="#ä¸»ä»æ¶æ„" class="headerlink" title="ä¸»ä»æ¶æ„"></a>ä¸»ä»æ¶æ„</h3><p>å•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œå°±éœ€è¦æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚å› ä¸ºæ ¹æ®ç»éªŒï¼Œå¯¹Redisçš„æ“ä½œå¤§éƒ¨åˆ†éƒ½æ˜¯è¯»ï¼Œå†™æ“ä½œå å°‘æ•°ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤ä¸­é‡‡ç”¨è¯»å†™åˆ†ç¦»ï¼ŒåŒæ—¶ä»¥å°‘é‡ä¸»èŠ‚ç‚¹å’Œå¤§é‡ä»èŠ‚ç‚¹æ­é…ï¼Œå¤§å¤§æå‡Redisçš„è¯»å–æ€§èƒ½ã€‚<strong>ä¸»èŠ‚ç‚¹éœ€è¦æ³¨æ„çš„å°±æ˜¯æ•°æ®åŒæ­¥å¦‚ä½•åŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚</strong></p><h3 id="ä¸»ä»æ¶æ„å›¾"><a href="#ä¸»ä»æ¶æ„å›¾" class="headerlink" title="ä¸»ä»æ¶æ„å›¾"></a>ä¸»ä»æ¶æ„å›¾</h3><p><img src="/Resources/Pasted%20image%2020230601142227.png"></p><h3 id="æ­å»ºä¸»ä»æ¶æ„"><a href="#æ­å»ºä¸»ä»æ¶æ„" class="headerlink" title="æ­å»ºä¸»ä»æ¶æ„"></a>æ­å»ºä¸»ä»æ¶æ„</h3><p>ä½¿ç”¨dockeræ­å»ºredisä¸»ä»æ¶æ„<br>å‚è€ƒï¼š<a href="../../../Develop/%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA/Docker%20%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E5%90%88%E9%9B%86.md#1%20Master%20Slave">docker æ­å»ºredisä¸»ä»æ¶æ„</a></p><p><strong>ä¸»ä»å¤åˆ¶åŒæ­¥åŸç†</strong></p><ul><li>ä¸»ä»å…¨é‡åŒæ­¥<ul><li>Replication Idï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li><li>offsetï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li><li><img src="/Resources/Pasted%20image%2020230601143233.png"></li></ul></li><li>ä¸»ä»å¢é‡åŒæ­¥<ul><li><img src="/Resources/Pasted%20image%2020230601143341.png"></li><li><img src="/Resources/Pasted%20image%2020230601143359.png"></li></ul></li></ul><h2 id="14ã€Rediså“¨å…µæœºåˆ¶"><a href="#14ã€Rediså“¨å…µæœºåˆ¶" class="headerlink" title="14ã€Rediså“¨å…µæœºåˆ¶"></a>14ã€Rediså“¨å…µæœºåˆ¶</h2><h3 id="å“¨å…µSentinelæœºåˆ¶"><a href="#å“¨å…µSentinelæœºåˆ¶" class="headerlink" title="å“¨å…µSentinelæœºåˆ¶"></a>å“¨å…µSentinelæœºåˆ¶</h3><p>Sentinelï¼ˆå“¨å…µï¼‰æ˜¯Redisçš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªSentinelå®ä¾‹ç»„æˆçš„Sentinelç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç›‘è§†ä»»æ„å¤šä¸ªä¸»æœåŠ¡å™¨ï¼Œä»¥åŠè¿™äº›ä¸»æœåŠ¡å™¨å±ä¸‹çš„æ‰€æœ‰ä»æœåŠ¡å™¨ï¼Œå¹¶åœ¨è¢«ç›‘è§†çš„ä¸»æœåŠ¡å™¨è¿›å…¥ä¸‹çº¿çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨å°†ä¸‹çº¿ä¸»æœåŠ¡å™¨å±ä¸‹çš„æŸä¸ªä»æœåŠ¡å™¨å‡çº§ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚ç®€å•çš„è¯´<strong>å“¨å…µå°±æ˜¯å¸¦æœ‰è‡ªåŠ¨æ•…éšœè½¬ç§»åŠŸèƒ½çš„ä¸»ä»æ¶æ„</strong>ã€‚<br><img src="/Resources/Pasted%20image%2020230605095101.png"></p><p><strong>å“¨å…µæ¶æ„åŸç†</strong><br><img src="/Resources/Pasted%20image%2020220921164320.png"></p><blockquote><p>å¦‚æœæœ€åçš„masterè¢«ä¿®å¤äº†ä¹‹åï¼Œå°†æˆä¸ºæ–°çš„slaveèŠ‚ç‚¹ç»§ç»­åŠ å…¥redisé›†ç¾¤ï¼ˆSentinelç³»ç»Ÿï¼‰ä¸­ã€‚</p></blockquote><p><strong>å“¨å…µç›‘æ§æœºåˆ¶</strong><br><img src="/Resources/Pasted%20image%2020220921195400.png"></p><h3 id="å“¨å…µè„‘è£‚"><a href="#å“¨å…µè„‘è£‚" class="headerlink" title="å“¨å…µè„‘è£‚"></a>å“¨å…µè„‘è£‚</h3><p>é›†ç¾¤è„‘è£‚æ˜¯ç”±äºä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å’Œsentinelå¤„äºä¸åŒçš„ç½‘ç»œåˆ†åŒºï¼Œä½¿å¾—sentinelæ²¡æœ‰èƒ½å¤Ÿå¿ƒè·³æ„ŸçŸ¥åˆ°ä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡é€‰ä¸¾çš„æ–¹å¼æå‡äº†ä¸€ä¸ªä»èŠ‚ç‚¹ä¸ºä¸»ï¼Œè¿™æ ·å°±å­˜åœ¨äº†ä¸¤ä¸ªmasterï¼Œå°±åƒå¤§è„‘åˆ†è£‚äº†ä¸€æ ·ï¼Œè¿™æ ·ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿˜åœ¨è€çš„ä¸»èŠ‚ç‚¹é‚£é‡Œå†™å…¥æ•°æ®ï¼Œæ–°èŠ‚ç‚¹æ— æ³•åŒæ­¥æ•°æ®ï¼Œå½“ç½‘ç»œæ¢å¤åï¼Œsentinelä¼šå°†è€çš„ä¸»èŠ‚ç‚¹é™ä¸ºä»èŠ‚ç‚¹ï¼Œè¿™æ—¶å†ä»æ–°masteråŒæ­¥æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±</p><p><img src="/Resources/Pasted%20image%2020230605100402.png"></p><p><img src="/Resources/Pasted%20image%2020230605100349.png"><br>è§£å†³åŠæ³•ï¼šæˆ‘ä»¬å¯ä»¥ä¿®æ”¹redisçš„é…ç½®ï¼Œå¯ä»¥è®¾ç½®æœ€å°‘çš„ä»èŠ‚ç‚¹æ•°é‡ä»¥åŠç¼©çŸ­ä¸»ä»æ•°æ®åŒæ­¥çš„å»¶è¿Ÿæ—¶é—´ï¼Œè¾¾ä¸åˆ°è¦æ±‚å°±æ‹’ç»è¯·æ±‚ï¼Œå°±å¯ä»¥é¿å…å¤§é‡çš„æ•°æ®ä¸¢å¤±</p><p>redisä¸­æœ‰ä¸¤ä¸ªé…ç½®å‚æ•°ï¼š</p><p>min-replicas-to-write 1Â Â  è¡¨ç¤ºæœ€å°‘çš„salveèŠ‚ç‚¹ä¸º1ä¸ª</p><p>min-replicas-max-lag 5Â  è¡¨ç¤ºæ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡5ç§’</p><h3 id="æ­å»ºå“¨å…µæ¶æ„"><a href="#æ­å»ºå“¨å…µæ¶æ„" class="headerlink" title="æ­å»ºå“¨å…µæ¶æ„"></a>æ­å»ºå“¨å…µæ¶æ„</h3><p>å‚è€ƒï¼š<a href="../../../Develop/%E5%BC%80%E5%8F%91%E8%99%9A%E6%8B%9F%E6%9C%BA/Docker%20%E5%AE%89%E8%A3%85%E5%AE%B9%E5%99%A8%E5%90%88%E9%9B%86.md#2%20Redis%20Sentinel">2 Redis Sentinel</a></p><h3 id="Springbootæ“ä½œå“¨å…µæœºåˆ¶ä¸‹çš„Redis"><a href="#Springbootæ“ä½œå“¨å…µæœºåˆ¶ä¸‹çš„Redis" class="headerlink" title="Springbootæ“ä½œå“¨å…µæœºåˆ¶ä¸‹çš„Redis"></a>Springbootæ“ä½œå“¨å…µæœºåˆ¶ä¸‹çš„Redis</h3><blockquote><p>ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹çš„åªéœ€è¦åŠ ä¸€ä¸ªå¯†ç å°±å¯ä»¥äº†ï¼Œå…¶ä»–éƒ½ä¸éœ€è¦æ›´æ”¹ï¼</p></blockquote><h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8989</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-comment">#  å•èŠ‚ç‚¹</span><br>  <span class="hljs-comment">#  redis:</span><br>  <span class="hljs-comment">#    host: 192.168.153.135</span><br>  <span class="hljs-comment">#    password: redispwd</span><br>  <span class="hljs-comment">#  redis sentinelé…ç½®</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">redispwd</span><br>    <span class="hljs-attr">sentinel:</span><br>      <span class="hljs-comment"># masteræ˜¯ä½¿ç”¨å“¨å…µç›‘å¬çš„é‚£ä¸ªåç§°</span><br>      <span class="hljs-attr">master:</span> <span class="hljs-string">mymaster</span><br>      <span class="hljs-comment"># è¿æ¥çš„ä¸å†æ˜¯ä¸€ä¸ªå…·ä½“redisä¸»æœº,å†™çš„æ˜¯å¤šä¸ªå“¨å…µèŠ‚ç‚¹</span><br>      <span class="hljs-attr">nodes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.153</span><span class="hljs-number">.135</span><span class="hljs-string">:26379</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.153</span><span class="hljs-number">.135</span><span class="hljs-string">:26380</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.153</span><span class="hljs-number">.135</span><span class="hljs-string">:26381</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">redispwd</span><br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><ol><li><p>æ‰§è¡ŒæŸ¥è¯¢çš„å‘½ä»¤ï¼šä»æ•°æ®åº“æ‹¿æ•°æ®å¹¶ç¼“å­˜åˆ°redis<br><img src="/Resources/Pasted%20image%2020220922201818.png"></p></li><li><p>æ­¤æ—¶åœæ‰masteræœåŠ¡å™¨</p></li><li><p>å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢çš„å‘½ä»¤ï¼š<br>æŠ¥é”™è¿ä¸ä¸Šredisï¼ˆæ­¤æ—¶è¿æ¥çš„æ˜¯æ–°çš„masteræ‰¾ä¸åˆ°ï¼‰<br><img src="/Resources/Pasted%20image%2020220923091850.png"><br>æš‚æ—¶ä¸çŸ¥é“æ€ä¹ˆè§£å†³ï¼Œå¯è§†åŒ–å·¥å…·æ˜¯å¯ä»¥å®ç°ä¸»èŠ‚ç‚¹å®•æœºï¼Œä»èŠ‚ç‚¹å˜æˆä¸»èŠ‚ç‚¹ï¼Œå¹¶èƒ½å¤Ÿå®ç°ä¸»ä»å¤åˆ¶ï¼Œè¿™é‡Œå¯èƒ½æ˜¯é…ç½®æ–‡ä»¶å†™é”™äº†ï¼Œå¯¼è‡´å‡ºé—®é¢˜ï¼Œä¹‹åå†è§£å†³</p></li></ol><h2 id="15ã€Redisé›†ç¾¤"><a href="#15ã€Redisé›†ç¾¤" class="headerlink" title="15ã€Redisé›†ç¾¤"></a>15ã€Redisé›†ç¾¤</h2><p>Redisåœ¨3.0åå¼€å§‹æ”¯æŒClusterï¼ˆæ¨¡å¼ï¼‰æ¨¡å¼ï¼Œç›®å‰redisçš„é›†ç¾¤æ”¯æŒèŠ‚ç‚¹çš„è‡ªåŠ¨å‘ç°ï¼Œæ”¯æŒslave-masteré€‰ä¸¾å’Œå®¹é”™ï¼Œæ”¯æŒåœ¨çº¿åˆ†ç‰‡(sharding shard )ç­‰ç‰¹æ€§ã€‚</p><h2 id="16ã€åŒå†™ä¸€è‡´"><a href="#16ã€åŒå†™ä¸€è‡´" class="headerlink" title="16ã€åŒå†™ä¸€è‡´"></a>16ã€åŒå†™ä¸€è‡´</h2><p>åŒå†™ä¸€è‡´æ€§ï¼šå½“ä¿®æ”¹äº†æ•°æ®åº“çš„æ•°æ®ä¹Ÿè¦åŒæ—¶æ›´æ–°ç¼“å­˜çš„æ•°æ®ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®è¦ä¿æŒä¸€è‡´</p><h3 id="ä¸€è‡´æ€§è¦æ±‚é«˜"><a href="#ä¸€è‡´æ€§è¦æ±‚é«˜" class="headerlink" title="ä¸€è‡´æ€§è¦æ±‚é«˜"></a>ä¸€è‡´æ€§è¦æ±‚é«˜</h3><p>Redissonæä¾›çš„è¯»å†™é”</p><h3 id="å…è®¸å»¶è¿Ÿä¸€è‡´"><a href="#å…è®¸å»¶è¿Ÿä¸€è‡´" class="headerlink" title="å…è®¸å»¶è¿Ÿä¸€è‡´"></a>å…è®¸å»¶è¿Ÿä¸€è‡´</h3><p>å¼‚æ­¥é€šçŸ¥ä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§</p><p>åŸºäºMQçš„å¼‚æ­¥é€šçŸ¥ï¼š<br><img src="/Resources/Pasted%20image%2020230531153915.png"><br>åŸºäºCanalçš„å¼‚æ­¥é€šçŸ¥ï¼š<br><img src="/Resources/Pasted%20image%2020230531153939.png"></p><h2 id="17ã€æ•°æ®è¿‡æœŸç­–ç•¥"><a href="#17ã€æ•°æ®è¿‡æœŸç­–ç•¥" class="headerlink" title="17ã€æ•°æ®è¿‡æœŸç­–ç•¥"></a>17ã€æ•°æ®è¿‡æœŸç­–ç•¥</h2><p>Rediså¯¹æ•°æ®è®¾ç½®æ•°æ®çš„æœ‰æ•ˆæ—¶é—´ï¼Œæ•°æ®è¿‡æœŸä»¥åï¼Œå°±éœ€è¦å°†æ•°æ®ä»å†…å­˜ä¸­åˆ é™¤æ‰ã€‚å¯ä»¥æŒ‰ç…§ä¸åŒçš„è§„åˆ™è¿›è¡Œåˆ é™¤ï¼Œè¿™ç§åˆ é™¤è§„åˆ™å°±è¢«ç§°ä¹‹ä¸ºæ•°æ®çš„åˆ é™¤ç­–ç•¥ï¼ˆæ•°æ®è¿‡æœŸç­–ç•¥ï¼‰ã€‚</p><p>Redisçš„è¿‡æœŸåˆ é™¤ç­–ç•¥ï¼šæƒ°æ€§åˆ é™¤ + å®šæœŸåˆ é™¤ä¸¤ç§ç­–ç•¥è¿›è¡Œé…åˆä½¿ç”¨</p><ul><li>æƒ°æ€§åˆ é™¤<ul><li>è®¾ç½®è¯¥keyè¿‡æœŸæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å»ç®¡å®ƒï¼Œå½“éœ€è¦è¯¥keyæ—¶ï¼Œæˆ‘ä»¬åœ¨æ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œæˆ‘ä»¬å°±åˆ æ‰å®ƒï¼Œåä¹‹è¿”å›è¯¥key</li><li>ä¼˜ç‚¹ ï¼šå¯¹CPUå‹å¥½ï¼Œåªä¼šåœ¨ä½¿ç”¨è¯¥keyæ—¶æ‰ä¼šè¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œå¯¹äºå¾ˆå¤šç”¨ä¸åˆ°çš„keyä¸ç”¨æµªè´¹æ—¶é—´è¿›è¡Œè¿‡æœŸæ£€æŸ¥</li><li>ç¼ºç‚¹ ï¼šå¯¹å†…å­˜ä¸å‹å¥½ï¼Œå¦‚æœä¸€ä¸ªkeyå·²ç»è¿‡æœŸï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ä½¿ç”¨ï¼Œé‚£ä¹ˆè¯¥keyå°±ä¼šä¸€ç›´å­˜åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜æ°¸è¿œä¸ä¼šé‡Šæ”¾</li></ul></li><li>å®šæœŸåˆ é™¤<ul><li>æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å°±å¯¹ä¸€äº›keyè¿›è¡Œæ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢è¿‡æœŸçš„key(ä»ä¸€å®šæ•°é‡çš„æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„éšæœºkeyè¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkey)ã€‚</li><li>ä¸¤ç§æ¨¡å¼ï¼š<ul><li>SLOWæ¨¡å¼æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œé¢‘ç‡é»˜è®¤ä¸º10hzï¼Œæ¯æ¬¡ä¸è¶…è¿‡25msï¼Œä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>redis.conf</code> çš„ hz é€‰é¡¹æ¥è°ƒæ•´è¿™ä¸ªæ¬¡æ•°<br><img src="/Resources/Pasted%20image%2020230531172213.png"></li><li>lFASTæ¨¡å¼æ‰§è¡Œé¢‘ç‡ä¸å›ºå®šï¼Œä½†ä¸¤æ¬¡é—´éš”ä¸ä½äº2msï¼Œæ¯æ¬¡è€—æ—¶ä¸è¶…è¿‡1ms</li></ul></li><li>ä¼˜ç‚¹ï¼šå¯ä»¥é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU çš„å½±å“ã€‚å¦å¤–å®šæœŸåˆ é™¤ï¼Œä¹Ÿèƒ½æœ‰æ•ˆé‡Šæ”¾è¿‡æœŸé”®å ç”¨çš„å†…å­˜ã€‚</li><li>ç¼ºç‚¹ï¼šéš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ã€‚</li></ul></li></ul><h2 id="18ã€æ•°æ®æ·˜æ±°ç­–ç•¥"><a href="#18ã€æ•°æ®æ·˜æ±°ç­–ç•¥" class="headerlink" title="18ã€æ•°æ®æ·˜æ±°ç­–ç•¥"></a>18ã€æ•°æ®æ·˜æ±°ç­–ç•¥</h2><p>æ•°æ®çš„æ·˜æ±°ç­–ç•¥ï¼šå½“Redisä¸­çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œæ­¤æ—¶åœ¨å‘Redisä¸­æ·»åŠ æ–°çš„keyï¼Œé‚£ä¹ˆRediså°±ä¼šæŒ‰ç…§æŸä¸€ç§è§„åˆ™å°†å†…å­˜ä¸­çš„æ•°æ®åˆ é™¤æ‰ï¼Œè¿™ç§æ•°æ®çš„åˆ é™¤è§„åˆ™è¢«ç§°ä¹‹ä¸ºå†…å­˜çš„æ·˜æ±°ç­–ç•¥ã€‚</p><p><img src="/Resources/Pasted%20image%2020230531173256.png"></p><p>Redisæ”¯æŒ8ç§ä¸åŒç­–ç•¥æ¥é€‰æ‹©è¦åˆ é™¤çš„keyï¼š</p><ul><li>noevictionï¼š ä¸æ·˜æ±°ä»»ä½•keyï¼Œä½†æ˜¯å†…å­˜æ»¡æ—¶ä¸å…è®¸å†™å…¥æ–°æ•°æ®ï¼Œ<strong>é»˜è®¤å°±æ˜¯è¿™ç§ç­–ç•¥</strong>ã€‚</li><li>volatile-ttlï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼Œæ¯”è¾ƒkeyçš„å‰©ä½™TTLå€¼ï¼ŒTTLè¶Šå°è¶Šå…ˆè¢«æ·˜æ±°</li><li>allkeys-randomï¼šå¯¹å…¨ä½“key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚</li><li>volatile-randomï¼šå¯¹è®¾ç½®äº†TTLçš„key ï¼Œéšæœºè¿›è¡Œæ·˜æ±°ã€‚</li><li>allkeys-lruï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</li><li>volatile-lruï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLRUç®—æ³•è¿›è¡Œæ·˜æ±°</li><li>allkeys-lfuï¼š å¯¹å…¨ä½“keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</li><li>volatile-lfuï¼š å¯¹è®¾ç½®äº†TTLçš„keyï¼ŒåŸºäºLFUç®—æ³•è¿›è¡Œæ·˜æ±°</li></ul><p>LRUï¼ˆLeast <strong>Recently</strong> Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚ç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œè¿™ä¸ªå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><p>LFUï¼ˆLeast <strong>Frequently</strong> Usedï¼‰æœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚ä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><p>ä½¿ç”¨å»ºè®®ï¼š<br>1.ä¼˜å…ˆä½¿ç”¨ allkeys-lru ç­–ç•¥ã€‚å……åˆ†åˆ©ç”¨ LRU ç®—æ³•çš„ä¼˜åŠ¿ï¼ŒæŠŠæœ€è¿‘æœ€å¸¸è®¿é—®çš„æ•°æ®ç•™åœ¨ç¼“å­˜ä¸­ã€‚å¦‚æœä¸šåŠ¡æœ‰æ˜æ˜¾çš„å†·çƒ­æ•°æ®åŒºåˆ†ï¼Œå»ºè®®ä½¿ç”¨ã€‚</p><p>2.å¦‚æœä¸šåŠ¡ä¸­æ•°æ®è®¿é—®é¢‘ç‡å·®åˆ«ä¸å¤§ï¼Œæ²¡æœ‰æ˜æ˜¾å†·çƒ­æ•°æ®åŒºåˆ†ï¼Œå»ºè®®ä½¿ç”¨ allkeys-randomï¼Œéšæœºé€‰æ‹©æ·˜æ±°ã€‚</p><p>3.å¦‚æœä¸šåŠ¡ä¸­æœ‰ç½®é¡¶çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ volatile-lru ç­–ç•¥ï¼ŒåŒæ—¶ç½®é¡¶æ•°æ®ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™äº›æ•°æ®å°±ä¸€ç›´ä¸è¢«åˆ é™¤ï¼Œä¼šæ·˜æ±°å…¶ä»–è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®ã€‚</p><p>4.å¦‚æœä¸šåŠ¡ä¸­æœ‰çŸ­æ—¶é«˜é¢‘è®¿é—®çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ allkeys-lfu æˆ– volatile-lfu ç­–ç•¥ã€‚</p><h2 id="19ã€åˆ†å¸ƒå¼é”"><a href="#19ã€åˆ†å¸ƒå¼é”" class="headerlink" title="19ã€åˆ†å¸ƒå¼é”"></a>19ã€åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”ä½¿ç”¨çš„åœºæ™¯ï¼šé›†ç¾¤æƒ…å†µä¸‹çš„å®šæ—¶ä»»åŠ¡ã€æŠ¢å•ã€å¹‚ç­‰æ€§åœºæ™¯</p><p>æŠ¢åˆ¸åœºæ™¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ¢è´­ä¼˜æƒ åˆ¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rushToPurchase</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-comment">//è·å–ä¼˜æƒ åˆ¸æ•°é‡</span><br><span class="hljs-type">Integer</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(<span class="hljs-string">&quot;num&quot;</span>);<br><span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æŠ¢å®Œ</span><br><span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == num || num &lt;= <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ä¼˜æƒ åˆ¸å·²æŠ¢å®Œ&quot;</span>);<br>&#125;<br><span class="hljs-comment">//ä¼˜æƒ åˆ¸æ•°é‡å‡ä¸€ï¼Œè¯´æ˜æŠ¢åˆ°äº†ä¼˜æƒ åˆ¸</span><br>num = num - <span class="hljs-number">1</span>;<br><span class="hljs-comment">// é‡æ–°è®¾ç½®ä¼˜æƒ åˆ¸çš„æ•°é‡</span><br>redisTemplate.opsForValue().set(<span class="hljs-string">&quot;num&quot;</span>, num);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ï¼Œä¼šå¯¼è‡´è¶…å–ç°è±¡ï¼Œå¦‚åº“å­˜ä¸º1çš„ä¼˜æƒ åˆ¸ï¼Œç»è¿‡ä¸¤ä¸ªçº¿ç¨‹çš„æ‰§è¡Œåï¼Œåº“å­˜å°±ä¼šå˜æˆ-1<br><img src="/Resources/Pasted%20image%2020230601095723.png"></p><p>åŠ é”ï¼šä½¿ç”¨synchronizedå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä½†è¿™ç§é”ï¼ˆæœ¬åœ°é”ï¼‰åªé€‚ç”¨äºå•ä½“åº”ç”¨ï¼Œåªèƒ½åœ¨å•ä¸ªjvmä¸­ç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ¢è´­ä¼˜æƒ åˆ¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rushToPurchase</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br><span class="hljs-comment">//è·å–ä¼˜æƒ åˆ¸æ•°é‡</span><br><span class="hljs-type">Integer</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(<span class="hljs-string">&quot;num&quot;</span>);<br><span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æŠ¢å®Œ</span><br><span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == num || num &lt;= <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ä¼˜æƒ åˆ¸å·²æŠ¢å®Œ&quot;</span>);<br>&#125;<br><span class="hljs-comment">//ä¼˜æƒ åˆ¸æ•°é‡å‡ä¸€ï¼Œè¯´æ˜æŠ¢åˆ°äº†ä¼˜æƒ åˆ¸</span><br>num = num - <span class="hljs-number">1</span>;<br><span class="hljs-comment">// é‡æ–°è®¾ç½®ä¼˜æƒ åˆ¸çš„æ•°é‡</span><br>redisTemplate.opsForValue().set(<span class="hljs-string">&quot;num&quot;</span>, num);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨synchronizedï¼Œå¤šä¸ªtomcatä»»ç„¶ä¼šå‡ºç°è¶…å–é—®é¢˜</p><p><img src="/Resources/Pasted%20image%2020230601100459.png"></p><p>åˆ†å¸ƒå¼é”<br><img src="/Resources/Pasted%20image%2020230601101303.png"></p><p>å®ç°ï¼š<br>Rediså®ç°åˆ†å¸ƒå¼é”ä¸»è¦åˆ©ç”¨Redisçš„setnxå‘½ä»¤ã€‚setnxæ˜¯SET if not exists(å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ SET)çš„ç®€å†™ã€‚<br><img src="/Resources/Pasted%20image%2020230601102342.png"><br>æ³¨æ„ï¼š<br>Q:å¦‚æœä¸è®¾ç½®æ—¶é—´ï¼Œå¯èƒ½ä¼šå› ä¸ºä¸šåŠ¡è¶…æ—¶æˆ–è€…æœåŠ¡å®•æœºå‡ºç°æ­»é”ï¼Œå› ä¸ºæ— æ³•é‡Šæ”¾é”<br>Q:å¦‚æœè®¾ç½®æ—¶é—´è¿‡çŸ­ï¼Œä¸šåŠ¡æ²¡æœ‰ç»“æŸå°±è¢«è‡ªåŠ¨åˆ é™¤äº†</p><p>A1:è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†å…·ä½“æ•°å€¼éœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡è®¾ç½®<br>A2:ç»™é”ç»­æœŸï¼šä½¿ç”¨redissonå®ç°çš„åˆ†å¸ƒå¼é”</p><p>redissonå®ç°çš„åˆ†å¸ƒå¼é”:åŠ é”å’Œè®¾ç½®è¿‡æœŸæ—¶é—´æ˜¯åŸºäºluaè„šæœ¬ï¼ˆLuaè„šæœ¬æ˜¯rediså·²ç»å†…ç½®çš„ä¸€ç§è½»é‡å°å·§è¯­è¨€ï¼Œå…¶æ‰§è¡Œæ˜¯é€šè¿‡redisçš„<strong>eval</strong>Â &#x2F; <strong>evalsha</strong>Â å‘½ä»¤æ¥è¿è¡Œï¼ŒæŠŠæ“ä½œå°è£…æˆä¸€ä¸ªLuaè„šæœ¬ï¼Œ<del>å¦‚è®ºå¦‚ä½•éƒ½æ˜¯ä¸€æ¬¡æ‰§è¡Œçš„åŸå­æ“ä½œ</del>ï¼Œä¸è¿‡ï¼Œå¦‚æœ Lua è„šæœ¬è¿è¡Œæ—¶å‡ºé”™å¹¶ä¸­é€”ç»“æŸï¼Œå‡ºé”™ä¹‹åçš„å‘½ä»¤æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚å¹¶ä¸”ï¼Œå‡ºé”™ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æ˜¯æ— æ³•è¢«æ’¤é”€çš„ï¼Œæ— æ³•å®ç°ç±»ä¼¼å…³ç³»å‹æ•°æ®åº“æ‰§è¡Œå¤±è´¥å¯ä»¥å›æ»šçš„é‚£ç§åŸå­æ€§æ•ˆæœã€‚å³ï¼Œå¯ä»¥çœ‹ä½œæ˜¯åŸå­æ“ä½œï¼Œ<strong>ä½†ä¸¥æ ¼æ¥è¯´çš„è¯ï¼Œä¸å®Œå…¨æ»¡è¶³åŸå­æ€§ã€‚</strong>ï¼‰å®ç°çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedissonClient redissonClient;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">redisLock</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-comment">// è·å–é”ï¼ˆé‡å…¥é”ï¼‰ï¼Œæ‰§è¡Œé”çš„åç§°</span><br><span class="hljs-type">RLock</span> <span class="hljs-variable">rLock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockName);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">// å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯:è·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span><br><span class="hljs-comment">// boolean isLock = lock.tryLock(10ï¼Œ30ï¼ŒTimeUnit.SECONDS) ;</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">isLocked</span> <span class="hljs-operator">=</span> rLock.tryLock(expireTime, TimeUnit.MILLISECONDS);<br><span class="hljs-keyword">if</span> (isLocked) &#123;<br><span class="hljs-comment">// TODO</span><br>&#125;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-comment">// é‡Šæ”¾é”</span><br>rLock.unlock();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Resources/Pasted%20image%2020230601103935.png"></p><p>redissonå®ç°çš„åˆ†å¸ƒå¼é”-å¯é‡å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add1</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;heimalock&quot;</span>);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock();<br><span class="hljs-comment">//æ‰§è¡Œä¸šåŠ¡</span><br>add2();<br><span class="hljs-comment">//é‡Šæ”¾é”</span><br>lock.unlock();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add2</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;heimalock&quot;</span>);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock();<br><span class="hljs-comment">//æ‰§è¡Œä¸šåŠ¡</span><br><span class="hljs-comment">//é‡Šæ”¾é”</span><br>lock.unlock();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œadd1åˆ›å»ºçš„é”ï¼Œadd2ä¹Ÿå¯ä»¥æ‹¿åˆ°ç»§ç»­ç”¨ï¼ˆå› ä¸ºæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œå› ä¸ºredissonå®ç°çš„åˆ†å¸ƒå¼é”æ˜¯å¯é‡å…¥çš„ï¼Œåº•å±‚ç»´æŠ¤äº†hashç»“æ„ï¼Œå½“æ‰§è¡Œadd1çš„æ—¶å€™ï¼Œé‡å…¥æ¬¡æ•°ä¸º1<br><img src="/Resources/Pasted%20image%2020230601110132.png"><br>å½“æ‰§è¡Œadd2çš„æ—¶å€™ï¼Œé‡å…¥æ¬¡æ•°ä¸º2<br>å½“æ‰§è¡Œå®Œæˆadd2çš„æ—¶å€™ï¼Œé‡å…¥æ¬¡æ•°ä¸º1<br>å½“æ‰§è¡Œå®Œæˆadd1çš„æ—¶å€™ï¼Œé‡å…¥æ¬¡æ•°ä¸º0ï¼›<br>Qï¼šä¸ºä»€ä¹ˆadd1é‡Œé¢åŠ é”ï¼Œadd2è¿˜è¦åŠ é”å‘¢ï¼Ÿ<br>Aï¼šå› ä¸ºadd2ä¸æ˜¯åªä¼šåœ¨add1é‡Œé¢è°ƒç”¨</p><p>redissonå®ç°çš„åˆ†å¸ƒå¼é”-ä¸»ä»ä¸€è‡´æ€§<br>å½“javaåº”ç”¨è·å–é”æ—¶ï¼ŒmasterèŠ‚ç‚¹å®•æœºäº†<br><img src="/Resources/Pasted%20image%2020230601112840.png"></p><p>æ­¤æ—¶redisä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œç”±äºä¹‹å‰çš„masterå®•æœºäº†ï¼Œè¿˜æ²¡æ¥å¾—åŠæ•°æ®åŒæ­¥ï¼Œæ­¤æ—¶å¦å¤–ä¸€ä¸ªjavaåº”ç”¨è·å–äº†é”ï¼Œé‚£ä¹ˆç°åœ¨å°±ä¼šæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰ä¸€æŠŠé”<br><img src="/Resources/Pasted%20image%2020230601112932.png"></p><p>è§£å†³ï¼š<br><img src="/Resources/Pasted%20image%2020230601113203.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Redis&quot;&gt;&lt;a href=&quot;#Redis&quot; class=&quot;headerlink&quot; title=&quot;Redis&quot;&gt;&lt;/a&gt;Redis&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://redis.io/&quot;&gt;Redis - è‹±æ–‡å®˜ç½‘&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;h</summary>
      
    
    
    
    <category term="Database" scheme="http://conquers.github.io/categories/Database/"/>
    
    <category term="Redis" scheme="http://conquers.github.io/categories/Database/Redis/"/>
    
    
    <category term="Redis" scheme="http://conquers.github.io/tags/Redis/"/>
    
  </entry>
  
</feed>
